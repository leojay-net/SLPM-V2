(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,387921,991548,137486,982008,e=>{"use strict";e.s(["default",()=>c],387921);var t=e.i(843476),o=e.i(271645),n=e.i(914685);let a=o.forwardRef(function(e,t){let{title:n,titleId:a,...i}=e;return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},i),n?o.createElement("title",{id:a},n):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5Z"}))}),i=o.forwardRef(function(e,t){let{title:n,titleId:a,...i}=e;return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},i),n?o.createElement("title",{id:a},n):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 5.25a3 3 0 0 1 3 3m3 0a6 6 0 0 1-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1 1 21.75 8.25Z"}))});var r=e.i(685249);let s=o.forwardRef(function(e,t){let{title:n,titleId:a,...i}=e;return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},i),n?o.createElement("title",{id:a},n):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m0-10.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.75c0 5.592 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.57-.598-3.75h-.152c-3.196 0-6.1-1.25-8.25-3.286Zm0 13.036h.008v.008H12v-.008Z"}))}),l=o.forwardRef(function(e,t){let{title:n,titleId:a,...i}=e;return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},i),n?o.createElement("title",{id:a},n):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125"}))});function c(e){let{isOpen:c,onClose:m,onConnect:d,isConnecting:u}=e,[g,h]=(0,o.useState)(""),p=[{id:"argentx",name:"ArgentX",icon:"argentx",description:"Most popular Starknet wallet with advanced features",isInstalled:!!window.starknet_argentX,isPopular:!0},{id:"braavos",name:"Braavos",icon:"braavos",description:"Security-focused wallet with hardware support",isInstalled:!!window.starknet_braavos},{id:"okx",name:"OKX Wallet",icon:"okx",description:"Multi-chain wallet with DeFi integration",isInstalled:!!window.starknet_okxwallet}];return c?(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:(0,t.jsxs)("div",{className:"bg-gray-900 border border-gray-700 rounded-xl max-w-md w-full p-6 shadow-2xl",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)(n.WalletIcon,{className:"w-6 h-6 text-blue-400"}),(0,t.jsx)("h2",{className:"text-xl font-bold text-white",children:"Connect Wallet"})]}),(0,t.jsx)("button",{onClick:m,className:"text-gray-400 hover:text-white transition-colors",children:(0,t.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,t.jsx)("div",{className:"space-y-3",children:p.map(e=>(0,t.jsx)("div",{className:"relative",children:(0,t.jsx)("button",{onClick:()=>{var t;h(t=e.id),d(t)},disabled:u||!e.isInstalled,className:"w-full p-4 rounded-lg border transition-all duration-200 ".concat(e.isInstalled?"border-gray-600 hover:border-orange-500 hover:bg-gray-800 focus:border-orange-500 focus:ring-2 focus:ring-orange-500/20":"border-gray-700 bg-gray-800/50 cursor-not-allowed opacity-50"," ").concat(g===e.id&&u?"border-orange-500 bg-orange-500/10":""),children:(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsxs)("div",{className:"w-12 h-12 bg-gray-800 rounded-lg flex items-center justify-center",children:["argentx"===e.id&&(0,t.jsx)(r.ShieldCheckIcon,{className:"w-6 h-6 text-blue-400"}),"braavos"===e.id&&(0,t.jsx)(s,{className:"w-6 h-6 text-orange-400"}),"okx"===e.id&&(0,t.jsx)(l,{className:"w-6 h-6 text-gray-300"})]}),(0,t.jsxs)("div",{className:"flex-1 text-left",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("h3",{className:"font-semibold text-white",children:e.name}),e.isPopular&&(0,t.jsx)("span",{className:"px-2 py-1 bg-orange-500/20 text-orange-400 text-xs rounded font-medium",children:"Popular"})]}),(0,t.jsx)("p",{className:"text-sm text-gray-400 mt-1",children:e.description}),!e.isInstalled&&(0,t.jsx)("p",{className:"text-xs text-red-400 mt-1",children:"Not installed"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[e.isInstalled?(0,t.jsx)(r.ShieldCheckIcon,{className:"w-5 h-5 text-green-400"}):(0,t.jsx)(i,{className:"w-5 h-5 text-gray-600"}),g===e.id&&u&&(0,t.jsx)("div",{className:"w-4 h-4 border-2 border-orange-500 border-t-transparent rounded-full animate-spin"})]})]})})},e.id))}),(0,t.jsx)("div",{className:"mt-6 p-4 bg-gray-800/50 rounded-lg border border-gray-700",children:(0,t.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,t.jsx)(a,{className:"w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-white",children:"Wallet Security"}),(0,t.jsx)("p",{className:"text-sm text-gray-400 mt-1",children:"Only connect wallets you trust. The mixer requires transaction signing for privacy operations."})]})]})}),(0,t.jsx)("div",{className:"mt-4 text-center",children:(0,t.jsxs)("p",{className:"text-xs text-gray-500",children:["Don't have a wallet?"," ",(0,t.jsx)("a",{href:"https://www.argent.xyz/starknet/",target:"_blank",rel:"noopener noreferrer",className:"text-orange-400 hover:text-orange-300 transition-colors",children:"Install ArgentX"})]})})]})}):null}e.s(["default",()=>h],991548);var m=e.i(163858),d=e.i(263150),u=e.i(860463);let g=o.forwardRef(function(e,t){let{title:n,titleId:a,...i}=e;return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},i),n?o.createElement("title",{id:a},n):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))});function h(e){let{type:n,title:a,message:i,isVisible:r,onClose:s,autoClose:l=!0,duration:c=5e3}=e;if(o.default.useEffect(()=>{if(r&&l){let e=setTimeout(s,c);return()=>clearTimeout(e)}},[r,l,c,s]),!r)return null;let h={success:{icon:m.CheckCircleIcon,bgColor:"bg-green-500/10",borderColor:"border-green-500/20",iconColor:"text-green-400",titleColor:"text-green-300"},error:{icon:g,bgColor:"bg-red-500/10",borderColor:"border-red-500/20",iconColor:"text-red-400",titleColor:"text-red-300"},warning:{icon:d.ExclamationTriangleIcon,bgColor:"bg-yellow-500/10",borderColor:"border-yellow-500/20",iconColor:"text-yellow-400",titleColor:"text-yellow-300"},info:{icon:u.InformationCircleIcon,bgColor:"bg-blue-500/10",borderColor:"border-blue-500/20",iconColor:"text-blue-400",titleColor:"text-blue-300"}}[n],p=h.icon;return(0,t.jsx)("div",{className:"fixed top-4 right-4 z-50 max-w-sm w-full",children:(0,t.jsx)("div",{className:"".concat(h.bgColor," ").concat(h.borderColor," border rounded-lg p-4 shadow-lg transition-all duration-300 transform ").concat(r?"translate-x-0 opacity-100":"translate-x-full opacity-0"),children:(0,t.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,t.jsx)(p,{className:"w-6 h-6 ".concat(h.iconColor," flex-shrink-0")}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("h4",{className:"font-semibold ".concat(h.titleColor),children:a}),(0,t.jsx)("p",{className:"text-sm text-gray-300 mt-1",children:i})]}),(0,t.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-white transition-colors",children:(0,t.jsx)(g,{className:"w-5 h-5"})})]})})})}e.s(["stepDeposit",()=>y],137486);var p=e.i(590658),w=e.i(68043),f=e.i(412776),S=e.i(301986);let x="0x04718f5a0fc34cc1af16a1cdee98ffb20c31f5cd61d6ab07201858f4287c938d",v=w.ENV.MIXER_CONTRACT_ADDRESS||f.PRIVACY_MIXER.CONTRACT_ADDRESS;async function y(e,t){console.log("üí∞ SLPM Deposit: Starting deposit step"),console.log("üí∞ SLPM Deposit: Amount requested:",e,"STRK");try{let o=f.PRIVACY_MIXER.DEPLOYMENT_PARAMS.MIN_DEPOSIT,n=Number(o)/1e18;if(e<n){let o="Requested amount ".concat(e," STRK is below current minimum deposit (").concat(n," STRK). Increase amount or redeploy with lower MIN_DEPOSIT.");throw console.warn("‚ö†Ô∏è SLPM Deposit: Early rejection -",o),t({type:"deposit:error",message:o}),Error(o)}t({type:"deposit:initiated",message:"Connecting to Starknet wallet..."}),console.log("üí∞ SLPM Deposit: Initializing wallet client...");let a=new p.RealStarknetWalletClient(w.ENV.STARKNET_RPC);console.log("üí∞ SLPM Deposit: Connecting wallet...");let i=await a.connect();console.log("üí∞ SLPM Deposit: Wallet connected:",{address:i.account.address,walletType:i.walletType}),t({type:"deposit:wallet_connected",message:"Wallet connected successfully"}),console.log("üí∞ SLPM Deposit: Initializing privacy mixer contract..."),await a.initMixerContract(v),console.log("üí∞ SLPM Deposit: Mixer contract initialized"),console.log("üí∞ SLPM Deposit: Checking STRK balance...");let r=await a.getBalance(x),s=BigInt(Math.round(Number(e)*10**r.decimals)),l=BigInt("0x800000000000011000000000000000000000000000000000000000000000000")-BigInt(1);if(s>l)throw Error("Amount too large for Starknet felt: ".concat(s.toString()));if(console.log("üí∞ SLPM Deposit: Balance check:",{tokenAddress:x,symbol:r.symbol,onChainBalanceWei:r.balance.toString(),onChainBalanceSTRK:Number(r.balance)/Math.pow(10,r.decimals),decimals:r.decimals,requestedAmountWei:s.toString(),requestedAmountSTRK:e,requestedAmountHex:"0x"+s.toString(16),minDepositWei:o.toString(),minDepositSTRK:n}),r.balance<s)throw Error("Insufficient STRK balance. Required: ".concat(e," STRK, Available: ").concat(Number(r.balance)/Math.pow(10,r.decimals)," STRK"));t({type:"deposit:balance_checked",message:"Balance confirmed: ".concat(Number(r.balance)/Math.pow(10,r.decimals)," STRK available")}),console.log("üí∞ SLPM Deposit: Generating commitment & nullifier (contract spec)...");let c="0x"+Array.from(crypto.getRandomValues(new Uint8Array(31))).map(e=>e.toString(16).padStart(2,"0")).join(""),m=BigInt(s.toString()),d=function(e,t){if(!e.startsWith("0x"))throw Error("secret must be 0x-prefixed");let o=BigInt(e),{low:n,high:a}=S.uint256.bnToUint256(t),i=S.hash.computePoseidonHashOnElements([o,BigInt(n),BigInt(a)]),r=S.hash.computePoseidonHashOnElements([o,BigInt(i)]);return{commitment:S.num.toHex(i),nullifier:S.num.toHex(r),secret:e,amountLow:BigInt(n),amountHigh:BigInt(a)}}(c,m);console.log("üí∞ SLPM Deposit: Generated artifacts:",{secret:d.secret.slice(0,10)+"...",commitment:d.commitment,nullifier:d.nullifier.slice(0,10)+"..."}),t({type:"deposit:balance_checked",message:"Privacy commitment generated"}),console.log("üí∞ SLPM Deposit: Approving STRK spending by mixer contract...");let u=await a.approve(x,v,s);console.log("üí∞ SLPM Deposit: Approval transaction submitted:",u),t({type:"deposit:transfer_submitted",message:"Approval submitted: ".concat(u.transactionHash)}),console.log("üí∞ SLPM Deposit: Waiting for approval confirmation...");let g=await a.waitForTransaction(u.transactionHash);if(console.log("üí∞ SLPM Deposit: Approval confirmed:",g),"REJECTED"===g.status)throw Error("Approval transaction was rejected by the network");t({type:"deposit:balance_checked",message:"STRK spending approval confirmed"}),console.log("üí∞ SLPM Deposit: Verifying allowance was set correctly...");try{let o=await a.callContract(x,"allowance",[i.account.address,v]),n=BigInt(o[0]||0);if(console.log("üí∞ SLPM Deposit: Current allowance:",{allowanceWei:n.toString(),allowanceSTRK:Number(n)/Math.pow(10,r.decimals),requiredWei:s.toString(),requiredSTRK:e,sufficient:n>=s}),n<s)throw Error("Insufficient allowance: ".concat(Number(n)/Math.pow(10,r.decimals)," STRK allowed, ").concat(e," STRK required"));t({type:"deposit:balance_checked",message:"Allowance verified: ".concat(Number(n)/Math.pow(10,r.decimals)," STRK")})}catch(e){console.error("üí∞ SLPM Deposit: Allowance check failed:",e),t({type:"deposit:balance_checked",message:"Allowance check failed, proceeding with deposit..."})}console.log("üí∞ SLPM Deposit: Depositing to privacy mixer contract...");let h=await a.depositToMixer(d.commitment,s);console.log("üí∞ SLPM Deposit: Deposit transaction submitted:",h),t({type:"deposit:transfer_submitted",message:"Deposit to mixer submitted: ".concat(h)}),console.log("üí∞ SLPM Deposit: Waiting for deposit confirmation...");let y=await a.waitForTransaction(h);if(console.log("üí∞ SLPM Deposit: Deposit confirmed:",y),"REJECTED"===y.status)throw Error("Deposit transaction was rejected by the network");t({type:"deposit:confirmed",message:"STRK deposit confirmed in privacy mixer",progress:20}),console.log("üí∞ SLPM Deposit: Step completed successfully"),console.log("üîÑ SLPM Deposit: Now preparing for immediate withdrawal to enable swapping..."),t({type:"deposit:preparing_withdrawal",message:"Preparing privacy withdrawal for mixing...",progress:22});let M=d.commitment;return{transactionHash:y.transactionHash,amount:e,amountWei:s.toString(),walletAddress:i.account.address,commitmentHash:M,secret:d.secret,nullifier:d.nullifier,mixerContractAddress:v,withdrawalReady:!0}}catch(o){let e=o instanceof Error?o.message:"Unknown deposit error";throw/Execute failed/i.test(e)&&(e+=" (Possible causes: amount below MIN_DEPOSIT, insufficient allowance, or token transfer_from failure)"),console.error("‚ùå SLPM Deposit: Step failed:",o),t({type:"deposit:error",message:e}),Error(e)}}e.s(["stepWithdrawForMixing",()=>b],982008);var M=e.i(615245),C=e.i(216746);async function b(e,t){console.log("üîÑ SLPM Withdraw: Starting immediate withdrawal for mixing pipeline"),console.log("üîÑ SLPM Withdraw: Parameters:",{commitment:e.commitmentHash.slice(0,10)+"...",amount:e.amount,nullifier:e.nullifier.slice(0,10)+"..."});try{let o,n;t({type:"deposit:preparing_withdrawal",message:"Preparing withdrawal for privacy mixing...",progress:25});let a=(0,M.getSharedSwapAccount)(),i=(0,M.getSharedSwapAccountRaw)(),r=null,s=null;if(a&&i){console.log("üîÑ SLPM Withdraw: Using shared swap account for headless withdrawal");let t=(0,M.getSharedSwapProvider)();if(!t)throw Error("Shared swap provider not initialized");s=new C.PrivacyMixerContract(e.mixerContractAddress,i,t)}else console.log("üîÑ SLPM Withdraw: Shared account not configured, falling back to interactive wallet connection"),r=new p.RealStarknetWalletClient(w.ENV.STARKNET_RPC),await r.connect(),await r.initMixerContract(e.mixerContractAddress);let l=f.SHARED_SWAP_ACCOUNT_ADDRESS;console.log("üîÑ SLPM Withdraw: Preparing withdrawal transaction..."),console.log("üîÑ SLPM Withdraw: Withdrawal details (shared swap account):",{nullifier:e.nullifier.slice(0,10)+"...",commitment:e.commitmentHash.slice(0,10)+"...",recipient:l.slice(0,10)+"...",amount:e.amountWei}),console.log("üîÑ SLPM Withdraw: Generating withdrawal proof (3-element format)...");let c=BigInt(e.amountWei),m=BigInt(l),d=S.uint256.bnToUint256(c),u=BigInt(d.low),g=BigInt(d.high),h=S.hash.computePoseidonHashOnElements([m]),x=S.hash.computePoseidonHashOnElements([u,g]),v=[e.secret,S.num.toHex(h),S.num.toHex(x)];if(3!==v.length)throw Error("Generated proof length mismatch: expected 3, got ".concat(v.length));if(console.log("üîÑ SLPM Withdraw: Proof generated:",{proofLength:v.length,elements:v.map(e=>e.slice(0,10)+"...")}),t({type:"deposit:preparing_withdrawal",message:"Checking minimum mixing delay...",progress:25}),console.log("üïê SLPM Withdraw: Checking timing requirements..."),console.log("üïê SLPM Withdraw: Contract requires 4 second delay between deposit and withdrawal"),console.log("‚è≥ SLPM Withdraw: Waiting 4 seconds for mixing delay..."),await new Promise(e=>setTimeout(e,4e3)),console.log("‚úÖ SLPM Withdraw: Minimum delay satisfied, proceeding with withdrawal"),t({type:"deposit:preparing_withdrawal",message:"Submitting withdrawal transaction...",progress:30}),console.log("üîÑ SLPM Withdraw: Executing withdrawal from privacy mixer..."),s)o=(await s.withdraw(e.nullifier,e.commitmentHash,l,c,v)).transaction_hash;else if(r)o=await r.withdrawFromMixer(e.nullifier,e.commitmentHash,l,c,v);else throw Error("No withdrawal pathway available");if(console.log("üîÑ SLPM Withdraw: Withdrawal transaction submitted:",o),t({type:"deposit:withdrawn_for_mixing",message:"Withdrawal submitted: ".concat(o),progress:35}),console.log("üîÑ SLPM Withdraw: Waiting for withdrawal confirmation..."),r)n=await r.waitForTransaction(o);else{let e=(0,M.getSharedSwapProvider)();if(!e)throw Error("Shared swap provider not available for confirmation");n=await e.waitForTransaction(o)}if(console.log("üîÑ SLPM Withdraw: Withdrawal confirmed:",n),"REJECTED"===n.status)throw Error("Withdrawal transaction was rejected by the network");t({type:"deposit:withdrawn_for_mixing",message:"STRK successfully withdrawn from privacy mixer for mixing pipeline",progress:40}),console.log("üîÑ SLPM Withdraw: Step completed successfully"),console.log("üîÑ SLPM Withdraw: Funds are now available for Lightning/Cashu mixing");let y=n.transactionHash||n.transaction_hash||o;return console.log("üîÑ SLPM Withdraw: Determined withdrawal tx hash:",y),{withdrawalTxHash:y,availableForSwap:!0,controllingWallet:l,amount:e.amount,amountWei:e.amountWei,originalDeposit:e}}catch(e){throw console.error("‚ùå SLPM Withdraw: Step failed:",e),t({type:"deposit:error",message:e instanceof Error?e.message:"Unknown withdrawal error"}),e}}},287810,e=>{"use strict";e.s(["stepDynamicEstimateSats",()=>n]);var t=e.i(516687),o=e.i(68043);async function n(e,n){n({type:"mix:progress",message:"Fetching real-time STRK‚Üísats estimate...",progress:11});let a=new t.RealAtomiqSwapClient(o.ENV.NETWORK);try{let t=await a.estimateLightningSatsFromStrk(e);return console.log("üßÆ SLPM DynamicEstimate: Result",t),t}catch(n){console.warn("‚ö†Ô∏è SLPM DynamicEstimate: Falling back after failure:",n);let t=Math.floor(e*(o.ENV.STRK_SATS_RATE||700));return{satsOut:t,rate:t/e,source:"fallback"}}}},470556,e=>{"use strict";e.s(["stepCreateMintInvoice",()=>r],470556);var t=e.i(299749),o=e.i(212164);class n{async ensureInitialized(){if(!this.initialized)try{console.log("üîó Connecting to Cashu mint: ".concat(this.mintUrl)),await this.wallet.loadMint(),this.initialized=!0,console.log("‚úÖ Cashu mint connected successfully")}catch(e){throw console.warn("‚ö†Ô∏è Failed to connect to Cashu mint: ".concat(e instanceof Error?e.message:String(e))),Error("Cashu mint connection failed: ".concat(e instanceof Error?e.message:"Unknown error"))}}async createMintQuote(e){await this.ensureInitialized();let t=await this.wallet.createMintQuote(Number(e));return{quote:t.quote,amount:BigInt(t.amount),state:t.state===o.MintQuoteState.PAID?"PAID":t.state===o.MintQuoteState.ISSUED?"ISSUED":"CREATED",request:t.request}}async checkMintQuote(e){await this.ensureInitialized();let t=await this.wallet.checkMintQuote(e);return{quote:t.quote,amount:BigInt(t.amount||0),state:t.state===o.MintQuoteState.PAID?"PAID":t.state===o.MintQuoteState.ISSUED?"ISSUED":"CREATED",request:t.request}}async mintProofs(e,t){return await this.ensureInitialized(),(await this.wallet.mintProofs(Number(e),t)).map(this.convertToEcashProof)}async createMeltQuote(e){await this.ensureInitialized();{let t=await fetch("/api/cashu/melt-quote",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({invoice:e,mintUrl:this.mintUrl})});if(!t.ok)throw Error("melt-quote failed: ".concat(await t.text()));let o=await t.json();return{quote:o.quote,amount:BigInt(o.amount),fee_reserve:BigInt(o.fee_reserve),unit:o.unit,expiry:o.expiry,request:o.request}}}async meltProofs(e,t){await this.ensureInitialized();let o=t.map(this.convertFromEcashProof);{var n,a,i;console.log("üîß [Cashu Client] Browser path: preparing melt request...",{quoteId:(null==(n=e.quote)?void 0:n.substring(0,20))+"...",proofsCount:o.length,totalAmount:o.reduce((e,t)=>e+Number(t.amount),0),mintUrl:this.mintUrl});let t={quote:e.quote,amount:e.amount.toString(),fee_reserve:e.fee_reserve.toString(),unit:e.unit,expiry:e.expiry,request:e.request};console.log("‚ö° [Cashu Client] Sending melt request to server proxy...",{proofsFormat:o.length>0?{firstProofFields:Object.keys(o[0]),firstProofAmount:o[0].amount,firstProofAmountType:typeof o[0].amount}:"no proofs"});let r=await fetch("/api/cashu/melt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({quote:t,proofs:o,mintUrl:this.mintUrl})});if(!r.ok){let e=await r.text();throw console.error("‚ùå [Cashu Client] Melt request failed:",{status:r.status,statusText:r.statusText,error:e}),Error("melt failed: ".concat(e))}let s=await r.json();return console.log("‚úÖ [Cashu Client] Melt response received:",{changeProofs:(null==(a=s.change)?void 0:a.length)||0,changeAmount:(null==(i=s.change)?void 0:i.reduce((e,t)=>e+t.amount,0))||0}),{change:(s.change||[]).map(this.convertToEcashProof)}}}async send(e,t){await this.ensureInitialized();let o=t.map(this.convertFromEcashProof),{keep:n,send:a}=await this.wallet.send(Number(e),o);return{keep:n.map(this.convertToEcashProof),send:a.map(this.convertToEcashProof)}}createToken(e){let t=e.map(this.convertFromEcashProof);return(0,o.getEncodedTokenV4)({mint:this.mint.mintUrl,proofs:t})}async receive(e){return await this.ensureInitialized(),(await this.wallet.receive(e)).map(this.convertToEcashProof)}async getMintInfo(){await this.ensureInitialized();let e=await this.mint.getInfo();return{name:e.name,description:e.description,version:e.version}}getBalance(e){return e.reduce((e,t)=>e+t.amount,0n)}convertToEcashProof(e){return{secret:e.secret,signature:e.C,amount:BigInt(e.amount),currency:"SAT",keysetId:e.id}}convertFromEcashProof(e){return{secret:e.secret,C:e.signature,amount:Number(e.amount),id:e.keysetId}}constructor(e){(0,t._)(this,"mint",void 0),(0,t._)(this,"wallet",void 0),(0,t._)(this,"initialized",!1),(0,t._)(this,"mintUrl",void 0),this.mintUrl=e,this.mint=new o.CashuMint(e),this.wallet=new o.CashuWallet(this.mint)}}class a{selectMint(){let e=Math.floor(Math.random()*this.mintUrls.length),t=this.mintUrls[e];return this.clients.get(t)}getAllMints(){return Array.from(this.clients.values())}async distributeSend(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=this.mintUrls.slice(0,o),a=e/BigInt(o),i=[];for(let e of n){let o=this.clients.get(e),n=t.filter(e=>this.getBalance([e])<=a);i.push({mint:o,proofs:n})}return{distributions:i}}getBalance(e){return e.reduce((e,t)=>e+t.amount,0n)}constructor(e){(0,t._)(this,"clients",new Map),(0,t._)(this,"mintUrls",void 0),this.mintUrls=e,e.forEach(e=>{this.clients.set(e,new n(e))})}}var i=e.i(68043);async function r(e,t){console.log("üè¶ SLPM MintInvoice: Starting mint invoice creation"),console.log("üè¶ SLPM MintInvoice: Amount:",e,"sats");try{var o;t({type:"mix:progress",message:"Creating Cashu mint invoice for ".concat(e," sats..."),progress:15}),console.log("üè¶ SLPM MintInvoice: Initializing Cashu services..."),console.log("üè¶ SLPM MintInvoice: Available mints:",i.ENV.CASHU_MINTS.length),console.log("üè¶ SLPM MintInvoice: Default mint:",i.ENV.CASHU_DEFAULT_MINT);let r=i.ENV.CASHU_MINTS.length?new a(i.ENV.CASHU_MINTS):null,s=r?r.selectMint():new n(i.ENV.CASHU_DEFAULT_MINT);console.log("üè¶ SLPM MintInvoice: Cashu client type:",r?"Multi-mint manager":"Single mint"),console.log("üè¶ SLPM MintInvoice: Creating mint quote...");let l=await s.createMintQuote(BigInt(e));if(console.log("üè¶ SLPM MintInvoice: Mint quote created:",{quote:l.quote,amount:l.amount.toString(),state:l.state,invoice:(null==(o=l.request)?void 0:o.slice(0,50))+"..."}),!l.request)throw Error("Cashu mint did not provide Lightning invoice");return t({type:"mix:progress",message:"Cashu mint invoice created successfully",progress:20}),console.log("üè¶ SLPM MintInvoice: Invoice ready for Atomiq payment"),console.log("üè¶ SLPM MintInvoice: Step completed successfully"),{cashu:s,cashuManager:r,mintQuote:l,lightningInvoice:l.request,amount:e}}catch(o){throw console.error("‚ùå SLPM MintInvoice: Step failed:",o),console.error("üîç SLPM MintInvoice: Error details:",{message:o instanceof Error?o.message:"Unknown error",stack:o instanceof Error?o.stack:void 0,context:{sats:e,mintUrl:i.ENV.CASHU_DEFAULT_MINT,mintsAvailable:i.ENV.CASHU_MINTS.length}}),t({type:"mix:error",message:o instanceof Error?o.message:"Unknown mint invoice error"}),o}}},668409,947128,e=>{"use strict";e.s(["stepSwapToLightning",()=>a],668409);var t=e.i(516687),o=e.i(412776),n=e.i(68043);async function a(a,i,r,s){console.log("‚ö° SLPM SwapToLN: Starting STRK ‚Üí Lightning BTC swap"),console.log("‚ö° SLPM SwapToLN: Parameters:",{amountStrk:a,fromWallet:i.walletAddress.slice(0,10)+"...",network:n.ENV.NETWORK,fundsAvailable:i.fundsAvailable||!1,targetInvoice:r.lightningInvoice.slice(0,50)+"..."}),i.fundsAvailable?console.log("‚úÖ SLPM SwapToLN: Funds confirmed available after privacy mixer withdrawal"):console.log("‚ö†Ô∏è SLPM SwapToLN: Warning - funds availability not confirmed");try{var l;let i;s({type:"mix:progress",message:"Converting ".concat(a," STRK to Lightning BTC..."),progress:25}),console.log("üèóÔ∏è SLPM SwapToLN: Initializing Atomiq client...");let c=new t.RealAtomiqSwapClient(n.ENV.NETWORK),m=null==(l=r.lightningInvoice)?void 0:l.trim();console.log("‚ö° SLPM SwapToLN: Using Cashu mint invoice for automated mixer flow...");try{let{millisatoshis:t}=await e.A(676247).then(e=>e.decode(m));t&&(i=Number(BigInt(t)/1000n))}catch(e){console.warn("‚ö†Ô∏è SLPM SwapToLN: Failed to decode invoice for sats amount, proceeding (swap call will re-validate):",e instanceof Error?e.message:e)}(null==i||i<=0)&&(console.warn("‚ö†Ô∏è SLPM SwapToLN: Could not decode invoice amount, using mint amount as fallback"),i=r.amount),console.log("‚ö° SLPM SwapToLN: Lightning invoice details:",{invoice:m.slice(0,50)+"...",invoiceSats:i,strkInputApprox:a,note:"invoiceSats is authoritative output; STRK input derived by SDK"}),s({type:"mix:progress",message:"Converting ".concat(a," STRK to Lightning BTC..."),progress:30}),console.log("‚ö° SLPM SwapToLN: Executing STRK ‚Üí Lightning swap (exactOut via invoice)...");let d=await c.swapStrkToLightning(i||r.amount,m,o.SHARED_SWAP_ACCOUNT_ADDRESS);if(console.log("‚ö° SLPM SwapToLN: Swap result:",{success:d.success,txId:d.txId,amount:d.amount,route:d.route,error:d.error}),!d.success)throw Error("STRK ‚Üí Lightning swap failed: ".concat(d.error||"Unknown error"));return console.log("‚è≥ SLPM SwapToLN: Waiting for Lightning payment confirmation..."),s({type:"mix:progress",message:"Waiting for Lightning payment confirmation...",progress:35}),await new Promise(e=>setTimeout(e,3e3)),console.log("‚úÖ SLPM SwapToLN: Lightning payment confirmed!"),s({type:"mix:progress",message:"STRK successfully swapped to Lightning BTC",progress:40}),{executionId:d.txId||"swap_".concat(Date.now()),lightningInvoice:m,lightningAmount:i||r.amount,lightningPaymentHash:d.txId,swapTxId:d.txId,amountIn:a,amountOut:d.amount,fee:0,cashu:r.cashu,mintQuote:r.mintQuote}}catch(e){throw console.error("‚ùå SLPM SwapToLN: Step failed:",e),console.error("üîç SLPM SwapToLN: Error details:",{message:e instanceof Error?e.message:"Unknown error",stack:e instanceof Error?e.stack:void 0,context:{amountStrk:a,network:n.ENV.NETWORK}}),s({type:"mix:error",message:e instanceof Error?e.message:"Unknown swap error"}),e}}e.s(["stepClaimCashuProofs",()=>r],947128);var i=e.i(212164);async function r(e,t,o,n){console.log("ü™ô SLPM ClaimCashu: Starting Cashu proof claiming"),console.log("ü™ô SLPM ClaimCashu: Parameters:",{quoteId:e.quote,amount:o,expectedState:"PAID"});try{n({type:"mix:progress",message:"Claiming Cashu proofs for ".concat(o," sats..."),progress:45}),console.log("üîç SLPM ClaimCashu: Checking if mint quote was paid...");let a=await t.checkMintQuote(e.quote);if(console.log("üîç SLPM ClaimCashu: Quote status:",{quote:a.quote,state:a.state,amount:a.amount.toString()}),"PAID"!==a.state){console.log("‚è≥ SLPM ClaimCashu: Payment not confirmed yet, waiting..."),await new Promise(e=>setTimeout(e,2e3));let o=await t.checkMintQuote(e.quote);if(console.log("üîç SLPM ClaimCashu: Retry status:",o.state),"PAID"!==o.state)throw Error("Lightning payment not confirmed. Quote state: ".concat(o.state))}console.log("‚úÖ SLPM ClaimCashu: Lightning payment confirmed by Cashu mint"),console.log("üè≠ SLPM ClaimCashu: Minting Cashu proofs...");let r=await t.mintProofs(BigInt(o),e.quote);console.log("üè≠ SLPM ClaimCashu: Cashu proofs minted:",{count:r.length,totalAmount:r.reduce((e,t)=>e+Number(t.amount),0),proofs:r.map(e=>{var t;return{amount:Number(e.amount),secret:(null==(t=e.secret)?void 0:t.slice(0,10))+"..."}})});try{r.reduce((e,t)=>e+Number(t.amount),0);let o=t.createToken(r);try{let e="unknown";try{let t=(0,i.getDecodedToken)(o);e=(null==t?void 0:t.mint)||e}catch(e){}}catch(e){console.warn("‚ö†Ô∏è SLPM ClaimCashu: Failed to save token to server vault:",e)}{let t="slpm:cashu-token:".concat(e.quote);window.localStorage.setItem(t,o),console.log("üíæ SLPM ClaimCashu: Saved ecash token to localStorage under key",t)}}catch(e){console.warn("‚ö†Ô∏è SLPM ClaimCashu: Could not persist ecash token:",e)}let s=r.reduce((e,t)=>e+Number(t.amount),0);return Math.abs(s-o)>1&&console.warn("‚ö†Ô∏è SLPM ClaimCashu: Amount mismatch:",{expected:o,received:s,difference:s-o}),n({type:"mix:progress",message:"Cashu proofs claimed: ".concat(r.length," proofs for ").concat(s," sats"),progress:50}),console.log("ü™ô SLPM ClaimCashu: Step completed successfully"),r}catch(t){throw console.error("‚ùå SLPM ClaimCashu: Step failed:",t),console.error("üîç SLPM ClaimCashu: Error details:",{message:t instanceof Error?t.message:"Unknown error",stack:t instanceof Error?t.stack:void 0,context:{quoteId:e.quote,targetSats:o,quoteState:e.state}}),n({type:"mix:error",message:t instanceof Error?t.message:"Unknown Cashu claiming error"}),t}}}]);