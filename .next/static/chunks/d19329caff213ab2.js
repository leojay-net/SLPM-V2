(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,834055,e=>{"use strict";async function r(e,r,o){try{console.log("ðŸ” Server-side Cashu Melt: Starting single-API melt with retry...");let o=await fetch("/api/cashu/receive-and-melt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({encodedToken:e,invoice:r})}),t=await o.json();if(!o.ok){if(console.error("âŒ Server-side Cashu Melt: API error:",t),"INSUFFICIENT_BALANCE"===t.error)return{success:!1,error:"Insufficient balance for invoice + fees",details:t.details};return{success:!1,error:t.error||"Server-side melt failed"}}return console.log("âœ… Server-side Cashu Melt: Completed successfully:",t.result),{success:!0,result:t.result}}catch(e){return console.error("âŒ Server-side Cashu Melt: Network error:",e),{success:!1,error:e instanceof Error?e.message:"Network error during melt"}}}async function o(r){try{console.log("ðŸ§® Calculating max invoice amount from token balance...");let{getDecodedToken:o}=await e.A(94904),t=o(r).proofs.reduce((e,r)=>e+r.amount,0),n=0;for(let e=1;e<=t;e++){let r=Math.max(2,Math.ceil(.01*e))+1;if(e+r<=t)n=e;else break}return console.log("âœ… Max invoice calculation:",{availableBalance:t,maxAmount:n,estimatedFee:Math.max(2,Math.ceil(.01*n))+1}),{success:!0,maxAmount:n,availableBalance:t}}catch(e){return console.error("âŒ Failed to calculate max invoice amount:",e),{success:!1,error:e instanceof Error?e.message:"Calculation failed"}}}async function t(e){console.log("ðŸ” Getting encoded token from storage for quote:",e);try{{let r=window.localStorage.getItem("slpm:cashu-token:".concat(e));if(r)return console.log("âœ… Found token in localStorage"),r}return console.warn("âŒ No encoded token found for quote:",e),null}catch(e){return console.error("âŒ Error retrieving encoded token:",e),null}}e.s(["calculateMaxInvoiceAmount",()=>o,"getEncodedTokenFromStorage",()=>t,"serverSideCashuMelt",()=>r])},94904,e=>{e.v(e=>Promise.resolve().then(()=>e(212164)))}]);