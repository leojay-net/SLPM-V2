(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,212164,t=>{"use strict";let e;t.s(["CashuAuthMint",()=>nR,"CashuAuthWallet",()=>nP,"CashuMint",()=>nk,"CashuWallet",()=>nU,"CheckStateEnum",()=>nu,"ConsoleLogger",()=>ns,"HttpResponseError",()=>nd,"LogLevel",()=>nn,"MeltQuoteState",()=>nf,"MintOperationError",()=>ny,"MintQuoteState",()=>nc,"NetworkError",()=>np,"OutputData",()=>nS,"PaymentRequest",()=>rM,"PaymentRequestTransportType",()=>nh,"decodePaymentRequest",()=>r2,"deriveKeysetId",()=>rY,"getBlindedAuthToken",()=>nq,"getDecodedToken",()=>rG,"getDecodedTokenBinary",()=>r9,"getEncodedAuthToken",()=>nO,"getEncodedToken",()=>rj,"getEncodedTokenBinary",()=>r7,"getEncodedTokenV4",()=>rV,"getTokenMetadata",()=>rW,"hasValidDleq",()=>r4,"injectWebSocketImpl",()=>nr,"setGlobalRequestOptions",()=>nb],212164);let r="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function n(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&"Uint8Array"===t.constructor.name}function i(t){if(!Number.isSafeInteger(t)||t<0)throw Error("positive integer expected, got "+t)}function o(t){for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];if(!n(t))throw Error("Uint8Array expected");if(r.length>0&&!r.includes(t.length))throw Error("Uint8Array expected of length "+r+", got length="+t.length)}function s(t){if("function"!=typeof t||"function"!=typeof t.create)throw Error("Hash should be wrapped by utils.createHasher");i(t.outputLen),i(t.blockLen)}function a(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(t.destroyed)throw Error("Hash instance has been destroyed");if(e&&t.finished)throw Error("Hash#digest() has already been called")}function l(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];for(let t=0;t<e.length;t++)e[t].fill(0)}function u(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function f(t,e){return t<<32-e|t>>>e}function c(t,e){return t<<e|t>>>32-e>>>0}let h="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,d=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function p(t){if(o(t),h)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=d[t[r]];return e}let y={_0:48,_9:57,A:65,F:70,a:97,f:102};function g(t){return t>=y._0&&t<=y._9?t-y._0:t>=y.A&&t<=y.F?t-(y.A-10):t>=y.a&&t<=y.f?t-(y.a-10):void 0}function m(t){if("string"!=typeof t)throw Error("hex string expected, got "+typeof t);if(h)return Uint8Array.fromHex(t);let e=t.length,r=e/2;if(e%2)throw Error("hex string expected, got unpadded hex of length "+e);let n=new Uint8Array(r);for(let e=0,i=0;e<r;e++,i+=2){let r=g(t.charCodeAt(i)),o=g(t.charCodeAt(i+1));if(void 0===r||void 0===o)throw Error('hex string expected, got non-hex character "'+(t[i]+t[i+1])+'" at index '+i);n[e]=16*r+o}return n}function b(t){if("string"!=typeof t)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function w(t){return"string"==typeof t&&(t=b(t)),o(t),t}function v(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];let n=0;for(let t=0;t<e.length;t++){let r=e[t];o(r),n+=r.length}let i=new Uint8Array(n);for(let t=0,r=0;t<e.length;t++){let n=e[t];i.set(n,r),r+=n.length}return i}class E{}function x(t){let e=e=>t().update(w(e)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function B(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32;if(r&&"function"==typeof r.getRandomValues)return r.getRandomValues(new Uint8Array(t));if(r&&"function"==typeof r.randomBytes)return Uint8Array.from(r.randomBytes(t));throw Error("crypto.getRandomValues must be defined")}class k extends E{update(t){a(this),o(t=w(t));let{view:e,buffer:r,blockLen:n}=this,i=t.length;for(let o=0;o<i;){let s=Math.min(n-this.pos,i-o);if(s===n){let e=u(t);for(;n<=i-o;o+=n)this.process(e,o);continue}r.set(t.subarray(o,o+s),this.pos),this.pos+=s,o+=s,this.pos===n&&(this.process(e,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){a(this);o(t);let e=this.outputLen;if(t.length<e)throw Error("digestInto() expects output buffer of length at least "+e);this.finished=!0;let{buffer:r,view:n,blockLen:i,isLE:s}=this,{pos:f}=this;r[f++]=128,l(this.buffer.subarray(f)),this.padOffset>i-f&&(this.process(n,0),f=0);for(let t=f;t<i;t++)r[t]=0;!function(t,e,r,n){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,r,n);let i=BigInt(32),o=BigInt(0xffffffff),s=Number(r>>i&o),a=Number(r&o),l=4*!!n,u=4*!n;t.setUint32(e+l,s,n),t.setUint32(e+u,a,n)}(n,i-8,BigInt(8*this.length),s),this.process(n,0);let c=u(t),h=this.outputLen;if(h%4)throw Error("_sha2: outputLen should be aligned to 32bit");let d=h/4,p=this.get();if(d>p.length)throw Error("_sha2: outputLen bigger than state");for(let t=0;t<d;t++)c.setUint32(4*t,p[t],s)}digest(){let{buffer:t,outputLen:e}=this;this.digestInto(t);let r=t.slice(0,e);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:e,buffer:r,length:n,finished:i,destroyed:o,pos:s}=this;return t.destroyed=o,t.finished=i,t.length=n,t.pos=s,n%e&&t.buffer.set(r),t}clone(){return this._cloneInto()}constructor(t,e,r,n){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=t,this.outputLen=e,this.padOffset=r,this.isLE=n,this.buffer=new Uint8Array(t),this.view=u(this.buffer)}}let A=Uint32Array.from([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),_=Uint32Array.from([0xc1059ed8,0x367cd507,0x3070dd17,0xf70e5939,0xffc00b31,0x68581511,0x64f98fa7,0xbefa4fa4]),I=Uint32Array.from([0xcbbb9d5d,0xc1059ed8,0x629a292a,0x367cd507,0x9159015a,0x3070dd17,0x152fecd8,0xf70e5939,0x67332667,0xffc00b31,0x8eb44a87,0x68581511,0xdb0c2e0d,0x64f98fa7,0x47b5481d,0xbefa4fa4]),S=Uint32Array.from([0x6a09e667,0xf3bcc908,0xbb67ae85,0x84caa73b,0x3c6ef372,0xfe94f82b,0xa54ff53a,0x5f1d36f1,0x510e527f,0xade682d1,0x9b05688c,0x2b3e6c1f,0x1f83d9ab,0xfb41bd6b,0x5be0cd19,0x137e2179]),U=BigInt(0x100000000-1),R=BigInt(32),P=(t,e,r)=>t>>>r,O=(t,e,r)=>t<<32-r|e>>>r,q=(t,e,r)=>t>>>r|e<<32-r,T=(t,e,r)=>t<<32-r|e>>>r,M=(t,e,r)=>t<<64-r|e>>>r-32,N=(t,e,r)=>t>>>r-32|e<<64-r;function K(t,e,r,n){let i=(e>>>0)+(n>>>0);return{h:t+r+(i/0x100000000|0)|0,l:0|i}}let C=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),F=(t,e,r,n)=>e+r+n+(t/0x100000000|0)|0,D=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),L=(t,e,r,n,i)=>e+r+n+i+(t/0x100000000|0)|0,H=(t,e,r,n,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(i>>>0),j=(t,e,r,n,i,o)=>e+r+n+i+o+(t/0x100000000|0)|0,V=Uint32Array.from([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),z=new Uint32Array(64);class Q extends k{get(){let{A:t,B:e,C:r,D:n,E:i,F:o,G:s,H:a}=this;return[t,e,r,n,i,o,s,a]}set(t,e,r,n,i,o,s,a){this.A=0|t,this.B=0|e,this.C=0|r,this.D=0|n,this.E=0|i,this.F=0|o,this.G=0|s,this.H=0|a}process(t,e){for(let r=0;r<16;r++,e+=4)z[r]=t.getUint32(e,!1);for(let t=16;t<64;t++){let e=z[t-15],r=z[t-2],n=f(e,7)^f(e,18)^e>>>3,i=f(r,17)^f(r,19)^r>>>10;z[t]=i+z[t-7]+n+z[t-16]|0}let{A:r,B:n,C:i,D:o,E:s,F:a,G:l,H:u}=this;for(let t=0;t<64;t++){var c,h,d,p;let e=u+(f(s,6)^f(s,11)^f(s,25))+((c=s)&a^~c&l)+V[t]+z[t]|0,y=(f(r,2)^f(r,13)^f(r,22))+((h=r)&(d=n)^h&(p=i)^d&p)|0;u=l,l=a,a=s,s=o+e|0,o=i,i=n,n=r,r=e+y|0}r=r+this.A|0,n=n+this.B|0,i=i+this.C|0,o=o+this.D|0,s=s+this.E|0,a=a+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(r,n,i,o,s,a,l,u)}roundClean(){l(z)}destroy(){this.set(0,0,0,0,0,0,0,0),l(this.buffer)}constructor(t=32){super(64,t,8,!1),this.A=0|A[0],this.B=0|A[1],this.C=0|A[2],this.D=0|A[3],this.E=0|A[4],this.F=0|A[5],this.G=0|A[6],this.H=0|A[7]}}let G=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=t.length,n=new Uint32Array(r),i=new Uint32Array(r);for(let o=0;o<r;o++){let{h:r,l:s}=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e?{h:Number(t&U),l:Number(t>>R&U)}:{h:0|Number(t>>R&U),l:0|Number(t&U)}}(t[o],e);[n[o],i[o]]=[r,s]}return[n,i]}(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),W=G[0],Z=G[1],Y=new Uint32Array(80),J=new Uint32Array(80);class $ extends k{get(){let{Ah:t,Al:e,Bh:r,Bl:n,Ch:i,Cl:o,Dh:s,Dl:a,Eh:l,El:u,Fh:f,Fl:c,Gh:h,Gl:d,Hh:p,Hl:y}=this;return[t,e,r,n,i,o,s,a,l,u,f,c,h,d,p,y]}set(t,e,r,n,i,o,s,a,l,u,f,c,h,d,p,y){this.Ah=0|t,this.Al=0|e,this.Bh=0|r,this.Bl=0|n,this.Ch=0|i,this.Cl=0|o,this.Dh=0|s,this.Dl=0|a,this.Eh=0|l,this.El=0|u,this.Fh=0|f,this.Fl=0|c,this.Gh=0|h,this.Gl=0|d,this.Hh=0|p,this.Hl=0|y}process(t,e){for(let r=0;r<16;r++,e+=4)Y[r]=t.getUint32(e),J[r]=t.getUint32(e+=4);for(let t=16;t<80;t++){let e=0|Y[t-15],r=0|J[t-15],n=q(e,r,1)^q(e,r,8)^P(e,r,7),i=T(e,r,1)^T(e,r,8)^O(e,r,7),o=0|Y[t-2],s=0|J[t-2],a=q(o,s,19)^M(o,s,61)^P(o,s,6),l=D(i,T(o,s,19)^N(o,s,61)^O(o,s,6),J[t-7],J[t-16]),u=L(l,n,a,Y[t-7],Y[t-16]);Y[t]=0|u,J[t]=0|l}let{Ah:r,Al:n,Bh:i,Bl:o,Ch:s,Cl:a,Dh:l,Dl:u,Eh:f,El:c,Fh:h,Fl:d,Gh:p,Gl:y,Hh:g,Hl:m}=this;for(let t=0;t<80;t++){let e=q(f,c,14)^q(f,c,18)^M(f,c,41),b=T(f,c,14)^T(f,c,18)^N(f,c,41),w=f&h^~f&p,v=H(m,b,c&d^~c&y,Z[t],J[t]),E=j(v,g,e,w,W[t],Y[t]),x=0|v,B=q(r,n,28)^M(r,n,34)^M(r,n,39),k=T(r,n,28)^N(r,n,34)^N(r,n,39),A=r&i^r&s^i&s,_=n&o^n&a^o&a;g=0|p,m=0|y,p=0|h,y=0|d,h=0|f,d=0|c,({h:f,l:c}=K(0|l,0|u,0|E,0|x)),l=0|s,u=0|a,s=0|i,a=0|o,i=0|r,o=0|n;let I=C(x,k,_);r=F(I,E,B,A),n=0|I}({h:r,l:n}=K(0|this.Ah,0|this.Al,0|r,0|n)),({h:i,l:o}=K(0|this.Bh,0|this.Bl,0|i,0|o)),({h:s,l:a}=K(0|this.Ch,0|this.Cl,0|s,0|a)),({h:l,l:u}=K(0|this.Dh,0|this.Dl,0|l,0|u)),({h:f,l:c}=K(0|this.Eh,0|this.El,0|f,0|c)),({h:h,l:d}=K(0|this.Fh,0|this.Fl,0|h,0|d)),({h:p,l:y}=K(0|this.Gh,0|this.Gl,0|p,0|y)),({h:g,l:m}=K(0|this.Hh,0|this.Hl,0|g,0|m)),this.set(r,n,i,o,s,a,l,u,f,c,h,d,p,y,g,m)}roundClean(){l(Y,J)}destroy(){l(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}constructor(t=64){super(128,t,16,!1),this.Ah=0|S[0],this.Al=0|S[1],this.Bh=0|S[2],this.Bl=0|S[3],this.Ch=0|S[4],this.Cl=0|S[5],this.Dh=0|S[6],this.Dl=0|S[7],this.Eh=0|S[8],this.El=0|S[9],this.Fh=0|S[10],this.Fl=0|S[11],this.Gh=0|S[12],this.Gl=0|S[13],this.Hh=0|S[14],this.Hl=0|S[15]}}let X=x(()=>new Q),tt=x(()=>new $);class te extends E{update(t){return a(this),this.iHash.update(t),this}digestInto(t){a(this),o(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));let{oHash:e,iHash:r,finished:n,destroyed:i,blockLen:o,outputLen:s}=this;return t.finished=n,t.destroyed=i,t.blockLen=o,t.outputLen=s,t.oHash=e._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}constructor(t,e){super(),this.finished=!1,this.destroyed=!1,s(t);let r=w(e);if(this.iHash=t.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let n=this.blockLen,i=new Uint8Array(n);i.set(r.length>n?t.create().update(r).digest():r);for(let t=0;t<i.length;t++)i[t]^=54;this.iHash.update(i),this.oHash=t.create();for(let t=0;t<i.length;t++)i[t]^=106;this.oHash.update(i),l(i)}}let tr=(t,e,r)=>new te(t,e).update(r).digest();tr.create=(t,e)=>new te(t,e);let tn=BigInt(0),ti=BigInt(1);function to(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if("boolean"!=typeof t)throw Error((e&&'"'.concat(e,'"'))+"expected boolean, got type="+typeof t);return t}function ts(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=n(t),o=null==t?void 0:t.length,s=void 0!==e;if(!i||s&&o!==e){let n=i?"length=".concat(o):"type=".concat(typeof t);throw Error((r&&'"'.concat(r,'" '))+"expected Uint8Array"+(s?" of length ".concat(e):"")+", got "+n)}return t}function ta(t){let e=t.toString(16);return 1&e.length?"0"+e:e}function tl(t){if("string"!=typeof t)throw Error("hex string expected, got "+typeof t);return""===t?tn:BigInt("0x"+t)}function tu(t){return tl(p(t))}function tf(t){return o(t),tl(p(Uint8Array.from(t).reverse()))}function tc(t,e){return m(t.toString(16).padStart(2*e,"0"))}function th(t,e){return tc(t,e).reverse()}function td(t,e,r){let i;if("string"==typeof e)try{i=m(e)}catch(e){throw Error(t+" must be hex string or Uint8Array, cause: "+e)}else if(n(e))i=Uint8Array.from(e);else throw Error(t+" must be hex string or Uint8Array");let o=i.length;if("number"==typeof r&&o!==r)throw Error(t+" of length "+r+" expected, got "+o);return i}let tp=t=>"bigint"==typeof t&&tn<=t;function ty(t,e,r){return tp(t)&&tp(e)&&tp(r)&&e<=t&&t<r}function tg(t){let e;for(e=0;t>tn;t>>=ti,e+=1);return e}let tm=t=>(ti<<BigInt(t))-ti;function tb(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!t||"object"!=typeof t)throw Error("expected valid options object");function n(e,r,n){let i=t[e];if(n&&void 0===i)return;let o=typeof i;if(o!==r||null===i)throw Error('param "'.concat(e,'" is invalid: expected ').concat(r,", got ").concat(o))}Object.entries(e).forEach(t=>{let[e,r]=t;return n(e,r,!1)}),Object.entries(r).forEach(t=>{let[e,r]=t;return n(e,r,!0)})}function tw(t){let e=new WeakMap;return function(r){for(var n=arguments.length,i=Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];let s=e.get(r);if(void 0!==s)return s;let a=t(r,...i);return e.set(r,a),a}}let tv=BigInt(0),tE=BigInt(1),tx=BigInt(2),tB=BigInt(3),tk=BigInt(4),tA=BigInt(5),t_=BigInt(7),tI=BigInt(8),tS=BigInt(9),tU=BigInt(16);function tR(t,e){let r=t%e;return r>=tv?r:e+r}function tP(t,e,r){let n=t;for(;e-- >tv;)n*=n,n%=r;return n}function tO(t,e){if(t===tv)throw Error("invert: expected non-zero number");if(e<=tv)throw Error("invert: expected positive modulus, got "+e);let r=tR(t,e),n=e,i=tv,o=tE,s=tE,a=tv;for(;r!==tv;){let t=n/r,e=n%r,l=i-s*t,u=o-a*t;n=r,r=e,i=s,o=a,s=l,a=u}if(n!==tE)throw Error("invert: does not exist");return tR(i,e)}function tq(t,e,r){if(!t.eql(t.sqr(e),r))throw Error("Cannot find square root")}function tT(t,e){let r=(t.ORDER+tE)/tk,n=t.pow(e,r);return tq(t,n,e),n}function tM(t,e){let r=(t.ORDER-tA)/tI,n=t.mul(e,tx),i=t.pow(n,r),o=t.mul(e,i),s=t.mul(t.mul(o,tx),i),a=t.mul(o,t.sub(s,t.ONE));return tq(t,a,e),a}function tN(t){if(t<tB)throw Error("sqrt is not defined for small field");let e=t-tE,r=0;for(;e%tx===tv;)e/=tx,r++;let n=tx,i=tH(t);for(;1===tD(i,n);)if(n++>1e3)throw Error("Cannot find square root: probably non-prime P");if(1===r)return tT;let o=i.pow(n,e),s=(e+tE)/tx;return function(t,n){if(t.is0(n))return n;if(1!==tD(t,n))throw Error("Cannot find square root");let i=r,a=t.mul(t.ONE,o),l=t.pow(n,e),u=t.pow(n,s);for(;!t.eql(l,t.ONE);){if(t.is0(l))return t.ZERO;let e=1,r=t.sqr(l);for(;!t.eql(r,t.ONE);)if(e++,r=t.sqr(r),e===i)throw Error("Cannot find square root");let n=tE<<BigInt(i-e-1),o=t.pow(a,n);i=e,a=t.sqr(o),l=t.mul(l,a),u=t.mul(u,o)}return u}}let tK=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function tC(t){return tb(t,tK.reduce((t,e)=>(t[e]="function",t),{ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"})),t}function tF(t,e){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=Array(e.length).fill(r?t.ZERO:void 0),i=e.reduce((e,r,i)=>t.is0(r)?e:(n[i]=e,t.mul(e,r)),t.ONE),o=t.inv(i);return e.reduceRight((e,r,i)=>t.is0(r)?e:(n[i]=t.mul(e,n[i]),t.mul(e,r)),o),n}function tD(t,e){let r=(t.ORDER-tE)/tx,n=t.pow(e,r),i=t.eql(n,t.ONE),o=t.eql(n,t.ZERO),s=t.eql(n,t.neg(t.ONE));if(!i&&!o&&!s)throw Error("invalid Legendre symbol result");return i?1:o?0:-1}function tL(t,e){void 0!==e&&i(e);let r=void 0!==e?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function tH(t,e){let r,n,i,o,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(t<=tv)throw Error("invalid field: expected ORDER > 0, got "+t);let l=!1;if("object"==typeof e&&null!=e){if(a.sqrt||s)throw Error("cannot specify opts in two arguments");e.BITS&&(r=e.BITS),e.sqrt&&(n=e.sqrt),"boolean"==typeof e.isLE&&(s=e.isLE),"boolean"==typeof e.modFromBytes&&(l=e.modFromBytes),i=e.allowedLengths}else"number"==typeof e&&(r=e),a.sqrt&&(n=a.sqrt);let{nBitLength:u,nByteLength:f}=tL(t,r);if(f>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let c=Object.freeze({ORDER:t,isLE:s,BITS:u,BYTES:f,MASK:tm(u),ZERO:tv,ONE:tE,allowedLengths:i,create:e=>tR(e,t),isValid:e=>{if("bigint"!=typeof e)throw Error("invalid field element: expected bigint, got "+typeof e);return tv<=e&&e<t},is0:t=>t===tv,isValidNot0:t=>!c.is0(t)&&c.isValid(t),isOdd:t=>(t&tE)===tE,neg:e=>tR(-e,t),eql:(t,e)=>t===e,sqr:e=>tR(e*e,t),add:(e,r)=>tR(e+r,t),sub:(e,r)=>tR(e-r,t),mul:(e,r)=>tR(e*r,t),pow:(t,e)=>(function(t,e,r){if(r<tv)throw Error("invalid exponent, negatives unsupported");if(r===tv)return t.ONE;if(r===tE)return e;let n=t.ONE,i=e;for(;r>tv;)r&tE&&(n=t.mul(n,i)),i=t.sqr(i),r>>=tE;return n})(c,t,e),div:(e,r)=>tR(e*tO(r,t),t),sqrN:t=>t*t,addN:(t,e)=>t+e,subN:(t,e)=>t-e,mulN:(t,e)=>t*e,inv:e=>tO(e,t),sqrt:n||(e=>(o||(o=t%tk===tB?tT:t%tI===tA?tM:t%tU===tS?function(t){let e=tH(t),r=tN(t),n=r(e,e.neg(e.ONE)),i=r(e,n),o=r(e,e.neg(n)),s=(t+t_)/tU;return(t,e)=>{let r=t.pow(e,s),a=t.mul(r,n),l=t.mul(r,i),u=t.mul(r,o),f=t.eql(t.sqr(a),e),c=t.eql(t.sqr(l),e);r=t.cmov(r,a,f),a=t.cmov(u,l,c);let h=t.eql(t.sqr(a),e),d=t.cmov(r,a,h);return tq(t,d,e),d}}(t):tN(t)),o(c,e))),toBytes:t=>s?th(t,f):tc(t,f),fromBytes:function(e){let r=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(i){if(!i.includes(e.length)||e.length>f)throw Error("Field.fromBytes: expected "+i+" bytes, got "+e.length);let t=new Uint8Array(f);t.set(e,s?0:t.length-e.length),e=t}if(e.length!==f)throw Error("Field.fromBytes: expected "+f+" bytes, got "+e.length);let n=s?tf(e):tu(e);if(l&&(n=tR(n,t)),!r&&!c.isValid(n))throw Error("invalid field element: outside of range 0..ORDER");return n},invertBatch:t=>tF(c,t),cmov:(t,e,r)=>r?e:t});return Object.freeze(c)}function tj(t){if("bigint"!=typeof t)throw Error("field order must be bigint");return Math.ceil(t.toString(2).length/8)}function tV(t){let e=tj(t);return e+Math.ceil(e/2)}function tz(t,e){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=t.length,i=tj(e),o=tV(e);if(n<16||n<o||n>1024)throw Error("expected "+o+"-1024 bytes of input, got "+n);let s=tR(r?tf(t):tu(t),e-tE)+tE;return r?th(s,i):tc(s,i)}let tQ=BigInt(0),tG=BigInt(1);function tW(t,e){let r=e.negate();return t?r:e}function tZ(t,e){let r=tF(t.Fp,e.map(t=>t.Z));return e.map((e,n)=>t.fromAffine(e.toAffine(r[n])))}function tY(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw Error("invalid window size, expected [1.."+e+"], got W="+t)}function tJ(t,e){tY(t,e);let r=Math.ceil(e/t)+1,n=2**(t-1),i=2**t;return{windows:r,windowSize:n,mask:tm(t),maxNumber:i,shiftBy:BigInt(t)}}function t$(t,e,r){let{windowSize:n,mask:i,maxNumber:o,shiftBy:s}=r,a=Number(t&i),l=t>>s;a>n&&(a-=o,l+=tG);let u=e*n,f=u+Math.abs(a)-1,c=0===a;return{nextN:l,offset:f,isZero:c,isNeg:a<0,isNegF:e%2!=0,offsetF:u}}let tX=new WeakMap,t0=new WeakMap;function t1(t){return t0.get(t)||1}function t2(t){if(t!==tQ)throw Error("invalid wNAF")}class t8{_unsafeLadder(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.ZERO,n=t;for(;e>tQ;)e&tG&&(r=r.add(n)),n=n.double(),e>>=tG;return r}precomputeWindow(t,e){let{windows:r,windowSize:n}=tJ(e,this.bits),i=[],o=t,s=o;for(let t=0;t<r;t++){s=o,i.push(s);for(let t=1;t<n;t++)s=s.add(o),i.push(s);o=s.double()}return i}wNAF(t,e,r){if(!this.Fn.isValid(r))throw Error("invalid scalar");let n=this.ZERO,i=this.BASE,o=tJ(t,this.bits);for(let t=0;t<o.windows;t++){let{nextN:s,offset:a,isZero:l,isNeg:u,isNegF:f,offsetF:c}=t$(r,t,o);r=s,l?i=i.add(tW(f,e[c])):n=n.add(tW(u,e[a]))}return t2(r),{p:n,f:i}}wNAFUnsafe(t,e,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.ZERO,i=tJ(t,this.bits);for(let t=0;t<i.windows&&r!==tQ;t++){let{nextN:o,offset:s,isZero:a,isNeg:l}=t$(r,t,i);if(r=o,!a){let t=e[s];n=n.add(l?t.negate():t)}}return t2(r),n}getPrecomputes(t,e,r){let n=tX.get(e);return n||(n=this.precomputeWindow(e,t),1!==t&&("function"==typeof r&&(n=r(n)),tX.set(e,n))),n}cached(t,e,r){let n=t1(t);return this.wNAF(n,this.getPrecomputes(n,t,r),e)}unsafe(t,e,r,n){let i=t1(t);return 1===i?this._unsafeLadder(t,e,n):this.wNAFUnsafe(i,this.getPrecomputes(i,t,r),e,n)}createCache(t,e){tY(e,this.bits),t0.set(t,e),tX.delete(t)}hasCache(t){return 1!==t1(t)}constructor(t,e){this.BASE=t.BASE,this.ZERO=t.ZERO,this.Fn=t.Fn,this.bits=e}}function t6(t,e,r){if(!e)return tH(t,{isLE:r});if(e.ORDER!==t)throw Error("Field.ORDER must match order: Fp == p, Fn == n");return tC(e),e}let t3=(t,e)=>(t+(t>=0?e:-e)/ee)/e;function t5(t){if(!["compact","recovered","der"].includes(t))throw Error('Signature format must be "compact", "recovered", or "der"');return t}function t4(t,e){let r={};for(let n of Object.keys(e))r[n]=void 0===t[n]?e[n]:t[n];return to(r.lowS,"lowS"),to(r.prehash,"prehash"),void 0!==r.format&&t5(r.format),r}let t7={Err:class extends Error{constructor(t=""){super(t)}},_tlv:{encode:(t,e)=>{let{Err:r}=t7;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(1&e.length)throw new r("tlv.encode: unpadded data");let n=e.length/2,i=ta(n);if(i.length/2&128)throw new r("tlv.encode: long form length too big");let o=n>127?ta(i.length/2|128):"";return ta(t)+o+i+e},decode(t,e){let{Err:r}=t7,n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");let i=e[n++],o=0;if(128&i){let t=127&i;if(!t)throw new r("tlv.decode(long): indefinite length not supported");if(t>4)throw new r("tlv.decode(long): byte length is too big");let s=e.subarray(n,n+t);if(s.length!==t)throw new r("tlv.decode: length bytes not complete");if(0===s[0])throw new r("tlv.decode(long): zero leftmost byte");for(let t of s)o=o<<8|t;if(n+=t,o<128)throw new r("tlv.decode(long): not minimal encoding")}else o=i;let s=e.subarray(n,n+o);if(s.length!==o)throw new r("tlv.decode: wrong value length");return{v:s,l:e.subarray(n+o)}}},_int:{encode(t){let{Err:e}=t7;if(t<t9)throw new e("integer: negative integers are not allowed");let r=ta(t);if(8&Number.parseInt(r[0],16)&&(r="00"+r),1&r.length)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){let{Err:e}=t7;if(128&t[0])throw new e("invalid signature integer: negative");if(0===t[0]&&!(128&t[1]))throw new e("invalid signature integer: unnecessary leading zero");return tu(t)}},toSig(t){let{Err:e,_int:r,_tlv:n}=t7,i=td("signature",t),{v:o,l:s}=n.decode(48,i);if(s.length)throw new e("invalid signature: left bytes after parsing");let{v:a,l:l}=n.decode(2,o),{v:u,l:f}=n.decode(2,l);if(f.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(t){let{_tlv:e,_int:r}=t7,n=e.encode(2,r.encode(t.r)),i=e.encode(2,r.encode(t.s));return e.encode(48,n+i)}},t9=BigInt(0),et=BigInt(1),ee=BigInt(2),er=BigInt(3),en=BigInt(4);function ei(t,e){let r,{BYTES:n}=t;if("bigint"==typeof e)r=e;else{let i=td("private key",e);try{r=t.fromBytes(i)}catch(t){throw Error("invalid private key: expected ui8a of size ".concat(n,", got ").concat(typeof e))}}if(!t.isValidNot0(r))throw Error("invalid private key: out of range [1..N-1]");return r}function eo(t){return Uint8Array.of(t?2:3)}function es(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}b("HashToScalar-");let ea={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},el={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]},eu=BigInt(0),ef=BigInt(1),ec=BigInt(2),eh=tH(ea.p,{sqrt:function(t){let e=ea.p,r=BigInt(3),n=BigInt(6),i=BigInt(11),o=BigInt(22),s=BigInt(23),a=BigInt(44),l=BigInt(88),u=t*t*t%e,f=u*u*t%e,c=tP(f,r,e)*f%e,h=tP(c,r,e)*f%e,d=tP(h,ec,e)*u%e,p=tP(d,i,e)*d%e,y=tP(p,o,e)*p%e,g=tP(y,a,e)*y%e,m=tP(g,l,e)*g%e,b=tP(m,a,e)*y%e,w=tP(b,r,e)*f%e,v=tP(w,s,e)*p%e,E=tP(v,n,e)*u%e,x=tP(E,ec,e);if(!eh.eql(eh.sqr(x),t))throw Error("Cannot find square root");return x}}),ed=function(t,e){let r=e=>(function(t){let{CURVE:e,curveOpts:r,hash:i,ecdsaOpts:o}=function(t){let{CURVE:e,curveOpts:r}=function(t){let e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp,n=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(t=>Math.ceil(t/2)))):void 0,i={Fp:r,Fn:tH(e.n,{BITS:t.nBitLength,allowedLengths:n,modFromBytes:t.wrapPrivateKey}),allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:i}}(t),n={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:r,hash:t.hash,ecdsaOpts:n}}(t),a=function(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};s(e),tb(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});let i=r.randomBytes||B,o=r.hmac||function(t){for(var r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return tr(e,t,v(...n))},{Fp:a,Fn:l}=t,{ORDER:u,BITS:f}=l,{keygen:c,getPublicKey:h,getSharedSecret:d,utils:y,lengths:g}=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{Fn:r}=t,n=e.randomBytes||B,i=Object.assign(es(t.Fp,r),{seed:tV(r.ORDER)});function o(t){try{return!!ei(r,t)}catch(t){return!1}}function s(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n(i.seed);return tz(ts(t,i.seed,"seed"),r.ORDER)}function a(e){let n=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return t.BASE.multiply(ei(r,e)).toBytes(n)}function l(e){if("bigint"==typeof e)return!1;if(e instanceof t)return!0;let{secretKey:n,publicKey:o,publicKeyUncompressed:s}=i;if(r.allowedLengths||n===o)return;let a=td("key",e).length;return a===o||a===s}return Object.freeze({getPublicKey:a,getSharedSecret:function(e,n){let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(!0===l(e))throw Error("first arg must be private key");if(!1===l(n))throw Error("second arg must be public key");let o=ei(r,e);return t.fromHex(n).multiply(o).toBytes(i)},keygen:function(t){let e=s(t);return{secretKey:e,publicKey:a(e)}},Point:t,utils:{isValidSecretKey:o,isValidPublicKey:function(e,r){let{publicKey:n,publicKeyUncompressed:o}=i;try{let i=e.length;if(!0===r&&i!==n||!1===r&&i!==o)return!1;return!!t.fromBytes(e)}catch(t){return!1}},randomSecretKey:s,isValidPrivateKey:o,randomPrivateKey:s,normPrivateKeyToScalar:t=>ei(r,t),precompute(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.BASE;return r.precompute(e,!1)}},lengths:i})}(t,r),b={prehash:!1,lowS:"boolean"==typeof r.lowS&&r.lowS,format:void 0,extraEntropy:!1},w="compact";function E(t,e){if(!l.isValidNot0(e))throw Error("invalid signature ".concat(t,": out of range 1..Point.Fn.ORDER"));return e}class x{static fromBytes(t){let e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w;if(!function(t,e){t5(e);let r=g.signature;ts(t,"compact"===e?r:"recovered"===e?r+1:void 0,"".concat(e," signature"))}(t,r),"der"===r){let{r:e,s:r}=t7.toSig(ts(t));return new x(e,r)}"recovered"===r&&(e=t[0],r="compact",t=t.subarray(1));let n=l.BYTES,i=t.subarray(0,n),o=t.subarray(n,2*n);return new x(l.fromBytes(i),l.fromBytes(o),e)}static fromHex(t,e){return this.fromBytes(m(t),e)}addRecoveryBit(t){return new x(this.r,this.s,t)}recoverPublicKey(e){let r=a.ORDER,{r:n,s:i,recovery:o}=this;if(null==o||![0,1,2,3].includes(o))throw Error("recovery id invalid");if(u*ee<r&&o>1)throw Error("recovery id is ambiguous for h>1 curve");let s=2===o||3===o?n+u:n;if(!a.isValid(s))throw Error("recovery id 2 or 3 invalid");let f=a.toBytes(s),c=t.fromBytes(v(eo((1&o)==0),f)),h=l.inv(s),d=A(td("msgHash",e)),p=l.create(-d*h),y=l.create(i*h),g=t.BASE.multiplyUnsafe(p).add(c.multiplyUnsafe(y));if(g.is0())throw Error("point at infinify");return g.assertValidity(),g}hasHighS(){return this.s>u>>et}toBytes(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w;if(t5(t),"der"===t)return m(t7.hexFromSig(this));let e=l.toBytes(this.r),r=l.toBytes(this.s);if("recovered"===t){if(null==this.recovery)throw Error("recovery bit must be present");return v(Uint8Array.of(this.recovery),e,r)}return v(e,r)}toHex(t){return p(this.toBytes(t))}assertValidity(){}static fromCompact(t){return x.fromBytes(td("sig",t),"compact")}static fromDER(t){return x.fromBytes(td("sig",t),"der")}normalizeS(){return this.hasHighS()?new x(this.r,l.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return p(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return p(this.toBytes("compact"))}constructor(t,e,r){this.r=E("r",t),this.s=E("s",e),null!=r&&(this.recovery=r),Object.freeze(this)}}let k=r.bits2int||function(t){if(t.length>8192)throw Error("input is too large");let e=tu(t),r=8*t.length-f;return r>0?e>>BigInt(r):e},A=r.bits2int_modN||function(t){return l.create(k(t))},_=tm(f);function I(t){var e="num < 2^"+f;if(!ty(t,t9,_))throw Error("expected valid "+e+": "+t9+" <= n < "+_+", got "+t);return l.toBytes(t)}function S(t,r){return ts(t,void 0,"message"),r?ts(e(t),void 0,"prehashed message"):t}return Object.freeze({keygen:c,getPublicKey:h,getSharedSecret:d,utils:y,lengths:g,Point:t,sign:function(r,n){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{seed:a,k2sig:f}=function(e,r,n){if(["recovered","canonical"].some(t=>t in n))throw Error("sign() legacy options not supported");let{lowS:o,prehash:s,extraEntropy:a}=t4(n,b),f=A(e=S(e,s)),c=ei(l,r),h=[I(c),I(f)];if(null!=a&&!1!==a){let t=!0===a?i(g.secretKey):a;h.push(td("extraEntropy",t))}return{seed:v(...h),k2sig:function(e){let r=k(e);if(!l.isValidNot0(r))return;let n=l.inv(r),i=t.BASE.multiply(r).toAffine(),s=l.create(i.x);if(s===t9)return;let a=l.create(n*l.create(f+s*c));if(a===t9)return;let h=2*(i.x!==s)|Number(i.y&et),d=a;return o&&a>u>>et&&(d=l.neg(a),h^=1),new x(s,d,h)}}}(r=td("message",r),n,s);return(function(t,e,r){if("number"!=typeof t||t<2)throw Error("hashLen must be a number");if("number"!=typeof e||e<2)throw Error("qByteLen must be a number");if("function"!=typeof r)throw Error("hmacFn must be a function");let n=t=>new Uint8Array(t),i=t=>Uint8Array.of(t),o=n(t),s=n(t),a=0,l=()=>{o.fill(1),s.fill(0),a=0},u=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return r(s,o,...e)},f=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n(0);s=u(i(0),t),o=u(),0!==t.length&&(s=u(i(1),t),o=u())},c=()=>{if(a++>=1e3)throw Error("drbg: tried 1000 values");let t=0,r=[];for(;t<e;){let e=(o=u()).slice();r.push(e),t+=o.length}return v(...r)};return(t,e)=>{let r;for(l(),f(t);!(r=e(c()));)f();return l(),r}})(e.outputLen,l.BYTES,o)(a,f)},verify:function(e,r,i){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{lowS:s,prehash:a,format:u}=t4(o,b);if(i=td("publicKey",i),r=S(td("message",r),a),"strict"in o)throw Error("options.strict was renamed to lowS");let f=void 0===u?function(t){let e,r="string"==typeof t||n(t),i=!r&&null!==t&&"object"==typeof t&&"bigint"==typeof t.r&&"bigint"==typeof t.s;if(!r&&!i)throw Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(i)e=new x(t.r,t.s);else if(r){try{e=x.fromBytes(td("sig",t),"der")}catch(t){if(!(t instanceof t7.Err))throw t}if(!e)try{e=x.fromBytes(td("sig",t),"compact")}catch(t){return!1}}return!!e&&e}(e):x.fromBytes(td("sig",e),u);if(!1===f)return!1;try{let e=t.fromBytes(i);if(s&&f.hasHighS())return!1;let{r:n,s:o}=f,a=A(r),u=l.inv(o),c=l.create(a*u),h=l.create(n*u),d=t.BASE.multiplyUnsafe(c).add(e.multiplyUnsafe(h));if(d.is0())return!1;return l.create(d.x)===n}catch(t){return!1}},recoverPublicKey:function(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{prehash:n}=t4(r,b);return e=S(e,n),x.fromBytes(t,"recovered").recoverPublicKey(e).toBytes()},Signature:x,hash:e})}(function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=function(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;if(void 0===n&&(n="edwards"===t),!e||"object"!=typeof e)throw Error("expected valid ".concat(t," CURVE object"));for(let t of["p","n","h"]){let r=e[t];if(!("bigint"==typeof r&&r>tQ))throw Error("CURVE.".concat(t," must be positive bigint"))}let i=t6(e.p,r.Fp,n),o=t6(e.n,r.Fn,n);for(let r of["Gx","Gy","a","weierstrass"===t?"b":"d"])if(!i.isValid(e[r]))throw Error("CURVE.".concat(r," must be valid field element of CURVE.Fp"));return{CURVE:e=Object.freeze(Object.assign({},e)),Fp:i,Fn:o}}("weierstrass",t,e),{Fp:n,Fn:i}=r,o=r.CURVE,{h:s,n:a}=o;tb(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:l}=e;if(l&&(!n.is0(o.a)||"bigint"!=typeof l.beta||!Array.isArray(l.basises)))throw Error('invalid endo: expected "beta": bigint and "basises": array');let u=es(n,i);function f(){if(!n.isOdd)throw Error("compression is not supported: Field does not have .isOdd()")}let c=e.toBytes||function(t,e,r){let{x:i,y:o}=e.toAffine(),s=n.toBytes(i);return(to(r,"isCompressed"),r)?(f(),v(eo(!n.isOdd(o)),s)):v(Uint8Array.of(4),s,n.toBytes(o))},h=e.fromBytes||function(t){ts(t,void 0,"Point");let{publicKey:e,publicKeyUncompressed:r}=u,i=t.length,o=t[0],s=t.subarray(1);if(i===e&&(2===o||3===o)){let t,e=n.fromBytes(s);if(!n.isValid(e))throw Error("bad point: is not on curve, wrong x");let r=d(e);try{t=n.sqrt(r)}catch(t){throw Error("bad point: is not on curve, sqrt error"+(t instanceof Error?": "+t.message:""))}return f(),(1&o)==1!==n.isOdd(t)&&(t=n.neg(t)),{x:e,y:t}}if(i===r&&4===o){let t=n.BYTES,e=n.fromBytes(s.subarray(0,t)),r=n.fromBytes(s.subarray(t,2*t));if(!y(e,r))throw Error("bad point: is not on curve");return{x:e,y:r}}throw Error("bad point: got length ".concat(i,", expected compressed=").concat(e," or uncompressed=").concat(r))};function d(t){let e=n.sqr(t),r=n.mul(e,t);return n.add(n.add(r,n.mul(t,o.a)),o.b)}function y(t,e){let r=n.sqr(e),i=d(t);return n.eql(r,i)}if(!y(o.Gx,o.Gy))throw Error("bad curve params: generator point");let g=n.mul(n.pow(o.a,er),en),m=n.mul(n.sqr(o.b),BigInt(27));if(n.is0(n.add(g,m)))throw Error("bad curve params: a or b");function b(t,e){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!n.isValid(e)||r&&n.is0(e))throw Error("bad point coordinate ".concat(t));return e}function w(t){if(!(t instanceof A))throw Error("ProjectivePoint expected")}function E(t){if(!l||!l.basises)throw Error("no endo");return function(t,e,r){let[[n,i],[o,s]]=e,a=t3(s*t,r),l=t3(-i*t,r),u=t-a*n-l*o,f=-a*i-l*s,c=u<t9,h=f<t9;c&&(u=-u),h&&(f=-f);let d=tm(Math.ceil(tg(r)/2))+et;if(u<t9||u>=d||f<t9||f>=d)throw Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:c,k1:u,k2neg:h,k2:f}}(t,l.basises,i.ORDER)}let x=tw((t,e)=>{let{X:r,Y:i,Z:o}=t;if(n.eql(o,n.ONE))return{x:r,y:i};let s=t.is0();null==e&&(e=s?n.ONE:n.inv(o));let a=n.mul(r,e),l=n.mul(i,e),u=n.mul(o,e);if(s)return{x:n.ZERO,y:n.ZERO};if(!n.eql(u,n.ONE))throw Error("invZ was invalid");return{x:a,y:l}}),B=tw(t=>{if(t.is0()){if(e.allowInfinityPoint&&!n.is0(t.Y))return;throw Error("bad point: ZERO")}let{x:r,y:i}=t.toAffine();if(!n.isValid(r)||!n.isValid(i))throw Error("bad point: x or y not field elements");if(!y(r,i))throw Error("bad point: equation left != right");if(!t.isTorsionFree())throw Error("bad point: not in prime-order subgroup");return!0});function k(t,e,r,i,o){return r=new A(n.mul(r.X,t),r.Y,r.Z),e=tW(i,e),r=tW(o,r),e.add(r)}class A{static CURVE(){return o}static fromAffine(t){let{x:e,y:r}=t||{};if(!t||!n.isValid(e)||!n.isValid(r))throw Error("invalid affine point");if(t instanceof A)throw Error("projective point not allowed");return n.is0(e)&&n.is0(r)?A.ZERO:new A(e,r,n.ONE)}static fromBytes(t){let e=A.fromAffine(h(ts(t,void 0,"point")));return e.assertValidity(),e}static fromHex(t){return A.fromBytes(td("pointHex",t))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,e=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return I.createCache(this,t),e||this.multiply(er),this}assertValidity(){B(this)}hasEvenY(){let{y:t}=this.toAffine();if(!n.isOdd)throw Error("Field doesn't support isOdd");return!n.isOdd(t)}equals(t){w(t);let{X:e,Y:r,Z:i}=this,{X:o,Y:s,Z:a}=t,l=n.eql(n.mul(e,a),n.mul(o,i)),u=n.eql(n.mul(r,a),n.mul(s,i));return l&&u}negate(){return new A(this.X,n.neg(this.Y),this.Z)}double(){let{a:t,b:e}=o,r=n.mul(e,er),{X:i,Y:s,Z:a}=this,l=n.ZERO,u=n.ZERO,f=n.ZERO,c=n.mul(i,i),h=n.mul(s,s),d=n.mul(a,a),p=n.mul(i,s);return p=n.add(p,p),f=n.mul(i,a),f=n.add(f,f),l=n.mul(t,f),u=n.mul(r,d),u=n.add(l,u),l=n.sub(h,u),u=n.add(h,u),u=n.mul(l,u),l=n.mul(p,l),f=n.mul(r,f),d=n.mul(t,d),p=n.sub(c,d),p=n.mul(t,p),p=n.add(p,f),f=n.add(c,c),c=n.add(f,c),c=n.add(c,d),c=n.mul(c,p),u=n.add(u,c),d=n.mul(s,a),d=n.add(d,d),c=n.mul(d,p),l=n.sub(l,c),f=n.mul(d,h),f=n.add(f,f),new A(l,u,f=n.add(f,f))}add(t){w(t);let{X:e,Y:r,Z:i}=this,{X:s,Y:a,Z:l}=t,u=n.ZERO,f=n.ZERO,c=n.ZERO,h=o.a,d=n.mul(o.b,er),p=n.mul(e,s),y=n.mul(r,a),g=n.mul(i,l),m=n.add(e,r),b=n.add(s,a);m=n.mul(m,b),b=n.add(p,y),m=n.sub(m,b),b=n.add(e,i);let v=n.add(s,l);return b=n.mul(b,v),v=n.add(p,g),b=n.sub(b,v),v=n.add(r,i),u=n.add(a,l),v=n.mul(v,u),u=n.add(y,g),v=n.sub(v,u),c=n.mul(h,b),u=n.mul(d,g),c=n.add(u,c),u=n.sub(y,c),c=n.add(y,c),f=n.mul(u,c),y=n.add(p,p),y=n.add(y,p),g=n.mul(h,g),b=n.mul(d,b),y=n.add(y,g),g=n.sub(p,g),g=n.mul(h,g),b=n.add(b,g),p=n.mul(y,b),f=n.add(f,p),p=n.mul(v,b),u=n.mul(m,u),u=n.sub(u,p),p=n.mul(m,y),c=n.mul(v,c),new A(u,f,c=n.add(c,p))}subtract(t){return this.add(t.negate())}is0(){return this.equals(A.ZERO)}multiply(t){let r,n,{endo:o}=e;if(!i.isValidNot0(t))throw Error("invalid scalar: out of range");let s=t=>I.cached(this,t,t=>tZ(A,t));if(o){let{k1neg:e,k1:i,k2neg:a,k2:l}=E(t),{p:u,f:f}=s(i),{p:c,f:h}=s(l);n=f.add(h),r=k(o.beta,u,c,e,a)}else{let{p:e,f:i}=s(t);r=e,n=i}return tZ(A,[r,n])[0]}multiplyUnsafe(t){let{endo:r}=e;if(!i.isValid(t))throw Error("invalid scalar: out of range");if(t===t9||this.is0())return A.ZERO;if(t===et)return this;if(I.hasCache(this))return this.multiply(t);if(!r)return I.unsafe(this,t);{let{k1neg:e,k1:n,k2neg:i,k2:o}=E(t),{p1:s,p2:a}=function(t,e,r,n){let i=e,o=t.ZERO,s=t.ZERO;for(;r>tQ||n>tQ;)r&tG&&(o=o.add(i)),n&tG&&(s=s.add(i)),i=i.double(),r>>=tG,n>>=tG;return{p1:o,p2:s}}(A,this,n,o);return k(r.beta,s,a,e,i)}}multiplyAndAddUnsafe(t,e,r){let n=this.multiplyUnsafe(e).add(t.multiplyUnsafe(r));return n.is0()?void 0:n}toAffine(t){return x(this,t)}isTorsionFree(){let{isTorsionFree:t}=e;return s===et||(t?t(A,this):I.unsafe(this,a).is0())}clearCofactor(){let{clearCofactor:t}=e;return s===et?this:t?t(A,this):this.multiplyUnsafe(s)}isSmallOrder(){return this.multiplyUnsafe(s).is0()}toBytes(){let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return to(t,"isCompressed"),this.assertValidity(),c(A,this,t)}toHex(){let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return p(this.toBytes(t))}toString(){return"<Point ".concat(this.is0()?"ZERO":this.toHex(),">")}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(){let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return this.toBytes(t)}_setWindowSize(t){this.precompute(t)}static normalizeZ(t){return tZ(A,t)}static msm(t,e){return function(t,e,r,n){if(!Array.isArray(r))throw Error("array expected");r.forEach((e,r)=>{if(!(e instanceof t))throw Error("invalid point at index "+r)});if(!Array.isArray(n))throw Error("array of scalars expected");n.forEach((t,r)=>{if(!e.isValid(t))throw Error("invalid scalar at index "+r)});let i=r.length,o=n.length;if(i!==o)throw Error("arrays of points and scalars must have equal length");let s=t.ZERO,a=tg(BigInt(i)),l=1;a>12?l=a-3:a>4?l=a-2:a>0&&(l=2);let u=tm(l),f=Array(Number(u)+1).fill(s),c=Math.floor((e.BITS-1)/l)*l,h=s;for(let t=c;t>=0;t-=l){f.fill(s);for(let e=0;e<o;e++){let i=Number(n[e]>>BigInt(t)&u);f[i]=f[i].add(r[e])}let e=s;for(let t=f.length-1,r=s;t>0;t--)r=r.add(f[t]),e=e.add(r);if(h=h.add(e),0!==t)for(let t=0;t<l;t++)h=h.double()}return h}(A,i,t,e)}static fromPrivateKey(t){return A.BASE.multiply(ei(i,t))}constructor(t,e,r){this.X=b("x",t),this.Y=b("y",e,!0),this.Z=b("z",r),Object.freeze(this)}}A.BASE=new A(o.Gx,o.Gy,n.ONE),A.ZERO=new A(n.ZERO,n.ONE,n.ZERO),A.Fp=n,A.Fn=i;let _=i.BITS,I=new t8(A,e.endo?Math.ceil(_/2):_);return A.BASE.precompute(8),A}(e,r),i,o),l=a.Point;return Object.assign({},a,{ProjectivePoint:l,CURVE:Object.assign({},t,tL(l.Fn.ORDER,l.Fn.BITS))})})({...t,hash:e});return{...r(e),create:r}}({...ea,Fp:eh,lowS:!0,endo:el},X),ep={};function ey(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];let i=ep[t];if(void 0===i){let e=X(b(t));i=v(e,e),ep[t]=i}return X(v(i,...r))}let eg=t=>t.toBytes(!0).slice(1),em=ed.Point;function eb(t){let{Fn:e,BASE:r}=em,n=ei(e,t),i=r.multiply(n);return{scalar:i.y%ec===eu?n:e.neg(n),bytes:eg(i)}}function ew(t){if(!eh.isValidNot0(t))throw Error("invalid x: Fail if x â‰¥ p");let e=eh.create(t*t),r=eh.create(e*t+BigInt(7)),n=eh.sqrt(r);n%ec!==eu&&(n=eh.neg(n));let i=em.fromAffine({x:t,y:n});return i.assertValidity(),i}function ev(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return em.Fn.create(tu(ey("BIP0340/challenge",...e)))}function eE(t){return eb(t).bytes}function ex(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B(32),{Fn:n}=em,i=td("message",t),{bytes:o,scalar:s}=eb(e),a=td("auxRand",r,32),l=n.toBytes(s^tu(ey("BIP0340/aux",a))),{bytes:u,scalar:f}=eb(ey("BIP0340/nonce",l,o,i)),c=ev(u,o,i),h=new Uint8Array(64);if(h.set(u,0),h.set(n.toBytes(n.create(f+c*s)),32),!eB(h,i,o))throw Error("sign: Invalid signature produced");return h}function eB(t,e,r){let{Fn:n,BASE:i}=em,o=td("signature",t,64),s=td("message",e),a=td("publicKey",r,32);try{let t=ew(tu(a)),e=tu(o.subarray(0,32));if(!ty(e,ef,ea.p))return!1;let r=tu(o.subarray(32,64));if(!ty(r,ef,ea.n))return!1;let l=ev(n.toBytes(e),eg(t),s),u=i.multiplyUnsafe(r).add(t.multiplyUnsafe(n.neg(l))),{x:f,y:c}=u.toAffine();if(u.is0()||c%ec!==eu||f!==e)return!1;return!0}catch(t){return!1}}let ek=(()=>{let t=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B(48);return tz(t,ea.n)};return ed.utils.randomSecretKey,{keygen:function(e){let r=t(e);return{secretKey:r,publicKey:eE(r)}},getPublicKey:eE,sign:ex,verify:eB,Point:em,utils:{randomSecretKey:t,randomPrivateKey:t,taggedHash:ey,lift_x:ew,pointToBytes:eg,numberToBytesBE:tc,bytesToNumberBE:tu,mod:tR},lengths:{secretKey:32,publicKey:32,publicKeyHasPrefix:!1,signature:64,seed:48}}})(),eA=function(t,e){let r=e.map(t=>Array.from(t).reverse());return(e,n)=>{let[i,o,s,a]=r.map(r=>r.reduce((r,n)=>t.add(t.mul(r,e),n))),[l,u]=tF(t,[o,a],!0);return e=t.mul(i,l),n=t.mul(n,t.mul(s,u)),{x:e,y:n}}}(eh,[["0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa8c7","0x7d3d4c80bc321d5b9f315cea7fd44c5d595d2fc0bf63b92dfff1044f17c6581","0x534c328d23f234e6e2a413deca25caece4506144037c40314ecbd0b53d9dd262","0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa88c"],["0xd35771193d94918a9ca34ccbb7b640dd86cd409542f8487d9fe6b745781eb49b","0xedadc6f64383dc1df7c4b2d51b54225406d36b641f5e41bbc52a56612a8c6d14","0x0000000000000000000000000000000000000000000000000000000000000001"],["0x4bda12f684bda12f684bda12f684bda12f684bda12f684bda12f684b8e38e23c","0xc75e0c32d5cb7c0fa9d0a54b12a0a6d5647ab046d686da6fdffc90fc201d71a3","0x29a6194691f91a73715209ef6512e576722830a201be2018a765e85a9ecee931","0x2f684bda12f684bda12f684bda12f684bda12f684bda12f684bda12f38e38d84"],["0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffff93b","0x7a06534bb8bdb49fd5e9e6632722c2989467c1bfc8e8d978dfb425d2685c2573","0x6484aa716545ca2cf3a70c3fa8fe337e0a3d21162f0d6299a7bf8192bfd2a76f","0x0000000000000000000000000000000000000000000000000000000000000001"]].map(t=>t.map(t=>BigInt(t)))),e_=function(t,e){tC(t);let{A:r,B:n,Z:i}=e;if(!t.isValid(r)||!t.isValid(n)||!t.isValid(i))throw Error("mapToCurveSimpleSWU: invalid opts");let o=function(t,e){let r=t.ORDER,n=t9;for(let t=r-et;t%ee===t9;t/=ee)n+=et;let i=n,o=ee<<i-et-et,s=o*ee,a=(r-et)/s,l=(a-et)/ee,u=s-et,f=t.pow(e,a),c=t.pow(e,(a+et)/ee),h=(e,r)=>{let n=f,s=t.pow(r,u),a=t.sqr(s);a=t.mul(a,r);let h=t.mul(e,a);h=t.pow(h,l),h=t.mul(h,s),s=t.mul(h,r),a=t.mul(h,e);let d=t.mul(a,s);h=t.pow(d,o);let p=t.eql(h,t.ONE);s=t.mul(a,c),h=t.mul(d,n),a=t.cmov(s,a,p),d=t.cmov(h,d,p);for(let e=i;e>et;e--){let r=e-ee;r=ee<<r-et;let i=t.pow(d,r),o=t.eql(i,t.ONE);s=t.mul(a,n),n=t.mul(n,n),i=t.mul(d,n),a=t.cmov(s,a,o),d=t.cmov(i,d,o)}return{isValid:p,value:a}};if(t.ORDER%en===er){let r=(t.ORDER-er)/en,n=t.sqrt(t.neg(e));h=(e,i)=>{let o=t.sqr(i),s=t.mul(e,i);o=t.mul(o,s);let a=t.pow(o,r);a=t.mul(a,s);let l=t.mul(a,n),u=t.mul(t.sqr(a),i),f=t.eql(u,e),c=t.cmov(l,a,f);return{isValid:f,value:c}}}return h}(t,i);if(!t.isOdd)throw Error("Field does not have .isOdd()");return e=>{let s,a,l,u,f,c,h,d;s=t.sqr(e),s=t.mul(s,i),a=t.sqr(s),a=t.add(a,s),l=t.add(a,t.ONE),l=t.mul(l,n),u=t.cmov(i,t.neg(a),!t.eql(a,t.ZERO)),u=t.mul(u,r),a=t.sqr(l),c=t.sqr(u),f=t.mul(c,r),a=t.add(a,f),a=t.mul(a,l),c=t.mul(c,u),f=t.mul(c,n),a=t.add(a,f),h=t.mul(s,l);let{isValid:p,value:y}=o(a,c);d=t.mul(s,e),d=t.mul(d,y),h=t.cmov(h,l,p),d=t.cmov(d,y,p);let g=t.isOdd(e)===t.isOdd(d);d=t.cmov(t.neg(d),d,g);let m=tF(t,[u],!0)[0];return{x:h=t.mul(h,m),y:d}}}(eh,{A:BigInt("0x3f8731abdd661adca08a5558f0f5d272e953d363cb6f0e5d405447c01a444533"),B:BigInt("1771"),Z:eh.create(BigInt("-11"))});!function(t,e,r){if("function"!=typeof e)throw Error("mapToCurve() must be defined")}(ed.Point,t=>{let{x:e,y:r}=e_(eh.create(t[0]));return eA(e,r)},eh.ORDER);var eI,eS={},eU={};eU.byteLength=function(t){var e=eN(t),r=e[0],n=e[1];return(r+n)*3/4-n},eU.toByteArray=function(t){var e,r,n=eN(t),i=n[0],o=n[1],s=new eO((i+o)*3/4-o),a=0,l=o>0?i-4:i;for(r=0;r<l;r+=4)e=eP[t.charCodeAt(r)]<<18|eP[t.charCodeAt(r+1)]<<12|eP[t.charCodeAt(r+2)]<<6|eP[t.charCodeAt(r+3)],s[a++]=e>>16&255,s[a++]=e>>8&255,s[a++]=255&e;return 2===o&&(e=eP[t.charCodeAt(r)]<<2|eP[t.charCodeAt(r+1)]>>4,s[a++]=255&e),1===o&&(e=eP[t.charCodeAt(r)]<<10|eP[t.charCodeAt(r+1)]<<4|eP[t.charCodeAt(r+2)]>>2,s[a++]=e>>8&255,s[a++]=255&e),s},eU.fromByteArray=function(t){for(var e,r=t.length,n=r%3,i=[],o=0,s=r-n;o<s;o+=16383)i.push(function(t,e,r){for(var n,i=[],o=e;o<r;o+=3)i.push(eR[(n=(t[o]<<16&0xff0000)+(t[o+1]<<8&65280)+(255&t[o+2]))>>18&63]+eR[n>>12&63]+eR[n>>6&63]+eR[63&n]);return i.join("")}(t,o,o+16383>s?s:o+16383));return 1===n?i.push(eR[(e=t[r-1])>>2]+eR[e<<4&63]+"=="):2===n&&i.push(eR[(e=(t[r-2]<<8)+t[r-1])>>10]+eR[e>>4&63]+eR[e<<2&63]+"="),i.join("")};for(var eR=[],eP=[],eO="u">typeof Uint8Array?Uint8Array:Array,eq="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",eT=0,eM=eq.length;eT<eM;++eT)eR[eT]=eq[eT],eP[eq.charCodeAt(eT)]=eT;function eN(t){var e=t.length;if(e%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");-1===r&&(r=e);var n=r===e?0:4-r%4;return[r,n]}eP[45]=62,eP[95]=63;var eK={};eK.read=function(t,e,r,n,i){var o,s,a=8*i-n-1,l=(1<<a)-1,u=l>>1,f=-7,c=r?i-1:0,h=r?-1:1,d=t[e+c];for(c+=h,o=d&(1<<-f)-1,d>>=-f,f+=a;f>0;o=256*o+t[e+c],c+=h,f-=8);for(s=o&(1<<-f)-1,o>>=-f,f+=n;f>0;s=256*s+t[e+c],c+=h,f-=8);if(0===o)o=1-u;else{if(o===l)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,n),o-=u}return(d?-1:1)*s*Math.pow(2,o-n)},eK.write=function(t,e,r,n,i,o){var s,a,l,u=8*o-i-1,f=(1<<u)-1,c=f>>1,h=5960464477539062e-23*(23===i),d=n?0:o-1,p=n?1:-1,y=+(e<0||0===e&&1/e<0);for(isNaN(e=Math.abs(e))||e===1/0?(a=+!!isNaN(e),s=f):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),s+c>=1?e+=h/l:e+=h*Math.pow(2,1-c),e*l>=2&&(s++,l/=2),s+c>=f?(a=0,s=f):s+c>=1?(a=(e*l-1)*Math.pow(2,i),s+=c):(a=e*Math.pow(2,c-1)*Math.pow(2,i),s=0));i>=8;t[r+d]=255&a,d+=p,a/=256,i-=8);for(s=s<<i|a,u+=i;u>0;t[r+d]=255&s,d+=p,s/=256,u-=8);t[r+d-p]|=128*y},function(t){let e="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=s,t.SlowBuffer=function(t){return+t!=t&&(t=0),s.alloc(+t)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=0x7fffffff;let{Uint8Array:r,ArrayBuffer:n,SharedArrayBuffer:i}=globalThis;function o(t){if(t>0x7fffffff)throw RangeError('The value "'+t+'" is invalid for option "size"');let e=new r(t);return Object.setPrototypeOf(e,s.prototype),e}function s(t,e,r){if("number"==typeof t){if("string"==typeof e)throw TypeError('The "string" argument must be of type string. Received type number');return u(t)}return a(t,e,r)}function a(t,e,a){if("string"==typeof t){var l=t,u=e;if(("string"!=typeof u||""===u)&&(u="utf8"),!s.isEncoding(u))throw TypeError("Unknown encoding: "+u);let r=0|d(l,u),n=o(r),i=n.write(l,u);return i!==r&&(n=n.slice(0,i)),n}if(n.isView(t)){var p=t;if(N(p,r)){let t=new r(p);return c(t.buffer,t.byteOffset,t.byteLength)}return f(p)}if(null==t)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(N(t,n)||t&&N(t.buffer,n)||"u">typeof i&&(N(t,i)||t&&N(t.buffer,i)))return c(t,e,a);if("number"==typeof t)throw TypeError('The "value" argument must not be of type number. Received type number');let y=t.valueOf&&t.valueOf();if(null!=y&&y!==t)return s.from(y,e,a);let g=function(t){if(s.isBuffer(t)){let e=0|h(t.length),r=o(e);return 0===r.length||t.copy(r,0,0,e),r}return void 0!==t.length?"number"!=typeof t.length||function(t){return t!=t}(t.length)?o(0):f(t):"Buffer"===t.type&&Array.isArray(t.data)?f(t.data):void 0}(t);if(g)return g;if("u">typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return s.from(t[Symbol.toPrimitive]("string"),e,a);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function l(t){if("number"!=typeof t)throw TypeError('"size" argument must be of type number');if(t<0)throw RangeError('The value "'+t+'" is invalid for option "size"')}function u(t){return l(t),o(t<0?0:0|h(t))}function f(t){let e=t.length<0?0:0|h(t.length),r=o(e);for(let n=0;n<e;n+=1)r[n]=255&t[n];return r}function c(t,e,n){let i;if(e<0||t.byteLength<e)throw RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(n||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(i=void 0===e&&void 0===n?new r(t):void 0===n?new r(t,e):new r(t,e,n),s.prototype),i}function h(t){if(t>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|t}function d(t,e){if(s.isBuffer(t))return t.length;if(n.isView(t)||N(t,n))return t.byteLength;if("string"!=typeof t)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);let r=t.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===r)return 0;let o=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return q(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return T(t).length;default:if(o)return i?-1:q(t).length;e=(""+e).toLowerCase(),o=!0}}function p(t,e,r){let n=!1;if((void 0===e||e<0)&&(e=0),e>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0)||(r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return function(t,e,r){let n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);let i="";for(let n=e;n<r;++n)i+=K[t[n]];return i}(this,e,r);case"utf8":case"utf-8":return b(this,e,r);case"ascii":return function(t,e,r){let n="";r=Math.min(t.length,r);for(let i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}(this,e,r);case"latin1":case"binary":return function(t,e,r){let n="";r=Math.min(t.length,r);for(let i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}(this,e,r);case"base64":var i,o,s;return i=this,o=e,s=r,0===o&&s===i.length?eU.fromByteArray(i):eU.fromByteArray(i.slice(o,s));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(t,e,r){let n=t.slice(e,r),i="";for(let t=0;t<n.length-1;t+=2)i+=String.fromCharCode(n[t]+256*n[t+1]);return i}(this,e,r);default:if(n)throw TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function y(t,e,r){let n=t[e];t[e]=t[r],t[r]=n}function g(t,e,n,i,o){var a;if(0===t.length)return -1;if("string"==typeof n?(i=n,n=0):n>0x7fffffff?n=0x7fffffff:n<-0x80000000&&(n=-0x80000000),(a=n*=1)!=a&&(n=o?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(o)return -1;n=t.length-1}else if(n<0)if(!o)return -1;else n=0;if("string"==typeof e&&(e=s.from(e,i)),s.isBuffer(e))return 0===e.length?-1:m(t,e,n,i,o);if("number"==typeof e)return e&=255,"function"==typeof r.prototype.indexOf?o?r.prototype.indexOf.call(t,e,n):r.prototype.lastIndexOf.call(t,e,n):m(t,[e],n,i,o);throw TypeError("val must be string, number or Buffer")}function m(t,e,r,n,i){let o,s=1,a=t.length,l=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return -1;s=2,a/=2,l/=2,r/=2}function u(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(i){let n=-1;for(o=r;o<a;o++)if(u(t,o)===u(e,-1===n?0:o-n)){if(-1===n&&(n=o),o-n+1===l)return n*s}else -1!==n&&(o-=o-n),n=-1}else for(r+l>a&&(r=a-l),o=r;o>=0;o--){let r=!0;for(let n=0;n<l;n++)if(u(t,o+n)!==u(e,n)){r=!1;break}if(r)return o}return -1}function b(t,e,r){r=Math.min(t.length,r);let n=[],i=e;for(;i<r;){let e=t[i],o=null,s=e>239?4:e>223?3:e>191?2:1;if(i+s<=r){let r,n,a,l;switch(s){case 1:e<128&&(o=e);break;case 2:(192&(r=t[i+1]))==128&&(l=(31&e)<<6|63&r)>127&&(o=l);break;case 3:r=t[i+1],n=t[i+2],(192&r)==128&&(192&n)==128&&(l=(15&e)<<12|(63&r)<<6|63&n)>2047&&(l<55296||l>57343)&&(o=l);break;case 4:r=t[i+1],n=t[i+2],a=t[i+3],(192&r)==128&&(192&n)==128&&(192&a)==128&&(l=(15&e)<<18|(63&r)<<12|(63&n)<<6|63&a)>65535&&l<1114112&&(o=l)}}null===o?(o=65533,s=1):o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|1023&o),n.push(o),i+=s}var o=n;let s=o.length;if(s<=4096)return String.fromCharCode.apply(String,o);let a="",l=0;for(;l<s;)a+=String.fromCharCode.apply(String,o.slice(l,l+=4096));return a}function w(t,e,r){if(t%1!=0||t<0)throw RangeError("offset is not uint");if(t+e>r)throw RangeError("Trying to access beyond buffer length")}function v(t,e,r,n,i,o){if(!s.isBuffer(t))throw TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<o)throw RangeError('"value" argument is out of bounds');if(r+n>t.length)throw RangeError("Index out of range")}function E(t,e,r,n,i){U(e,n,i,t,r,7);let o=Number(e&BigInt(0xffffffff));t[r++]=o,o>>=8,t[r++]=o,o>>=8,t[r++]=o,o>>=8,t[r++]=o;let s=Number(e>>BigInt(32)&BigInt(0xffffffff));return t[r++]=s,s>>=8,t[r++]=s,s>>=8,t[r++]=s,s>>=8,t[r++]=s,r}function x(t,e,r,n,i){U(e,n,i,t,r,7);let o=Number(e&BigInt(0xffffffff));t[r+7]=o,o>>=8,t[r+6]=o,o>>=8,t[r+5]=o,o>>=8,t[r+4]=o;let s=Number(e>>BigInt(32)&BigInt(0xffffffff));return t[r+3]=s,s>>=8,t[r+2]=s,s>>=8,t[r+1]=s,s>>=8,t[r]=s,r+8}function B(t,e,r,n,i,o){if(r+n>t.length||r<0)throw RangeError("Index out of range")}function k(t,e,r,n,i){return e*=1,r>>>=0,i||B(t,e,r,4),eK.write(t,e,r,n,23,4),r+4}function A(t,e,r,n,i){return e*=1,r>>>=0,i||B(t,e,r,8),eK.write(t,e,r,n,52,8),r+8}s.TYPED_ARRAY_SUPPORT=function(){try{let t=new r(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,r.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(t){return!1}}(),!s.TYPED_ARRAY_SUPPORT&&"u">typeof console&&"function"==typeof console.error&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.buffer}}),Object.defineProperty(s.prototype,"offset",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.byteOffset}}),s.poolSize=8192,s.from=function(t,e,r){return a(t,e,r)},Object.setPrototypeOf(s.prototype,r.prototype),Object.setPrototypeOf(s,r),s.alloc=function(t,e,r){return l(t),t<=0?o(t):void 0!==e?"string"==typeof r?o(t).fill(e,r):o(t).fill(e):o(t)},s.allocUnsafe=function(t){return u(t)},s.allocUnsafeSlow=function(t){return u(t)},s.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==s.prototype},s.compare=function(t,e){if(N(t,r)&&(t=s.from(t,t.offset,t.byteLength)),N(e,r)&&(e=s.from(e,e.offset,e.byteLength)),!s.isBuffer(t)||!s.isBuffer(e))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;let n=t.length,i=e.length;for(let r=0,o=Math.min(n,i);r<o;++r)if(t[r]!==e[r]){n=t[r],i=e[r];break}return n<i?-1:+(i<n)},s.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(t,e){let n;if(!Array.isArray(t))throw TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return s.alloc(0);if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;let i=s.allocUnsafe(e),o=0;for(n=0;n<t.length;++n){let e=t[n];if(N(e,r))o+e.length>i.length?(s.isBuffer(e)||(e=s.from(e)),e.copy(i,o)):r.prototype.set.call(i,e,o);else if(s.isBuffer(e))e.copy(i,o);else throw TypeError('"list" argument must be an Array of Buffers');o+=e.length}return i},s.byteLength=d,s.prototype._isBuffer=!0,s.prototype.swap16=function(){let t=this.length;if(t%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(let e=0;e<t;e+=2)y(this,e,e+1);return this},s.prototype.swap32=function(){let t=this.length;if(t%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(let e=0;e<t;e+=4)y(this,e,e+3),y(this,e+1,e+2);return this},s.prototype.swap64=function(){let t=this.length;if(t%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(let e=0;e<t;e+=8)y(this,e,e+7),y(this,e+1,e+6),y(this,e+2,e+5),y(this,e+3,e+4);return this},s.prototype.toString=function(){let t=this.length;return 0===t?"":0==arguments.length?b(this,0,t):p.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(t){if(!s.isBuffer(t))throw TypeError("Argument must be a Buffer");return this===t||0===s.compare(this,t)},s.prototype.inspect=function(){let e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},e&&(s.prototype[e]=s.prototype.inspect),s.prototype.compare=function(t,e,n,i,o){if(N(t,r)&&(t=s.from(t,t.offset,t.byteLength)),!s.isBuffer(t))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===i&&(i=0),void 0===o&&(o=this.length),e<0||n>t.length||i<0||o>this.length)throw RangeError("out of range index");if(i>=o&&e>=n)return 0;if(i>=o)return -1;if(e>=n)return 1;if(e>>>=0,n>>>=0,i>>>=0,o>>>=0,this===t)return 0;let a=o-i,l=n-e,u=Math.min(a,l),f=this.slice(i,o),c=t.slice(e,n);for(let t=0;t<u;++t)if(f[t]!==c[t]){a=f[t],l=c[t];break}return a<l?-1:+(l<a)},s.prototype.includes=function(t,e,r){return -1!==this.indexOf(t,e,r)},s.prototype.indexOf=function(t,e,r){return g(this,t,e,r,!0)},s.prototype.lastIndexOf=function(t,e,r){return g(this,t,e,r,!1)},s.prototype.write=function(t,e,r,n){var i,o,s,a,l,u,f,c;if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else if(isFinite(e))e>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let h=this.length-e;if((void 0===r||r>h)&&(r=h),t.length>0&&(r<0||e<0)||e>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");let d=!1;for(;;)switch(n){case"hex":return function(t,e,r,n){let i;r=Number(r)||0;let o=t.length-r;n?(n=Number(n))>o&&(n=o):n=o;let s=e.length;for(n>s/2&&(n=s/2),i=0;i<n;++i){var a;let n=parseInt(e.substr(2*i,2),16);if((a=n)!=a)break;t[r+i]=n}return i}(this,t,e,r);case"utf8":case"utf-8":return i=e,o=r,M(q(t,this.length-i),this,i,o);case"ascii":case"latin1":case"binary":return s=e,a=r,M(function(t){let e=[];for(let r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(t),this,s,a);case"base64":return l=e,u=r,M(T(t),this,l,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return f=e,c=r,M(function(t,e){let r,n,i=[];for(let o=0;o<t.length&&!((e-=2)<0);++o)n=(r=t.charCodeAt(o))>>8,i.push(r%256),i.push(n);return i}(t,this.length-f),this,f,c);default:if(d)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),d=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},s.prototype.slice=function(t,e){let r=this.length;t=~~t,e=void 0===e?r:~~e,t<0?(t+=r)<0&&(t=0):t>r&&(t=r),e<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t);let n=this.subarray(t,e);return Object.setPrototypeOf(n,s.prototype),n},s.prototype.readUintLE=s.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||w(t,e,this.length);let n=this[t],i=1,o=0;for(;++o<e&&(i*=256);)n+=this[t+o]*i;return n},s.prototype.readUintBE=s.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||w(t,e,this.length);let n=this[t+--e],i=1;for(;e>0&&(i*=256);)n+=this[t+--e]*i;return n},s.prototype.readUint8=s.prototype.readUInt8=function(t,e){return t>>>=0,e||w(t,1,this.length),this[t]},s.prototype.readUint16LE=s.prototype.readUInt16LE=function(t,e){return t>>>=0,e||w(t,2,this.length),this[t]|this[t+1]<<8},s.prototype.readUint16BE=s.prototype.readUInt16BE=function(t,e){return t>>>=0,e||w(t,2,this.length),this[t]<<8|this[t+1]},s.prototype.readUint32LE=s.prototype.readUInt32LE=function(t,e){return t>>>=0,e||w(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+0x1000000*this[t+3]},s.prototype.readUint32BE=s.prototype.readUInt32BE=function(t,e){return t>>>=0,e||w(t,4,this.length),0x1000000*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},s.prototype.readBigUInt64LE=C(function(t){R(t>>>=0,"offset");let e=this[t],r=this[t+7];(void 0===e||void 0===r)&&P(t,this.length-8);let n=e+256*this[++t]+65536*this[++t]+0x1000000*this[++t],i=this[++t]+256*this[++t]+65536*this[++t]+0x1000000*r;return BigInt(n)+(BigInt(i)<<BigInt(32))}),s.prototype.readBigUInt64BE=C(function(t){R(t>>>=0,"offset");let e=this[t],r=this[t+7];(void 0===e||void 0===r)&&P(t,this.length-8);let n=0x1000000*e+65536*this[++t]+256*this[++t]+this[++t],i=0x1000000*this[++t]+65536*this[++t]+256*this[++t]+r;return(BigInt(n)<<BigInt(32))+BigInt(i)}),s.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||w(t,e,this.length);let n=this[t],i=1,o=0;for(;++o<e&&(i*=256);)n+=this[t+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*e)),n},s.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||w(t,e,this.length);let n=e,i=1,o=this[t+--n];for(;n>0&&(i*=256);)o+=this[t+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*e)),o},s.prototype.readInt8=function(t,e){return t>>>=0,e||w(t,1,this.length),128&this[t]?-((255-this[t]+1)*1):this[t]},s.prototype.readInt16LE=function(t,e){t>>>=0,e||w(t,2,this.length);let r=this[t]|this[t+1]<<8;return 32768&r?0xffff0000|r:r},s.prototype.readInt16BE=function(t,e){t>>>=0,e||w(t,2,this.length);let r=this[t+1]|this[t]<<8;return 32768&r?0xffff0000|r:r},s.prototype.readInt32LE=function(t,e){return t>>>=0,e||w(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},s.prototype.readInt32BE=function(t,e){return t>>>=0,e||w(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},s.prototype.readBigInt64LE=C(function(t){R(t>>>=0,"offset");let e=this[t],r=this[t+7];return(void 0===e||void 0===r)&&P(t,this.length-8),(BigInt(this[t+4]+256*this[t+5]+65536*this[t+6]+(r<<24))<<BigInt(32))+BigInt(e+256*this[++t]+65536*this[++t]+0x1000000*this[++t])}),s.prototype.readBigInt64BE=C(function(t){R(t>>>=0,"offset");let e=this[t],r=this[t+7];return(void 0===e||void 0===r)&&P(t,this.length-8),(BigInt((e<<24)+65536*this[++t]+256*this[++t]+this[++t])<<BigInt(32))+BigInt(0x1000000*this[++t]+65536*this[++t]+256*this[++t]+r)}),s.prototype.readFloatLE=function(t,e){return t>>>=0,e||w(t,4,this.length),eK.read(this,t,!0,23,4)},s.prototype.readFloatBE=function(t,e){return t>>>=0,e||w(t,4,this.length),eK.read(this,t,!1,23,4)},s.prototype.readDoubleLE=function(t,e){return t>>>=0,e||w(t,8,this.length),eK.read(this,t,!0,52,8)},s.prototype.readDoubleBE=function(t,e){return t>>>=0,e||w(t,8,this.length),eK.read(this,t,!1,52,8)},s.prototype.writeUintLE=s.prototype.writeUIntLE=function(t,e,r,n){if(t*=1,e>>>=0,r>>>=0,!n){let n=Math.pow(2,8*r)-1;v(this,t,e,r,n,0)}let i=1,o=0;for(this[e]=255&t;++o<r&&(i*=256);)this[e+o]=t/i&255;return e+r},s.prototype.writeUintBE=s.prototype.writeUIntBE=function(t,e,r,n){if(t*=1,e>>>=0,r>>>=0,!n){let n=Math.pow(2,8*r)-1;v(this,t,e,r,n,0)}let i=r-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+r},s.prototype.writeUint8=s.prototype.writeUInt8=function(t,e,r){return t*=1,e>>>=0,r||v(this,t,e,1,255,0),this[e]=255&t,e+1},s.prototype.writeUint16LE=s.prototype.writeUInt16LE=function(t,e,r){return t*=1,e>>>=0,r||v(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},s.prototype.writeUint16BE=s.prototype.writeUInt16BE=function(t,e,r){return t*=1,e>>>=0,r||v(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},s.prototype.writeUint32LE=s.prototype.writeUInt32LE=function(t,e,r){return t*=1,e>>>=0,r||v(this,t,e,4,0xffffffff,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},s.prototype.writeUint32BE=s.prototype.writeUInt32BE=function(t,e,r){return t*=1,e>>>=0,r||v(this,t,e,4,0xffffffff,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},s.prototype.writeBigUInt64LE=C(function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return E(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))}),s.prototype.writeBigUInt64BE=C(function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return x(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))}),s.prototype.writeIntLE=function(t,e,r,n){if(t*=1,e>>>=0,!n){let n=Math.pow(2,8*r-1);v(this,t,e,r,n-1,-n)}let i=0,o=1,s=0;for(this[e]=255&t;++i<r&&(o*=256);)t<0&&0===s&&0!==this[e+i-1]&&(s=1),this[e+i]=(t/o|0)-s&255;return e+r},s.prototype.writeIntBE=function(t,e,r,n){if(t*=1,e>>>=0,!n){let n=Math.pow(2,8*r-1);v(this,t,e,r,n-1,-n)}let i=r-1,o=1,s=0;for(this[e+i]=255&t;--i>=0&&(o*=256);)t<0&&0===s&&0!==this[e+i+1]&&(s=1),this[e+i]=(t/o|0)-s&255;return e+r},s.prototype.writeInt8=function(t,e,r){return t*=1,e>>>=0,r||v(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},s.prototype.writeInt16LE=function(t,e,r){return t*=1,e>>>=0,r||v(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},s.prototype.writeInt16BE=function(t,e,r){return t*=1,e>>>=0,r||v(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},s.prototype.writeInt32LE=function(t,e,r){return t*=1,e>>>=0,r||v(this,t,e,4,0x7fffffff,-0x80000000),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},s.prototype.writeInt32BE=function(t,e,r){return t*=1,e>>>=0,r||v(this,t,e,4,0x7fffffff,-0x80000000),t<0&&(t=0xffffffff+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},s.prototype.writeBigInt64LE=C(function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return E(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),s.prototype.writeBigInt64BE=C(function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return x(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),s.prototype.writeFloatLE=function(t,e,r){return k(this,t,e,!0,r)},s.prototype.writeFloatBE=function(t,e,r){return k(this,t,e,!1,r)},s.prototype.writeDoubleLE=function(t,e,r){return A(this,t,e,!0,r)},s.prototype.writeDoubleBE=function(t,e,r){return A(this,t,e,!1,r)},s.prototype.copy=function(t,e,n,i){if(!s.isBuffer(t))throw TypeError("argument should be a Buffer");if(n||(n=0),i||0===i||(i=this.length),e>=t.length&&(e=t.length),e||(e=0),i>0&&i<n&&(i=n),i===n||0===t.length||0===this.length)return 0;if(e<0)throw RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw RangeError("Index out of range");if(i<0)throw RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-e<i-n&&(i=t.length-e+n);let o=i-n;return this===t&&"function"==typeof r.prototype.copyWithin?this.copyWithin(e,n,i):r.prototype.set.call(t,this.subarray(n,i),e),o},s.prototype.fill=function(t,e,r,n){let i;if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!s.isEncoding(n))throw TypeError("Unknown encoding: "+n);if(1===t.length){let e=t.charCodeAt(0);("utf8"===n&&e<128||"latin1"===n)&&(t=e)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<r)throw RangeError("Out of range index");if(r<=e)return this;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(i=e;i<r;++i)this[i]=t;else{let o=s.isBuffer(t)?t:s.from(t,n),a=o.length;if(0===a)throw TypeError('The value "'+t+'" is invalid for argument "value"');for(i=0;i<r-e;++i)this[i+e]=o[i%a]}return this};let _={};function I(t,e,r){_[t]=class extends r{get code(){return t}set code(t){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:t,writable:!0})}toString(){return"".concat(this.name," [").concat(t,"]: ").concat(this.message)}constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name="".concat(this.name," [").concat(t,"]"),this.stack,delete this.name}}}function S(t){let e="",r=t.length,n=+("-"===t[0]);for(;r>=n+4;r-=3)e="_".concat(t.slice(r-3,r)).concat(e);return"".concat(t.slice(0,r)).concat(e)}function U(t,e,r,n,i,o){if(t>r||t<e){let r,n="bigint"==typeof e?"n":"";throw r=0===e||e===BigInt(0)?">= 0".concat(n," and < 2").concat(n," ** ").concat((o+1)*8).concat(n):">= -(2".concat(n," ** ").concat((o+1)*8-1).concat(n,") and < 2 ** ").concat((o+1)*8-1).concat(n),new _.ERR_OUT_OF_RANGE("value",r,t)}R(i,"offset"),(void 0===n[i]||void 0===n[i+o])&&P(i,n.length-(o+1))}function R(t,e){if("number"!=typeof t)throw new _.ERR_INVALID_ARG_TYPE(e,"number",t)}function P(t,e,r){throw Math.floor(t)!==t?(R(t,r),new _.ERR_OUT_OF_RANGE("offset","an integer",t)):e<0?new _.ERR_BUFFER_OUT_OF_BOUNDS:new _.ERR_OUT_OF_RANGE("offset",">= 0 and <= ".concat(e),t)}I("ERR_BUFFER_OUT_OF_BOUNDS",function(t){return t?"".concat(t," is outside of buffer bounds"):"Attempt to access memory outside buffer bounds"},RangeError),I("ERR_INVALID_ARG_TYPE",function(t,e){return'The "'.concat(t,'" argument must be of type number. Received type ').concat(typeof e)},TypeError),I("ERR_OUT_OF_RANGE",function(t,e,r){let n='The value of "'.concat(t,'" is out of range.'),i=r;return Number.isInteger(r)&&Math.abs(r)>0x100000000?i=S(String(r)):"bigint"==typeof r&&(i=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(i=S(i)),i+="n"),n+=" It must be ".concat(e,". Received ").concat(i)},RangeError);let O=/[^+/0-9A-Za-z-_]/g;function q(t,e){let r;e=e||1/0;let n=t.length,i=null,o=[];for(let s=0;s<n;++s){if((r=t.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319||s+1===n){(e-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&o.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;o.push(r)}else if(r<2048){if((e-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((e-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return o}function T(t){return eU.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(O,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function M(t,e,r,n){let i;for(i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}function N(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}let K=function(){let t="0123456789abcdef",e=Array(256);for(let r=0;r<16;++r){let n=16*r;for(let i=0;i<16;++i)e[n+i]=t[r]+t[i]}return e}();function C(t){return typeof BigInt>"u"?F:t}function F(){throw Error("BigInt not supported")}}(eS);let eC=eS.Buffer;class eF{static fromHex(t){if(0===(t=t.trim()).length)return new Uint8Array(0);if(t.length<2||1&t.length)throw Error("Invalid hex string: odd length.");if((t.startsWith("0x")||t.startsWith("0X"))&&(t=t.slice(2)),!t.match(/^[0-9a-fA-F]*$/))throw Error("Invalid hex string: contains non-hex characters");let e=t.match(/.{1,2}/g);if(!e)throw Error("Invalid hex string");return new Uint8Array(e.map(t=>parseInt(t,16)))}static toHex(t){return Array.from(t,t=>t.toString(16).padStart(2,"0")).join("")}static fromString(t){return t=t.trim(),new TextEncoder().encode(t)}static toString(t){return new TextDecoder("utf-8").decode(t)}static concat(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];let n=new Uint8Array(e.reduce((t,e)=>t+e.length,0)),i=0;for(let t of e)n.set(t,i),i+=t.length;return n}static alloc(t){return new Uint8Array(t)}static writeBigUint64BE(t){let e=new ArrayBuffer(8);return new DataView(e).setBigUint64(0,t,!1),new Uint8Array(e)}static toBase64(t){if("u">typeof eC)return eC.from(t).toString("base64");if(t.length>32768){let e="";for(let r=0;r<t.length;r+=32768)e+=btoa(String.fromCharCode(...t.slice(r,r+32768)));return e}return btoa(String.fromCharCode(...t))}static fromBase64(t){if(t=t.trim(),"u">typeof eC)return new Uint8Array(eC.from(t,"base64"));let e=t.replace(/-/g,"+").replace(/_/g,"/");for(;e.length%4;)e+="=";return new Uint8Array([...atob(e)].map(t=>t.charCodeAt(0)))}static equals(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return 0===r}static compare(t,e){let r=Math.min(t.length,e.length);for(let n=0;n<r;n++){if(t[n]<e[n])return -1;if(t[n]>e[n])return 1}return t.length-e.length}}function eD(t){return eL(p(t))}function eL(t){return BigInt("0x".concat(t))}let eH=m("536563703235366b315f48617368546f43757276655f43617368755f");function ej(t){let e=X(eF.concat(eH,t)),r=new Uint32Array(1);for(let t=0;t<65536;t++){let t=new Uint8Array(r.buffer),n=X(eF.concat(e,t));try{return eV(p(eF.concat(new Uint8Array([2]),n)))}catch(t){r[0]++}}throw Error("No valid point found")}function eV(t){return ed.ProjectivePoint.fromHex(t)}let ez=Uint32Array.from([0x67452301,0xefcdab89,0x98badcfe,0x10325476,0xc3d2e1f0]),eQ=new Uint32Array(80);(t,e)=>Math.floor(0x100000000*Math.abs(Math.sin(e+1)));let eG=Uint8Array.from([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),eW=Uint8Array.from(Array(16).fill(0).map((t,e)=>e)),eZ=eW.map(t=>(9*t+5)%16),eY=(()=>{let t=[[eW],[eZ]];for(let e=0;e<4;e++)for(let r of t)r.push(r[e].map(t=>eG[t]));return t})(),eJ=eY[0],e$=eY[1],eX=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map(t=>Uint8Array.from(t)),e0=eJ.map((t,e)=>t.map(t=>eX[e][t])),e1=e$.map((t,e)=>t.map(t=>eX[e][t])),e2=Uint32Array.from([0,0x5a827999,0x6ed9eba1,0x8f1bbcdc,0xa953fd4e]),e8=Uint32Array.from([0x50a28be6,0x5c4dd124,0x6d703ef3,0x7a6d76e9,0]);function e6(t,e,r,n){return 0===t?e^r^n:1===t?e&r|~e&n:2===t?(e|~r)^n:3===t?e&n|r&~n:e^(r|~n)}let e3=new Uint32Array(16);class e5 extends k{get(){let{h0:t,h1:e,h2:r,h3:n,h4:i}=this;return[t,e,r,n,i]}set(t,e,r,n,i){this.h0=0|t,this.h1=0|e,this.h2=0|r,this.h3=0|n,this.h4=0|i}process(t,e){for(let r=0;r<16;r++,e+=4)e3[r]=t.getUint32(e,!0);let r=0|this.h0,n=r,i=0|this.h1,o=i,s=0|this.h2,a=s,l=0|this.h3,u=l,f=0|this.h4,h=f;for(let t=0;t<5;t++){let e=4-t,d=e2[t],p=e8[t],y=eJ[t],g=e$[t],m=e0[t],b=e1[t];for(let e=0;e<16;e++){let n=c(r+e6(t,i,s,l)+e3[y[e]]+d,m[e])+f|0;r=f,f=l,l=0|c(s,10),s=i,i=n}for(let t=0;t<16;t++){let r=c(n+e6(e,o,a,u)+e3[g[t]]+p,b[t])+h|0;n=h,h=u,u=0|c(a,10),a=o,o=r}}this.set(this.h1+s+u|0,this.h2+l+h|0,this.h3+f+n|0,this.h4+r+o|0,this.h0+i+a|0)}roundClean(){l(e3)}destroy(){this.destroyed=!0,l(this.buffer),this.set(0,0,0,0,0)}constructor(){super(64,20,8,!0),this.h0=0x67452301,this.h1=-0x10325477,this.h2=-0x67452302,this.h3=0x10325476,this.h4=-0x3c2d1e10}}let e4=x(()=>new e5);function e7(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&"Uint8Array"===t.constructor.name}function e9(t,e){return!!Array.isArray(e)&&(0===e.length||(t?e.every(t=>"string"==typeof t):e.every(t=>Number.isSafeInteger(t))))}function rt(t){if("function"!=typeof t)throw Error("function expected");return!0}function re(t,e){if("string"!=typeof e)throw Error("".concat(t,": string expected"));return!0}function rr(t){if(!Number.isSafeInteger(t))throw Error("invalid integer: ".concat(t))}function rn(t){if(!Array.isArray(t))throw Error("array expected")}function ri(t,e){if(!e9(!0,e))throw Error("".concat(t,": array of strings expected"))}function ro(t,e){if(!e9(!1,e))throw Error("".concat(t,": array of numbers expected"))}function rs(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];let n=t=>t,i=(t,e)=>r=>t(e(r));return{encode:e.map(t=>t.encode).reduceRight(i,n),decode:e.map(t=>t.decode).reduce(i,n)}}function ra(t){let e="string"==typeof t?t.split(""):t,r=e.length;ri("alphabet",e);let n=new Map(e.map((t,e)=>[t,e]));return{encode:n=>(rn(n),n.map(n=>{if(!Number.isSafeInteger(n)||n<0||n>=r)throw Error('alphabet.encode: digit index outside alphabet "'.concat(n,'". Allowed: ').concat(t));return e[n]})),decode:e=>(rn(e),e.map(e=>{re("alphabet.decode",e);let r=n.get(e);if(void 0===r)throw Error('Unknown letter: "'.concat(e,'". Allowed: ').concat(t));return r}))}}function rl(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return re("join",t),{encode:e=>(ri("join.decode",e),e.join(t)),decode:e=>(re("join.decode",e),e.split(t))}}function ru(t,e,r){if(e<2)throw Error("convertRadix: invalid from=".concat(e,", base cannot be less than 2"));if(r<2)throw Error("convertRadix: invalid to=".concat(r,", base cannot be less than 2"));if(rn(t),!t.length)return[];let n=0,i=[],o=Array.from(t,t=>{if(rr(t),t<0||t>=e)throw Error("invalid integer: ".concat(t));return t}),s=o.length;for(;;){let t=0,a=!0;for(let i=n;i<s;i++){let s=o[i],l=e*t,u=l+s;if(!Number.isSafeInteger(u)||l/e!==t||u-s!==l)throw Error("convertRadix: carry overflow");let f=u/r;t=u%r;let c=Math.floor(f);if(o[i]=c,!Number.isSafeInteger(c)||c*r+t!==u)throw Error("convertRadix: carry overflow");a&&(c?a=!1:n=i)}if(i.push(t),a)break}for(let e=0;e<t.length-1&&0===t[e];e++)i.push(0);return i.reverse()}let rf=(t,e)=>0===e?t:rf(e,t%e),rc=(()=>{let t=[];for(let e=0;e<40;e++)t.push(2**e);return t})();"function"==typeof Uint8Array.from([]).toBase64&&Uint8Array.fromBase64;let rh=rs((eI=58,rr(58),{encode:t=>{if(!e7(t))throw Error("radix.encode input should be Uint8Array");return ru(Array.from(t),256,58)},decode:t=>(ro("radix.decode",t),Uint8Array.from(ru(t,58,256)))}),ra("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),rl("")),rd=rs(ra("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),rl(""));"function"==typeof Uint8Array.from([]).toHex&&Uint8Array.fromHex;let rp=ed.ProjectivePoint,ry=(t=>rs(function(t,e){return rr(4),rt(e),{encode(r){if(!e7(r))throw Error("checksum.encode: input should be Uint8Array");let n=e(r).slice(0,4),i=new Uint8Array(r.length+t);return i.set(r),i.set(n,r.length),i},decode(r){if(!e7(r))throw Error("checksum.decode: input should be Uint8Array");let n=r.slice(0,-t),i=r.slice(-t),o=e(n).slice(0,t);for(let e=0;e<t;e++)if(o[e]!==i[e])throw Error("Invalid checksum");return n}}}(4,e=>t(t(e))),rh))(X);function rg(t){return o(t),BigInt("0x"+(0===t.length?"0":p(t)))}let rm=b("Bitcoin seed"),rb={private:0x488ade4,public:0x488b21e},rw=t=>{if(!Number.isSafeInteger(t)||t<0||t>0x100000000-1)throw Error("invalid number, should be from 0 to 2**32-1, got "+t);let e=new Uint8Array(4);return u(e).setUint32(0,t,!1),e};class rv{get fingerprint(){if(!this.pubHash)throw Error("No publicKey set!");return u(this.pubHash).getUint32(0,!1)}get identifier(){return this.pubHash}get pubKeyHash(){return this.pubHash}get privateKey(){return this.privKeyBytes||null}get publicKey(){return this.pubKey||null}get privateExtendedKey(){let t=this.privateKey;if(!t)throw Error("No private key");return ry.encode(this.serialize(this.versions.private,v(new Uint8Array([0]),t)))}get publicExtendedKey(){if(!this.pubKey)throw Error("No public key");return ry.encode(this.serialize(this.versions.public,this.pubKey))}static fromMasterSeed(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:rb;if(o(t),8*t.length<128||8*t.length>512)throw Error("HDKey: seed length must be between 128 and 512 bits; 256 bits is advised, got "+t.length);let r=tr(tt,rm,t);return new rv({versions:e,chainCode:r.slice(32),privateKey:r.slice(0,32)})}static fromExtendedKey(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:rb,r=ry.decode(t),n=u(r),i=n.getUint32(0,!1),o={versions:e,depth:r[4],parentFingerprint:n.getUint32(5,!1),index:n.getUint32(9,!1),chainCode:r.slice(13,45)},s=r.slice(45),a=0===s[0];if(i!==e[a?"private":"public"])throw Error("Version mismatch");return new rv(a?{...o,privateKey:s.slice(1)}:{...o,publicKey:s})}static fromJSON(t){return rv.fromExtendedKey(t.xpriv)}derive(t){if(!/^[mM]'?/.test(t))throw Error('Path must start with "m" or "M"');if(/^[mM]'?$/.test(t))return this;let e=t.replace(/^[mM]'?\//,"").split("/"),r=this;for(let t of e){let e=/^(\d+)('?)$/.exec(t),n=e&&e[1];if(!e||3!==e.length||"string"!=typeof n)throw Error("invalid child index: "+t);let i=+n;if(!Number.isSafeInteger(i)||i>=0x80000000)throw Error("Invalid index");"'"===e[2]&&(i+=0x80000000),r=r.deriveChild(i)}return r}deriveChild(t){if(!this.pubKey||!this.chainCode)throw Error("No publicKey or chainCode set");let e=rw(t);if(t>=0x80000000){let t=this.privateKey;if(!t)throw Error("Could not derive hardened child key");e=v(new Uint8Array([0]),t,e)}else e=v(this.pubKey,e);let r=tr(tt,this.chainCode,e),n=rg(r.slice(0,32)),i=r.slice(32);if(!ed.utils.isValidPrivateKey(n))throw Error("Tweak bigger than curve order");let o={versions:this.versions,chainCode:i,depth:this.depth+1,parentFingerprint:this.fingerprint,index:t};try{if(this.privateKey){let t=tR(this.privKey+n,ed.CURVE.n);if(!ed.utils.isValidPrivateKey(t))throw Error("The tweak was out of range or the resulted private key is invalid");o.privateKey=t}else{let t=rp.fromHex(this.pubKey).add(rp.fromPrivateKey(n));if(t.equals(rp.ZERO))throw Error("The tweak was equal to negative P, which made the result key invalid");o.publicKey=t.toRawBytes(!0)}return new rv(o)}catch(e){return this.deriveChild(t+1)}}sign(t){if(!this.privateKey)throw Error("No privateKey set!");return o(t,32),ed.sign(t,this.privKey).toCompactRawBytes()}verify(t,e){let r;if(o(t,32),o(e,64),!this.publicKey)throw Error("No publicKey set!");try{r=ed.Signature.fromCompact(e)}catch(t){return!1}return ed.verify(r,t,this.publicKey)}wipePrivateData(){return this.privKey=void 0,this.privKeyBytes&&(this.privKeyBytes.fill(0),this.privKeyBytes=void 0),this}toJSON(){return{xpriv:this.privateExtendedKey,xpub:this.publicExtendedKey}}serialize(t,e){if(!this.chainCode)throw Error("No chainCode set");return o(e,33),v(rw(t),new Uint8Array([this.depth]),rw(this.parentFingerprint),rw(this.index),this.chainCode,e)}constructor(t){if(this.depth=0,this.index=0,this.chainCode=null,this.parentFingerprint=0,!t||"object"!=typeof t)throw Error("HDKey.constructor must not be called directly");if(this.versions=t.versions||rb,this.depth=t.depth||0,this.chainCode=t.chainCode||null,this.index=t.index||0,this.parentFingerprint=t.parentFingerprint||0,!this.depth&&(this.parentFingerprint||this.index))throw Error("HDKey: zero depth with non-zero index/parent fingerprint");if(t.publicKey&&t.privateKey)throw Error("HDKey: publicKey and privateKey at same time.");if(t.privateKey){if(!ed.utils.isValidPrivateKey(t.privateKey))throw Error("Invalid private key");this.privKey="bigint"==typeof t.privateKey?t.privateKey:rg(t.privateKey),this.privKeyBytes=function(t){if("bigint"!=typeof t)throw Error("bigint expected");return m(t.toString(16).padStart(64,"0"))}(this.privKey),this.pubKey=ed.getPublicKey(t.privateKey,!0)}else if(t.publicKey)this.pubKey=rp.fromHex(t.publicKey).toRawBytes(!0);else throw Error("HDKey: no public or private key provided");this.pubHash=e4(X(this.pubKey))}}function rE(t){return eF.fromBase64(t)}function rx(t){let e=JSON.stringify(t);return eF.toBase64(eF.fromString(e)).replace(/\+/g,"-").replace(/\//g,"_").split("=")[0]}function rB(t){if("string"!=typeof t||0===t.length||!/^[A-Za-z0-9\-_]+={0,2}$/.test(t)&&!/^[A-Za-z0-9+/]+={0,2}$/.test(t))return!1;let e=t.replace(/-/g,"+").replace(/_/g,"/"),r=(4-e.length%4)%4;if(r>2)return!1;let n=e+"=".repeat(r);try{let t=eF.fromBase64(n),r=eF.toBase64(t),i=r.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""),o=e.replace(/=+$/,"");return r.replace(/=+$/,"")===o||i===o}catch(t){return!1}}let rk=(t,e,r,n)=>{let i=eF.concat(eF.fromString("Cashu_KDF_HMAC_SHA256"),eF.fromHex(e),eF.writeBigUint64BE(BigInt(r)));switch(n){case 0:i=eF.concat(i,eF.fromHex("00"));break;case 1:i=eF.concat(i,eF.fromHex("01"))}return tr(X,t,i)},rA=(t,e,r,n)=>{let i=rv.fromMasterSeed(t),o=(t=>/^[a-fA-F0-9]+$/.test(t)?eL(t)%BigInt(0x80000000-1):eD(eF.fromBase64(t))%BigInt(0x80000000-1))(e),s="".concat("m/129372'/0'","/").concat(o,"'/").concat(r,"'/").concat(n),a=i.derive(s);if(null===a.privateKey)throw Error("Could not derive private key");return a.privateKey},r_=t=>{try{return t instanceof Uint8Array&&(t=new TextDecoder().decode(t)),JSON.parse(t)}catch(t){throw Error("can't parse secret")}},rI=function(t,e){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=Array.isArray(e)?e:[e];return t.map((t,e)=>{let i=t;for(let t of n)try{i=rS(i,t)}catch(n){let t=n instanceof Error?n.message:"Unknown error";if(r)throw Error("Failed signing proof #".concat(e+1,": ").concat(t));console.warn("Proof #".concat(e+1,": ").concat(t))}return i})},rS=(t,e)=>{let r=r_(t.secret);if("P2PK"!==r[0])throw Error("not a P2PK secret");let n=p(ek.getPublicKey(e)),i=function(t){try{let e="string"==typeof t?r_(t):t;if("P2PK"!==e[0])throw Error('Invalid P2PK secret: must start with "P2PK"');let r=Math.floor(Date.now()/1e3);return function(t){let e="string"==typeof t?r_(t):t;if("P2PK"!==e[0])throw Error('Invalid P2PK secret: must start with "P2PK"');let{tags:r}=e[1],n=r&&r.find(t=>"locktime"===t[0]);return n&&n.length>1?parseInt(n[1],10):1/0}(e)>r?function(t){let e="string"==typeof t?r_(t):t;if("P2PK"!==e[0])throw Error('Invalid P2PK secret: must start with "P2PK"');let{data:r,tags:n}=e[1],i=n&&n.find(t=>"pubkeys"===t[0]);return[r,...i&&i.length>1?i.slice(1):[]].filter(Boolean)}(e):function(t){let e="string"==typeof t?r_(t):t;if("P2PK"!==e[0])throw Error('Invalid P2PK secret: must start with "P2PK"');let{tags:r}=e[1],n=r&&r.find(t=>"refund"===t[0]);return n&&n.length>1?n.slice(1).filter(Boolean):[]}(e)}catch(t){}return[]}(r);if(!i.length||!i.some(t=>t.includes(n)))throw Error("Signature not required from [02|03]".concat(n));let o=(t=>{if(!t)return[];if("string"==typeof t)try{return JSON.parse(t).signatures||[]}catch(t){return console.error("Failed to parse witness string:",t),[]}return t.signatures||[]})(t.witness);if(o.some(e=>{try{return((t,e,r)=>{try{let n=X(e),i=66===r.length?r.slice(2):r;if(ek.verify(t,n,m(i)))return!0}catch(t){console.error("verifyP2PKsecret error:",t)}return!1})(e,t.secret,n)}catch(t){return!1}}))throw Error("Proof already signed by [02|03]".concat(n));let s=((t,e)=>{let r=X(t);return p(ek.sign(r,e))})(t.secret,e);return o.push(s),{...t,witness:{signatures:o}}};function rU(t,e,r){let n=ej(t);e||(e=eD(ed.utils.randomPrivateKey()));let i=ed.ProjectivePoint.BASE.multiply(e),o=n.add(i);return void 0!==r?((t,e)=>{let r=((t,e)=>{let r=X(t);return p(ek.sign(r,e))})(t.B_.toHex(!0),e);return t.witness={signatures:[r]},t})({B_:o,r:e,secret:t},r):{B_:o,r:e,secret:t}}function rR(t){let e=[];return function t(e,r){if(null===e)r.push(246);else if(void 0===e)r.push(247);else if("boolean"==typeof e)r.push(e?245:244);else if("number"==typeof e)rP(e,r);else if("string"==typeof e)rO(e,r);else if(Array.isArray(e)){var n=e,i=r;let o=n.length;if(o<24)i.push(128|o);else if(o<256)i.push(152,o);else if(o<65536)i.push(153,o>>8,255&o);else throw Error("Unsupported array length");for(let e of n)t(e,i)}else if(e instanceof Uint8Array){var o=e,s=r;let t=o.length;if(t<24)s.push(64+t);else if(t<256)s.push(88,t);else if(t<65536)s.push(89,t>>8&255,255&t);else if(t<0x100000000)s.push(90,t>>24&255,t>>16&255,t>>8&255,255&t);else throw Error("Byte string too long to encode");for(let t=0;t<o.length;t++)s.push(o[t])}else if("object"!=typeof e||null===e||Array.isArray(e))throw Error("Unsupported type");else{var a=e,l=r;let n=Object.keys(a);for(let e of(rP(n.length,l),l[l.length-1]|=160,n))rO(e,l),t(a[e],l)}}(t,e),new Uint8Array(e)}function rP(t,e){if(t<24)e.push(t);else if(t<256)e.push(24,t);else if(t<65536)e.push(25,t>>8,255&t);else if(t<0x100000000)e.push(26,t>>24,t>>16&255,t>>8&255,255&t);else throw Error("Unsupported integer size")}function rO(t,e){let r=new TextEncoder().encode(t),n=r.length;if(n<24)e.push(96+n);else if(n<256)e.push(120,n);else if(n<65536)e.push(121,n>>8&255,255&n);else if(n<0x100000000)e.push(122,n>>24&255,n>>16&255,n>>8&255,255&n);else throw Error("String too long to encode");for(let t=0;t<r.length;t++)e.push(r[t])}function rq(t){return function t(e,r){if(r>=e.byteLength)throw Error("Unexpected end of data");let n=e.getUint8(r++),i=n>>5,o=31&n;switch(i){case 0:var s=e,a=r,l=o;let{value:u,offset:f}=rT(s,a,l);return{value:u,offset:f};case 1:var c=e,h=r,d=o;let{value:p,offset:y}=rT(c,h,d);return{value:-1-p,offset:y};case 2:var g=e,m=r,b=o;let{value:w,offset:v}=rT(g,m,b);if(v+w>g.byteLength)throw Error("Byte string length exceeds data length");return{value:new Uint8Array(g.buffer,g.byteOffset+v,w),offset:v+w};case 3:var E=e,x=r,B=o;let{value:k,offset:A}=rT(E,x,B);if(A+k>E.byteLength)throw Error("String length exceeds data length");let _=new Uint8Array(E.buffer,E.byteOffset+A,k);return{value:new TextDecoder().decode(_),offset:A+k};case 4:return function(e,r,n){let{value:i,offset:o}=rT(e,r,n),s=[],a=o;for(let r=0;r<i;r++){let r=t(e,a);s.push(r.value),a=r.offset}return{value:s,offset:a}}(e,r,o);case 5:return function(e,r,n){let{value:i,offset:o}=rT(e,r,n),s={},a=o;for(let r=0;r<i;r++){var l;let r=t(e,a);if("number"!=typeof(l=r.value)&&"string"!=typeof l)throw Error("Invalid key type");let n=t(e,r.offset);s[r.value]=n.value,a=n.offset}return{value:s,offset:a}}(e,r,o);case 7:var I=e,S=r,U=o;if(U<24)switch(U){case 20:return{value:!1,offset:S};case 21:return{value:!0,offset:S};case 22:return{value:null,offset:S};case 23:return{value:void 0,offset:S};default:throw Error("Unknown simple value: ".concat(U))}if(24===U)return{value:I.getUint8(S++),offset:S};if(25===U)return{value:function(t){let e=(31744&t)>>10,r=1023&t,n=32768&t?-1:1;return 0===e?6103515625e-14*n*(r/1024):31===e?r?NaN:1/0*n:n*2**(e-15)*(1+r/1024)}(I.getUint16(S,!1)),offset:S+=2};if(26===U)return{value:I.getFloat32(S,!1),offset:S+=4};if(27===U)return{value:I.getFloat64(S,!1),offset:S+=8};throw Error("Unknown simple or float value: ".concat(U));default:throw Error("Unsupported major type: ".concat(i))}}(new DataView(t.buffer,t.byteOffset,t.byteLength),0).value}function rT(t,e,r){if(r<24)return{value:r,offset:e};if(24===r)return{value:t.getUint8(e++),offset:e};if(25===r)return{value:t.getUint16(e,!1),offset:e+=2};if(26===r)return{value:t.getUint32(e,!1),offset:e+=4};if(27===r)return{value:0x100000000*t.getUint32(e,!1)+t.getUint32(e+4,!1),offset:e+=8};throw Error("Unsupported length: ".concat(r))}class rM{toRawRequest(){let t={};return this.transport&&(t.t=this.transport.map(t=>({t:t.type,a:t.target,g:t.tags}))),this.id&&(t.i=this.id),this.amount&&(t.a=this.amount),this.unit&&(t.u=this.unit),this.mints&&(t.m=this.mints),this.description&&(t.d=this.description),this.singleUse&&(t.s=this.singleUse),this.nut10&&(t.nut10={k:this.nut10.kind,d:this.nut10.data,t:this.nut10.tags}),t}toEncodedRequest(){let t=rR(this.toRawRequest());return"creqA"+eF.toBase64(t)}getTransport(t){var e;return null==(e=this.transport)?void 0:e.find(e=>e.type===t)}static fromRawRequest(t){let e=t.t?t.t.map(t=>({type:t.t,target:t.a,tags:t.g})):void 0,r=t.nut10?{kind:t.nut10.k,data:t.nut10.d,tags:t.nut10.t}:void 0;return new rM(e,t.i,t.a,t.u,t.m,t.d,t.s,r)}static fromEncodedRequest(t){if(!t.startsWith("creq"))throw Error("unsupported pr: invalid prefix");if("A"!==t[4])throw Error("unsupported pr version");let e=rq(rE(t.slice(5)));return this.fromRawRequest(e)}constructor(t,e,r,n,i,o,s=!1,a){this.transport=t,this.id=e,this.amount=r,this.unit=n,this.mints=i,this.description=o,this.singleUse=s,this.nut10=a}}function rN(t,e,r,n){if(r){let n=nt(r);if(0===t&&0===n)return r;let i=r.filter(t=>t>0),o=nt(i);if(o>t)throw Error("Split is greater than total amount: ".concat(o," > ").concat(t));if(i.some(t=>!(t in e)))throw Error("Provided amount preferences do not match the amounts of the mint keyset.");if(o===t)return i;r=i,t-=o}else r=[];let i=rC(e,"desc");if(!i||0===i.length)throw Error("Cannot split amount, keyset is inactive or contains no keys");if(i.forEach(e=>{if(t<=0||e<=0)return;let n=Math.floor(t/e);for(let t=0;t<n;++t)r.push(e);t%=e}),0!==t)throw Error("Unable to split remaining amount: ".concat(t));return r.sort((t,e)=>t-e)}function rK(t,e,r,n){let i=[],o=t.map(t=>t.amount);rC(r,"asc").forEach(t=>{let r=Math.max(n-o.filter(e=>e===t).length,0);for(let n=0;n<r&&!(i.reduce((t,e)=>t+e,0)+t>e);++n)i.push(t)});let s=e-i.reduce((t,e)=>t+e,0);return s&&rN(s,r).forEach(t=>{i.push(t)}),i.sort((t,e)=>t-e)}function rC(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"desc";return"desc"==e?Object.keys(t).map(t=>parseInt(t)).sort((t,e)=>e-t):Object.keys(t).map(t=>parseInt(t)).sort((t,e)=>t-e)}function rF(t){return BigInt("0x".concat(t))}function rD(t){return/^[a-f0-9]*$/i.test(t)}function rL(t){return Array.isArray(t)?t.some(t=>!rD(t.id)):!rD(t.id)}function rH(t){return t.map(t=>{let e={...t};return e.id=e.id.slice(0,16),e})}function rj(t,e){if(rL(t.proofs)||(null==e?void 0:e.version)===3){if((null==e?void 0:e.version)===4)throw Error("can not encode to v4 token if proofs contain non-hex keyset id");var r=null==e?void 0:e.removeDleq;rL(t.proofs)||(t.proofs=rH(t.proofs)),r&&(t.proofs=r3(t.proofs));let n={token:[{mint:t.mint,proofs:t.proofs}]};return t.unit&&(n.unit=t.unit),t.memo&&(n.memo=t.memo),"cashuA"+rx(n)}return rV(t,null==e?void 0:e.removeDleq)}function rV(t,e){var r;if(e&&(t.proofs=r3(t.proofs)),t.proofs.forEach(t=>{if(t.dleq&&null==t.dleq.r)throw Error("Missing blinding factor in included DLEQ proof")}),rL(t.proofs))throw Error("can not encode to v4 token if proofs contain non-hex keyset id");return t.proofs=rH(t.proofs),"cashuB"+(r=rR(rz(t)),eF.toBase64(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""))}function rz(t){let e={},r=t.mint;for(let r=0;r<t.proofs.length;r++){let n=t.proofs[r];e[n.id]?e[n.id].push(n):e[n.id]=[n]}let n={m:r,u:t.unit||"sat",t:Object.keys(e).map(t=>({i:m(t),p:e[t].map(t=>{var e;return{a:t.amount,s:t.secret,c:m(t.C),...t.dleq&&{d:{e:m(t.dleq.e),s:m(t.dleq.s),r:m(null!=(e=t.dleq.r)?e:"00")}},...t.witness&&{w:JSON.stringify(t.witness)}}})}))};return t.memo&&(n.d=t.memo),n}function rQ(t){let e=[];t.t.forEach(t=>t.p.forEach(r=>{e.push({secret:r.s,C:p(r.c),amount:r.a,id:p(t.i),...r.d&&{dleq:{r:p(r.d.r),s:p(r.d.s),e:p(r.d.e)}},...r.w&&{witness:r.w}})}));let r={mint:t.m,proofs:e,unit:t.u||"sat"};return t.d&&(r.memo=t.d),r}function rG(t,e){let r=rZ(t=ne(t));return r.proofs=function(t,e){let r=[];for(let n of t){let t;try{t=m(n.id)}catch(t){r.push(n);continue}if(0===t[0])r.push(n);else if(1===t[0]){if(!e)throw Error("A short keyset ID v2 was encountered, but got no keysets to map it to.");let t=!1;for(let i of e)if(n.id===i.id.slice(0,n.id.length)){n.id=i.id,r.push(n),t=!0;break}if(!t)throw Error("Couldn't map short keyset ID ".concat(n.id," to any known keysets of the current Mint"))}else throw Error("Unknown keyset ID version: ".concat(t[0]))}return r}(r.proofs,e),r}function rW(t){let e=rZ(t=ne(t));return{unit:e.unit||"sat",mint:e.mint,amount:r1(e.proofs),incompleteProofs:e.proofs.map(t=>({secret:t.secret,C:t.C,amount:t.amount,...t.dleq&&{dleq:t.dleq}})),...e.memo&&{memo:e.memo}}}function rZ(t){let e=t.slice(0,1),r=t.slice(1);if("A"===e){let t=JSON.parse(eF.toString(eF.fromBase64(r.replace(/-/g,"+").replace(/_/g,"/").split("=")[0])));if(t.token.length>1)throw Error("Multi entry token are not supported");let e=t.token[0],n={mint:e.mint,proofs:e.proofs,unit:t.unit||"sat"};return t.memo&&(n.memo=t.memo),n}if("B"===e)return rQ(rq(rE(r)));throw Error("Token version is not supported")}function rY(t,e,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(i){let e=X(Object.entries(t).sort((t,e)=>t[0]-e[0]).map(t=>{let[,e]=t;return e}).reduce((t,e)=>t+e,""));return eF.toBase64(e).slice(0,12)}let o=Object.entries(t).sort((t,e)=>t[0]-e[0]).map(t=>{let[,e]=t;return m(e)}).reduce((t,e)=>rJ(t,e),new Uint8Array),s;switch(n){case 0:return s=X(o),"00"+eF.toHex(s).slice(0,14);case 1:if(!e)throw Error("Cannot compute keyset ID version 01: unit is required.");return o=rJ(o,eF.fromString("unit:"+e)),r&&(o=rJ(o,eF.fromString("final_expiry:"+r.toString()))),s=X(o),"01"+eF.toHex(s);default:throw Error("Unrecognized keyset ID version: ".concat(n))}}function rJ(t,e){let r=new Uint8Array(t.length+e.length);return r.set(t),r.set(e,t.length),r}function r$(t){return"object"==typeof t}function rX(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return e.map(t=>t.replace(/(^\/+|\/+$)/g,"")).join("/")}function r0(t){return t.replace(/\/$/,"")}function r1(t){return t.reduce((t,e)=>t+e.amount,0)}function r2(t){return rM.fromEncodedRequest(t)}class r8{get value(){return this._value}set value(t){this._value=t}get next(){return this._next}set next(t){this._next=t}constructor(t){this._value=t,this._next=null}}class r6{get first(){return this._first}set first(t){this._first=t}get last(){return this._last}set last(t){this._last=t}get size(){return this._size}set size(t){this._size=t}enqueue(t){let e=new r8(t);return 0!==this._size&&this._last?this._last.next=e:this._first=e,this._last=e,this._size++,!0}dequeue(){if(0===this._size||!this._first)return null;let t=this._first;return this._first=t.next,t.next=null,this._size--,t.value}constructor(){this._first=null,this._last=null,this._size=0}}function r3(t){return t.map(t=>{let e={...t};return delete e.dleq,e})}function r5(t){let e=rB(t.id),r=/^[a-fA-F0-9]+$/.test(t.id),n=r?m(t.id)[0]:0;return rY(t.keys,t.unit,t.final_expiry,n,e&&!r)===t.id}function r4(t,e){var r;if(null==t.dleq)return!1;let n={e:m(t.dleq.e),s:m(t.dleq.s),r:rF(null!=(r=t.dleq.r)?r:"00")};if(!(t.amount in e.keys))throw Error("undefined key for amount ".concat(t.amount));let i=e.keys[t.amount];return((t,e,r,n)=>{if(void 0===e.r)throw Error("verifyDLEQProof_reblind: Undefined blinding factor");let i=ej(t),o=r.add(n.multiply(e.r)),s=ed.ProjectivePoint.fromPrivateKey(e.r);return((t,e,r,n)=>{let i=ed.ProjectivePoint.fromPrivateKey(p(t.s)),o=n.multiply(eD(t.e)),s=e.multiply(eD(t.s)),a=r.multiply(eD(t.e));return function(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}(function(t){let e=t.map(t=>t.toHex(!1)).join("");return X(new TextEncoder().encode(e))}([i.subtract(o),s.subtract(a),n,r]),t.e)})(e,i.add(s),o,n)})(new TextEncoder().encode(t.secret),n,eV(t.C),eV(i))}function r7(t){let e=new TextEncoder,r=rR(rz(t));return function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];let n=new Uint8Array(e.reduce((t,e)=>t+e.length,0)),i=0;for(let t=0;t<e.length;t++)n.set(e[t],i),i+=e[t].length;return n}(e.encode("craw"),e.encode("B"),r)}function r9(t){let e=new TextDecoder,r=e.decode(t.slice(0,4)),n=e.decode(new Uint8Array([t[4]]));if("craw"!==r||"B"!==n)throw Error("not a valid binary token");return rQ(rq(t.slice(5)))}function nt(t){return t.reduce((t,e)=>t+e,0)}function ne(t){return["web+cashu://","cashu://","cashu:","cashu"].forEach(e=>{t.startsWith(e)&&(t=t.slice(e.length))}),t}function nr(t){e=t}"u">typeof WebSocket&&(e=WebSocket);let nn={FATAL:"FATAL",ERROR:"ERROR",WARN:"WARN",INFO:"INFO",DEBUG:"DEBUG",TRACE:"TRACE"},ni={fatal(){},error(){},warn(){},info(){},debug(){},trace(){},log(){}},no=class t{logToConsole(e,r,n){if(t.SEVERITY[e]>t.SEVERITY[this.minLevel])return;let i="[".concat(e,"] "),o=r,s=new Set;if(n){let t=Object.fromEntries(Object.entries(n).map(t=>{let[e,r]=t;return[e,r instanceof Error?{message:r.message,stack:r.stack}:r]}));o=r.replace(/\{(\w+)\}/g,(e,r)=>{if(r in t&&void 0!==t[r]){s.add(r);let e=t[r];return"string"==typeof e?e:"number"==typeof e||"boolean"==typeof e?e.toString():null==e?"":JSON.stringify(e)}return e});let a=Object.fromEntries(Object.entries(t).filter(t=>{let[e]=t;return!s.has(e)})),l=this.getConsoleMethod(e);Object.keys(a).length>0?l(i+o,a):l(i+o)}else this.getConsoleMethod(e)(i+o)}getConsoleMethod(t){switch(t){case nn.FATAL:case nn.ERROR:return console.error;case nn.WARN:return console.warn;case nn.INFO:return console.info;case nn.DEBUG:return console.debug;case nn.TRACE:return console.trace;default:return console.log}}fatal(t,e){this.logToConsole(nn.FATAL,t,e)}error(t,e){this.logToConsole(nn.ERROR,t,e)}warn(t,e){this.logToConsole(nn.WARN,t,e)}info(t,e){this.logToConsole(nn.INFO,t,e)}debug(t,e){this.logToConsole(nn.DEBUG,t,e)}trace(t,e){this.logToConsole(nn.TRACE,t,e)}log(t,e,r){this.logToConsole(t,e,r)}constructor(t=nn.INFO){this.minLevel=t}};no.SEVERITY={[nn.FATAL]:0,[nn.ERROR]:1,[nn.WARN]:2,[nn.INFO]:3,[nn.DEBUG]:4,[nn.TRACE]:5};let ns=no;class na{static getInstance(){return na.instance||(na.instance=new na),na.instance}getConnection(t,e){if(this.connectionMap.has(t))return this.connectionMap.get(t);let r=new nl(t,e);return this.connectionMap.set(t,r),r}constructor(){this.connectionMap=new Map}}class nl{connect(){return this.connectionPromise||(this.connectionPromise=new Promise((t,e)=>{try{this.ws=new this._WS(this.url.toString()),this.onCloseCallbacks=[]}catch(t){e(t instanceof Error?t:Error(String(t)));return}this.ws.onopen=()=>{t()},this.ws.onerror=()=>{e(Error("Failed to open WebSocket"))},this.ws.onmessage=t=>{this.messageQueue.enqueue(t.data),this.handlingInterval||(this.handlingInterval=setInterval(this.handleNextMessage.bind(this),0))},this.ws.onclose=t=>{this.connectionPromise=void 0,this.onCloseCallbacks.forEach(e=>e(t))}})),this.connectionPromise}sendRequest(t,e){var r,n;if((null==(r=this.ws)?void 0:r.readyState)!==1){if("unsubscribe"===t)return;throw this._logger.error("Attempted sendRequest, but socket was not open"),Error("Socket not open")}let i=this.rpcId;this.rpcId++;let o=JSON.stringify({jsonrpc:"2.0",method:t,params:e,id:i});null==(n=this.ws)||n.send(o)}closeSubscription(t){var e;null==(e=this.ws)||e.send(JSON.stringify(["CLOSE",t]))}addSubListener(t,e){(this.subListeners[t]=this.subListeners[t]||[]).push(e)}addRpcListener(t,e,r){this.rpcListeners[r]={callback:t,errorCallback:e}}removeRpcListener(t){delete this.rpcListeners[t]}removeListener(t,e){if(this.subListeners[t]){if(1===this.subListeners[t].length)return void delete this.subListeners[t];this.subListeners[t]=this.subListeners[t].filter(t=>t!==e)}}async ensureConnection(){var t;(null==(t=this.ws)?void 0:t.readyState)!==1&&await this.connect()}handleNextMessage(){let t;if(0===this.messageQueue.size){clearInterval(this.handlingInterval),this.handlingInterval=void 0;return}let e=this.messageQueue.dequeue();try{if(t=JSON.parse(e),"result"in t&&null!=t.id)this.rpcListeners[t.id]&&(this.rpcListeners[t.id].callback(),this.removeRpcListener(t.id));else if("error"in t&&null!=t.id)this.rpcListeners[t.id]&&(this.rpcListeners[t.id].errorCallback(Error(t.error.message)),this.removeRpcListener(t.id));else if("method"in t&&!("id"in t)){var r,n;let e=null==(r=t.params)?void 0:r.subId;if(!e)return;(null==(n=this.subListeners[e])?void 0:n.length)>0&&this.subListeners[e].forEach(e=>{var r;return e(null==(r=t.params)?void 0:r.payload)})}}catch(t){this._logger.error("Error doing handleNextMessage",{e:t});return}}createSubscription(t,e,r){var n;if((null==(n=this.ws)?void 0:n.readyState)!==1)throw this._logger.error("Attempted createSubscription, but socket was not open"),Error("Socket is not open");let i=(Math.random()+1).toString(36).substring(7);return this.addRpcListener(()=>{this.addSubListener(i,e)},r,this.rpcId),this.sendRequest("subscribe",{...t,subId:i}),this.rpcId++,i}cancelSubscription(t,e,r){this.removeListener(t,e),this.addRpcListener(()=>{this._logger.info("Unsubscribed {subId}",{subId:t})},r||(t=>this._logger.error("Unsubscribe failed",{e:t})),this.rpcId),this.sendRequest("unsubscribe",{subId:t})}get activeSubscriptions(){return Object.keys(this.subListeners)}close(){var t;this.ws&&(null==(t=this.ws)||t.close())}onClose(t){this.onCloseCallbacks.push(t)}constructor(t,r){this.subListeners={},this.rpcListeners={},this.rpcId=0,this.onCloseCallbacks=[],this._WS=function(){if(void 0===e)throw Error("WebSocket implementation not initialized");return e}(),this.url=new URL(t),this.messageQueue=new r6,this._logger=null!=r?r:ni}}let nu={UNSPENT:"UNSPENT",PENDING:"PENDING",SPENT:"SPENT"},nf={UNPAID:"UNPAID",PENDING:"PENDING",PAID:"PAID"},nc={UNPAID:"UNPAID",PAID:"PAID",ISSUED:"ISSUED"};var nh=(t=>(t.POST="post",t.NOSTR="nostr",t))(nh||{});class nd extends Error{constructor(t,e){super(t),this.status=e,this.name="HttpResponseError",Object.setPrototypeOf(this,nd.prototype)}}class np extends Error{constructor(t){super(t),this.name="NetworkError",Object.setPrototypeOf(this,np.prototype)}}class ny extends nd{constructor(t,e){super(e||"Unknown mint operation error",400),this.code=t,this.name="MintOperationError",Object.setPrototypeOf(this,ny.prototype)}}let ng={},nm=ni;function nb(t){ng=t}async function nw(t){let e,{endpoint:r,requestBody:n,headers:i,...o}=t,s=n?JSON.stringify(n):void 0,a={Accept:"application/json, text/plain, */*",...s?{"Content-Type":"application/json"}:void 0,...i};try{e=await fetch(r,{body:s,headers:a,...o})}catch(t){throw new np(t instanceof Error?t.message:"Network request failed")}if(!e.ok){let t;try{t=await e.json()}catch(e){t={error:"bad response"}}if(400===e.status&&"code"in t&&"number"==typeof t.code&&"detail"in t&&"string"==typeof t.detail)throw new ny(t.code,t.detail);let r="HTTP request failed";throw"error"in t&&"string"==typeof t.error?r=t.error:"detail"in t&&"string"==typeof t.detail&&(r=t.detail),new nd(r,e.status)}try{return await e.json()}catch(t){throw nm.error("Failed to parse HTTP response",{err:t}),new nd("bad response",e.status)}}async function nv(t){return await nw({...t,...ng})}function nE(t,e){return t.state||(e.warn("Field 'state' not found in MeltQuoteResponse. Update NUT-05 of mint: https://github.com/cashubtc/nuts/pull/136)"),"boolean"==typeof t.paid&&(t.state=t.paid?nf.PAID:nf.UNPAID)),t}function nx(t,e){return t.state||(e.warn("Field 'state' not found in MintQuoteResponse. Update NUT-04 of mint: https://github.com/cashubtc/nuts/pull/141)"),"boolean"==typeof t.paid&&(t.state=t.paid?nc.PAID:nc.UNPAID)),t}class nB{isSupported(t){switch(t){case 4:case 5:return this.checkMintMelt(t);case 7:case 8:case 9:case 10:case 11:case 12:case 14:case 20:return this.checkGenericNut(t);case 17:return this.checkNut17();case 15:return this.checkNut15();default:throw Error("nut is not supported by cashu-ts")}}requiresBlindAuthToken(t){if(!this._protectedEnpoints)return!1;if("boolean"==typeof this._protectedEnpoints.cache[t])return this._protectedEnpoints.cache[t];let e=this._protectedEnpoints.apiReturn.some(e=>e.regex.test(t));return this._protectedEnpoints.cache[t]=e,e}checkGenericNut(t){var e;return(null==(e=this._mintInfo.nuts[t])?void 0:e.supported)?{supported:!0}:{supported:!1}}checkMintMelt(t){let e=this._mintInfo.nuts[t];return e&&e.methods.length>0&&!e.disabled?{disabled:!1,params:e.methods}:{disabled:!0,params:e.methods}}checkNut17(){return this._mintInfo.nuts[17]&&this._mintInfo.nuts[17].supported.length>0?{supported:!0,params:this._mintInfo.nuts[17].supported}:{supported:!1}}checkNut15(){return this._mintInfo.nuts[15]&&this._mintInfo.nuts[15].methods.length>0?{supported:!0,params:this._mintInfo.nuts[15].methods}:{supported:!1}}get contact(){return this._mintInfo.contact}get description(){return this._mintInfo.description}get description_long(){return this._mintInfo.description_long}get name(){return this._mintInfo.name}get pubkey(){return this._mintInfo.pubkey}get nuts(){return this._mintInfo.nuts}get version(){return this._mintInfo.version}get motd(){return this._mintInfo.motd}get supportsBolt12Description(){var t;return null==(t=this._mintInfo.nuts[4])?void 0:t.methods.some(t=>{var e;return"bolt12"===t.method&&(null==(e=t.options)?void 0:e.description)===!0})}constructor(t){this._mintInfo=t,t.nuts[22]&&(this._protectedEnpoints={cache:{},apiReturn:t.nuts[22].protected_endpoints.map(t=>({method:t.method,regex:new RegExp(t.path)}))})}}class nk{get mintUrl(){return this._mintUrl}static async getInfo(t,e,r){var n,i;return n=await (e||nv)({endpoint:rX(t,"/v1/info")}),i=null!=r?r:ni,Array.isArray(null==n?void 0:n.contact)&&(null==n?void 0:n.contact.length)>0&&(n.contact=n.contact.map(t=>Array.isArray(t)&&2===t.length&&"string"==typeof t[0]&&"string"==typeof t[1]?(i.warn("Mint returned deprecated 'contact' field: Update NUT-06: https://github.com/cashubtc/nuts/pull/117"),{method:t[0],info:t[1]}):t)),n}async getInfo(){return nk.getInfo(this._mintUrl,this._customRequest,this._logger)}async getLazyMintInfo(){if(this._mintInfo)return this._mintInfo;let t=await nk.getInfo(this._mintUrl,this._customRequest);return this._mintInfo=new nB(t),this._mintInfo}static async swap(t,e,r,n){var i;let o=r||nv,s=await o({endpoint:rX(t,"/v1/swap"),method:"POST",requestBody:e,headers:n?{"Blind-auth":n}:{}});if(!r$(s)||!Array.isArray(null==s?void 0:s.signatures))throw Error(null!=(i=s.detail)?i:"bad response");return s}async swap(t){let e=await this.handleBlindAuth("/v1/swap");return nk.swap(this._mintUrl,t,this._customRequest,e)}static async createMintQuote(t,e,r,n,i){let o=r||nv;return nx(await o({endpoint:rX(t,"/v1/mint/quote/bolt11"),method:"POST",requestBody:e,headers:n?{"Blind-auth":n}:{}}),null!=i?i:ni)}async createMintQuote(t){let e=await this.handleBlindAuth("/v1/mint/quote/bolt11");return nk.createMintQuote(this._mintUrl,t,this._customRequest,e)}static async createMintQuoteBolt12(t,e,r,n){let i=r||nv;return await i({endpoint:rX(t,"/v1/mint/quote/bolt12"),method:"POST",requestBody:e,headers:n?{"Blind-auth":n}:{}})}async createMintQuoteBolt12(t){let e=await this.handleBlindAuth("/v1/mint/quote/bolt12");return nk.createMintQuoteBolt12(this._mintUrl,t,this._customRequest,e)}static async checkMintQuote(t,e,r,n,i){let o=r||nv;return nx(await o({endpoint:rX(t,"/v1/mint/quote/bolt11",e),method:"GET",headers:n?{"Blind-auth":n}:{}}),null!=i?i:ni)}async checkMintQuote(t){let e=await this.handleBlindAuth("/v1/mint/quote/bolt11/".concat(t));return nk.checkMintQuote(this._mintUrl,t,this._customRequest,e)}static async checkMintQuoteBolt12(t,e,r,n){let i=r||nv;return await i({endpoint:rX(t,"/v1/mint/quote/bolt12",e),method:"GET",headers:n?{"Blind-auth":n}:{}})}async checkMintQuoteBolt12(t){let e=await this.handleBlindAuth("/v1/mint/quote/bolt12/".concat(t));return nk.checkMintQuoteBolt12(this._mintUrl,t,this._customRequest,e)}static async mint(t,e,r,n){let i=r||nv,o=await i({endpoint:rX(t,"/v1/mint/bolt11"),method:"POST",requestBody:e,headers:n?{"Blind-auth":n}:{}});if(!r$(o)||!Array.isArray(null==o?void 0:o.signatures))throw Error("bad response");return o}async mint(t){let e=await this.handleBlindAuth("/v1/mint/bolt11");return nk.mint(this._mintUrl,t,this._customRequest,e)}static async mintBolt12(t,e,r,n){let i=r||nv,o=await i({endpoint:rX(t,"/v1/mint/bolt12"),method:"POST",requestBody:e,headers:n?{"Blind-auth":n}:{}});if(!r$(o)||!Array.isArray(null==o?void 0:o.signatures))throw Error("bad response");return o}async mintBolt12(t){let e=await this.handleBlindAuth("/v1/mint/bolt12");return nk.mintBolt12(this._mintUrl,t,this._customRequest,e)}static async createMeltQuote(t,e,r,n,i){let o=r||nv,s=nE(await o({endpoint:rX(t,"/v1/melt/quote/bolt11"),method:"POST",requestBody:e,headers:n?{"Blind-auth":n}:{}}),null!=i?i:ni);if(!r$(s)||"number"!=typeof(null==s?void 0:s.amount)||"number"!=typeof(null==s?void 0:s.fee_reserve)||"string"!=typeof(null==s?void 0:s.quote))throw Error("bad response");return s}async createMeltQuote(t){let e=await this.handleBlindAuth("/v1/melt/quote/bolt11");return nk.createMeltQuote(this._mintUrl,t,this._customRequest,e)}static async createMeltQuoteBolt12(t,e,r,n){let i=r||nv;return await i({endpoint:rX(t,"/v1/melt/quote/bolt12"),method:"POST",requestBody:e,headers:n?{"Blind-auth":n}:{}})}async createMeltQuoteBolt12(t){let e=await this.handleBlindAuth("/v1/melt/quote/bolt12");return nk.createMeltQuoteBolt12(this._mintUrl,t,this._customRequest,e)}static async checkMeltQuote(t,e,r,n,i){let o=r||nv,s=nE(await o({endpoint:rX(t,"/v1/melt/quote/bolt11",e),method:"GET",headers:n?{"Blind-auth":n}:{}}),null!=i?i:ni);if(!r$(s)||"number"!=typeof(null==s?void 0:s.amount)||"number"!=typeof(null==s?void 0:s.fee_reserve)||"string"!=typeof(null==s?void 0:s.quote)||"string"!=typeof(null==s?void 0:s.state)||!Object.values(nf).includes(s.state))throw Error("bad response");return s}async checkMeltQuote(t){let e=await this.handleBlindAuth("/v1/melt/quote/bolt11/".concat(t));return nk.checkMeltQuote(this._mintUrl,t,this._customRequest,e)}static async checkMeltQuoteBolt12(t,e,r,n){let i=r||nv;return await i({endpoint:rX(t,"/v1/melt/quote/bolt12",e),method:"GET",headers:n?{"Blind-auth":n}:{}})}async checkMeltQuoteBolt12(t){let e=await this.handleBlindAuth("/v1/melt/quote/bolt12/".concat(t));return nk.checkMeltQuoteBolt12(this._mintUrl,t,this._customRequest,e)}static async melt(t,e,r,n,i){let o=r||nv,s=nE(await o({endpoint:rX(t,"/v1/melt/bolt11"),method:"POST",requestBody:e,headers:n?{"Blind-auth":n}:{}}),null!=i?i:ni);if(!r$(s)||"string"!=typeof(null==s?void 0:s.state)||!Object.values(nf).includes(s.state))throw Error("bad response");return s}async melt(t){let e=await this.handleBlindAuth("/v1/melt/bolt11");return nk.melt(this._mintUrl,t,this._customRequest,e)}static async meltBolt12(t,e,r,n){let i=r||nv;return await i({endpoint:rX(t,"/v1/melt/bolt12"),method:"POST",requestBody:e,headers:n?{"Blind-auth":n}:{}})}async meltBolt12(t){let e=await this.handleBlindAuth("/v1/melt/bolt12");return nk.meltBolt12(this._mintUrl,t,this._customRequest,e)}static async check(t,e,r){let n=await (r||nv)({endpoint:rX(t,"/v1/checkstate"),method:"POST",requestBody:e});if(!r$(n)||!Array.isArray(null==n?void 0:n.states))throw Error("bad response");return n}static async getKeys(t,e,r){e&&(e=e.replace(/\//g,"_").replace(/\+/g,"-"));let n=await (r||nv)({endpoint:e?rX(t,"/v1/keys",e):rX(t,"/v1/keys")});if(!r$(n)||!Array.isArray(n.keysets))throw Error("bad response");return n}async getKeys(t,e){return await nk.getKeys(e||this._mintUrl,t,this._customRequest)}static async getKeySets(t,e){return(e||nv)({endpoint:rX(t,"/v1/keysets")})}async getKeySets(){return nk.getKeySets(this._mintUrl,this._customRequest)}async check(t){return nk.check(this._mintUrl,t,this._customRequest)}static async restore(t,e,r){let n=await (r||nv)({endpoint:rX(t,"/v1/restore"),method:"POST",requestBody:e});if(!r$(n)||!Array.isArray(null==n?void 0:n.outputs)||!Array.isArray(null==n?void 0:n.signatures))throw Error("bad response");return n}async restore(t){return nk.restore(this._mintUrl,t,this._customRequest)}async connectWebSocket(){if(this.ws)await this.ws.ensureConnection();else{let t=new URL(this._mintUrl),e="v1/ws";t.pathname&&(t.pathname.endsWith("/")?t.pathname+=e:t.pathname+="/"+e),this.ws=na.getInstance().getConnection("".concat("https:"===t.protocol?"wss":"ws","://").concat(t.host).concat(t.pathname));try{await this.ws.connect()}catch(t){throw this._logger.error("Failed to connect to WebSocket...",{e:t}),Error("Failed to connect to WebSocket...")}}}disconnectWebSocket(){this.ws&&this.ws.close()}get webSocketConnection(){return this.ws}async handleBlindAuth(t){if(this._checkNut22&&(await this.getLazyMintInfo()).requiresBlindAuthToken(t)){if(!this._authTokenGetter)throw Error("Can not call a protected endpoint without authProofGetter");return this._authTokenGetter()}}constructor(t,e,r,n){var i;this._mintUrl=t,this._customRequest=e,this._checkNut22=!1,this._mintUrl=r0(t),this._customRequest=e,r&&(this._checkNut22=!0,this._authTokenGetter=r),this._logger=null!=(i=null==n?void 0:n.logger)?i:ni,nm=this._logger}}class nA{getSerializedBlindedMessage(){return{amount:this.amount,B_:this.B_.toHex(!0),id:this.id}}constructor(t,e,r){this.amount=t,this.B_=e,this.id=r}}function n_(t){return"function"==typeof t}let nI=new Set(["locktime","pubkeys","n_sigs","refund","n_sigs_refund"]);class nS{toProof(t,e){var r;let n,i;t.dleq&&(n={s:m(t.dleq.s),e:m(t.dleq.e),r:this.blindingFactor});let o={id:t.id,amount:t.amount,C_:eV(t.C_)},s=eV(e.keys[t.amount]);return{...{amount:(i=function(t,e,r,n){var i;let o=(i=t.C_,i.subtract(n.multiply(e)));return{id:t.id,amount:t.amount,secret:r,C:o}}(o,this.blindingFactor,this.secret,s)).amount,C:i.C.toHex(!0),id:i.id,secret:new TextDecoder().decode(i.secret),witness:JSON.stringify(i.witness)},...n&&{dleq:{s:p(n.s),e:p(n.e),r:(null!=(r=n.r)?r:BigInt(0)).toString(16).padStart(64,"0")}}}}static createP2PKData(t,e,r,n){return rN(e,r.keys,n).map(e=>this.createSingleP2PKData(t,e,r.id))}static createSingleP2PKData(t,e,r){var n,i,o,s,a;let l=Array.isArray(t.pubkey)?t.pubkey:[t.pubkey],u=null!=(i=t.refundKeys)?i:[],f=Math.max(1,Math.min(null!=(o=t.requiredSignatures)?o:1,l.length)),c=Math.max(1,Math.min(null!=(s=t.requiredRefundSignatures)?s:1,u.length||1)),h=l[0],d=l.slice(1),y=[],g=null!=(a=t.locktime)?a:NaN;if(Number.isSafeInteger(g)&&g>=0&&y.push(["locktime",String(g)]),d.length>0&&(y.push(["pubkeys",...d]),f>1&&y.push(["n_sigs",String(f)])),u.length>0&&(y.push(["refund",...u]),c>1&&y.push(["n_sigs_refund",String(c)])),null==(n=t.additionalTags)?void 0:n.length){let e=t.additionalTags.map((t,e)=>{let[r,...n]=t;if("string"!=typeof r||!r)throw Error("additionalTags[".concat(e,"][0] must be a non empty string"));if(nI.has(r))throw Error('additionalTags must not use reserved key "'.concat(r,'"'));return[r,...n.map(String)]});y.push(...e)}let m=JSON.stringify(["P2PK",{nonce:p(B(32)),data:h,tags:y}]),b=[...m].length;if(b>1024)throw Error("Secret too long (".concat(b," characters), maximum is ").concat(1024));let w=new TextEncoder().encode(m),{r:v,B_:E}=rU(w);return new nS(new nA(e,E,r).getSerializedBlindedMessage(),v,w)}static createRandomData(t,e,r){return rN(t,e.keys,r).map(t=>this.createSingleRandomData(t,e.id))}static createSingleRandomData(t,e){let r=p(B(32)),n=new TextEncoder().encode(r),{r:i,B_:o}=rU(n);return new nS(new nA(t,o,e).getSerializedBlindedMessage(),i,n)}static createDeterministicData(t,e,r,n,i){return rN(t,n.keys,i).map((t,i)=>this.createSingleDeterministicData(t,e,r+i,n.id))}static createSingleDeterministicData(t,e,r,n){let i=p(((t,e,r)=>{let n=/^[a-fA-F0-9]+$/.test(e);if(!n&&rB(e)||n&&e.startsWith("00"))return rA(t,e,r,0);if(n&&e.startsWith("01"))return rk(t,e,r,0);throw Error("Unrecognized keyset ID version ".concat(e.slice(0,2)))})(e,n,r)),o=new TextEncoder().encode(i),{r:s,B_:a}=rU(o,rF(p(((t,e,r)=>{let n=/^[a-fA-F0-9]+$/.test(e);if(!n&&rB(e)||n&&e.startsWith("00"))return rA(t,e,r,1);if(n&&e.startsWith("01"))return rk(t,e,r,1);throw Error("Unrecognized keyset ID version ".concat(e.slice(0,2)))})(e,n,r))));return new nS(new nA(t,a,n).getSerializedBlindedMessage(),s,o)}constructor(t,e,r){this.secret=r,this.blindingFactor=e,this.blindedMessage=t}}class nU{get unit(){return this._unit}get keys(){return this._keys}get keysetId(){if(!this._keysetId)throw Error("No keysetId set");return this._keysetId}set keysetId(t){this._keysetId=t}get keysets(){return this._keysets}get mintInfo(){if(!this._mintInfo)throw Error("Mint info not loaded");return this._mintInfo}async getMintInfo(){let t=await this.mint.getInfo();return this._mintInfo=new nB(t),this._mintInfo}async lazyGetMintInfo(){return this._mintInfo?this._mintInfo:await this.getMintInfo()}async loadMint(){await Promise.all([this.getMintInfo(),this.getKeys()])}getActiveKeyset(t){let e=t.filter(t=>t.active&&t.unit===this._unit),r=(e=e.filter(t=>rD(t.id))).sort((t,e)=>{var r,n;return(null!=(r=t.input_fee_ppk)?r:0)-(null!=(n=e.input_fee_ppk)?n:0)})[0];if(!r)throw Error("No active keyset found");return r}async getKeySets(){let t=(await this.mint.getKeySets()).keysets.filter(t=>t.unit===this._unit);return this._keysets=t,this._keysets}async getAllKeys(){let t=await this.mint.getKeys();return t.keysets.forEach(t=>{if(!r5(t))throw Error("Couldn't verify keyset ID ".concat(t.id))}),this._keys=new Map(t.keysets.map(t=>[t.id,t])),this.keysetId=this.getActiveKeyset(this._keysets).id,t.keysets}async getKeys(t,e){if((!(this._keysets.length>0)||e)&&await this.getKeySets(),t||(t=this.getActiveKeyset(this._keysets).id),!this._keysets.find(e=>e.id===t)&&(await this.getKeySets(),!this._keysets.find(e=>e.id===t)))throw Error("could not initialize keys. No keyset with id '".concat(t,"' found"));if(!this._keys.get(t)){let e=await this.mint.getKeys(t);if(!r5(e.keysets[0]))throw Error("Couldn't verify keyset ID ".concat(e.keysets[0].id));this._keys.set(t,e.keysets[0])}return this.keysetId=t,this._keys.get(t)}async receive(t,e){let r,{requireDleq:n,keysetId:i,outputAmounts:o,counter:s,pubkey:a,privkey:l,outputData:u,p2pk:f}=e||{};0===this._keysets.length&&await this.getKeySets(),"string"==typeof t&&(t=rG(t,this._keysets));let c=await this.getKeys(i);if(n&&t.proofs.some(t=>!r4(t,c)))throw Error("Token contains proofs with invalid DLEQ");let h=r1(t.proofs)-this.getFeesForProofs(t.proofs);u?r={send:u}:this._keepFactory&&(r={send:this._keepFactory});let d=this.createSwapPayload(h,t.proofs,c,o,s,a,l,r,f),{signatures:p}=await this.mint.swap(d.payload),y=d.outputData.map((t,e)=>t.toProof(p[e],c)),g=[];return d.sortedIndices.forEach((t,e)=>{g[t]=y[e]}),g}async send(t,e,r){let{offline:n,includeFees:i,includeDleq:o,keysetId:s,outputAmounts:a,pubkey:l,privkey:u,outputData:f}=r||{};if(o&&(e=e.filter(t=>null!=t.dleq)),r1(e)<t)throw Error("Not enough funds available to send");let{keep:c,send:h}=this.selectProofsToSend(e,t,null==r?void 0:r.includeFees),d=i?this.getFeesForProofs(h):0;if(!n&&(r1(h)!=t+d||a||l||u||s||f)){let n=await this.swap(t,e,r),{keep:i,send:o}=n;return{keep:i,send:o,serialized:n.serialized}}if(r1(h)<t+d)throw Error("Not enough funds available to send");return{keep:c,send:h}}selectProofsToSend(t,e){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=function(){let t=Date.now();return{elapsed:()=>Date.now()-t}}(),i=null,o=1/0,s=0,a=0,l=(t,e)=>t-(r?Math.ceil(e/1e3):0),u=t=>{let e=[...t];for(let t=e.length-1;t>0;t--){let r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}return e},f=(t,e,r)=>{let n=0,i=t.length-1,o=null;for(;n<=i;){let s=Math.floor((n+i)/2),a=t[s].exFee;(r?a<=e:a>=e)?(o=s,r?n=s+1:i=s-1):r?i=s-1:n=s+1}return r?o:n<t.length?n:null},c=(t,e)=>{let r=e.exFee,n=0,i=t.length;for(;n<i;){let e=Math.floor((n+i)/2);t[e].exFee<r?n=e+1:i=e}t.splice(n,0,e)},h=(t,r)=>l(t,r)<e?1/0:t+r/1e3-e,d=0,p=0,y=t.map(t=>{let e=this.getProofFeePPK(t),n=r?t.amount-e/1e3:t.amount;return(!r||n>0)&&(d+=t.amount,p+=e),{proof:t,exFee:n,ppkfee:e}}),g=r?y.filter(t=>t.exFee>0):y;if(g.sort((t,e)=>t.exFee-e.exFee),g.length>0){let t;{let r=f(g,e,!1);if(null!==r){let e=g[r].exFee,n=f(g,e,!0);if(null===n)throw Error("Unexpected null rightIndex in binary search");t=n+1}else t=g.length}for(let e=t;e<g.length;e++)d-=g[e].proof.amount,p-=g[e].ppkfee;g=g.slice(0,t)}let m=l(d,p);if(e<=0||e>m)return{keep:t,send:[]};let b=Math.min(Math.ceil(+e),e+0,m);for(let t=0;t<60;t++){let r=[],d=0,p=0;for(let t of u(g)){let n=d+t.proof.amount,i=p+t.ppkfee,o=l(n,i);if(r.push(t),d=n,p=i,o>=e)break}let y=new Set(r),m=g.filter(t=>!y.has(t));for(let t of u(Array.from({length:r.length},(t,e)=>e)).slice(0,5e3)){let n=l(d,p);if(n===e||n>=e&&n<=b)break;let i=r[t],o=d-i.proof.amount,s=p-i.ppkfee,a=e-l(o,s),u=f(m,a,!1);if(null!==u){let e=m[u];(a>=0||e.exFee<=i.exFee)&&(r[t]=e,d=o+e.proof.amount,p=s+e.ppkfee,m.splice(u,1),c(m,i))}}let w=h(d,p);if(w<o){this._logger.debug("selectProofsToSend: best solution found in trial #{trial} - amount: {amount}, delta: {delta}",{trial:t,amount:d,delta:w}),i=[...r].sort((t,e)=>e.exFee-t.exFee),o=w,s=d,a=p;let e=[...i];for(;e.length>1&&o>0;){let t=e.pop(),r=d-t.proof.amount,n=p-t.ppkfee,l=h(r,n);if(l==1/0)break;l<o&&(i=[...e],o=l,s=r,a=n,d=r,p=n)}}if(i&&o<1/0){let t=l(s,a);if(t===e||t>=e&&t<=b)break}if(n.elapsed()>1e3){this._logger.warn("Proof selection took too long. Returning best selection so far.");break}}if(i&&o<1/0){let e=i.map(t=>t.proof),r=new Set(e),o=t.filter(t=>!r.has(t));return this._logger.info("Proof selection took {time}ms",{time:n.elapsed()}),{keep:o,send:e}}return{keep:t,send:[]}}getFeesForProofs(t){return Math.ceil(t.reduce((t,e)=>t+this.getProofFeePPK(e),0)/1e3)}getProofFeePPK(t){let e=this._keysets.find(e=>e.id===t.id);if(!e)throw Error("Could not get fee. No keyset found for keyset id: ".concat(t.id));return(null==e?void 0:e.input_fee_ppk)||0}getFeesForKeyset(t,e){var r;return Math.floor(Math.max((t*((null==(r=this._keysets.find(t=>t.id===e))?void 0:r.input_fee_ppk)||0)+999)/1e3,0))}async swap(t,e,r){let n,{outputAmounts:i}=r||{},{includeFees:o,keysetId:s,counter:a,pubkey:l,privkey:u,proofsWeHave:f,outputData:c,p2pk:h}=r||{},d=await this.getKeys(s),p=t,y=r1(e),g=(null==i?void 0:i.sendAmounts)||rN(p,d.keys);if(o){let t=this.getFeesForKeyset(g.length,d.id),e=rN(t,d.keys);for(;this.getFeesForKeyset(g.concat(e).length,d.id)>t;)e=rN(++t,d.keys);g=g.concat(e),p+=t}let{keep:m,send:b}=this.selectProofsToSend(e,p,!0),w=r1(b)-this.getFeesForProofs(b)-p;if(w<0)throw Error("Not enough balance to send");if((null==i?void 0:i.keepAmounts)||f)if((null==i?void 0:i.keepAmounts)||!f){if(i){var v;if((null==(v=i.keepAmounts)?void 0:v.reduce((t,e)=>t+e,0))!=w)throw Error("Keep amounts do not match amount to keep");n=i.keepAmounts}}else n=rK(f,w,d.keys,this._denominationTarget);else n=rN(w,d.keys);if(p+this.getFeesForProofs(b)>y)throw this._logger.error("Not enough funds available (".concat(y,") for swap amountToSend: ").concat(p," + fee: ").concat(this.getFeesForProofs(b)," | length: ").concat(b.length)),Error("Not enough funds available for swap");i={keepAmounts:n,sendAmounts:g};let E=(null==c?void 0:c.keep)||this._keepFactory,x=null==c?void 0:c.send,B=this.createSwapPayload(p,b,d,i,a,l,u,{keep:E,send:x},h),{signatures:k}=await this.mint.swap(B.payload),A=B.outputData.map((t,e)=>t.toProof(k[e],d)),_=[],I=[],S=Array(B.keepVector.length),U=Array(A.length);return B.sortedIndices.forEach((t,e)=>{S[t]=B.keepVector[e],U[t]=A[e]}),U.forEach((t,e)=>{S[e]?_.push(t):I.push(t)}),{keep:[..._,...m],send:I}}async batchRestore(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:300,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0,i=Math.ceil(t/e),o=[],s,a=0;for(;a<i;){let t=await this.restore(r,e,{keysetId:n});t.proofs.length>0?(a=0,o.push(...t.proofs),s=t.lastCounterWithSignature):a++,r+=e}return{proofs:o,lastCounterWithSignature:s}}async restore(t,e,r){let n,{keysetId:i}=r||{},o=await this.getKeys(i);if(!this._seed)throw Error("CashuWallet must be initialized with a seed to use restore");let s=Array(e).fill(0),a=nS.createDeterministicData(0,this._seed,t,o,s),{outputs:l,signatures:u}=await this.mint.restore({outputs:a.map(t=>t.blindedMessage)}),f={};l.forEach((t,e)=>f[t.B_]=u[e]);let c=[];for(let e=0;e<a.length;e++){let r=f[a[e].blindedMessage.B_];r&&(n=t+e,a[e].blindedMessage.amount=r.amount,c.push(a[e].toProof(r,o)))}return{proofs:c,lastCounterWithSignature:n}}async createMintQuote(t,e){let r={unit:this._unit,amount:t,description:e},n=await this.mint.createMintQuote(r);return{...n,amount:n.amount||t,unit:n.unit||this.unit}}async createLockedMintQuote(t,e,r){let{supported:n}=(await this.lazyGetMintInfo()).isSupported(20);if(!n)throw Error("Mint does not support NUT-20");let i={unit:this._unit,amount:t,description:r,pubkey:e},o=await this.mint.createMintQuote(i);if("string"!=typeof o.pubkey)throw Error("Mint returned unlocked mint quote");{let e=o.pubkey;return{...o,pubkey:e,amount:o.amount||t,unit:o.unit||this.unit}}}async createMintQuoteBolt12(t,e){let r=await this.lazyGetMintInfo();if((null==e?void 0:e.description)&&!r.supportsBolt12Description)throw Error("Mint does not support description for bolt12");let n={pubkey:t,unit:this._unit,amount:null==e?void 0:e.amount,description:null==e?void 0:e.description};return this.mint.createMintQuoteBolt12(n)}async checkMintQuote(t){let e="string"==typeof t?t:t.quote,r=await this.mint.checkMintQuote(e);return"string"==typeof t?r:{...r,amount:r.amount||t.amount,unit:r.unit||t.unit}}async checkMintQuoteBolt12(t){return this.mint.checkMintQuoteBolt12(t)}async mintProofs(t,e,r){return this._mintProofs("bolt11",t,e,r)}async mintProofsBolt12(t,e,r,n){return this._mintProofs("bolt12",t,e,{...n,privateKey:r})}async createMeltQuote(t){let e={unit:this._unit,request:t},r=await this.mint.createMeltQuote(e);return{...r,unit:r.unit||this.unit,request:r.request||t}}async createMeltQuoteBolt12(t,e){return this.mint.createMeltQuoteBolt12({unit:this._unit,request:t,options:e?{amountless:{amount_msat:e}}:void 0})}async createMultiPathMeltQuote(t,e){let{supported:r,params:n}=(await this.lazyGetMintInfo()).isSupported(15);if(!r)throw Error("Mint does not support NUT-15");if(!(null==n?void 0:n.some(t=>"bolt11"===t.method&&t.unit===this.unit)))throw Error("Mint does not support MPP for bolt11 and ".concat(this.unit));let i={unit:this._unit,request:t,options:{mpp:{amount:e}}};return{...await this.mint.createMeltQuote(i),request:t,unit:this._unit}}async checkMeltQuote(t){let e="string"==typeof t?t:t.quote,r=await this.mint.checkMeltQuote(e);return"string"==typeof t?r:{...r,request:t.request,unit:t.unit}}async checkMeltQuoteBolt12(t){return this.mint.checkMeltQuoteBolt12(t)}async meltProofs(t,e,r){return this._meltProofs("bolt11",t,e,r)}async meltProofsBolt12(t,e,r){return this._meltProofs("bolt12",t,e,r)}createSwapPayload(t,e,r,n,i,o,s,a,l){let u=e.reduce((t,e)=>t+e.amount,0);n&&n.sendAmounts&&!n.keepAmounts&&(n.keepAmounts=rN(u-t-this.getFeesForProofs(e),r.keys));let f=u-t-this.getFeesForProofs(e),c=[],h=[];if(null==a?void 0:a.keep)if(n_(a.keep)){let t=a.keep;rN(f,r.keys).forEach(e=>{c.push(t(e,r))})}else c=a.keep;else c=this.createOutputData(f,r,i,void 0,null==n?void 0:n.keepAmounts,void 0,this._keepFactory);if(null==a?void 0:a.send)if(n_(a.send)){let e=a.send;rN(t,r.keys).forEach(t=>{h.push(e(t,r))})}else h=a.send;else h=this.createOutputData(t,r,i?i+c.length:void 0,o,null==n?void 0:n.sendAmounts,l);s&&(e=rI(e,s)),e=(e=r3(e)).map(t=>{let e=t.witness&&"string"!=typeof t.witness?JSON.stringify(t.witness):t.witness;return{...t,witness:e}});let d=[...c,...h],p=d.map((t,e)=>e).sort((t,e)=>d[t].blindedMessage.amount-d[e].blindedMessage.amount),y=[...Array.from({length:c.length},()=>!0),...Array.from({length:h.length},()=>!1)],g=p.map(t=>d[t]),m=p.map(t=>y[t]);return{payload:{inputs:e,outputs:g.map(t=>t.blindedMessage)},outputData:g,keepVector:m,sortedIndices:p}}async checkProofsStates(t){let e=new TextEncoder,r=t.map(t=>ej(e.encode(t.secret)).toHex(!0)),n=[];for(let t=0;t<r.length;t+=100){let e=r.slice(t,t+100),{states:i}=await this.mint.check({Ys:e}),o={};i.forEach(t=>{o[t.Y]=t});for(let t=0;t<e.length;t++){let r=o[e[t]];if(!r)throw Error("Could not find state for proof with Y: "+e[t]);n.push(r)}}return n}async onMintQuoteUpdates(t,e,r){if(await this.mint.connectWebSocket(),!this.mint.webSocketConnection)throw Error("failed to establish WebSocket connection.");let n=this.mint.webSocketConnection.createSubscription({kind:"bolt11_mint_quote",filters:t},e,r);return()=>{var t;null==(t=this.mint.webSocketConnection)||t.cancelSubscription(n,e)}}async onMeltQuotePaid(t,e,r){return this.onMeltQuoteUpdates([t],t=>{t.state===nf.PAID&&e(t)},r)}async onMintQuotePaid(t,e,r){return this.onMintQuoteUpdates([t],t=>{t.state===nc.PAID&&e(t)},r)}async onMeltQuoteUpdates(t,e,r){if(await this.mint.connectWebSocket(),!this.mint.webSocketConnection)throw Error("failed to establish WebSocket connection.");let n=this.mint.webSocketConnection.createSubscription({kind:"bolt11_melt_quote",filters:t},e,r);return()=>{var t;null==(t=this.mint.webSocketConnection)||t.cancelSubscription(n,e)}}async onProofStateUpdates(t,e,r){if(await this.mint.connectWebSocket(),!this.mint.webSocketConnection)throw Error("failed to establish WebSocket connection.");let n=new TextEncoder,i={};for(let e=0;e<t.length;e++)i[ej(n.encode(t[e].secret)).toHex(!0)]=t[e];let o=Object.keys(i),s=this.mint.webSocketConnection.createSubscription({kind:"proof_state",filters:o},t=>{e({...t,proof:i[t.Y]})},r);return()=>{var t;null==(t=this.mint.webSocketConnection)||t.cancelSubscription(s,e)}}createOutputData(t,e,r,n,i,o,s){let a;if(n)a=nS.createP2PKData({pubkey:n,additionalTags:null==o?void 0:o.additionalTags},t,e,i);else if(r||0===r){if(!this._seed)throw Error("cannot create deterministic messages without seed");a=nS.createDeterministicData(t,this._seed,r,e,i)}else a=o?nS.createP2PKData(o,t,e,i):s?rN(t,e.keys).map(t=>s(t,e)):nS.createRandomData(t,e,i);return a}createBlankOutputs(t,e,r,n){let i=Math.ceil(Math.log2(t))||1;i<0&&(i=0);let o=i?Array(i).fill(0):[];return this.createOutputData(0,e,r,void 0,o,void 0,n)}async _mintProofs(t,e,r,n){let{outputAmounts:i}=n||{},{counter:o,pubkey:s,p2pk:a,keysetId:l,proofsWeHave:u,outputData:f,privateKey:c}=n||{},h=await this.getKeys(l);!i&&u&&(i={keepAmounts:rK(u,e,h.keys,this._denominationTarget),sendAmounts:[]});let d=[];if(f)if(n_(f)){let t=rN(e,h.keys,null==i?void 0:i.keepAmounts);for(let e=0;e<t.length;e++)d.push(f(t[e],h))}else d=f;else if(this._keepFactory){let t=rN(e,h.keys,null==i?void 0:i.keepAmounts);for(let e=0;e<t.length;e++)d.push(this._keepFactory(t[e],h))}else d=this.createOutputData(e,h,o,s,null==i?void 0:i.keepAmounts,a);let y=d.map(t=>t.blindedMessage),g={outputs:y,quote:"string"==typeof r?r:r.quote};if("string"!=typeof r&&r.pubkey){if(!c)throw Error("Can not sign locked quote without private key");g.signature=function(t,e,r){let n=function(t,e){let r=t;for(let t of e)r+=t.B_;return X(new TextEncoder().encode(r))}(e,r),i=m(t);return p(ek.sign(n,i))}(c,r.quote,y)}if("bolt12"===t){let{signatures:t}=await this.mint.mintBolt12(g);return d.map((e,r)=>e.toProof(t[r],h))}let{signatures:b}=await this.mint.mint(g);return d.map((t,e)=>t.toProof(b[e],h))}async _meltProofs(t,e,r,n){var i,o,s,a;let{keysetId:l,counter:u,privkey:f}=n||{},c=await this.getKeys(l),h=this.createBlankOutputs(r1(r)-e.amount,c,u,this._keepFactory);null!=f&&(r=rI(r,f)),r=(r=r3(r)).map(t=>{let e=t.witness&&"string"!=typeof t.witness?JSON.stringify(t.witness):t.witness;return{...t,witness:e}});let d={quote:e.quote,inputs:r,outputs:h.map(t=>t.blindedMessage)};if("bolt12"===t){let t=await this.mint.meltBolt12(d);return{quote:{...t,unit:e.unit,request:e.request},change:null!=(s=null==(o=t.change)?void 0:o.map((t,e)=>h[e].toProof(t,c)))?s:[]}}let p=await this.mint.melt(d);return{quote:{...p,unit:e.unit,request:e.request},change:null!=(a=null==(i=p.change)?void 0:i.map((t,e)=>h[e].toProof(t,c)))?a:[]}}constructor(t,e){var r;this._keys=new Map,this._keysets=[],this._seed=void 0,this._unit="sat",this._mintInfo=void 0,this._denominationTarget=3,this.mint=t,this._logger=null!=(r=null==e?void 0:e.logger)?r:ni,this._logger.warn("cashu-ts v3 has been released. Please upgrade to access the latest features. v2 is now in minimal maintenance mode.");let n=[];if((null==e?void 0:e.keys)&&!Array.isArray(e.keys)?n=[e.keys]:(null==e?void 0:e.keys)&&Array.isArray(null==e?void 0:e.keys)&&(n=null==e?void 0:e.keys),n&&n.forEach(t=>this._keys.set(t.id,t)),(null==e?void 0:e.unit)&&(this._unit=null==e?void 0:e.unit),(null==e?void 0:e.keysets)&&(this._keysets=e.keysets),(null==e?void 0:e.mintInfo)&&(this._mintInfo=new nB(e.mintInfo)),(null==e?void 0:e.denominationTarget)&&(this._denominationTarget=e.denominationTarget),null==e?void 0:e.bip39seed){if(e.bip39seed instanceof Uint8Array){this._seed=e.bip39seed;return}throw Error("bip39seed must be a valid UInt8Array")}(null==e?void 0:e.keepFactory)&&(this._keepFactory=e.keepFactory)}}class nR{get mintUrl(){return this._mintUrl}static async mint(t,e,r,n){let i=n||nv,o=await i({endpoint:rX(t,"/v1/auth/blind/mint"),method:"POST",requestBody:e,headers:{"Clear-auth":"".concat(r)}});if(!r$(o)||!Array.isArray(null==o?void 0:o.signatures))throw Error("bad response");return o}async mint(t,e){return nR.mint(this._mintUrl,t,e,this._customRequest)}static async getKeys(t,e,r){let n=await (r||nv)({endpoint:e?rX(t,"/v1/auth/blind/keys",e):rX(t,"/v1/auth/blind/keys")});if(!r$(n)||!Array.isArray(n.keysets))throw Error("bad response");return n}async getKeys(t,e){return await nR.getKeys(e||this._mintUrl,t,this._customRequest)}static async getKeySets(t,e){return(e||nv)({endpoint:rX(t,"/v1/auth/blind/keysets")})}async getKeySets(){return nR.getKeySets(this._mintUrl,this._customRequest)}constructor(t,e){this._mintUrl=t,this._customRequest=e,this._mintUrl=r0(t),this._customRequest=e}}class nP{get keys(){return this._keys}get keysetId(){if(!this._keysetId)throw Error("No keysetId set");return this._keysetId}set keysetId(t){this._keysetId=t}get keysets(){return this._keysets}async loadMint(){await this.getKeySets(),await this.getKeys()}getActiveKeyset(t){let e=t.filter(t=>t.active),r=(e=e.filter(t=>t.id.startsWith("00"))).sort((t,e)=>{var r,n;return(null!=(r=t.input_fee_ppk)?r:0)-(null!=(n=e.input_fee_ppk)?n:0)})[0];if(!r)throw Error("No active keyset found");return r}async getKeySets(){let t=(await this.mint.getKeySets()).keysets.filter(t=>t.unit===this._unit);return this._keysets=t,this._keysets}async getAllKeys(){let t=await this.mint.getKeys();return this._keys=new Map(t.keysets.map(t=>[t.id,t])),this.keysetId=this.getActiveKeyset(this._keysets).id,t.keysets}async getKeys(t,e){if((!(this._keysets.length>0)||e)&&await this.getKeySets(),t||(t=this.getActiveKeyset(this._keysets).id),!this._keysets.find(e=>e.id===t)&&(await this.getKeySets(),!this._keysets.find(e=>e.id===t)))throw Error("could not initialize keys. No keyset with id '".concat(t,"' found"));if(!this._keys.get(t)){let e=await this.mint.getKeys(t);this._keys.set(t,e.keysets[0])}return this.keysetId=t,this._keys.get(t)}async mintProofs(t,e,r){let n=await this.getKeys(null==r?void 0:r.keysetId),i=nS.createRandomData(t,n),o={outputs:i.map(t=>t.blindedMessage)},{signatures:s}=await this.mint.mint(o,e),a=i.map((t,e)=>t.toProof(s[e],n));if(a.some(t=>!r4(t,n)))throw Error("Mint returned auth proofs with invalid DLEQ");return a}constructor(t,e){this._keys=new Map,this._keysets=[],this._unit="auth",this.mint=t;let r=[];(null==e?void 0:e.keys)&&!Array.isArray(e.keys)?r=[e.keys]:(null==e?void 0:e.keys)&&Array.isArray(null==e?void 0:e.keys)&&(r=null==e?void 0:e.keys),r&&r.forEach(t=>this._keys.set(t.id,t)),(null==e?void 0:e.keysets)&&(this._keysets=e.keysets)}}function nO(t){return"authA"+rx({id:t.id,secret:t.secret,C:t.C})}async function nq(t,e,r){let n=new nR(e);return(await new nP(n).mintProofs(t,r)).map(t=>nO(t))}}]);