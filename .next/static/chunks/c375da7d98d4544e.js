(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,233151,e=>{"use strict";e.s(["default",()=>F],233151);var t=e.i(843476),a=e.i(271645),s=e.i(914685),n=e.i(163858),i=e.i(388589),o=e.i(387921),r=e.i(370221),l=e.i(263150),c=e.i(885817),d=e.i(922881),m=e.i(779529);function g(e){let{transactions:a,currentMixingSession:s}=e;return(0,t.jsxs)("div",{className:"bg-gray-900 border border-gray-700 rounded-xl p-6",children:[(0,t.jsxs)("h2",{className:"text-xl font-bold text-white mb-6 flex items-center space-x-3",children:[(0,t.jsx)(c.EyeSlashIcon,{className:"w-6 h-6 text-blue-400"}),(0,t.jsx)("span",{children:"Privacy Operations"})]}),s&&(0,t.jsxs)("div",{className:"mb-8 p-6 bg-gray-900/60 border border-gray-700 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("h3",{className:"font-semibold text-white flex items-center space-x-2",children:[(0,t.jsx)(m.ArrowPathIcon,{className:"w-5 h-5 text-orange-400 animate-spin"}),(0,t.jsx)("span",{children:"Active Mixing Session"})]}),(0,t.jsxs)("div",{className:"text-sm text-gray-400",children:["Phase: ",(0,t.jsx)("span",{className:"text-orange-400 capitalize",children:s.phase})]})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm text-gray-400 mb-2",children:[(0,t.jsx)("span",{children:"Progress"}),(0,t.jsxs)("span",{children:[s.progress,"%"]})]}),(0,t.jsx)("div",{className:"w-full bg-gray-700 rounded-full h-2",children:(0,t.jsx)("div",{className:"bg-orange-500 h-2 rounded-full transition-all duration-1000",style:{width:"".concat(s.progress,"%")}})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-400",children:"Anonymity Set:"}),(0,t.jsx)("span",{className:"text-white ml-2 font-medium",children:s.anonymitySetSize})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-400",children:"Est. Time:"}),(0,t.jsxs)("span",{className:"text-white ml-2 font-medium",children:[s.estimatedTime,"min"]})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold text-white mb-4",children:"Recent Transactions"}),0===a.length?(0,t.jsxs)("div",{className:"text-center py-8 text-gray-400",children:[(0,t.jsx)(d.BanknotesIcon,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),(0,t.jsx)("p",{children:"No transactions yet"}),(0,t.jsx)("p",{className:"text-sm mt-1",children:"Start your first privacy mix to see transactions here"})]}):(0,t.jsx)("div",{className:"space-y-3",children:a.map(e=>{var a;return(0,t.jsx)("div",{className:"p-4 bg-gray-800 border border-gray-700 rounded-lg hover:border-gray-600 transition-colors",children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex items-start space-x-3",children:[(e=>{switch(e){case"completed":return(0,t.jsx)(n.CheckCircleIcon,{className:"w-5 h-5 text-green-400"});case"failed":return(0,t.jsx)(l.ExclamationTriangleIcon,{className:"w-5 h-5 text-red-400"});case"processing":return(0,t.jsx)(m.ArrowPathIcon,{className:"w-5 h-5 text-orange-400 animate-spin"});default:return(0,t.jsx)(r.ClockIcon,{className:"w-5 h-5 text-gray-400"})}})(e.status),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("span",{className:"font-medium text-white capitalize",children:e.type}),(0,t.jsx)("span",{className:"text-sm text-gray-400",children:"â€¢"}),(0,t.jsxs)("span",{className:"text-sm text-white font-mono",children:[e.amount," STRK"]})]}),(0,t.jsxs)("div",{className:"text-sm text-gray-400 mt-1",children:[e.fromNetwork," â†’ ",e.toNetwork]}),(0,t.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:new Date(e.timestamp).toLocaleString()})]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("div",{className:"text-sm font-medium ".concat((e=>{switch(e){case"completed":return"text-green-400";case"failed":return"text-red-400";case"processing":return"text-orange-400";default:return"text-gray-400"}})(e.status)," capitalize"),children:e.status}),(0,t.jsxs)("div",{className:"text-xs text-gray-400 mt-1",children:["Privacy Score: ",(0,t.jsxs)("span",{className:(a=e.privacyScore)>=80?"text-green-400":a>=60?"text-yellow-400":"text-red-400",children:[e.privacyScore,"%"]})]}),e.anonymitySetSize&&(0,t.jsxs)("div",{className:"text-xs text-gray-400 mt-1",children:["Anonymity Set: ",e.anonymitySetSize]})]})]})},e.id)})})]}),a.length>0&&(0,t.jsxs)("div",{className:"mt-6 p-4 bg-gray-800/50 border border-gray-700 rounded-lg",children:[(0,t.jsx)("h4",{className:"font-medium text-white mb-3",children:"Privacy Metrics"}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-green-400",children:a.filter(e=>"completed"===e.status).length}),(0,t.jsx)("div",{className:"text-gray-400",children:"Completed"})]}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsxs)("div",{className:"text-2xl font-bold text-blue-400",children:[Math.round(a.reduce((e,t)=>e+t.privacyScore,0)/a.length),"%"]}),(0,t.jsx)("div",{className:"text-gray-400",children:"Avg Privacy"})]}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-orange-400",children:a.reduce((e,t)=>e+parseFloat(t.amount),0).toFixed(2)}),(0,t.jsx)("div",{className:"text-gray-400",children:"Total STRK"})]})]})]})]})}var p=e.i(991548);let u={setup:s.WalletIcon,deposit:d.BanknotesIcon,mixing:m.ArrowPathIcon,complete:n.CheckCircleIcon};function x(e){let{current:a}=e,s=[{id:"setup",name:"Setup"},{id:"deposit",name:"Deposit"},{id:"mixing",name:"Mixing"},{id:"complete",name:"Complete"}],n=s.findIndex(e=>e.id===a);return(0,t.jsx)("div",{className:"mb-8",children:(0,t.jsx)("div",{className:"flex items-center justify-between",children:s.map((e,a)=>{let i=u[e.id],o=a<=n;return(0,t.jsxs)("div",{className:"flex flex-col items-center relative",children:[(0,t.jsx)("div",{className:"w-11 h-11 rounded-full border-2 flex items-center justify-center mb-2 ".concat(o?"border-orange-500 bg-orange-500/10":"border-gray-600 bg-gray-800"),children:(0,t.jsx)(i,{className:"w-6 h-6 ".concat(o?"text-orange-400":"text-gray-400")})}),(0,t.jsx)("span",{className:"text-sm ".concat(a===n?"text-orange-400":o?"text-white":"text-gray-400"),children:e.name}),a<s.length-1&&(0,t.jsx)("div",{className:"absolute w-full h-0.5 top-6 left-11 ".concat(a<n?"bg-orange-500":"bg-gray-600"),style:{width:"calc(100% + 44px)"}})]},e.id)})})})}let h={standard:{name:"Standard",description:"10+ participants",minParticipants:10,estimatedTime:5,feeBps:10},enhanced:{name:"Enhanced",description:"50+ participants",minParticipants:50,estimatedTime:15,feeBps:20},maximum:{name:"Maximum",description:"100+ participants",minParticipants:100,estimatedTime:30,feeBps:30}};function y(e){var s;let{value:n,onChange:i,onStart:o,isConnected:r}=e,l=(0,a.useMemo)(()=>h[n.privacyLevel].feeBps/100,[n.privacyLevel]),d=n.amountStrk>0&&n.destinations.length>0&&(null==(s=n.destinations[0])?void 0:s.length)>0;return(0,t.jsxs)("div",{className:"bg-gray-900 border border-gray-700 rounded-xl p-6",children:[(0,t.jsxs)("h2",{className:"text-xl font-bold mb-6 flex items-center space-x-3",children:[(0,t.jsx)(c.EyeSlashIcon,{className:"w-6 h-6 text-blue-400"}),(0,t.jsx)("span",{children:"Configure Privacy Mix"})]}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("label",{className:"block text-sm text-gray-300 mb-2",children:"Amount (STRK)"}),(0,t.jsx)("input",{inputMode:"decimal",value:n.amountStrk||"",onChange:e=>i({amountStrk:Number(e.target.value||0)}),placeholder:"0.00",className:"w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-400 focus:border-orange-500 focus:outline-none"}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Min: 1 STRK â€¢ Max: 10,000 STRK"})]}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("label",{className:"block text-sm text-gray-300 mb-2",children:"Destination Address"}),(0,t.jsx)("input",{value:n.destinations[0]||"",onChange:e=>i({destinations:e.target.value.trim()?[e.target.value.trim()]:[]}),placeholder:"0x1234567890abcdef...",className:"w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-400 focus:border-orange-500 focus:outline-none"}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"The STRK address where mixed funds will be sent."})]}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("label",{className:"block text-sm text-gray-300 mb-3",children:"Privacy Level"}),(0,t.jsx)("div",{className:"grid sm:grid-cols-3 gap-3",children:Object.keys(h).map(e=>{let a=h[e],s=n.privacyLevel===e;return(0,t.jsxs)("button",{type:"button",onClick:()=>i({privacyLevel:e}),className:"p-4 border rounded-lg text-left ".concat(s?"border-orange-500 bg-orange-500/10":"border-gray-600 hover:border-gray-500"),children:[(0,t.jsx)("div",{className:"font-semibold",children:a.name}),(0,t.jsx)("div",{className:"text-sm text-gray-400",children:a.description}),(0,t.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:["Fee: ",(a.feeBps/100).toFixed(2),"% â€¢ Est: ",a.estimatedTime,"m"]})]},e)})})]}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("label",{className:"block text-sm text-gray-300 mb-3",children:"Advanced Privacy Options"}),(0,t.jsxs)("div",{className:"grid sm:grid-cols-2 gap-4",children:[(0,t.jsxs)("label",{className:"flex items-center gap-3 text-gray-300",children:[(0,t.jsx)("input",{type:"checkbox",checked:n.enableTimeDelays,onChange:e=>i({enableTimeDelays:e.target.checked})}),"Time delays & randomization"]}),(0,t.jsxs)("label",{className:"flex items-center gap-3 text-gray-300",children:[(0,t.jsx)("input",{type:"checkbox",checked:n.enableRandomizedMints,onChange:e=>i({enableRandomizedMints:e.target.checked})}),"Randomized Cashu mint hops"]}),(0,t.jsxs)("label",{className:"flex items-center gap-3 text-gray-300",children:[(0,t.jsx)("input",{type:"checkbox",checked:n.enableAmountObfuscation,onChange:e=>i({enableAmountObfuscation:e.target.checked})}),"Amount obfuscation"]}),(0,t.jsxs)("label",{className:"flex items-center gap-3 text-gray-300",children:[(0,t.jsx)("input",{type:"checkbox",checked:n.enableDecoyTx,onChange:e=>i({enableDecoyTx:e.target.checked})}),"Decoy transactions"]})]}),(0,t.jsxs)("div",{className:"mt-4 grid sm:grid-cols-2 gap-4",children:[(0,t.jsxs)("label",{className:"block text-sm text-gray-300",children:["Split outputs",(0,t.jsx)("input",{type:"number",min:1,max:10,value:n.splitCount,onChange:e=>i({splitCount:Number(e.target.value)}),className:"mt-1 w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-orange-500 focus:outline-none"})]}),(0,t.jsxs)("div",{className:"text-sm text-gray-400 self-end",children:["Fee estimate: ",l.toFixed(2),"%"]})]})]}),(0,t.jsx)("button",{onClick:o,disabled:!d,className:"w-full bg-orange-600 hover:bg-orange-700 disabled:bg-gray-700 disabled:cursor-not-allowed text-white font-semibold py-3 rounded-lg",children:r?"Start Privacy Mix":"Connect Wallet to Continue"})]})}function S(e){let{amount:a}=e;return(0,t.jsxs)("div",{className:"bg-gray-900 border border-gray-700 rounded-xl p-8 text-center",children:[(0,t.jsx)(d.BanknotesIcon,{className:"w-14 h-14 text-orange-400 mx-auto mb-4"}),(0,t.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"Processing Deposit"}),(0,t.jsxs)("p",{className:"text-gray-400 mb-6",children:["Preparing your ",a," STRK for mixing..."]}),(0,t.jsx)("div",{className:"animate-spin w-8 h-8 border-2 border-orange-500 border-t-transparent rounded-full mx-auto"})]})}function v(e){let{progress:a,anonymitySet:s,eta:n}=e;return(0,t.jsxs)("div",{className:"bg-gray-900 border border-gray-700 rounded-xl p-8",children:[(0,t.jsxs)("div",{className:"text-center mb-8",children:[(0,t.jsx)(m.ArrowPathIcon,{className:"w-14 h-14 text-orange-400 mx-auto mb-4 animate-spin"}),(0,t.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"Mixing in Progress"}),(0,t.jsxs)("p",{className:"text-gray-400",children:["Your transaction is being mixed with ",s," participants"]})]}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm text-gray-400 mb-2",children:[(0,t.jsx)("span",{children:"Progress"}),(0,t.jsxs)("span",{children:[Math.round(a),"%"]})]}),(0,t.jsx)("div",{className:"w-full bg-gray-700 rounded-full h-3",children:(0,t.jsx)("div",{className:"bg-orange-500 h-3 rounded-full transition-all duration-700",style:{width:"".concat(a,"%")}})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-center",children:[(0,t.jsxs)("div",{className:"p-4 bg-gray-800 rounded-lg",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-blue-400",children:s}),(0,t.jsx)("div",{className:"text-sm text-gray-400",children:"Anonymity Set"})]}),(0,t.jsxs)("div",{className:"p-4 bg-gray-800 rounded-lg",children:[(0,t.jsxs)("div",{className:"text-2xl font-bold text-orange-400",children:[n,"m"]}),(0,t.jsx)("div",{className:"text-sm text-gray-400",children:"Est. Time"})]})]})]})}function b(e){let{amount:a,anonymitySet:s,onReset:i}=e;return(0,t.jsxs)("div",{className:"bg-gray-900 border border-gray-700 rounded-xl p-8 text-center",children:[(0,t.jsx)(n.CheckCircleIcon,{className:"w-14 h-14 text-green-400 mx-auto mb-4"}),(0,t.jsx)("h2",{className:"text-2xl font-bold mb-2 text-green-400",children:"Mix Complete"}),(0,t.jsxs)("p",{className:"text-gray-400 mb-6",children:["Your ",a," STRK has been mixed with ",s," participants"]}),(0,t.jsx)("button",{onClick:i,className:"bg-orange-600 hover:bg-orange-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors",children:"Start New Mix"})]})}var f=e.i(137486),w=e.i(982008),P=e.i(470556),N=e.i(287810),j=e.i(668409),L=e.i(947128),M=e.i(68043);async function k(e,t,a,s,n){console.log("ðŸ”’ SLPM Privacy: Starting privacy step"),console.log("ðŸ”’ SLPM Privacy: Configuration:",{enableRandomizedMints:e.enableRandomizedMints,enableSplitOutputs:e.enableSplitOutputs,splitCount:e.splitCount,enableTimeDelays:e.enableTimeDelays,enableAmountObfuscation:e.enableAmountObfuscation,enableDecoyTx:e.enableDecoyTx,amountStrk:e.amountStrk}),console.log("ðŸ”’ SLPM Privacy: Input proofs:",{count:t.length,proofs:t.map(e=>{var t;return{amount:e.amount,C:(null==(t=e.C)?void 0:t.slice(0,10))+"..."}})});let i=t.reduce((e,t)=>e+BigInt(t.amount),0n);console.log("ðŸ”’ SLPM Privacy: Total proof value:",i.toString(),"sats");try{let o=t;if(e.enableRandomizedMints&&s&&!M.ENV.CASHU_SINGLE_MINT){console.log("ðŸŒ SLPM Privacy: Distributing across multiple mints..."),console.log("ðŸŒ SLPM Privacy: Distribution amount:",i.toString(),"sats");let{distributions:e}=await s.distributeSend(i,t,2);o=e.flatMap(e=>e.proofs),console.log("ðŸŒ SLPM Privacy: Distribution result:",{originalProofs:t.length,newProofs:o.length,distributions:e.length}),n({type:"cashu:routed",message:"Distributed across multiple mints",progress:60}),console.log("âœ… SLPM Privacy: Multi-mint distribution completed")}else console.log("â­ï¸ SLPM Privacy: Skipping multi-mint distribution (disabled or no manager)");if(e.enableSplitOutputs&&e.splitCount>1&&!M.ENV.DISABLE_CASHU_SPLIT){console.log("ðŸ”€ SLPM Privacy: Splitting outputs...");let t=Number(i),s=BigInt(Math.floor(t/Math.max(1,e.splitCount)));console.log("ðŸ”€ SLPM Privacy: Split parameters:",{totalSats:t,splitCount:e.splitCount,perPart:s.toString()});let r=[],l=o.slice();for(let t=0;t<e.splitCount;t++){console.log("ðŸ”€ SLPM Privacy: Creating split ".concat(t+1,"/").concat(e.splitCount,"..."));let{keep:n,send:i}=await a.send(s,l);r.push(...i),l=n,console.log("ðŸ”€ SLPM Privacy: Split ".concat(t+1," created:"),{sentProofs:i.length,keepProofs:n.length})}o=r.length?r:o,console.log("ðŸ”€ SLPM Privacy: Split result:",{finalProofs:o.length,splitSuccessful:r.length>0}),n({type:"cashu:routed",message:"Split into ".concat(e.splitCount," outputs"),progress:70}),console.log("âœ… SLPM Privacy: Output splitting completed")}else console.log("â­ï¸ SLPM Privacy: Skipping output splitting (disabled or invalid split count)");if(e.enableTimeDelays){console.log("â±ï¸ SLPM Privacy: Applying time delays...");let e=function(e){let t=Math.floor(300);return e+Math.floor(Math.random()*t)}(1e3);console.log("â±ï¸ SLPM Privacy: Delay duration:",e,"ms"),await C(e),console.log("âœ… SLPM Privacy: Time delay applied")}else console.log("â­ï¸ SLPM Privacy: Skipping time delays (disabled)");return e.enableAmountObfuscation?(console.log("ðŸ’° SLPM Privacy: Applying amount obfuscation..."),await C(200),console.log("âœ… SLPM Privacy: Amount obfuscation applied")):console.log("â­ï¸ SLPM Privacy: Skipping amount obfuscation (disabled)"),e.enableDecoyTx?(console.log("ðŸ‘» SLPM Privacy: Applying decoy transactions..."),await C(200),console.log("âœ… SLPM Privacy: Decoy transactions applied")):console.log("â­ï¸ SLPM Privacy: Skipping decoy transactions (disabled)"),n({type:"mix:progress",message:"Privacy heuristics applied",progress:80}),console.log("ðŸ”’ SLPM Privacy: Final result:",{inputProofs:t.length,outputProofs:o.length,privacyFeaturesApplied:[e.enableRandomizedMints&&"multi-mint",e.enableSplitOutputs&&"split-outputs",e.enableTimeDelays&&"time-delays",e.enableAmountObfuscation&&"amount-obfuscation",e.enableDecoyTx&&"decoy-tx"].filter(Boolean)}),console.log("ðŸ”’ SLPM Privacy: Step completed successfully"),o}catch(a){throw console.error("âŒ SLPM Privacy: Step failed:",a),console.error("ðŸ” SLPM Privacy: Error details:",{message:a instanceof Error?a.message:"Unknown error",stack:a instanceof Error?a.stack:void 0,context:{proofsCount:t.length,hasManager:!!s,configuration:{enableRandomizedMints:e.enableRandomizedMints,enableSplitOutputs:e.enableSplitOutputs,splitCount:e.splitCount}}}),a}}function C(e){return new Promise(t=>setTimeout(t,e))}var T=e.i(516687),A=e.i(834055),I=e.i(615245);async function E(e,t,a,s,n){console.log("ðŸ”„ SLPM SwapBack: Starting SIMPLIFIED Cashu redemption (no mixing/splitting/delays)");let i=e.reduce((e,t)=>e+Number(t.amount),0),o=t[0],r=(0,I.getSharedSwapAddress)();console.log("ðŸ”„ SLPM SwapBack: SIMPLIFIED Parameters:",{proofsCount:e.length,totalSats:i,singleDestination:(null==o?void 0:o.slice(0,10))+"...",network:M.ENV.NETWORK,mintUrl:M.ENV.CASHU_DEFAULT_MINT});try{var l,c;s({type:"mix:progress",message:"Converting ALL ecash to Lightning and STRK (single transaction)...",progress:80});let t=new T.RealAtomiqSwapClient(M.ENV.NETWORK);s({type:"mix:progress",message:"Calculating optimal invoice amount and melting ALL ecash proofs...",progress:85});let{finalInvoice:a,finalSwapId:d,meltResult:m}=await R(e,i,r||o,t,s,n);console.log("âœ… SLPM SwapBack: ALL Cashu proofs melted:",{invoiceAmount:a.slice(0,30)+"...",changeProofs:(null==(l=m.change)?void 0:l.length)||0,totalRedeemed:m.usedAmount}),s({type:"mix:progress",message:"Waiting for Lightning payment to complete...",progress:90}),console.log("ðŸ”„ SLPM SwapBack: Waiting for Lightning payment...");let g=await t.waitLightningToStrkCompletion(d,3e5),p="FAILED";if(g){console.log("âš¡ SLPM SwapBack: Lightning payment confirmed, claiming STRK...");try{if(await t.claimLightningToStrkSwap(d),p="CLAIMED",console.log("âœ… SLPM SwapBack: STRK claimed to single destination"),console.log("âœ… SLPM SwapBack: STRK claimed to swap destination"),r&&r.toLowerCase()!==o.toLowerCase())try{let e=null!=(c=(await t.getStatus(d)).amountOut)?c:0n;console.log("ðŸšš SLPM SwapBack: Forwarding STRK from shared to final recipient...",{from:r,to:o,amountWei:e.toString()}),await (0,I.transferStrkFromShared)(o,e),console.log("âœ… SLPM SwapBack: Forward transfer submitted")}catch(e){console.error("âŒ SLPM SwapBack: Forward transfer failed:",e),p="PAYMENT_CONFIRMED_CLAIM_FAILED"}}catch(e){console.error("âŒ SLPM SwapBack: Claim failed:",e),e instanceof Error&&/Invalid signer provided/i.test(e.message)&&console.error("ðŸ› ï¸ SLPM SwapBack: Signer invalid. Ensure SHARED_SWAP_ACCOUNT_PRIVATE_KEY and SHARED_SWAP_ACCOUNT_ADDRESS are set and correspond to a deployed Starknet account with funds for fees."),p="PAYMENT_CONFIRMED_CLAIM_FAILED"}}else console.warn("âš ï¸ SLPM SwapBack: Lightning payment did not complete in time");let u=[{destination:o,satsRedeemed:Number(m.usedAmount||i),strkSent:Number(m.usedAmount||i),txId:d,status:p}];return console.log("ðŸ“Š SLPM SwapBack: SIMPLIFIED Final result:",{destination:o,totalSatsRedeemed:u[0].satsRedeemed,totalStrkSent:u[0].strkSent,status:p}),s({type:"mix:progress",message:"Simplified swap completed",progress:95}),u}catch(e){throw console.error("âŒ SLPM SwapBack: SIMPLIFIED Critical error:",e),e}}async function R(e,t,a,s,n,i){console.log("ðŸª™ SLPM SwapBack: Starting SIMPLIFIED Cashu redemption (using encoded token like standalone)");let o=e.reduce((e,t)=>e+Number(t.amount),0);console.log("ðŸ’° SLPM SwapBack: ALL Available proofs:",{count:e.length,totalAmount:o,mintUrl:M.ENV.CASHU_DEFAULT_MINT});try{var r,l;console.log("âš¡ SLPM SwapBack: Retrieving encoded token for standalone pattern...");let e=null;if(i&&(console.log("ðŸ” SLPM SwapBack: Looking for token with quote ID:",i),e=await (0,A.getEncodedTokenFromStorage)(i)),!e){console.warn("âš ï¸ No encoded token found for quote ID, trying localStorage scan...");{let t=Object.keys(localStorage).filter(e=>e.startsWith("slpm:cashu-token:"));if(t.length>0){let a=t[t.length-1];e=localStorage.getItem(a),console.log("âœ… Found encoded token in localStorage:",a)}}}if(!e)throw console.warn("âš ï¸ No encoded token found anywhere, this may cause issues"),Error("No encoded token available - cannot use standalone script pattern");console.log("âœ… Successfully retrieved encoded token for direct melt"),console.log("ðŸ§® SLPM SwapBack: Calculating maximum invoice amount from token balance...");let o=await (0,A.calculateMaxInvoiceAmount)(e);if(!o.success)throw Error("Failed to calculate max invoice amount: ".concat(o.error));console.log("ðŸ’° SLPM SwapBack: Token balance analysis:",{availableBalance:o.availableBalance,maxInvoiceAmount:o.maxAmount,originalInvoiceAmount:t}),console.log("ðŸ”„ SLPM SwapBack: Getting optimized Atomiq quote for max safe amount..."),console.log("   Using calculated safe amount: ".concat(o.maxAmount," sats (original was ").concat(t," sats)"));let c=await s.beginLightningToStrkSwap(o.maxAmount,a);console.log("âœ… SLPM SwapBack: Got optimized Atomiq quote:",{swapId:c.id.slice(0,20)+"...",safeAmount:o.maxAmount,invoicePrefix:c.invoice.slice(0,30)+"..."});let d=c.invoice,m=c.id;console.log("ðŸ“‹ SLPM SwapBack: Full Atomiq invoice (copy):",d);try{window._slpmLastAtomiqInvoice=d,console.log("â„¹ï¸ Access invoice via window._slpmLastAtomiqInvoice")}catch(e){}console.log("ðŸ” SLPM SwapBack: Running server-side melt with built-in retry..."),n({type:"mix:progress",message:"Melting ecash to Lightning (with retry capability)...",progress:88});let g=await (0,A.serverSideCashuMelt)(e,d,i);if(!g.success){if(null==(l=g.details)?void 0:l.shortfall)throw console.log("âš ï¸ SLPM SwapBack: Invoice too large for available proofs"),console.log("   Required: ".concat(g.details.required," sats, Available: ").concat(g.details.available," sats")),Error("Invoice too large for available balance. Required: ".concat(g.details.required,", Available: ").concat(g.details.available));throw Error("Server-side melt failed: ".concat(g.error))}console.log("âœ… SLPM SwapBack: Server-side melt completed successfully"),console.log("âœ… SLPM SwapBack: Server-side melt completed successfully!",{invoiceAmount:g.result.invoiceAmount,changeAmount:g.result.changeAmount,changeCount:(null==(r=g.result.change)?void 0:r.length)||0});let p=(g.result.change||[]).map(e=>({secret:e.secret,signature:e.C,amount:BigInt(e.amount),currency:"SAT",keysetId:e.id}));return{finalInvoice:d,finalSwapId:m,meltResult:{change:p,usedAmount:g.result.invoiceAmount}}}catch(e){throw console.error("âŒ SLPM SwapBack: SIMPLIFIED melt failed:",e),Error("Failed to melt ALL proofs: ".concat(e))}}async function D(e,t){console.log("ðŸŽ¯ SLPM: Starting privacy mix operation"),console.log("ðŸ“‹ SLPM: Mix request:",{amount:e.amountStrk,destinations:e.destinations.length,privacyLevel:e.privacyLevel,features:{timeDelays:e.enableTimeDelays,splitOutputs:e.enableSplitOutputs,randomizedMints:e.enableRandomizedMints,amountObfuscation:e.enableAmountObfuscation,decoyTx:e.enableDecoyTx}});let a=null,s=null;try{var n,i,o,r;let l,c,d;console.log("ðŸ” SLPM: Validating ".concat(M.ENV.NETWORK," configuration..."));let m=(0,M.getNetworkStatus)();if(console.log("âš™ï¸ SLPM: ".concat(M.ENV.NETWORK," status:"),m),!m.ready)throw console.error("âŒ SLPM: ".concat(M.ENV.NETWORK," configuration incomplete")),console.error("Warnings:",m.warnings),Error("".concat(M.ENV.NETWORK," configuration incomplete. Check environment variables."));console.log("âœ… SLPM: ".concat(M.ENV.NETWORK," configuration validated")),t({type:"mix:progress",message:"Starting privacy mix on ".concat(M.ENV.NETWORK),progress:0}),console.log("ðŸš€ SLPM: Privacy mix operation initiated"),console.log("ðŸ’° SLPM: Step 1 - Depositing STRK to privacy mixer contract"),a=await (0,f.stepDeposit)(e.amountStrk,t),console.log("âœ… SLPM: Step 1 complete - STRK deposited to privacy mixer:",{commitment:a.commitmentHash.slice(0,10)+"...",amount:a.amount,mixerContract:a.mixerContractAddress}),console.log("ðŸ”„ SLPM: Step 1.5 - Withdrawing from privacy mixer for mixing pipeline");let g=await (0,w.stepWithdrawForMixing)(a,t);if(!g||!g.withdrawalTxHash)throw Error("Withdrawal step returned no transaction hash");let p="string"==typeof g.withdrawalTxHash?g.withdrawalTxHash.slice(0,10)+"...":"n/a",u="string"==typeof g.controllingWallet?g.controllingWallet.slice(0,10)+"...":"n/a";console.log("âœ… SLPM: Step 1.5 complete - Funds withdrawn and ready for mixing:",{withdrawalTx:p,availableForSwap:null!=(n=g.availableForSwap)&&n,controllingWallet:u}),console.log("ðŸŽ¯ SLPM: Step 2 - Dynamic STRK â†’ sats estimation (real-time if possible)..."),t({type:"mix:progress",message:"Estimating sats from STRK input...",progress:15});let x=await (0,N.stepDynamicEstimateSats)(g.amount,t);console.log("ðŸ’° SLPM: Dynamic estimation result:",x),console.log("ðŸ’° SLPM: Estimated ".concat(g.amount," STRK -> ").concat(x.satsOut," sats (source: ").concat(x.source,", rate: ").concat(x.rate.toFixed(2),")")),t({type:"mix:progress",message:"Creating Cashu mint invoice...",progress:18});let h=await (0,P.stepCreateMintInvoice)(x.satsOut,t);console.log("ðŸŽ¯ SLPM: Step 3 - Swapping STRK to Lightning..."),t({type:"mix:progress",message:"Swapping STRK to Lightning BTC...",progress:25}),s=await (0,j.stepSwapToLightning)(g.amount,{walletAddress:g.originalDeposit.walletAddress,mixerContractAddress:g.originalDeposit.mixerContractAddress,fundsAvailable:g.availableForSwap},h,t),console.log("ðŸŽ¯ SLPM: Step 4 - Claiming Cashu proofs..."),t({type:"mix:progress",message:"Claiming Cashu proofs...",progress:45});let y=await (0,L.stepClaimCashuProofs)(h.mintQuote,h.cashu,x.satsOut,t);console.log("ðŸŽ¯ SLPM: Cashu proofs claimed:",{count:y.length,totalValue:y.reduce((e,t)=>e+Number(t.amount),0)});let S=h.cashu,v=h.cashuManager;console.log("ðŸŽ¯ SLPM: Step 5 - Applying privacy techniques..."),t({type:"mix:progress",message:"Applying privacy mixing...",progress:60});let b=await k(e,y,S,v,t);console.log("âœ… SLPM: Privacy mixing complete:",{finalProofsCount:b.length,privacyLevel:e.privacyLevel,anonymityEnhanced:!0}),console.log("ðŸ”„ SLPM: Step 6 - Converting mixed tokens back and distributing..."),t({type:"mix:progress",message:"Converting mixed e-cash back and distributing to destinations",progress:80});let C=await E(b,e.destinations,S,t,h.mintQuote.quote),T=C.filter(e=>"CLAIMED"===e.status).length,A=C.length,I=C.reduce((e,t)=>e+t.strkSent,0);if(console.log("ðŸ“Š SLPM: Distribution results:",{totalDestinations:A,successfulDistributions:T,totalStrkDistributed:I,failedDistributions:A-T}),0===T)throw Error("All ".concat(A," destination distributions failed - no STRK was successfully delivered"));T<A?console.warn("âš ï¸ SLPM: Partial success - only ".concat(T,"/").concat(A," destinations received STRK")):console.log("âœ… SLPM: All distributions completed successfully"),console.log("âœ… SLPM: Privacy mixing completed with distribution results"),console.log("ðŸ“Š SLPM: Calculating final privacy metrics");let R=(i=e,("maximum"===i.privacyLevel?120:"enhanced"===i.privacyLevel?60:20)+((i.enableSplitOutputs?i.splitCount:0)+10*!!i.enableRandomizedMints)),D=(o=e,r=R,d=50+Math.min(40,Math.floor(r/4)),o.enableTimeDelays&&(d+=3),o.enableSplitOutputs&&o.splitCount>1&&(d+=3),o.enableRandomizedMints&&(d+=2),o.enableAmountObfuscation&&(d+=1),o.enableDecoyTx&&(d+=1),Math.min(100,d));return console.log("ðŸ“ˆ SLPM: Final privacy metrics:",{anonymitySetSize:R,privacyScore:D,privacyLevel:e.privacyLevel,mixingPath:"STRK â†’ Lightning â†’ Cashu â†’ Lightning â†’ STRK",destinationAccounts:e.destinations.length,totalFees:s.fee||0,privacyGuarantees:{unlinkability:"Account linkability broken via mixer contract",temporalPrivacy:"Time delays and batching applied",amountObfuscation:"Amount split across destinations",routingDiversification:"Multiple Cashu mints used"}}),T===A?(l="Privacy mix complete! ".concat(I," STRK distributed to ").concat(T," destinations through ").concat(R,"-member anonymity set"),c="mix:complete"):T>0?(l="Privacy mix partially complete - ".concat(I," STRK delivered to ").concat(T,"/").concat(A," destinations"),c="mix:partial"):(l="Privacy mix failed - no STRK was successfully delivered to any destination",c="mix:failed"),t({type:c,message:l,progress:T===A?100:90}),console.log("ðŸŽ‰ SLPM: Privacy mix operation result - ".concat(T,"/").concat(A," destinations successful")),{success:T>0,totalDestinations:A,successfulDistributions:T,totalStrkDistributed:I,distributionResults:C}}catch(e){throw console.error("âŒ SLPM: Privacy mix operation failed:",e),console.error("ðŸ” SLPM: Error details:",{message:e instanceof Error?e.message:"Unknown error",stack:e instanceof Error?e.stack:void 0,step:"Privacy mixing flow",progress:"Check individual step logs above"}),t({type:"mix:error",message:e instanceof Error?e.message:"Privacy mix failed"}),e}}async function B(e,t){try{await D(e,t)}catch(e){throw t({type:"mix:error",message:(null==e?void 0:e.message)||"Unknown error"}),e}}var O=e.i(755635);function F(){let e=(0,O.useWallet)(),[r,l]=(0,a.useState)({step:"setup",amount:"",privacyLevel:"standard",progress:0,anonymitySetSize:0,estimatedTime:0}),[c,d]=(0,a.useState)(!1),[m,u]=(0,a.useState)(!1),[h,f]=(0,a.useState)(!1),[w,P]=(0,a.useState)({show:!1,type:"info",title:"",message:""}),[N,j]=(0,a.useState)([]),[L,M]=(0,a.useState)({amountStrk:0,destinations:[],privacyLevel:"standard",enableTimeDelays:!0,enableSplitOutputs:!0,splitCount:2,enableRandomizedMints:!0,enableAmountObfuscation:!0,enableDecoyTx:!0}),k=(e,t,a)=>{P({show:!0,type:e,title:t,message:a})},C=async t=>{f(!0);try{await e.connect("argentx"===t.toLowerCase()?"argentX":"braavos"===t.toLowerCase()?"braavos":"okx"===t.toLowerCase()?"okx":"argentX"),d(!0),u(!1),k("success","Wallet Connected","Connected to ".concat(t))}catch(e){k("error","Connection Failed","Failed to connect wallet. Please try again.")}finally{f(!1)}};(0,a.useEffect)(()=>{d(e.isConnected)},[e.isConnected]);let T=async()=>{if(!c)return void u(!0);let e=parseFloat(r.amount||"0");if(!e||e<=0||0===L.destinations.length||!L.destinations[0])return void k("warning","Invalid Input","Enter amount and destination address");l(e=>({...e,step:"deposit",progress:0})),k("info","Starting Mix","Initializing mixing pipeline...");try{let t=Date.now().toString(36);await B({...L,amountStrk:e,privacyLevel:r.privacyLevel},a=>{"number"==typeof a.progress&&l(e=>{var t;return{...e,step:"deposit"===e.step&&a.progress>30?"mixing":e.step,progress:null!=(t=a.progress)?t:e.progress}}),"number"==typeof a.anonymitySetSize&&l(e=>{var t;return{...e,anonymitySetSize:null!=(t=a.anonymitySetSize)?t:e.anonymitySetSize}}),"number"==typeof a.estimatedTime&&l(e=>{var t;return{...e,estimatedTime:null!=(t=a.estimatedTime)?t:e.estimatedTime}}),j(s=>{let n=[...s],i=Date.now();if("deposit:initiated"===a.type&&n.push({id:"".concat(t,"-dep"),type:"deposit",amount:String(e),status:"pending",timestamp:i,privacyScore:0,fromNetwork:"Starknet",toNetwork:"Lightning"}),"lightning:paid"===a.type){let e=n.findIndex(e=>e.id==="".concat(t,"-dep"));e>=0&&(n[e]={...n[e],status:"completed"})}if("cashu:minted"!==a.type||n.some(e=>e.id==="".concat(t,"-mix"))||n.push({id:"".concat(t,"-mix"),type:"mix",amount:String(e),status:"processing",timestamp:i,privacyScore:0,fromNetwork:"Lightning",toNetwork:"STRK"}),"mix:complete"===a.type){var o;let e=n.findIndex(e=>e.id==="".concat(t,"-mix"));e>=0&&(n[e]={...n[e],status:"completed",privacyScore:null!=(o=a.privacyScore)?o:n[e].privacyScore,anonymitySetSize:r.anonymitySetSize||n[e].anonymitySetSize})}if("mix:error"===a.type){let e=n.findIndex(e=>e.id==="".concat(t,"-mix"));e>=0&&(n[e]={...n[e],status:"failed"})}return n}),"mix:complete"===a.type&&(k("success","Mix Complete","Privacy score ".concat(a.privacyScore,"%")),l(e=>({...e,step:"complete",progress:100}))),"mix:error"===a.type&&k("error","Mix Error",a.message||"Unknown error")})}catch(e){}};return(0,t.jsxs)("div",{className:"min-h-screen bg-gray-950 text-white",children:[(0,t.jsx)(i.default,{}),(0,t.jsx)("div",{className:"absolute inset-0 bg-gray-950 -z-10",children:(0,t.jsx)("div",{className:"absolute inset-0 opacity-70 pointer-events-none",style:{backgroundImage:"url('/patterns/grid.svg')",backgroundSize:"32px 32px",backgroundRepeat:"repeat"}})}),(0,t.jsxs)("div",{className:"relative z-10 container mx-auto px-4 py-8",children:[(0,t.jsxs)("div",{className:"text-center mb-12",children:[(0,t.jsx)("h1",{className:"text-4xl font-bold mb-4 text-white",children:"Privacy Mixer"}),(0,t.jsx)("p",{className:"text-gray-400 text-lg",children:"Enhanced privacy through advanced cryptographic mixing"}),(0,t.jsx)("div",{className:"mt-6",children:c?(0,t.jsxs)("div",{className:"inline-flex items-center space-x-2 bg-green-500/10 border border-green-500/20 rounded-lg px-4 py-2",children:[(0,t.jsx)(n.CheckCircleIcon,{className:"w-5 h-5 text-green-400"}),(0,t.jsx)("span",{className:"text-green-400 font-medium",children:"Wallet Connected"})]}):(0,t.jsxs)("button",{onClick:()=>u(!0),className:"inline-flex items-center space-x-2 bg-orange-500/10 border border-orange-500/20 hover:border-orange-500 rounded-lg px-4 py-2 transition-colors",children:[(0,t.jsx)(s.WalletIcon,{className:"w-5 h-5 text-orange-400"}),(0,t.jsx)("span",{className:"text-orange-400 font-medium",children:"Connect Wallet"})]})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,t.jsxs)("div",{className:"lg:col-span-2",children:[(0,t.jsx)(x,{current:r.step}),(0,t.jsxs)("div",{children:["setup"===r.step&&(0,t.jsx)(y,{value:L,onChange:e=>{null!=e.amountStrk&&l(t=>({...t,amount:String(e.amountStrk)})),e.privacyLevel&&l(t=>({...t,privacyLevel:e.privacyLevel})),M(t=>({...t,...e}))},onStart:T,isConnected:c}),"deposit"===r.step&&(0,t.jsx)(S,{amount:r.amount}),"mixing"===r.step&&(0,t.jsx)(v,{progress:r.progress,anonymitySet:r.anonymitySetSize,eta:r.estimatedTime}),"complete"===r.step&&(0,t.jsx)(b,{amount:r.amount,anonymitySet:r.anonymitySetSize,onReset:()=>l({step:"setup",amount:"",privacyLevel:"standard",progress:0,anonymitySetSize:0,estimatedTime:0})})]})]}),(0,t.jsx)("div",{className:"lg:col-span-1",children:(0,t.jsx)(g,{transactions:N,currentMixingSession:"mixing"===r.step?{id:"current",phase:r.step,progress:r.progress,anonymitySetSize:r.anonymitySetSize,estimatedTime:r.estimatedTime}:void 0})})]})]}),(0,t.jsx)(o.default,{isOpen:m,onClose:()=>u(!1),onConnect:C,isConnecting:h}),(0,t.jsx)(p.default,{type:w.type,title:w.title,message:w.message,isVisible:w.show,onClose:()=>P(e=>({...e,show:!1}))})]})}}]);