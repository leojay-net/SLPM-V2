{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/CODE/SLPM-enhanced/src/components/Navigation.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState } from 'react';\nimport Link from 'next/link';\nimport {\n    HomeIcon,\n    EyeSlashIcon,\n    DocumentTextIcon,\n    Bars3Icon,\n    XMarkIcon,\n    ArrowsRightLeftIcon,\n    ScissorsIcon\n} from '@heroicons/react/24/outline';\n\nexport default function Navigation() {\n    const [isOpen, setIsOpen] = useState(false);\n\n    const navItems = [\n        { href: '/', label: 'Home', icon: HomeIcon },\n        { href: '/mixer', label: 'Full Mix', icon: EyeSlashIcon },\n        { href: '/mixer/split', label: 'Split Mix', icon: ScissorsIcon },\n        { href: '/cross-chain', label: 'Cross-Chain', icon: ArrowsRightLeftIcon },\n        { href: '/docs', label: 'Docs', icon: DocumentTextIcon }\n    ];\n\n    return (\n        <nav className=\"bg-gray-900 border-b border-gray-700\">\n            <div className=\"container mx-auto px-4\">\n                <div className=\"flex items-center justify-between h-16\">\n                    {/* Logo */}\n                    <Link href=\"/\" className=\"flex items-center space-x-3\">\n                        <div className=\"w-8 h-8 bg-orange-500 rounded-lg flex items-center justify-center\">\n                            <EyeSlashIcon className=\"w-5 h-5 text-white\" />\n                        </div>\n                        <span className=\"text-xl font-bold text-white\">SLPM</span>\n                    </Link>\n\n                    {/* Desktop Navigation */}\n                    <div className=\"hidden md:flex items-center space-x-8\">\n                        {navItems.map((item) => {\n                            const Icon = item.icon;\n                            return (\n                                <Link\n                                    key={item.href}\n                                    href={item.href}\n                                    className=\"flex items-center space-x-2 text-gray-300 hover:text-orange-400 transition-colors\"\n                                >\n                                    <Icon className=\"w-5 h-5\" />\n                                    <span>{item.label}</span>\n                                </Link>\n                            );\n                        })}\n                    </div>\n\n                    {/* Mobile Menu Button */}\n                    <button\n                        onClick={() => setIsOpen(!isOpen)}\n                        className=\"md:hidden text-gray-300 hover:text-white\"\n                    >\n                        {isOpen ? (\n                            <XMarkIcon className=\"w-6 h-6\" />\n                        ) : (\n                            <Bars3Icon className=\"w-6 h-6\" />\n                        )}\n                    </button>\n                </div>\n\n                {/* Mobile Navigation */}\n                {isOpen && (\n                    <div className=\"md:hidden border-t border-gray-700 py-4\">\n                        <div className=\"flex flex-col space-y-4\">\n                            {navItems.map((item) => {\n                                const Icon = item.icon;\n                                return (\n                                    <Link\n                                        key={item.href}\n                                        href={item.href}\n                                        onClick={() => setIsOpen(false)}\n                                        className=\"flex items-center space-x-3 text-gray-300 hover:text-orange-400 transition-colors\"\n                                    >\n                                        <Icon className=\"w-5 h-5\" />\n                                        <span>{item.label}</span>\n                                    </Link>\n                                );\n                            })}\n                        </div>\n                    </div>\n                )}\n            </div>\n        </nav>\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;AAJA;;;;AAce,SAAS;;IACpB,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAC;IAErC,MAAM,WAAW;QACb;YAAE,MAAM;YAAK,OAAO;YAAQ,MAAM,8NAAQ;QAAC;QAC3C;YAAE,MAAM;YAAU,OAAO;YAAY,MAAM,0OAAY;QAAC;QACxD;YAAE,MAAM;YAAgB,OAAO;YAAa,MAAM,0OAAY;QAAC;QAC/D;YAAE,MAAM;YAAgB,OAAO;YAAe,MAAM,+PAAmB;QAAC;QACxE;YAAE,MAAM;YAAS,OAAO;YAAQ,MAAM,sPAAgB;QAAC;KAC1D;IAED,qBACI,6LAAC;QAAI,WAAU;kBACX,cAAA,6LAAC;YAAI,WAAU;;8BACX,6LAAC;oBAAI,WAAU;;sCAEX,6LAAC,0KAAI;4BAAC,MAAK;4BAAI,WAAU;;8CACrB,6LAAC;oCAAI,WAAU;8CACX,cAAA,6LAAC,0OAAY;wCAAC,WAAU;;;;;;;;;;;8CAE5B,6LAAC;oCAAK,WAAU;8CAA+B;;;;;;;;;;;;sCAInD,6LAAC;4BAAI,WAAU;sCACV,SAAS,GAAG,CAAC,CAAC;gCACX,MAAM,OAAO,KAAK,IAAI;gCACtB,qBACI,6LAAC,0KAAI;oCAED,MAAM,KAAK,IAAI;oCACf,WAAU;;sDAEV,6LAAC;4CAAK,WAAU;;;;;;sDAChB,6LAAC;sDAAM,KAAK,KAAK;;;;;;;mCALZ,KAAK,IAAI;;;;;4BAQ1B;;;;;;sCAIJ,6LAAC;4BACG,SAAS,IAAM,UAAU,CAAC;4BAC1B,WAAU;sCAET,uBACG,6LAAC,iOAAS;gCAAC,WAAU;;;;;qDAErB,6LAAC,iOAAS;gCAAC,WAAU;;;;;;;;;;;;;;;;;gBAMhC,wBACG,6LAAC;oBAAI,WAAU;8BACX,cAAA,6LAAC;wBAAI,WAAU;kCACV,SAAS,GAAG,CAAC,CAAC;4BACX,MAAM,OAAO,KAAK,IAAI;4BACtB,qBACI,6LAAC,0KAAI;gCAED,MAAM,KAAK,IAAI;gCACf,SAAS,IAAM,UAAU;gCACzB,WAAU;;kDAEV,6LAAC;wCAAK,WAAU;;;;;;kDAChB,6LAAC;kDAAM,KAAK,KAAK;;;;;;;+BANZ,KAAK,IAAI;;;;;wBAS1B;;;;;;;;;;;;;;;;;;;;;;AAO5B;GA7EwB;KAAA","debugId":null}},
    {"offset": {"line": 220, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/CODE/SLPM-enhanced/src/components/WalletConnection.tsx"],"sourcesContent":["\"use client\";\nimport React, { useState } from 'react';\nimport { WalletIcon, CreditCardIcon, KeyIcon, ShieldCheckIcon, ShieldExclamationIcon, CircleStackIcon } from '@heroicons/react/24/outline';\n\ninterface WalletOption {\n    id: string;\n    name: string;\n    icon: string;\n    description: string;\n    isInstalled: boolean;\n    isPopular?: boolean;\n}\n\ninterface WalletConnectionProps {\n    isOpen: boolean;\n    onClose: () => void;\n    onConnect: (walletId: string) => void;\n    isConnecting: boolean;\n}\n\nexport default function WalletConnection({ isOpen, onClose, onConnect, isConnecting }: WalletConnectionProps) {\n    const [selectedWallet, setSelectedWallet] = useState<string>('');\n\n    const wallets: WalletOption[] = [\n        {\n            id: 'argentx',\n            name: 'ArgentX',\n            icon: 'argentx',\n            description: 'Most popular Starknet wallet with advanced features',\n            isInstalled: typeof window !== 'undefined' && !!(window as any).starknet_argentX,\n            isPopular: true\n        },\n        {\n            id: 'braavos',\n            name: 'Braavos',\n            icon: 'braavos',\n            description: 'Security-focused wallet with hardware support',\n            isInstalled: typeof window !== 'undefined' && !!(window as any).starknet_braavos\n        },\n        {\n            id: 'okx',\n            name: 'OKX Wallet',\n            icon: 'okx',\n            description: 'Multi-chain wallet with DeFi integration',\n            isInstalled: typeof window !== 'undefined' && !!(window as any).starknet_okxwallet\n        }\n    ];\n\n    const handleConnect = (walletId: string) => {\n        setSelectedWallet(walletId);\n        onConnect(walletId);\n    };\n\n    if (!isOpen) return null;\n\n    return (\n        <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-gray-900 border border-gray-700 rounded-xl max-w-md w-full p-6 shadow-2xl\">\n                <div className=\"flex items-center justify-between mb-6\">\n                    <div className=\"flex items-center space-x-3\">\n                        <WalletIcon className=\"w-6 h-6 text-blue-400\" />\n                        <h2 className=\"text-xl font-bold text-white\">Connect Wallet</h2>\n                    </div>\n                    <button\n                        onClick={onClose}\n                        className=\"text-gray-400 hover:text-white transition-colors\"\n                    >\n                        <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                        </svg>\n                    </button>\n                </div>\n\n                <div className=\"space-y-3\">\n                    {wallets.map((wallet) => (\n                        <div key={wallet.id} className=\"relative\">\n                            <button\n                                onClick={() => handleConnect(wallet.id)}\n                                disabled={isConnecting || !wallet.isInstalled}\n                                className={`w-full p-4 rounded-lg border transition-all duration-200 ${wallet.isInstalled\n                                        ? 'border-gray-600 hover:border-orange-500 hover:bg-gray-800 focus:border-orange-500 focus:ring-2 focus:ring-orange-500/20'\n                                        : 'border-gray-700 bg-gray-800/50 cursor-not-allowed opacity-50'\n                                    } ${selectedWallet === wallet.id && isConnecting\n                                        ? 'border-orange-500 bg-orange-500/10'\n                                        : ''\n                                    }`}\n                            >\n                                <div className=\"flex items-center space-x-4\">\n                                    <div className=\"w-12 h-12 bg-gray-800 rounded-lg flex items-center justify-center\">\n                                        {wallet.id === 'argentx' && <ShieldCheckIcon className=\"w-6 h-6 text-blue-400\" />}\n                                        {wallet.id === 'braavos' && <ShieldExclamationIcon className=\"w-6 h-6 text-orange-400\" />}\n                                        {wallet.id === 'okx' && <CircleStackIcon className=\"w-6 h-6 text-gray-300\" />}\n                                    </div>\n                                    <div className=\"flex-1 text-left\">\n                                        <div className=\"flex items-center space-x-2\">\n                                            <h3 className=\"font-semibold text-white\">{wallet.name}</h3>\n                                            {wallet.isPopular && (\n                                                <span className=\"px-2 py-1 bg-orange-500/20 text-orange-400 text-xs rounded font-medium\">\n                                                    Popular\n                                                </span>\n                                            )}\n                                        </div>\n                                        <p className=\"text-sm text-gray-400 mt-1\">{wallet.description}</p>\n                                        {!wallet.isInstalled && (\n                                            <p className=\"text-xs text-red-400 mt-1\">Not installed</p>\n                                        )}\n                                    </div>\n                                    <div className=\"flex items-center space-x-2\">\n                                        {wallet.isInstalled ? (\n                                            <ShieldCheckIcon className=\"w-5 h-5 text-green-400\" />\n                                        ) : (\n                                            <KeyIcon className=\"w-5 h-5 text-gray-600\" />\n                                        )}\n                                        {selectedWallet === wallet.id && isConnecting && (\n                                            <div className=\"w-4 h-4 border-2 border-orange-500 border-t-transparent rounded-full animate-spin\"></div>\n                                        )}\n                                    </div>\n                                </div>\n                            </button>\n                        </div>\n                    ))}\n                </div>\n\n                <div className=\"mt-6 p-4 bg-gray-800/50 rounded-lg border border-gray-700\">\n                    <div className=\"flex items-start space-x-3\">\n                        <CreditCardIcon className=\"w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5\" />\n                        <div>\n                            <h4 className=\"font-medium text-white\">Wallet Security</h4>\n                            <p className=\"text-sm text-gray-400 mt-1\">\n                                Only connect wallets you trust. The mixer requires transaction signing for privacy operations.\n                            </p>\n                        </div>\n                    </div>\n                </div>\n\n                <div className=\"mt-4 text-center\">\n                    <p className=\"text-xs text-gray-500\">\n                        Don&apos;t have a wallet?{' '}\n                        <a\n                            href=\"https://www.argent.xyz/starknet/\"\n                            target=\"_blank\"\n                            rel=\"noopener noreferrer\"\n                            className=\"text-orange-400 hover:text-orange-300 transition-colors\"\n                        >\n                            Install ArgentX\n                        </a>\n                    </p>\n                </div>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 576, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/CODE/SLPM-enhanced/src/components/TransactionStatus.tsx"],"sourcesContent":["import React from 'react';\nimport {\n    ClockIcon,\n    CheckCircleIcon,\n    ExclamationTriangleIcon,\n    EyeSlashIcon,\n    BanknotesIcon,\n    ArrowPathIcon\n} from '@heroicons/react/24/outline';\n\ninterface Transaction {\n    id: string;\n    type: 'deposit' | 'mix' | 'withdraw';\n    amount: string;\n    status: 'pending' | 'processing' | 'completed' | 'failed';\n    timestamp: number;\n    privacyScore: number;\n    fromNetwork: string;\n    toNetwork: string;\n    anonymitySetSize?: number;\n}\n\ninterface TransactionStatusProps {\n    transactions: Transaction[];\n    currentMixingSession?: {\n        id: string;\n        phase: 'setup' | 'deposit' | 'mixing' | 'withdraw';\n        progress: number;\n        anonymitySetSize: number;\n        estimatedTime: number;\n    };\n}\n\nexport default function TransactionStatus({ transactions, currentMixingSession }: TransactionStatusProps) {\n    const getStatusIcon = (status: string) => {\n        switch (status) {\n            case 'completed':\n                return <CheckCircleIcon className=\"w-5 h-5 text-green-400\" />;\n            case 'failed':\n                return <ExclamationTriangleIcon className=\"w-5 h-5 text-red-400\" />;\n            case 'processing':\n                return <ArrowPathIcon className=\"w-5 h-5 text-orange-400 animate-spin\" />;\n            default:\n                return <ClockIcon className=\"w-5 h-5 text-gray-400\" />;\n        }\n    };\n\n    const getStatusColor = (status: string) => {\n        switch (status) {\n            case 'completed':\n                return 'text-green-400';\n            case 'failed':\n                return 'text-red-400';\n            case 'processing':\n                return 'text-orange-400';\n            default:\n                return 'text-gray-400';\n        }\n    };\n\n    const formatTimestamp = (timestamp: number) => {\n        const date = new Date(timestamp);\n        return date.toLocaleString();\n    };\n\n    const getPrivacyScoreColor = (score: number) => {\n        if (score >= 80) return 'text-green-400';\n        if (score >= 60) return 'text-yellow-400';\n        return 'text-red-400';\n    };\n\n    return (\n        <div className=\"bg-gray-900 border border-gray-700 rounded-xl p-6\">\n            <h2 className=\"text-xl font-bold text-white mb-6 flex items-center space-x-3\">\n                <EyeSlashIcon className=\"w-6 h-6 text-blue-400\" />\n                <span>Privacy Operations</span>\n            </h2>\n\n            {/* Current Mixing Session */}\n            {currentMixingSession && (\n                <div className=\"mb-8 p-6 bg-gray-900/60 border border-gray-700 rounded-lg\">\n                    <div className=\"flex items-center justify-between mb-4\">\n                        <h3 className=\"font-semibold text-white flex items-center space-x-2\">\n                            <ArrowPathIcon className=\"w-5 h-5 text-orange-400 animate-spin\" />\n                            <span>Active Mixing Session</span>\n                        </h3>\n                        <div className=\"text-sm text-gray-400\">\n                            Phase: <span className=\"text-orange-400 capitalize\">{currentMixingSession.phase}</span>\n                        </div>\n                    </div>\n\n                    {/* Progress Bar */}\n                    <div className=\"mb-4\">\n                        <div className=\"flex justify-between text-sm text-gray-400 mb-2\">\n                            <span>Progress</span>\n                            <span>{currentMixingSession.progress}%</span>\n                        </div>\n                        <div className=\"w-full bg-gray-700 rounded-full h-2\">\n                            <div className=\"bg-orange-500 h-2 rounded-full transition-all duration-1000\" style={{ width: `${currentMixingSession.progress}%` }}></div>\n                        </div>\n                    </div>\n\n                    {/* Session Stats */}\n                    <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                        <div>\n                            <span className=\"text-gray-400\">Anonymity Set:</span>\n                            <span className=\"text-white ml-2 font-medium\">{currentMixingSession.anonymitySetSize}</span>\n                        </div>\n                        <div>\n                            <span className=\"text-gray-400\">Est. Time:</span>\n                            <span className=\"text-white ml-2 font-medium\">{currentMixingSession.estimatedTime}min</span>\n                        </div>\n                    </div>\n                </div>\n            )}\n\n            {/* Transaction History */}\n            <div>\n                <h3 className=\"font-semibold text-white mb-4\">Recent Transactions</h3>\n                {transactions.length === 0 ? (\n                    <div className=\"text-center py-8 text-gray-400\">\n                        <BanknotesIcon className=\"w-12 h-12 mx-auto mb-3 opacity-50\" />\n                        <p>No transactions yet</p>\n                        <p className=\"text-sm mt-1\">Start your first privacy mix to see transactions here</p>\n                    </div>\n                ) : (\n                    <div className=\"space-y-3\">\n                        {transactions.map((tx) => (\n                            <div key={tx.id} className=\"p-4 bg-gray-800 border border-gray-700 rounded-lg hover:border-gray-600 transition-colors\">\n                                <div className=\"flex items-start justify-between\">\n                                    <div className=\"flex items-start space-x-3\">\n                                        {getStatusIcon(tx.status)}\n                                        <div>\n                                            <div className=\"flex items-center space-x-2\">\n                                                <span className=\"font-medium text-white capitalize\">{tx.type}</span>\n                                                <span className=\"text-sm text-gray-400\">•</span>\n                                                <span className=\"text-sm text-white font-mono\">{tx.amount} STRK</span>\n                                            </div>\n                                            <div className=\"text-sm text-gray-400 mt-1\">\n                                                {tx.fromNetwork} → {tx.toNetwork}\n                                            </div>\n                                            <div className=\"text-xs text-gray-500 mt-1\">\n                                                {formatTimestamp(tx.timestamp)}\n                                            </div>\n                                        </div>\n                                    </div>\n                                    <div className=\"text-right\">\n                                        <div className={`text-sm font-medium ${getStatusColor(tx.status)} capitalize`}>\n                                            {tx.status}\n                                        </div>\n                                        <div className=\"text-xs text-gray-400 mt-1\">\n                                            Privacy Score: <span className={getPrivacyScoreColor(tx.privacyScore)}>{tx.privacyScore}%</span>\n                                        </div>\n                                        {tx.anonymitySetSize && (\n                                            <div className=\"text-xs text-gray-400 mt-1\">\n                                                Anonymity Set: {tx.anonymitySetSize}\n                                            </div>\n                                        )}\n                                    </div>\n                                </div>\n                            </div>\n                        ))}\n                    </div>\n                )}\n            </div>\n\n            {/* Privacy Metrics Summary */}\n            {transactions.length > 0 && (\n                <div className=\"mt-6 p-4 bg-gray-800/50 border border-gray-700 rounded-lg\">\n                    <h4 className=\"font-medium text-white mb-3\">Privacy Metrics</h4>\n                    <div className=\"grid grid-cols-3 gap-4 text-sm\">\n                        <div className=\"text-center\">\n                            <div className=\"text-2xl font-bold text-green-400\">\n                                {transactions.filter(tx => tx.status === 'completed').length}\n                            </div>\n                            <div className=\"text-gray-400\">Completed</div>\n                        </div>\n                        <div className=\"text-center\">\n                            <div className=\"text-2xl font-bold text-blue-400\">\n                                {Math.round(transactions.reduce((acc, tx) => acc + tx.privacyScore, 0) / transactions.length)}%\n                            </div>\n                            <div className=\"text-gray-400\">Avg Privacy</div>\n                        </div>\n                        <div className=\"text-center\">\n                            <div className=\"text-2xl font-bold text-orange-400\">\n                                {transactions.reduce((acc, tx) => acc + parseFloat(tx.amount), 0).toFixed(2)}\n                            </div>\n                            <div className=\"text-gray-400\">Total STRK</div>\n                        </div>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1158, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/CODE/SLPM-enhanced/src/components/Notification.tsx"],"sourcesContent":["import React from 'react';\nimport { CheckCircleIcon, ExclamationTriangleIcon, InformationCircleIcon, XCircleIcon } from '@heroicons/react/24/outline';\n\ninterface NotificationProps {\n    type: 'success' | 'error' | 'warning' | 'info';\n    title: string;\n    message: string;\n    isVisible: boolean;\n    onClose: () => void;\n    autoClose?: boolean;\n    duration?: number;\n}\n\nexport default function Notification({\n    type,\n    title,\n    message,\n    isVisible,\n    onClose,\n    autoClose = true,\n    duration = 5000\n}: NotificationProps) {\n    React.useEffect(() => {\n        if (isVisible && autoClose) {\n            const timer = setTimeout(onClose, duration);\n            return () => clearTimeout(timer);\n        }\n    }, [isVisible, autoClose, duration, onClose]);\n\n    if (!isVisible) return null;\n\n    const typeConfig = {\n        success: {\n            icon: CheckCircleIcon,\n            bgColor: 'bg-green-500/10',\n            borderColor: 'border-green-500/20',\n            iconColor: 'text-green-400',\n            titleColor: 'text-green-300'\n        },\n        error: {\n            icon: XCircleIcon,\n            bgColor: 'bg-red-500/10',\n            borderColor: 'border-red-500/20',\n            iconColor: 'text-red-400',\n            titleColor: 'text-red-300'\n        },\n        warning: {\n            icon: ExclamationTriangleIcon,\n            bgColor: 'bg-yellow-500/10',\n            borderColor: 'border-yellow-500/20',\n            iconColor: 'text-yellow-400',\n            titleColor: 'text-yellow-300'\n        },\n        info: {\n            icon: InformationCircleIcon,\n            bgColor: 'bg-blue-500/10',\n            borderColor: 'border-blue-500/20',\n            iconColor: 'text-blue-400',\n            titleColor: 'text-blue-300'\n        }\n    };\n\n    const config = typeConfig[type];\n    const Icon = config.icon;\n\n    return (\n        <div className=\"fixed top-4 right-4 z-50 max-w-sm w-full\">\n            <div\n                className={`${config.bgColor} ${config.borderColor} border rounded-lg p-4 shadow-lg transition-all duration-300 transform ${isVisible ? 'translate-x-0 opacity-100' : 'translate-x-full opacity-0'\n                    }`}\n            >\n                <div className=\"flex items-start space-x-3\">\n                    <Icon className={`w-6 h-6 ${config.iconColor} flex-shrink-0`} />\n                    <div className=\"flex-1 min-w-0\">\n                        <h4 className={`font-semibold ${config.titleColor}`}>{title}</h4>\n                        <p className=\"text-sm text-gray-300 mt-1\">{message}</p>\n                    </div>\n                    <button\n                        onClick={onClose}\n                        className=\"text-gray-400 hover:text-white transition-colors\"\n                    >\n                        <XCircleIcon className=\"w-5 h-5\" />\n                    </button>\n                </div>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAAA;AACA;AAAA;AAAA;AAAA;;;;;AAYe,SAAS,aAAa,KAQjB;QARiB,EACjC,IAAI,EACJ,KAAK,EACL,OAAO,EACP,SAAS,EACT,OAAO,EACP,YAAY,IAAI,EAChB,WAAW,IAAI,EACC,GARiB;;IASjC,wKAAK,CAAC,SAAS;kCAAC;YACZ,IAAI,aAAa,WAAW;gBACxB,MAAM,QAAQ,WAAW,SAAS;gBAClC;8CAAO,IAAM,aAAa;;YAC9B;QACJ;iCAAG;QAAC;QAAW;QAAW;QAAU;KAAQ;IAE5C,IAAI,CAAC,WAAW,OAAO;IAEvB,MAAM,aAAa;QACf,SAAS;YACL,MAAM,mPAAe;YACrB,SAAS;YACT,aAAa;YACb,WAAW;YACX,YAAY;QAChB;QACA,OAAO;YACH,MAAM,uOAAW;YACjB,SAAS;YACT,aAAa;YACb,WAAW;YACX,YAAY;QAChB;QACA,SAAS;YACL,MAAM,2QAAuB;YAC7B,SAAS;YACT,aAAa;YACb,WAAW;YACX,YAAY;QAChB;QACA,MAAM;YACF,MAAM,qQAAqB;YAC3B,SAAS;YACT,aAAa;YACb,WAAW;YACX,YAAY;QAChB;IACJ;IAEA,MAAM,SAAS,UAAU,CAAC,KAAK;IAC/B,MAAM,OAAO,OAAO,IAAI;IAExB,qBACI,6LAAC;QAAI,WAAU;kBACX,cAAA,6LAAC;YACG,WAAW,AAAC,GAAoB,OAAlB,OAAO,OAAO,EAAC,KAA+F,OAA5F,OAAO,WAAW,EAAC,2EAC9C,OADuH,YAAY,8BAA8B;sBAGtK,cAAA,6LAAC;gBAAI,WAAU;;kCACX,6LAAC;wBAAK,WAAW,AAAC,WAA2B,OAAjB,OAAO,SAAS,EAAC;;;;;;kCAC7C,6LAAC;wBAAI,WAAU;;0CACX,6LAAC;gCAAG,WAAW,AAAC,iBAAkC,OAAlB,OAAO,UAAU;0CAAK;;;;;;0CACtD,6LAAC;gCAAE,WAAU;0CAA8B;;;;;;;;;;;;kCAE/C,6LAAC;wBACG,SAAS;wBACT,WAAU;kCAEV,cAAA,6LAAC,uOAAW;4BAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;AAM/C;GA1EwB;KAAA","debugId":null}},
    {"offset": {"line": 1305, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/CODE/SLPM-enhanced/src/components/mixer/Stepper.tsx"],"sourcesContent":["import React from 'react';\nimport { BanknotesIcon, CheckCircleIcon, ArrowPathIcon, WalletIcon } from '@heroicons/react/24/outline';\nimport { MixingStep } from '../../lib/types';\n\nconst icons = {\n    setup: WalletIcon,\n    deposit: BanknotesIcon,\n    mixing: ArrowPathIcon,\n    complete: CheckCircleIcon,\n};\n\nexport function Stepper({ current }: { current: MixingStep }) {\n    const steps: { id: MixingStep; name: string }[] = [\n        { id: 'setup', name: 'Setup' },\n        { id: 'deposit', name: 'Deposit' },\n        { id: 'mixing', name: 'Mixing' },\n        { id: 'complete', name: 'Complete' },\n    ];\n    const currentIndex = steps.findIndex((s) => s.id === current);\n    return (\n        <div className=\"mb-8\">\n            <div className=\"flex items-center justify-between\">\n                {steps.map((s, idx) => {\n                    const Icon = icons[s.id];\n                    const isActive = idx <= currentIndex;\n                    const isCurrent = idx === currentIndex;\n                    return (\n                        <div key={s.id} className=\"flex flex-col items-center relative\">\n                            <div className={`w-11 h-11 rounded-full border-2 flex items-center justify-center mb-2 ${isActive ? 'border-orange-500 bg-orange-500/10' : 'border-gray-600 bg-gray-800'}`}>\n                                <Icon className={`w-6 h-6 ${isActive ? 'text-orange-400' : 'text-gray-400'}`} />\n                            </div>\n                            <span className={`text-sm ${isCurrent ? 'text-orange-400' : isActive ? 'text-white' : 'text-gray-400'}`}>{s.name}</span>\n                            {idx < steps.length - 1 && (\n                                <div className={`absolute w-full h-0.5 top-6 left-11 ${idx < currentIndex ? 'bg-orange-500' : 'bg-gray-600'}`} style={{ width: 'calc(100% + 44px)' }} />\n                            )}\n                        </div>\n                    );\n                })}\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AACA;AAAA;AAAA;AAAA;;;AAGA,MAAM,QAAQ;IACV,OAAO,oOAAU;IACjB,SAAS,6OAAa;IACtB,QAAQ,6OAAa;IACrB,UAAU,mPAAe;AAC7B;AAEO,SAAS,QAAQ,KAAoC;QAApC,EAAE,OAAO,EAA2B,GAApC;IACpB,MAAM,QAA4C;QAC9C;YAAE,IAAI;YAAS,MAAM;QAAQ;QAC7B;YAAE,IAAI;YAAW,MAAM;QAAU;QACjC;YAAE,IAAI;YAAU,MAAM;QAAS;QAC/B;YAAE,IAAI;YAAY,MAAM;QAAW;KACtC;IACD,MAAM,eAAe,MAAM,SAAS,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;IACrD,qBACI,6LAAC;QAAI,WAAU;kBACX,cAAA,6LAAC;YAAI,WAAU;sBACV,MAAM,GAAG,CAAC,CAAC,GAAG;gBACX,MAAM,OAAO,KAAK,CAAC,EAAE,EAAE,CAAC;gBACxB,MAAM,WAAW,OAAO;gBACxB,MAAM,YAAY,QAAQ;gBAC1B,qBACI,6LAAC;oBAAe,WAAU;;sCACtB,6LAAC;4BAAI,WAAW,AAAC,yEAAwJ,OAAhF,WAAW,uCAAuC;sCACvI,cAAA,6LAAC;gCAAK,WAAW,AAAC,WAAyD,OAA/C,WAAW,oBAAoB;;;;;;;;;;;sCAE/D,6LAAC;4BAAK,WAAW,AAAC,WAAoF,OAA1E,YAAY,oBAAoB,WAAW,eAAe;sCAAoB,EAAE,IAAI;;;;;;wBAC/G,MAAM,MAAM,MAAM,GAAG,mBAClB,6LAAC;4BAAI,WAAW,AAAC,uCAA2F,OAArD,MAAM,eAAe,kBAAkB;4BAAiB,OAAO;gCAAE,OAAO;4BAAoB;;;;;;;mBANjJ,EAAE,EAAE;;;;;YAUtB;;;;;;;;;;;AAIhB;KA9BgB","debugId":null}},
    {"offset": {"line": 1414, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/CODE/SLPM-enhanced/src/components/mixer/SetupForm.tsx"],"sourcesContent":["import React, { useMemo } from 'react';\nimport { EyeSlashIcon } from '@heroicons/react/24/outline';\nimport { MixRequest, PrivacyLevel, PrivacyConfig } from '../../lib/types';\n\nconst PRIVACY_LEVELS: Record<PrivacyLevel, PrivacyConfig> = {\n    standard: { name: 'Standard', description: '10+ participants', minParticipants: 10, estimatedTime: 5, feeBps: 10 },\n    enhanced: { name: 'Enhanced', description: '50+ participants', minParticipants: 50, estimatedTime: 15, feeBps: 20 },\n    maximum: { name: 'Maximum', description: '100+ participants', minParticipants: 100, estimatedTime: 30, feeBps: 30 },\n};\n\nexport function SetupForm({\n    value,\n    onChange,\n    onStart,\n    isConnected,\n}: {\n    value: MixRequest;\n    onChange: (v: Partial<MixRequest>) => void;\n    onStart: () => void;\n    isConnected: boolean;\n}) {\n    const feePct = useMemo(() => PRIVACY_LEVELS[value.privacyLevel].feeBps / 100, [value.privacyLevel]);\n    const valid = value.amountStrk > 0 && value.destinations.length > 0 && value.destinations[0]?.length > 0;\n\n    return (\n        <div className=\"bg-gray-900 border border-gray-700 rounded-xl p-6\">\n            <h2 className=\"text-xl font-bold mb-6 flex items-center space-x-3\">\n                <EyeSlashIcon className=\"w-6 h-6 text-blue-400\" />\n                <span>Configure Privacy Mix</span>\n            </h2>\n\n            {/* Amount */}\n            <div className=\"mb-6\">\n                <label className=\"block text-sm text-gray-300 mb-2\">Amount (STRK)</label>\n                <input\n                    inputMode=\"decimal\"\n                    value={value.amountStrk || ''}\n                    onChange={(e) => onChange({ amountStrk: Number(e.target.value || 0) })}\n                    placeholder=\"0.00\"\n                    className=\"w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-400 focus:border-orange-500 focus:outline-none\"\n                />\n                <p className=\"text-xs text-gray-500 mt-1\">Min: 1 STRK • Max: 10,000 STRK</p>\n            </div>\n\n            {/* Single Destination */}\n            <div className=\"mb-6\">\n                <label className=\"block text-sm text-gray-300 mb-2\">Destination Address</label>\n                <input\n                    value={value.destinations[0] || ''}\n                    onChange={(e) => onChange({ destinations: e.target.value.trim() ? [e.target.value.trim()] : [] })}\n                    placeholder=\"0x1234567890abcdef...\"\n                    className=\"w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-400 focus:border-orange-500 focus:outline-none\"\n                />\n                <p className=\"text-xs text-gray-500 mt-1\">The STRK address where mixed funds will be sent.</p>\n            </div>\n\n            {/* Privacy level */}\n            <div className=\"mb-6\">\n                <label className=\"block text-sm text-gray-300 mb-3\">Privacy Level</label>\n                <div className=\"grid sm:grid-cols-3 gap-3\">\n                    {(Object.keys(PRIVACY_LEVELS) as PrivacyLevel[]).map((level) => {\n                        const cfg = PRIVACY_LEVELS[level];\n                        const active = value.privacyLevel === level;\n                        return (\n                            <button\n                                type=\"button\"\n                                key={level}\n                                onClick={() => onChange({ privacyLevel: level })}\n                                className={`p-4 border rounded-lg text-left ${active ? 'border-orange-500 bg-orange-500/10' : 'border-gray-600 hover:border-gray-500'}`}\n                            >\n                                <div className=\"font-semibold\">{cfg.name}</div>\n                                <div className=\"text-sm text-gray-400\">{cfg.description}</div>\n                                <div className=\"mt-2 text-xs text-gray-500\">Fee: {(cfg.feeBps / 100).toFixed(2)}% • Est: {cfg.estimatedTime}m</div>\n                            </button>\n                        );\n                    })}\n                </div>\n            </div>\n\n            {/* Day 6: Privacy enhancements */}\n            <div className=\"mb-6\">\n                <label className=\"block text-sm text-gray-300 mb-3\">Advanced Privacy Options</label>\n                <div className=\"grid sm:grid-cols-2 gap-4\">\n                    <label className=\"flex items-center gap-3 text-gray-300\">\n                        <input type=\"checkbox\" checked={value.enableTimeDelays} onChange={(e) => onChange({ enableTimeDelays: e.target.checked })} />\n                        Time delays & randomization\n                    </label>\n                    <label className=\"flex items-center gap-3 text-gray-300\">\n                        <input type=\"checkbox\" checked={value.enableRandomizedMints} onChange={(e) => onChange({ enableRandomizedMints: e.target.checked })} />\n                        Randomized Cashu mint hops\n                    </label>\n                    <label className=\"flex items-center gap-3 text-gray-300\">\n                        <input type=\"checkbox\" checked={value.enableAmountObfuscation} onChange={(e) => onChange({ enableAmountObfuscation: e.target.checked })} />\n                        Amount obfuscation\n                    </label>\n                    <label className=\"flex items-center gap-3 text-gray-300\">\n                        <input type=\"checkbox\" checked={value.enableDecoyTx} onChange={(e) => onChange({ enableDecoyTx: e.target.checked })} />\n                        Decoy transactions\n                    </label>\n                </div>\n                <div className=\"mt-4 grid sm:grid-cols-2 gap-4\">\n                    <label className=\"block text-sm text-gray-300\">\n                        Split outputs\n                        <input\n                            type=\"number\"\n                            min={1}\n                            max={10}\n                            value={value.splitCount}\n                            onChange={(e) => onChange({ splitCount: Number(e.target.value) })}\n                            className=\"mt-1 w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-orange-500 focus:outline-none\"\n                        />\n                    </label>\n                    <div className=\"text-sm text-gray-400 self-end\">Fee estimate: {(feePct).toFixed(2)}%</div>\n                </div>\n            </div>\n\n            <button\n                onClick={onStart}\n                disabled={!valid}\n                className={`w-full bg-orange-600 hover:bg-orange-700 disabled:bg-gray-700 disabled:cursor-not-allowed text-white font-semibold py-3 rounded-lg`}\n            >\n                {isConnected ? 'Start Privacy Mix' : 'Connect Wallet to Continue'}\n            </button>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1815, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/CODE/SLPM-enhanced/src/components/mixer/DepositView.tsx"],"sourcesContent":["import React from 'react';\nimport { BanknotesIcon } from '@heroicons/react/24/outline';\n\nexport function DepositView({ amount }: { amount: string }) {\n    return (\n        <div className=\"bg-gray-900 border border-gray-700 rounded-xl p-8 text-center\">\n            <BanknotesIcon className=\"w-14 h-14 text-orange-400 mx-auto mb-4\" />\n            <h2 className=\"text-2xl font-bold mb-2\">Processing Deposit</h2>\n            <p className=\"text-gray-400 mb-6\">Preparing your {amount} STRK for mixing...</p>\n            <div className=\"animate-spin w-8 h-8 border-2 border-orange-500 border-t-transparent rounded-full mx-auto\" />\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AACA;;;AAEO,SAAS,YAAY,KAA8B;QAA9B,EAAE,MAAM,EAAsB,GAA9B;IACxB,qBACI,6LAAC;QAAI,WAAU;;0BACX,6LAAC,6OAAa;gBAAC,WAAU;;;;;;0BACzB,6LAAC;gBAAG,WAAU;0BAA0B;;;;;;0BACxC,6LAAC;gBAAE,WAAU;;oBAAqB;oBAAgB;oBAAO;;;;;;;0BACzD,6LAAC;gBAAI,WAAU;;;;;;;;;;;;AAG3B;KATgB","debugId":null}},
    {"offset": {"line": 1879, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/CODE/SLPM-enhanced/src/components/mixer/MixingView.tsx"],"sourcesContent":["import React from 'react';\nimport { ArrowPathIcon } from '@heroicons/react/24/outline';\n\nexport function MixingView({ progress, anonymitySet, eta }: { progress: number; anonymitySet: number; eta: number }) {\n    return (\n        <div className=\"bg-gray-900 border border-gray-700 rounded-xl p-8\">\n            <div className=\"text-center mb-8\">\n                <ArrowPathIcon className=\"w-14 h-14 text-orange-400 mx-auto mb-4 animate-spin\" />\n                <h2 className=\"text-2xl font-bold mb-2\">Mixing in Progress</h2>\n                <p className=\"text-gray-400\">Your transaction is being mixed with {anonymitySet} participants</p>\n            </div>\n            <div className=\"mb-6\">\n                <div className=\"flex justify-between text-sm text-gray-400 mb-2\">\n                    <span>Progress</span>\n                    <span>{Math.round(progress)}%</span>\n                </div>\n                <div className=\"w-full bg-gray-700 rounded-full h-3\">\n                    <div className=\"bg-orange-500 h-3 rounded-full transition-all duration-700\" style={{ width: `${progress}%` }} />\n                </div>\n            </div>\n            <div className=\"grid grid-cols-2 gap-4 text-center\">\n                <div className=\"p-4 bg-gray-800 rounded-lg\">\n                    <div className=\"text-2xl font-bold text-blue-400\">{anonymitySet}</div>\n                    <div className=\"text-sm text-gray-400\">Anonymity Set</div>\n                </div>\n                <div className=\"p-4 bg-gray-800 rounded-lg\">\n                    <div className=\"text-2xl font-bold text-orange-400\">{eta}m</div>\n                    <div className=\"text-sm text-gray-400\">Est. Time</div>\n                </div>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AACA;;;AAEO,SAAS,WAAW,KAAwF;QAAxF,EAAE,QAAQ,EAAE,YAAY,EAAE,GAAG,EAA2D,GAAxF;IACvB,qBACI,6LAAC;QAAI,WAAU;;0BACX,6LAAC;gBAAI,WAAU;;kCACX,6LAAC,6OAAa;wBAAC,WAAU;;;;;;kCACzB,6LAAC;wBAAG,WAAU;kCAA0B;;;;;;kCACxC,6LAAC;wBAAE,WAAU;;4BAAgB;4BAAsC;4BAAa;;;;;;;;;;;;;0BAEpF,6LAAC;gBAAI,WAAU;;kCACX,6LAAC;wBAAI,WAAU;;0CACX,6LAAC;0CAAK;;;;;;0CACN,6LAAC;;oCAAM,KAAK,KAAK,CAAC;oCAAU;;;;;;;;;;;;;kCAEhC,6LAAC;wBAAI,WAAU;kCACX,cAAA,6LAAC;4BAAI,WAAU;4BAA6D,OAAO;gCAAE,OAAO,AAAC,GAAW,OAAT,UAAS;4BAAG;;;;;;;;;;;;;;;;;0BAGnH,6LAAC;gBAAI,WAAU;;kCACX,6LAAC;wBAAI,WAAU;;0CACX,6LAAC;gCAAI,WAAU;0CAAoC;;;;;;0CACnD,6LAAC;gCAAI,WAAU;0CAAwB;;;;;;;;;;;;kCAE3C,6LAAC;wBAAI,WAAU;;0CACX,6LAAC;gCAAI,WAAU;;oCAAsC;oCAAI;;;;;;;0CACzD,6LAAC;gCAAI,WAAU;0CAAwB;;;;;;;;;;;;;;;;;;;;;;;;AAK3D;KA7BgB","debugId":null}},
    {"offset": {"line": 2059, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/CODE/SLPM-enhanced/src/components/mixer/CompleteView.tsx"],"sourcesContent":["import React from 'react';\nimport { CheckCircleIcon } from '@heroicons/react/24/outline';\n\nexport function CompleteView({ amount, anonymitySet, onReset }: { amount: string; anonymitySet: number; onReset: () => void }) {\n    return (\n        <div className=\"bg-gray-900 border border-gray-700 rounded-xl p-8 text-center\">\n            <CheckCircleIcon className=\"w-14 h-14 text-green-400 mx-auto mb-4\" />\n            <h2 className=\"text-2xl font-bold mb-2 text-green-400\">Mix Complete</h2>\n            <p className=\"text-gray-400 mb-6\">Your {amount} STRK has been mixed with {anonymitySet} participants</p>\n            <button onClick={onReset} className=\"bg-orange-600 hover:bg-orange-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors\">Start New Mix</button>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AACA;;;AAEO,SAAS,aAAa,KAAgG;QAAhG,EAAE,MAAM,EAAE,YAAY,EAAE,OAAO,EAAiE,GAAhG;IACzB,qBACI,6LAAC;QAAI,WAAU;;0BACX,6LAAC,mPAAe;gBAAC,WAAU;;;;;;0BAC3B,6LAAC;gBAAG,WAAU;0BAAyC;;;;;;0BACvD,6LAAC;gBAAE,WAAU;;oBAAqB;oBAAM;oBAAO;oBAA2B;oBAAa;;;;;;;0BACvF,6LAAC;gBAAO,SAAS;gBAAS,WAAU;0BAAoG;;;;;;;;;;;;AAGpJ;KATgB","debugId":null}},
    {"offset": {"line": 2127, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/CODE/SLPM-enhanced/src/utils/zk.ts"],"sourcesContent":["// Shared zero-knowledge related helpers aligning EXACTLY with Cairo contract logic\n// Contract formulas (see contract/src/privacy_mixer.cairo):\n// commitment = Poseidon(secret, amount.low, amount.high)\n// nullifier  = Poseidon(secret, commitment)\n// proof      = [secret, hash(recipient), hash(amount.low, amount.high)]\n\nimport { hash, num, uint256 } from 'starknet';\n\nexport interface CommitmentArtifacts {\n    commitment: string; // hex 0x\n    nullifier: string;  // hex 0x\n    secret: string;     // hex 0x (felt)\n    amountLow: bigint;\n    amountHigh: bigint;\n}\n\nexport function generateSecret(): string {\n    // 31 random bytes -> fits in felt252\n    const bytes = crypto.getRandomValues(new Uint8Array(31));\n    return '0x' + Array.from(bytes).map(b => b.toString(16).padStart(2, '0')).join('');\n}\n\nexport function generateCommitmentArtifacts(secretHex: string, amount: bigint): CommitmentArtifacts {\n    if (!secretHex.startsWith('0x')) throw new Error('secret must be 0x-prefixed');\n    const secretBig = BigInt(secretHex);\n    const { low, high } = uint256.bnToUint256(amount);\n    const commitment = hash.computePoseidonHashOnElements([secretBig, BigInt(low), BigInt(high)]);\n    const nullifier = hash.computePoseidonHashOnElements([secretBig, BigInt(commitment)]);\n    return {\n        commitment: num.toHex(commitment),\n        nullifier: num.toHex(nullifier),\n        secret: secretHex,\n        amountLow: BigInt(low),\n        amountHigh: BigInt(high)\n    };\n}\n\nexport function generateProof(secretHex: string, amount: bigint, recipientHex: string): string[] {\n    const secretBig = BigInt(secretHex);\n    const recipientBig = BigInt(recipientHex);\n    const { low, high } = uint256.bnToUint256(amount);\n    const recipientHash = hash.computePoseidonHashOnElements([recipientBig]);\n    const amountHash = hash.computePoseidonHashOnElements([BigInt(low), BigInt(high)]);\n    return [secretHex, num.toHex(recipientHash), num.toHex(amountHash)];\n}\n\nexport function recomputeCommitment(secretHex: string, amount: bigint): string {\n    const secretBig = BigInt(secretHex);\n    const { low, high } = uint256.bnToUint256(amount);\n    const commitment = hash.computePoseidonHashOnElements([secretBig, BigInt(low), BigInt(high)]);\n    return num.toHex(commitment);\n}\n\nexport function recomputeNullifier(secretHex: string, commitmentHex: string): string {\n    const secretBig = BigInt(secretHex);\n    const commitmentBig = BigInt(commitmentHex);\n    const nullifier = hash.computePoseidonHashOnElements([secretBig, commitmentBig]);\n    return num.toHex(nullifier);\n}\n"],"names":[],"mappings":"AAAA,mFAAmF;AACnF,4DAA4D;AAC5D,yDAAyD;AACzD,4CAA4C;AAC5C,wEAAwE;;;;;;;;;;;;;AAExE;;AAUO,SAAS;IACZ,qCAAqC;IACrC,MAAM,QAAQ,OAAO,eAAe,CAAC,IAAI,WAAW;IACpD,OAAO,OAAO,MAAM,IAAI,CAAC,OAAO,GAAG,CAAC,CAAA,IAAK,EAAE,QAAQ,CAAC,IAAI,QAAQ,CAAC,GAAG,MAAM,IAAI,CAAC;AACnF;AAEO,SAAS,4BAA4B,SAAiB,EAAE,MAAc;IACzE,IAAI,CAAC,UAAU,UAAU,CAAC,OAAO,MAAM,IAAI,MAAM;IACjD,MAAM,YAAY,OAAO;IACzB,MAAM,EAAE,GAAG,EAAE,IAAI,EAAE,GAAG,wKAAO,CAAC,WAAW,CAAC;IAC1C,MAAM,aAAa,qKAAI,CAAC,6BAA6B,CAAC;QAAC;QAAW,OAAO;QAAM,OAAO;KAAM;IAC5F,MAAM,YAAY,qKAAI,CAAC,6BAA6B,CAAC;QAAC;QAAW,OAAO;KAAY;IACpF,OAAO;QACH,YAAY,oKAAG,CAAC,KAAK,CAAC;QACtB,WAAW,oKAAG,CAAC,KAAK,CAAC;QACrB,QAAQ;QACR,WAAW,OAAO;QAClB,YAAY,OAAO;IACvB;AACJ;AAEO,SAAS,cAAc,SAAiB,EAAE,MAAc,EAAE,YAAoB;IACjF,MAAM,YAAY,OAAO;IACzB,MAAM,eAAe,OAAO;IAC5B,MAAM,EAAE,GAAG,EAAE,IAAI,EAAE,GAAG,wKAAO,CAAC,WAAW,CAAC;IAC1C,MAAM,gBAAgB,qKAAI,CAAC,6BAA6B,CAAC;QAAC;KAAa;IACvE,MAAM,aAAa,qKAAI,CAAC,6BAA6B,CAAC;QAAC,OAAO;QAAM,OAAO;KAAM;IACjF,OAAO;QAAC;QAAW,oKAAG,CAAC,KAAK,CAAC;QAAgB,oKAAG,CAAC,KAAK,CAAC;KAAY;AACvE;AAEO,SAAS,oBAAoB,SAAiB,EAAE,MAAc;IACjE,MAAM,YAAY,OAAO;IACzB,MAAM,EAAE,GAAG,EAAE,IAAI,EAAE,GAAG,wKAAO,CAAC,WAAW,CAAC;IAC1C,MAAM,aAAa,qKAAI,CAAC,6BAA6B,CAAC;QAAC;QAAW,OAAO;QAAM,OAAO;KAAM;IAC5F,OAAO,oKAAG,CAAC,KAAK,CAAC;AACrB;AAEO,SAAS,mBAAmB,SAAiB,EAAE,aAAqB;IACvE,MAAM,YAAY,OAAO;IACzB,MAAM,gBAAgB,OAAO;IAC7B,MAAM,YAAY,qKAAI,CAAC,6BAA6B,CAAC;QAAC;QAAW;KAAc;IAC/E,OAAO,oKAAG,CAAC,KAAK,CAAC;AACrB","debugId":null}},
    {"offset": {"line": 2215, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/CODE/SLPM-enhanced/src/orchestrator/steps/deposit.ts"],"sourcesContent":["import { OrchestratorEvent } from '@/lib/types';\nimport { RealStarknetWalletClient } from '@/integrations/starknet/wallet';\nimport { ENV } from '@/config/env';\nimport { PRIVACY_MIXER } from '@/config/constants';\nimport { randomHex } from '@/crypto/bdhke';\nimport { num } from 'starknet';\nimport { generateCommitmentArtifacts, generateSecret } from '@/utils/zk';\n\n// Starknet addresses (mainnet)\nconst STRK_TOKEN_ADDRESS = '0x04718f5a0fc34cc1af16a1cdee98ffb20c31f5cd61d6ab07201858f4287c938d'; // STRK on mainnet\nconst MIXER_CONTRACT_ADDRESS = ENV.MIXER_CONTRACT_ADDRESS || PRIVACY_MIXER.CONTRACT_ADDRESS; // Use environment config first\n\nexport async function stepDeposit(amountStrk: number, onEvent: (e: OrchestratorEvent) => void) {\n    console.log('💰 SLPM Deposit: Starting deposit step');\n    console.log('💰 SLPM Deposit: Amount requested:', amountStrk, 'STRK');\n\n    try {\n        // Fast sanity check: current deployed contract min deposit is 1 STRK (1e18 wei)\n        // (See PRIVACY_MIXER.DEPLOYMENT_PARAMS.MIN_DEPOSIT). If user enters < 1 it will revert\n        // on-chain with a generic Execute failed (assert Amount below minimum) which is hard\n        // to decode client-side right now.\n        const configuredMinDepositWei = PRIVACY_MIXER.DEPLOYMENT_PARAMS.MIN_DEPOSIT; // bigint (wei)\n        const configuredMinDepositStrk = Number(configuredMinDepositWei) / 1e18; // for log (only safe here since value is small: 1e18)\n        if (amountStrk < configuredMinDepositStrk) {\n            const friendlyMsg = `Requested amount ${amountStrk} STRK is below current minimum deposit (${configuredMinDepositStrk} STRK). Increase amount or redeploy with lower MIN_DEPOSIT.`;\n            console.warn('⚠️ SLPM Deposit: Early rejection -', friendlyMsg);\n            onEvent({ type: 'deposit:error', message: friendlyMsg });\n            throw new Error(friendlyMsg);\n        }\n\n        onEvent({ type: 'deposit:initiated', message: 'Connecting to Starknet wallet...' });\n        console.log('💰 SLPM Deposit: Initializing wallet client...');\n\n        // Initialize Starknet wallet client\n        const walletClient = new RealStarknetWalletClient(ENV.STARKNET_RPC);\n\n        // Connect to wallet (ArgentX/Braavos)\n        console.log('💰 SLPM Deposit: Connecting wallet...');\n        const connection = await walletClient.connect();\n        console.log('💰 SLPM Deposit: Wallet connected:', {\n            address: connection.account.address,\n            walletType: connection.walletType\n        });\n\n        onEvent({ type: 'deposit:wallet_connected', message: 'Wallet connected successfully' });\n\n        // Initialize mixer contract\n        console.log('💰 SLPM Deposit: Initializing privacy mixer contract...');\n        await walletClient.initMixerContract(MIXER_CONTRACT_ADDRESS);\n        console.log('💰 SLPM Deposit: Mixer contract initialized');\n\n        // Check STRK balance\n        console.log('💰 SLPM Deposit: Checking STRK balance...');\n        const balance = await walletClient.getBalance(STRK_TOKEN_ADDRESS);\n        // Use decimal math carefully – avoid floating point drift by converting string\n        const scaled = BigInt(Math.round(Number(amountStrk) * 10 ** balance.decimals));\n        const amountWei = scaled;\n\n        // Validate amount doesn't exceed felt limit (2^251 - 1)\n        const FELT_MAX = BigInt('0x800000000000011000000000000000000000000000000000000000000000000') - BigInt(1);\n        if (amountWei > FELT_MAX) {\n            throw new Error(`Amount too large for Starknet felt: ${amountWei.toString()}`);\n        }\n\n        console.log('💰 SLPM Deposit: Balance check:', {\n            tokenAddress: STRK_TOKEN_ADDRESS,\n            symbol: balance.symbol,\n            onChainBalanceWei: balance.balance.toString(),\n            onChainBalanceSTRK: Number(balance.balance) / Math.pow(10, balance.decimals),\n            decimals: balance.decimals,\n            requestedAmountWei: amountWei.toString(),\n            requestedAmountSTRK: amountStrk,\n            requestedAmountHex: '0x' + amountWei.toString(16),\n            minDepositWei: configuredMinDepositWei.toString(),\n            minDepositSTRK: configuredMinDepositStrk\n        });\n\n        if (balance.balance < amountWei) {\n            throw new Error(`Insufficient STRK balance. Required: ${amountStrk} STRK, Available: ${Number(balance.balance) / Math.pow(10, balance.decimals)} STRK`);\n        }\n\n        onEvent({ type: 'deposit:balance_checked', message: `Balance confirmed: ${Number(balance.balance) / Math.pow(10, balance.decimals)} STRK available` });\n\n        // Generate correct commitment/nullifier per contract spec\n        console.log('💰 SLPM Deposit: Generating commitment & nullifier (contract spec)...');\n        const secretHex = generateSecret();\n        const amountBigInt = BigInt(amountWei.toString());\n        const artifacts = generateCommitmentArtifacts(secretHex, amountBigInt);\n        console.log('💰 SLPM Deposit: Generated artifacts:', {\n            secret: artifacts.secret.slice(0, 10) + '...',\n            commitment: artifacts.commitment,\n            nullifier: artifacts.nullifier.slice(0, 10) + '...'\n        });\n\n        onEvent({ type: 'deposit:balance_checked', message: 'Privacy commitment generated' });\n\n        // First approve STRK spending by mixer contract\n        console.log('💰 SLPM Deposit: Approving STRK spending by mixer contract...');\n        const approvalResult = await walletClient.approve(STRK_TOKEN_ADDRESS, MIXER_CONTRACT_ADDRESS, amountWei);\n        console.log('💰 SLPM Deposit: Approval transaction submitted:', approvalResult);\n\n        onEvent({ type: 'deposit:transfer_submitted', message: `Approval submitted: ${approvalResult.transactionHash}` });\n\n        // Wait for approval confirmation\n        console.log('💰 SLPM Deposit: Waiting for approval confirmation...');\n        const confirmedApproval = await walletClient.waitForTransaction(approvalResult.transactionHash);\n        console.log('💰 SLPM Deposit: Approval confirmed:', confirmedApproval);\n\n        if (confirmedApproval.status === 'REJECTED') {\n            throw new Error('Approval transaction was rejected by the network');\n        }\n\n        onEvent({ type: 'deposit:balance_checked', message: 'STRK spending approval confirmed' });\n\n        // Verify allowance was set correctly before attempting deposit\n        console.log('💰 SLPM Deposit: Verifying allowance was set correctly...');\n        try {\n            const allowanceResult = await walletClient.callContract(\n                STRK_TOKEN_ADDRESS,\n                'allowance',\n                [connection.account.address, MIXER_CONTRACT_ADDRESS]\n            );\n            const currentAllowance = BigInt(allowanceResult[0] || 0);\n            console.log('💰 SLPM Deposit: Current allowance:', {\n                allowanceWei: currentAllowance.toString(),\n                allowanceSTRK: Number(currentAllowance) / Math.pow(10, balance.decimals),\n                requiredWei: amountWei.toString(),\n                requiredSTRK: amountStrk,\n                sufficient: currentAllowance >= amountWei\n            });\n\n            if (currentAllowance < amountWei) {\n                throw new Error(`Insufficient allowance: ${Number(currentAllowance) / Math.pow(10, balance.decimals)} STRK allowed, ${amountStrk} STRK required`);\n            }\n\n            onEvent({ type: 'deposit:balance_checked', message: `Allowance verified: ${Number(currentAllowance) / Math.pow(10, balance.decimals)} STRK` });\n        } catch (allowanceError) {\n            console.error('💰 SLPM Deposit: Allowance check failed:', allowanceError);\n            // Continue anyway - some tokens might not support allowance query\n            onEvent({ type: 'deposit:balance_checked', message: 'Allowance check failed, proceeding with deposit...' });\n        }\n\n        // Now deposit to mixer contract with commitment\n        console.log('💰 SLPM Deposit: Depositing to privacy mixer contract...');\n        const depositTxHash = await walletClient.depositToMixer(artifacts.commitment, amountWei);\n        console.log('💰 SLPM Deposit: Deposit transaction submitted:', depositTxHash); onEvent({ type: 'deposit:transfer_submitted', message: `Deposit to mixer submitted: ${depositTxHash}` });\n\n        // Wait for deposit confirmation\n        console.log('💰 SLPM Deposit: Waiting for deposit confirmation...');\n        const confirmedTx = await walletClient.waitForTransaction(depositTxHash);\n        console.log('💰 SLPM Deposit: Deposit confirmed:', confirmedTx);\n\n        if (confirmedTx.status === 'REJECTED') {\n            throw new Error('Deposit transaction was rejected by the network');\n        }\n\n        onEvent({ type: 'deposit:confirmed', message: 'STRK deposit confirmed in privacy mixer', progress: 20 });\n        console.log('💰 SLPM Deposit: Step completed successfully');\n\n        console.log('🔄 SLPM Deposit: Now preparing for immediate withdrawal to enable swapping...');\n\n        // For privacy mixing, we need to immediately withdraw the funds to a temporary address\n        // that the orchestrator controls, so it can proceed with the Lightning/Cashu mixing\n        onEvent({ type: 'deposit:preparing_withdrawal', message: 'Preparing privacy withdrawal for mixing...', progress: 22 });\n\n        // Convert BigInt to hex string for Cairo felt252 compatibility\n        const commitmentHashHex = artifacts.commitment;\n\n        return {\n            transactionHash: confirmedTx.transactionHash,\n            amount: amountStrk,\n            amountWei: amountWei.toString(),\n            walletAddress: connection.account.address,\n            commitmentHash: commitmentHashHex,\n            secret: artifacts.secret,\n            nullifier: artifacts.nullifier,\n            mixerContractAddress: MIXER_CONTRACT_ADDRESS,\n            // Add withdrawal credentials for immediate processing\n            withdrawalReady: true\n        };\n\n    } catch (error) {\n        // Attempt to refine common failure causes\n        let refined = error instanceof Error ? error.message : 'Unknown deposit error';\n        if (/Execute failed/i.test(refined)) {\n            refined = refined + ' (Possible causes: amount below MIN_DEPOSIT, insufficient allowance, or token transfer_from failure)';\n        }\n        console.error('❌ SLPM Deposit: Step failed:', error);\n        onEvent({ type: 'deposit:error', message: refined });\n        throw new Error(refined);\n    }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2428, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/CODE/SLPM-enhanced/src/integrations/starknet/sharedAccount.ts"],"sourcesContent":["import { Account, RpcProvider, ec, cairo, CallData } from 'starknet';\nimport { StarknetSigner } from '@atomiqlabs/chain-starknet';\nimport { SHARED_SWAP_ACCOUNT_ADDRESS } from '@/config/constants';\nimport { ENV, getStarknetRpc } from '@/config/env';\nimport { PRIVACY_MIXER } from '@/config/constants';\n\n// Lazy singleton for shared swap account (prototype only)\nlet sharedAccount: Account | null = null;\nlet sharedSigner: StarknetSigner | null = null;\nlet sharedProvider: RpcProvider | null = null;\n\nexport function getSharedSwapAccount(): StarknetSigner | null {\n    if (sharedSigner) return sharedSigner;\n    if (!ENV.SHARED_SWAP_ACCOUNT_PRIVATE_KEY) {\n        return null; // Not configured\n    }\n\n    const address = (ENV.SHARED_SWAP_ACCOUNT_ADDRESS || SHARED_SWAP_ACCOUNT_ADDRESS).toLowerCase();\n    const provider = new RpcProvider({ nodeUrl: getStarknetRpc() });\n    sharedProvider = provider;\n\n    try {\n        // Validate private key (basic length/hex check)\n        const pk = ENV.SHARED_SWAP_ACCOUNT_PRIVATE_KEY.startsWith('0x')\n            ? ENV.SHARED_SWAP_ACCOUNT_PRIVATE_KEY\n            : '0x' + ENV.SHARED_SWAP_ACCOUNT_PRIVATE_KEY;\n\n        if (!/^0x[0-9a-fA-F]{64}$/.test(pk)) {\n            console.warn('Shared swap account private key format unexpected');\n        }\n\n        // Derive public key just for logging (not strictly needed)\n        try {\n            const pub = ec.starkCurve.getStarkKey(pk);\n            console.log('🔐 Shared swap account loaded (pubkey prefix):', pub.slice(0, 10) + '...');\n        } catch (e) {\n            console.warn('Could not derive public key for shared swap account:', e);\n        }\n\n        sharedAccount = new Account(provider, address, pk);\n        sharedSigner = new StarknetSigner(sharedAccount);\n        return sharedSigner;\n    } catch (e) {\n        console.error('Failed to instantiate shared swap account:', e);\n        return null;\n    }\n}\n\nexport function getSharedSwapProvider(): RpcProvider | null {\n    return sharedProvider;\n}\n\nexport function getSharedSwapAccountRaw(): Account | null {\n    // Get the raw Account for contracts that need it\n    if (!sharedSigner) {\n        // Try to initialize if not already done\n        getSharedSwapAccount();\n    }\n    return sharedAccount;\n}\n\n// Quick runtime validation to catch mismatched private key/address early\nexport async function validateSharedSwapSigner(): Promise<{ ok: boolean; reason?: string; address?: string }> {\n    try {\n        const signer = getSharedSwapAccount();\n        const acct = getSharedSwapAccountRaw();\n        const provider = getSharedSwapProvider();\n        if (!signer || !acct || !provider) {\n            return { ok: false, reason: 'Shared swap signer not configured (missing env or provider)' };\n        }\n\n        // Try to fetch nonce as a lightweight liveness check\n        try {\n            const nonce = await acct.getNonce();\n            console.log('✅ Shared swap account validation OK', { address: acct.address, nonce: nonce?.toString?.() || String(nonce) });\n            return { ok: true, address: acct.address };\n        } catch (e) {\n            console.warn('⚠️ Shared swap account nonce check failed', { address: acct.address, error: e instanceof Error ? e.message : String(e) });\n            return { ok: false, reason: 'Account nonce fetch failed (address may be wrong or not deployed)', address: acct.address };\n        }\n    } catch (e) {\n        return { ok: false, reason: e instanceof Error ? e.message : String(e) };\n    }\n}\n\nexport function getSharedSwapAddress(): string | null {\n    if (!sharedSigner) getSharedSwapAccount();\n    return sharedAccount?.address || null;\n}\n\n// Transfer STRK from the shared account to a recipient (amount in Wei)\nexport async function transferStrkFromShared(to: string, amountWei: bigint): Promise<string> {\n    const acct = getSharedSwapAccountRaw();\n    if (!acct) throw new Error('Shared swap account not configured');\n\n    const token = PRIVACY_MIXER.STRK_TOKEN;\n    const call = {\n        contractAddress: token,\n        entrypoint: 'transfer',\n        calldata: CallData.compile([to, cairo.uint256(amountWei)])\n    } as const;\n\n    const res = await acct.execute([call]);\n    const txHash = (res as any).transaction_hash || (res as any).hash || 'unknown_tx';\n    console.log('🚚 Shared STRK forward transfer submitted:', { to, amountWei: amountWei.toString(), txHash });\n    return txHash;\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2572, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/CODE/SLPM-enhanced/src/orchestrator/steps/withdrawForMixing.ts"],"sourcesContent":["import { OrchestratorEvent } from '@/lib/types';\nimport { RealStarknetWalletClient } from '@/integrations/starknet/wallet';\nimport { ENV } from '@/config/env';\nimport { PRIVACY_MIXER, SHARED_SWAP_ACCOUNT_ADDRESS } from '@/config/constants';\nimport { hash, uint256, num } from 'starknet';\nimport { getSharedSwapAccount, getSharedSwapProvider, getSharedSwapAccountRaw } from '@/integrations/starknet/sharedAccount';\nimport { PrivacyMixerContract } from '@/integrations/starknet/privacy-mixer-contract';\n\nexport async function stepWithdrawForMixing(\n    depositResult: {\n        commitmentHash: string;\n        secret: string;\n        nullifier: string;\n        amount: number;\n        amountWei: string;\n        mixerContractAddress: string;\n        walletAddress: string;\n    },\n    onEvent: (e: OrchestratorEvent) => void\n) {\n    console.log('🔄 SLPM Withdraw: Starting immediate withdrawal for mixing pipeline');\n    console.log('🔄 SLPM Withdraw: Parameters:', {\n        commitment: depositResult.commitmentHash.slice(0, 10) + '...',\n        amount: depositResult.amount,\n        nullifier: depositResult.nullifier.slice(0, 10) + '...'\n    });\n\n    try {\n        onEvent({\n            type: 'deposit:preparing_withdrawal',\n            message: 'Preparing withdrawal for privacy mixing...',\n            progress: 25\n        });\n\n        // Prefer headless shared account if configured (avoids UI popups)\n        const sharedSigner = getSharedSwapAccount();\n        const sharedAccount = getSharedSwapAccountRaw();\n        let walletClient: RealStarknetWalletClient | null = null;\n        let directMixerContract: PrivacyMixerContract | null = null;\n\n        if (sharedSigner && sharedAccount) {\n            console.log('🔄 SLPM Withdraw: Using shared swap account for headless withdrawal');\n            // Directly construct mixer contract wrapper with shared account\n            const provider = getSharedSwapProvider();\n            if (!provider) {\n                throw new Error('Shared swap provider not initialized');\n            }\n            directMixerContract = new PrivacyMixerContract(\n                depositResult.mixerContractAddress,\n                sharedAccount,\n                provider\n            );\n        } else {\n            console.log('🔄 SLPM Withdraw: Shared account not configured, falling back to interactive wallet connection');\n            walletClient = new RealStarknetWalletClient(ENV.STARKNET_RPC);\n            await walletClient.connect();\n            await walletClient.initMixerContract(depositResult.mixerContractAddress);\n        }\n\n        // Create a temporary hot wallet address for the orchestrator to control the funds\n        // In production, this would be a dedicated orchestrator wallet\n        // For now, we'll withdraw to the same user wallet but this enables the next steps\n        const recipientAddress = SHARED_SWAP_ACCOUNT_ADDRESS; // central swap account (prototype)\n\n        console.log('🔄 SLPM Withdraw: Preparing withdrawal transaction...');\n        console.log('🔄 SLPM Withdraw: Withdrawal details (shared swap account):', {\n            nullifier: depositResult.nullifier.slice(0, 10) + '...',\n            commitment: depositResult.commitmentHash.slice(0, 10) + '...',\n            recipient: recipientAddress.slice(0, 10) + '...',\n            amount: depositResult.amountWei\n        });\n\n        // Generate ZK proof (same 3-element format as main withdraw step & e2e test)\n        console.log('🔄 SLPM Withdraw: Generating withdrawal proof (3-element format)...');\n\n        const amountBigInt = BigInt(depositResult.amountWei);\n        const recipientBigInt = BigInt(recipientAddress);\n\n        const amountUint256 = uint256.bnToUint256(amountBigInt);\n        const amountLow = BigInt(amountUint256.low);\n        const amountHigh = BigInt(amountUint256.high);\n\n        const recipientHash = hash.computePoseidonHashOnElements([recipientBigInt]);\n        const amountHash = hash.computePoseidonHashOnElements([amountLow, amountHigh]);\n\n        const proof: string[] = [\n            depositResult.secret,             // secret\n            num.toHex(recipientHash),          // recipient_hash\n            num.toHex(amountHash)              // amount_hash\n        ];\n\n        if (proof.length !== 3) {\n            throw new Error(`Generated proof length mismatch: expected 3, got ${proof.length}`);\n        }\n\n        console.log('🔄 SLPM Withdraw: Proof generated:', {\n            proofLength: proof.length,\n            elements: proof.map(p => p.slice(0, 10) + '...')\n        });\n\n        onEvent({\n            type: 'deposit:preparing_withdrawal',\n            message: 'Checking minimum mixing delay...',\n            progress: 25\n        });\n\n        // Check if enough time has passed since deposit for privacy requirements\n        // The NEW contract enforces a 4-second delay between deposit and withdrawal for testing\n        const MINIMUM_DELAY_SECONDS = 4; // 4 seconds as per new test contract deployment\n\n        console.log('🕐 SLPM Withdraw: Checking timing requirements...');\n        console.log('🕐 SLPM Withdraw: Contract requires 4 second delay between deposit and withdrawal');\n\n        // Wait the required delay to satisfy contract requirements\n        console.log('⏳ SLPM Withdraw: Waiting 4 seconds for mixing delay...');\n        await new Promise(resolve => setTimeout(resolve, MINIMUM_DELAY_SECONDS * 1000));\n\n        console.log('✅ SLPM Withdraw: Minimum delay satisfied, proceeding with withdrawal');\n\n        onEvent({\n            type: 'deposit:preparing_withdrawal',\n            message: 'Submitting withdrawal transaction...',\n            progress: 30\n        });\n\n        // Execute withdrawal from privacy mixer\n        console.log('🔄 SLPM Withdraw: Executing withdrawal from privacy mixer...');\n        let withdrawalResult: string;\n        if (directMixerContract) {\n            const tx = await directMixerContract.withdraw(\n                depositResult.nullifier,\n                depositResult.commitmentHash,\n                recipientAddress,\n                amountBigInt,\n                proof\n            );\n            withdrawalResult = tx.transaction_hash;\n        } else if (walletClient) {\n            withdrawalResult = await walletClient.withdrawFromMixer(\n                depositResult.nullifier,\n                depositResult.commitmentHash,\n                recipientAddress,\n                amountBigInt,\n                proof\n            );\n        } else {\n            throw new Error('No withdrawal pathway available');\n        }\n\n        console.log('🔄 SLPM Withdraw: Withdrawal transaction submitted:', withdrawalResult);\n\n        onEvent({\n            type: 'deposit:withdrawn_for_mixing',\n            message: `Withdrawal submitted: ${withdrawalResult}`,\n            progress: 35\n        });\n\n        // Wait for withdrawal confirmation\n        console.log('🔄 SLPM Withdraw: Waiting for withdrawal confirmation...');\n        let confirmedWithdrawal: any;\n        if (walletClient) {\n            confirmedWithdrawal = await walletClient.waitForTransaction(withdrawalResult);\n        } else {\n            // Poll provider via shared account\n            const provider = getSharedSwapProvider();\n            if (!provider) {\n                throw new Error('Shared swap provider not available for confirmation');\n            }\n            confirmedWithdrawal = await provider.waitForTransaction(withdrawalResult);\n        }\n        console.log('🔄 SLPM Withdraw: Withdrawal confirmed:', confirmedWithdrawal);\n\n        if (confirmedWithdrawal.status === 'REJECTED') {\n            throw new Error('Withdrawal transaction was rejected by the network');\n        }\n\n        onEvent({\n            type: 'deposit:withdrawn_for_mixing',\n            message: 'STRK successfully withdrawn from privacy mixer for mixing pipeline',\n            progress: 40\n        });\n\n        console.log('🔄 SLPM Withdraw: Step completed successfully');\n        console.log('🔄 SLPM Withdraw: Funds are now available for Lightning/Cashu mixing');\n\n        const txHash = (confirmedWithdrawal as any).transactionHash || (confirmedWithdrawal as any).transaction_hash || withdrawalResult;\n        console.log('🔄 SLPM Withdraw: Determined withdrawal tx hash:', txHash);\n        return {\n            withdrawalTxHash: txHash,\n            availableForSwap: true,\n            controllingWallet: recipientAddress,\n            amount: depositResult.amount,\n            amountWei: depositResult.amountWei,\n            originalDeposit: depositResult\n        };\n\n    } catch (error) {\n        console.error('❌ SLPM Withdraw: Step failed:', error);\n        onEvent({\n            type: 'deposit:error',\n            message: error instanceof Error ? error.message : 'Unknown withdrawal error'\n        });\n        throw error;\n    }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2743, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/CODE/SLPM-enhanced/src/integrations/cashu/client.ts"],"sourcesContent":["// Real Cashu client implementation using @cashu/cashu-ts\nimport { CashuMint, CashuWallet, MintQuoteState, Proof, getEncodedTokenV4, getDecodedToken } from '@cashu/cashu-ts';\nimport { EcashProof } from '../../domain';\n\nexport interface MintQuote {\n    quote: string;\n    amount: bigint;\n    state: 'CREATED' | 'PAID' | 'ISSUED';\n    request?: string; // Lightning payment request\n}\n\nexport interface MeltQuote {\n    quote: string;\n    amount: bigint;\n    fee_reserve: bigint;\n    unit?: string;\n    expiry?: number;\n    request?: string;\n}\n\nexport interface CashuClient {\n    // Core operations\n    createMintQuote(amount: bigint): Promise<MintQuote>;\n    checkMintQuote(quote: string): Promise<MintQuote>;\n    mintProofs(amount: bigint, quote: string): Promise<EcashProof[]>;\n\n    // Lightning operations\n    createMeltQuote(invoice: string): Promise<MeltQuote>;\n    meltProofs(quote: MeltQuote, proofs: EcashProof[]): Promise<{ change: EcashProof[] }>;\n\n    // Token operations\n    createToken(proofs: EcashProof[]): string;\n    receive(token: string): Promise<EcashProof[]>;\n\n    // Privacy operations\n    send(amount: bigint, proofs: EcashProof[]): Promise<{ keep: EcashProof[], send: EcashProof[] }>;\n\n    // Multi-mint support\n    getMintInfo(): Promise<{ name?: string, description?: string, version?: string }>;\n    getBalance(proofs: EcashProof[]): bigint;\n}\n\nexport class RealCashuClient implements CashuClient {\n    private mint: CashuMint;\n    private wallet: CashuWallet;\n    private initialized = false;\n    private mintUrl: string;\n\n    constructor(mintUrl: string) {\n        this.mintUrl = mintUrl;\n        this.mint = new CashuMint(mintUrl);\n        this.wallet = new CashuWallet(this.mint);\n\n        // For Node.js environments, add better error handling\n        if (typeof window === 'undefined') {\n            console.log(`🪙 Initializing Cashu client for testnet mint: ${mintUrl}`);\n        }\n    }\n\n    private async ensureInitialized(): Promise<void> {\n        if (!this.initialized) {\n            try {\n                console.log(`🔗 Connecting to Cashu mint: ${this.mintUrl}`);\n                await this.wallet.loadMint();\n                this.initialized = true;\n                console.log(`✅ Cashu mint connected successfully`);\n            } catch (error) {\n                console.warn(`⚠️ Failed to connect to Cashu mint: ${error instanceof Error ? error.message : String(error)}`);\n                throw new Error(`Cashu mint connection failed: ${error instanceof Error ? error.message : 'Unknown error'}`);\n            }\n        }\n    }\n\n    async createMintQuote(amount: bigint): Promise<MintQuote> {\n        await this.ensureInitialized();\n        const mintQuote = await this.wallet.createMintQuote(Number(amount));\n\n        return {\n            quote: mintQuote.quote,\n            amount: BigInt(mintQuote.amount),\n            state: mintQuote.state === MintQuoteState.PAID ? 'PAID' :\n                mintQuote.state === MintQuoteState.ISSUED ? 'ISSUED' : 'CREATED',\n            request: mintQuote.request\n        };\n    }\n\n    async checkMintQuote(quote: string): Promise<MintQuote> {\n        await this.ensureInitialized();\n        const mintQuote = await this.wallet.checkMintQuote(quote);\n\n        return {\n            quote: mintQuote.quote,\n            amount: BigInt(mintQuote.amount || 0),\n            state: mintQuote.state === MintQuoteState.PAID ? 'PAID' :\n                mintQuote.state === MintQuoteState.ISSUED ? 'ISSUED' : 'CREATED',\n            request: mintQuote.request\n        };\n    }\n\n    async mintProofs(amount: bigint, quote: string): Promise<EcashProof[]> {\n        await this.ensureInitialized();\n        const proofs = await this.wallet.mintProofs(Number(amount), quote);\n\n        return proofs.map(this.convertToEcashProof);\n    }\n\n    async createMeltQuote(invoice: string): Promise<MeltQuote> {\n        await this.ensureInitialized();\n        // If running in browser, proxy via Next API to avoid CORS\n        if (typeof window !== 'undefined') {\n            const res = await fetch('/api/cashu/melt-quote', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({ invoice, mintUrl: this.mintUrl })\n            });\n            if (!res.ok) throw new Error(`melt-quote failed: ${await res.text()}`);\n            const meltQuote = await res.json();\n            return {\n                quote: meltQuote.quote,\n                amount: BigInt(meltQuote.amount),\n                fee_reserve: BigInt(meltQuote.fee_reserve),\n                unit: meltQuote.unit,\n                expiry: meltQuote.expiry,\n                request: meltQuote.request\n            };\n        }\n        const meltQuote = await this.wallet.createMeltQuote(invoice);\n\n        return {\n            quote: meltQuote.quote,\n            amount: BigInt(meltQuote.amount),\n            fee_reserve: BigInt(meltQuote.fee_reserve),\n            unit: meltQuote.unit,\n            expiry: meltQuote.expiry,\n            request: meltQuote.request\n        };\n    }\n\n    async meltProofs(quote: MeltQuote, proofs: EcashProof[]): Promise<{ change: EcashProof[] }> {\n        await this.ensureInitialized();\n        const cashuProofs = proofs.map(this.convertFromEcashProof);\n        // If running in browser, proxy via Next API to avoid CORS\n        if (typeof window !== 'undefined') {\n            console.log('🔧 [Cashu Client] Browser path: preparing melt request...', {\n                quoteId: quote.quote?.substring(0, 20) + '...',\n                proofsCount: cashuProofs.length,\n                totalAmount: cashuProofs.reduce((sum, p) => sum + Number(p.amount), 0),\n                mintUrl: this.mintUrl\n            });\n\n            // Avoid BigInt serialization issues by converting to strings\n            const serializableQuote = {\n                quote: quote.quote,\n                amount: quote.amount.toString(),\n                fee_reserve: quote.fee_reserve.toString(),\n                unit: quote.unit,\n                expiry: quote.expiry,\n                request: quote.request\n            };\n\n            console.log('⚡ [Cashu Client] Sending melt request to server proxy...', {\n                proofsFormat: cashuProofs.length > 0 ? {\n                    firstProofFields: Object.keys(cashuProofs[0]),\n                    firstProofAmount: cashuProofs[0].amount,\n                    firstProofAmountType: typeof cashuProofs[0].amount\n                } : 'no proofs'\n            });\n            const res = await fetch('/api/cashu/melt', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({ quote: serializableQuote, proofs: cashuProofs, mintUrl: this.mintUrl })\n            });\n\n            if (!res.ok) {\n                const errorText = await res.text();\n                console.error('❌ [Cashu Client] Melt request failed:', {\n                    status: res.status,\n                    statusText: res.statusText,\n                    error: errorText\n                });\n                throw new Error(`melt failed: ${errorText}`);\n            }\n\n            const payload = await res.json();\n            console.log('✅ [Cashu Client] Melt response received:', {\n                changeProofs: payload.change?.length || 0,\n                changeAmount: payload.change?.reduce((sum: number, p: any) => sum + p.amount, 0) || 0\n            });\n\n            const change = (payload.change || []).map(this.convertToEcashProof);\n            return { change };\n        }\n\n        // Node/server path: call mint directly\n        const meltQuoteResponse = {\n            quote: quote.quote,\n            amount: Number(quote.amount),\n            fee_reserve: Number(quote.fee_reserve),\n            state: 'UNPAID' as const,\n            expiry: Math.floor(Date.now() / 1000) + 3600,\n            payment_preimage: null,\n            request: '',\n            unit: 'sat'\n        };\n        const meltResponse = await this.wallet.meltProofs(meltQuoteResponse, cashuProofs);\n        return { change: meltResponse.change?.map(this.convertToEcashProof) || [] };\n    }\n\n    async send(amount: bigint, proofs: EcashProof[]): Promise<{ keep: EcashProof[], send: EcashProof[] }> {\n        await this.ensureInitialized();\n        const cashuProofs = proofs.map(this.convertFromEcashProof);\n        const { keep, send } = await this.wallet.send(Number(amount), cashuProofs);\n\n        return {\n            keep: keep.map(this.convertToEcashProof),\n            send: send.map(this.convertToEcashProof)\n        };\n    }\n\n    createToken(proofs: EcashProof[]): string {\n        const cashuProofs = proofs.map(this.convertFromEcashProof);\n        return getEncodedTokenV4({\n            mint: this.mint.mintUrl,\n            proofs: cashuProofs\n        });\n    }\n\n    async receive(token: string): Promise<EcashProof[]> {\n        await this.ensureInitialized();\n        const receiveProofs = await this.wallet.receive(token);\n        return receiveProofs.map(this.convertToEcashProof);\n    }\n\n    async getMintInfo(): Promise<{ name?: string, description?: string, version?: string }> {\n        await this.ensureInitialized();\n        const info = await this.mint.getInfo();\n        return {\n            name: info.name,\n            description: info.description,\n            version: info.version\n        };\n    }\n\n    getBalance(proofs: EcashProof[]): bigint {\n        return proofs.reduce((sum, proof) => sum + proof.amount, 0n);\n    }\n\n    // Utility methods for proof conversion\n    private convertToEcashProof(proof: Proof): EcashProof {\n        return {\n            secret: proof.secret,\n            signature: proof.C,\n            amount: BigInt(proof.amount),\n            currency: 'SAT',\n            keysetId: proof.id\n        };\n    }\n\n    private convertFromEcashProof(proof: EcashProof): Proof {\n        return {\n            secret: proof.secret,\n            C: proof.signature,\n            amount: Number(proof.amount),\n            id: proof.keysetId\n        };\n    }\n}\n\n// Multi-mint manager for routing diversification\nexport class MultiMintCashuManager {\n    private clients: Map<string, RealCashuClient> = new Map();\n    private mintUrls: string[];\n\n    constructor(mintUrls: string[]) {\n        this.mintUrls = mintUrls;\n        mintUrls.forEach(url => {\n            this.clients.set(url, new RealCashuClient(url));\n        });\n    }\n\n    // Select mint based on privacy strategy (random selection for now)\n    selectMint(): RealCashuClient {\n        const randomIndex = Math.floor(Math.random() * this.mintUrls.length);\n        const selectedUrl = this.mintUrls[randomIndex];\n        return this.clients.get(selectedUrl)!;\n    }\n\n    // Get all mints for distributed operations\n    getAllMints(): RealCashuClient[] {\n        return Array.from(this.clients.values());\n    }\n\n    // Split tokens across multiple mints for privacy\n    async distributeSend(\n        totalAmount: bigint,\n        proofs: EcashProof[],\n        numberOfMints: number = 2\n    ): Promise<{ distributions: Array<{ mint: RealCashuClient, proofs: EcashProof[] }> }> {\n        const mintsToUse = this.mintUrls.slice(0, numberOfMints);\n        const amountPerMint = totalAmount / BigInt(numberOfMints);\n        const distributions = [];\n\n        for (const mintUrl of mintsToUse) {\n            const client = this.clients.get(mintUrl)!;\n            // In real implementation, would need to convert proofs between mints\n            // For now, just distribute existing proofs\n            const relevantProofs = proofs.filter(p =>\n                this.getBalance([p]) <= amountPerMint\n            );\n            distributions.push({ mint: client, proofs: relevantProofs });\n        }\n\n        return { distributions };\n    }\n\n    private getBalance(proofs: EcashProof[]): bigint {\n        return proofs.reduce((sum, proof) => sum + proof.amount, 0n);\n    }\n}\n\n// Legacy mock client for backward compatibility\nexport class MockCashuClient implements CashuClient {\n    async createMintQuote(amount: bigint): Promise<MintQuote> {\n        return { quote: `q_${Date.now()}`, amount, state: 'CREATED' };\n    }\n    async checkMintQuote(quote: string): Promise<MintQuote> {\n        return { quote, amount: 0n, state: 'PAID' };\n    }\n    async mintProofs(amount: bigint, quote: string): Promise<EcashProof[]> {\n        const proof: EcashProof = {\n            secret: `sec_${quote}`,\n            signature: `sig_${quote}`,\n            amount,\n            currency: 'SAT',\n            keysetId: 'mock',\n        };\n        return [proof];\n    }\n    async createMeltQuote(invoice: string): Promise<MeltQuote> {\n        return { quote: `melt_${Date.now()}`, amount: 1000n, fee_reserve: 10n };\n    }\n    async meltProofs(_quote: MeltQuote, _proofs: EcashProof[]): Promise<{ change: EcashProof[] }> {\n        return { change: [] };\n    }\n    createToken(_proofs: EcashProof[]): string {\n        return 'mock_token';\n    }\n    async receive(_token: string): Promise<EcashProof[]> {\n        return [];\n    }\n    async send(amount: bigint, proofs: EcashProof[]): Promise<{ keep: EcashProof[], send: EcashProof[] }> {\n        return { keep: proofs, send: [] };\n    }\n    async getMintInfo(): Promise<{ name?: string, description?: string, version?: string }> {\n        return { name: 'Mock Mint', description: 'Test mint', version: '1.0.0' };\n    }\n    getBalance(proofs: EcashProof[]): bigint {\n        return proofs.reduce((sum, proof) => sum + proof.amount, 0n);\n    }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3067, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/CODE/SLPM-enhanced/src/orchestrator/steps/createMintInvoice.ts"],"sourcesContent":["import { OrchestratorEvent } from '@/lib/types';\nimport { MultiMintCashuManager, RealCashuClient } from '@/integrations/cashu/client';\nimport { ENV } from '@/config/env';\n\nexport async function stepCreateMintInvoice(\n    sats: number,\n    onEvent: (e: OrchestratorEvent) => void\n) {\n    console.log('🏦 SLPM MintInvoice: Starting mint invoice creation');\n    console.log('🏦 SLPM MintInvoice: Amount:', sats, 'sats');\n\n    try {\n        onEvent({\n            type: 'mix:progress',\n            message: `Creating Cashu mint invoice for ${sats} sats...`,\n            progress: 15\n        });\n\n        // Initialize Cashu manager/client\n        console.log('🏦 SLPM MintInvoice: Initializing Cashu services...');\n        console.log('🏦 SLPM MintInvoice: Available mints:', ENV.CASHU_MINTS.length);\n        console.log('🏦 SLPM MintInvoice: Default mint:', ENV.CASHU_DEFAULT_MINT);\n\n        const cashuManager = ENV.CASHU_MINTS.length ? new MultiMintCashuManager(ENV.CASHU_MINTS) : null;\n        const cashu = cashuManager ? cashuManager.selectMint() : new RealCashuClient(ENV.CASHU_DEFAULT_MINT);\n\n        console.log('🏦 SLPM MintInvoice: Cashu client type:', cashuManager ? 'Multi-mint manager' : 'Single mint');\n\n        // Create mint quote (this generates the Lightning invoice)\n        console.log('🏦 SLPM MintInvoice: Creating mint quote...');\n        const mintQuote = await cashu.createMintQuote(BigInt(sats));\n\n        console.log('🏦 SLPM MintInvoice: Mint quote created:', {\n            quote: mintQuote.quote,\n            amount: mintQuote.amount.toString(),\n            state: mintQuote.state,\n            invoice: mintQuote.request?.slice(0, 50) + '...'\n        });\n\n        if (!mintQuote.request) {\n            throw new Error('Cashu mint did not provide Lightning invoice');\n        }\n\n        onEvent({\n            type: 'mix:progress',\n            message: 'Cashu mint invoice created successfully',\n            progress: 20\n        });\n\n        console.log('🏦 SLPM MintInvoice: Invoice ready for Atomiq payment');\n        console.log('🏦 SLPM MintInvoice: Step completed successfully');\n\n        return {\n            cashu,\n            cashuManager,\n            mintQuote,\n            lightningInvoice: mintQuote.request,\n            amount: sats\n        };\n\n    } catch (error) {\n        console.error('❌ SLPM MintInvoice: Step failed:', error);\n        console.error('🔍 SLPM MintInvoice: Error details:', {\n            message: error instanceof Error ? error.message : 'Unknown error',\n            stack: error instanceof Error ? error.stack : undefined,\n            context: {\n                sats,\n                mintUrl: ENV.CASHU_DEFAULT_MINT,\n                mintsAvailable: ENV.CASHU_MINTS.length\n            }\n        });\n\n        onEvent({\n            type: 'mix:error',\n            message: error instanceof Error ? error.message : 'Unknown mint invoice error'\n        });\n        throw error;\n    }\n}\n"],"names":[],"mappings":";;;;AACA;AACA;;;AAEO,eAAe,sBAClB,IAAY,EACZ,OAAuC;IAEvC,QAAQ,GAAG,CAAC;IACZ,QAAQ,GAAG,CAAC,gCAAgC,MAAM;IAElD,IAAI;YAyBa;QAxBb,QAAQ;YACJ,MAAM;YACN,SAAS,AAAC,mCAAuC,OAAL,MAAK;YACjD,UAAU;QACd;QAEA,kCAAkC;QAClC,QAAQ,GAAG,CAAC;QACZ,QAAQ,GAAG,CAAC,yCAAyC,8HAAG,CAAC,WAAW,CAAC,MAAM;QAC3E,QAAQ,GAAG,CAAC,sCAAsC,8HAAG,CAAC,kBAAkB;QAExE,MAAM,eAAe,8HAAG,CAAC,WAAW,CAAC,MAAM,GAAG,IAAI,kKAAqB,CAAC,8HAAG,CAAC,WAAW,IAAI;QAC3F,MAAM,QAAQ,eAAe,aAAa,UAAU,KAAK,IAAI,4JAAe,CAAC,8HAAG,CAAC,kBAAkB;QAEnG,QAAQ,GAAG,CAAC,2CAA2C,eAAe,uBAAuB;QAE7F,2DAA2D;QAC3D,QAAQ,GAAG,CAAC;QACZ,MAAM,YAAY,MAAM,MAAM,eAAe,CAAC,OAAO;QAErD,QAAQ,GAAG,CAAC,4CAA4C;YACpD,OAAO,UAAU,KAAK;YACtB,QAAQ,UAAU,MAAM,CAAC,QAAQ;YACjC,OAAO,UAAU,KAAK;YACtB,SAAS,EAAA,qBAAA,UAAU,OAAO,cAAjB,yCAAA,mBAAmB,KAAK,CAAC,GAAG,OAAM;QAC/C;QAEA,IAAI,CAAC,UAAU,OAAO,EAAE;YACpB,MAAM,IAAI,MAAM;QACpB;QAEA,QAAQ;YACJ,MAAM;YACN,SAAS;YACT,UAAU;QACd;QAEA,QAAQ,GAAG,CAAC;QACZ,QAAQ,GAAG,CAAC;QAEZ,OAAO;YACH;YACA;YACA;YACA,kBAAkB,UAAU,OAAO;YACnC,QAAQ;QACZ;IAEJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,oCAAoC;QAClD,QAAQ,KAAK,CAAC,uCAAuC;YACjD,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;YAClD,OAAO,iBAAiB,QAAQ,MAAM,KAAK,GAAG;YAC9C,SAAS;gBACL;gBACA,SAAS,8HAAG,CAAC,kBAAkB;gBAC/B,gBAAgB,8HAAG,CAAC,WAAW,CAAC,MAAM;YAC1C;QACJ;QAEA,QAAQ;YACJ,MAAM;YACN,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACtD;QACA,MAAM;IACV;AACJ","debugId":null}},
    {"offset": {"line": 3143, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/CODE/SLPM-enhanced/src/integrations/swaps/atomiq.ts"],"sourcesContent":["// Real Atomiq swap integration using @atomiqlabs/sdk - Starknet + Lightning only\nimport {\n    BitcoinNetwork,\n    SwapperFactory,\n    ToBTCSwapState,\n    FromBTCLNSwapState\n} from '@atomiqlabs/sdk';\nimport * as bolt11 from 'bolt11';\nimport {\n    StarknetInitializer,\n    StarknetInitializerType,\n    StarknetSigner,\n    RpcProviderWithRetries,\n    StarknetFees\n} from '@atomiqlabs/chain-starknet';\nimport { ENV, getStarknetRpc } from '@/config/env';\nimport { getSharedSwapAccount } from '../starknet/sharedAccount';\n\n// Simple result type for focused Starknet ↔ Lightning swaps\ninterface SwapResult {\n    success: boolean;\n    txId?: string;\n    amount: number;\n    fromCurrency: string;\n    toCurrency: string;\n    route: string;\n    error?: string;\n}\n\nexport interface AtomiqSwapQuote {\n    id: string;\n    from: 'STRK' | 'BTC' | 'BTC_LN';\n    to: 'STRK' | 'BTC' | 'BTC_LN';\n    amountIn: bigint;\n    amountOut: bigint;\n    fee: bigint;\n    swapPrice: number;\n    marketPrice: number;\n    difference: number;\n    expiry: number;\n    createdAt: number;\n}\n\nexport type AtomiqSwapStatus =\n    | 'CREATED'\n    | 'QUOTED'\n    | 'COMMITED'\n    | 'SOFT_CLAIMED'\n    | 'CLAIMED'\n    | 'REFUNDED'\n    | 'REFUNDABLE'\n    | 'EXPIRED'\n    | 'FAILED';\n\nexport interface AtomiqSwapExecution {\n    id: string;\n    txId?: string;\n    status: AtomiqSwapStatus;\n    amountOut?: bigint;\n    errorCode?: string;\n    errorMessage?: string;\n    lightningPaymentHash?: string;\n    bitcoinAddress?: string;\n    lightningInvoice?: string;\n}\n\nexport interface AtomiqSwapClient {\n    // Core swap operations\n    getQuote(from: AtomiqSwapQuote['from'], to: AtomiqSwapQuote['to'], amount: bigint, exactIn?: boolean, destinationAddress?: string): Promise<AtomiqSwapQuote>;\n    execute(quoteId: string, walletSigner?: any, lightningInvoice?: string): Promise<AtomiqSwapExecution>;\n    getStatus(executionId: string): Promise<AtomiqSwapExecution>;\n\n    // Advanced operations\n    refund(executionId: string, walletSigner?: any): Promise<{ txId: string }>;\n    waitForCompletion(executionId: string, timeoutMs?: number): Promise<boolean>;\n\n    // Lightning-specific operations\n    getInvoice(executionId: string): Promise<string>;\n    payInvoice(invoice: string, walletSigner?: any): Promise<{ preimage: string }>;\n\n    // Swap limits and info\n    getSwapLimits(from: string, to: string): Promise<{ min: bigint; max: bigint }>;\n}\n\nexport class RealAtomiqSwapClient implements AtomiqSwapClient {\n    private swapper: any = null;\n    private factory: SwapperFactory<[StarknetInitializerType]> | null = null;\n    private initialized: boolean = false;\n    private network: 'MAINNET' | 'TESTNET';\n    private starknetRpc: string;\n    private isNodeJs: boolean;\n    private tokens: any = null;\n    private initializationPromise: Promise<void> | null = null;\n\n    constructor(network: 'MAINNET' | 'TESTNET' = ENV.NETWORK as 'MAINNET' | 'TESTNET', starknetRpc?: string) {\n        this.network = network;\n        this.starknetRpc = starknetRpc || getStarknetRpc();\n        this.isNodeJs = typeof window === 'undefined';\n\n        console.log(`🚀 Initializing Atomiq client for ${network} using RPC: ${this.starknetRpc}`);\n\n        // Only initialize in browser environment to avoid SSR issues\n        if (!this.isNodeJs) {\n            this.initializeForBrowser();\n        } else {\n            console.log('⚠️ Node.js environment detected - Atomiq SDK will initialize when needed');\n        }\n    }\n\n    private async initializeForBrowser(): Promise<void> {\n        try {\n            // Create factory with Starknet-only support (no Solana)\n            this.factory = new SwapperFactory<[StarknetInitializerType]>([StarknetInitializer] as const);\n            this.tokens = this.factory.Tokens;\n\n            // Start initialization (async)\n            this.initializationPromise = this.initializeAtomiqFactory();\n        } catch (error) {\n            console.error('❌ Failed to create Atomiq factory:', error);\n        }\n    }\n\n    private setupTestMode(): void {\n        if (this.isNodeJs) {\n            console.log('📋 Test mode setup: Atomiq SDK requires browser environment');\n            return;\n        }\n\n        // No simulation mode - user explicitly disabled it\n        this.initialized = false;\n        console.error('❌ Atomiq SDK initialization failed and simulation mode is disabled');\n        throw new Error('Atomiq SDK initialization failed - simulation mode disabled');\n    }\n\n    private async initializeAtomiqFactory(): Promise<void> {\n        try {\n            console.log('🔧 Initializing Atomiq SDK with Starknet + Lightning support...');\n\n            if (!this.factory) {\n                throw new Error('Factory not initialized - browser environment required');\n            }\n\n            // Create swapper configuration matching the demo pattern\n            const starknetRpc = new RpcProviderWithRetries({ nodeUrl: this.starknetRpc });\n\n            const swapperConfig: any = {\n                chains: {\n                    STARKNET: {\n                        rpcUrl: starknetRpc,\n                        fees: new StarknetFees(starknetRpc)\n                    }\n                },\n                bitcoinNetwork: this.network === 'MAINNET' ? BitcoinNetwork.MAINNET : BitcoinNetwork.TESTNET\n            };\n\n            // For Node.js environments, use simple memory storage to avoid SQLite dependency issues\n            if (this.isNodeJs) {\n                console.log('✅ Using memory storage for Node.js testing environment');\n                // Use default in-memory storage for simplicity\n            }\n\n            console.log('✅ Configured storage for privacy mixer environment');\n\n            // Create swapper using factory with Starknet-only configuration\n            this.swapper = this.factory.newSwapper(swapperConfig);\n            console.log('✅ Atomiq Swapper created for Starknet ↔ Lightning');\n\n            // Initialize the swapper\n            await this.swapper.init();\n\n            console.log('✅ Atomiq SDK initialized - ready for STRK ↔ Lightning swaps');\n\n            this.initialized = true;\n\n        } catch (error) {\n            console.error('❌ Failed to initialize Atomiq SDK:', error instanceof Error ? error.message : String(error));\n            console.error('Full error:', error);\n            throw error; // Don't fall back to simulation as requested\n        }\n    }\n\n    private async ensureInitialized(): Promise<void> {\n        if (this.isNodeJs) {\n            throw new Error('Atomiq SDK requires browser environment - Node.js not supported');\n        }\n\n        if (this.initialized) {\n            return;\n        }\n\n        if (this.initializationPromise) {\n            await this.initializationPromise;\n            return;\n        }\n\n        throw new Error('Atomiq SDK not initialized and no initialization promise found');\n    }\n\n    /**\n     * Execute Starknet to Lightning swap for privacy mixing\n     * Converts STRK to Lightning for enhanced privacy\n     */\n    async swapStrkToLightning(amount: number, lightningInvoice: string, sourceAddress: string): Promise<SwapResult> {\n        try {\n            await this.ensureInitialized();\n\n            // Preflight: fetch STRK input limits to avoid 'Amount too high' from SDK\n            try {\n                const limits = await this.getSwapLimits('STRK', 'BTC_LN');\n                const invoiceDecoded = (() => { try { return bolt11.decode(lightningInvoice); } catch { return null; } })();\n                const invoiceMsats = invoiceDecoded?.millisatoshis ? BigInt(invoiceDecoded.millisatoshis) : undefined;\n                const invoiceSats = invoiceMsats ? Number(invoiceMsats / 1000n) : undefined;\n\n                // Note: limits are for STRK input, but we only know Lightning output amount\n                // The SDK will calculate required STRK input based on current exchange rates\n                // For now, just log the values for debugging\n                console.log('🔍 Preflight limits check (STRK input limits):', {\n                    invoiceSats,\n                    strkMaxLimit: limits.max.toString(),\n                    strkMinLimit: limits.min.toString(),\n                    note: 'STRK input will be calculated by SDK based on invoice amount'\n                });\n\n                // Skip input validation since we don't know STRK input amount yet\n                // Let the SDK handle the validation and conversion\n\n            } catch (preflight_error) {\n                console.warn('⚠️ Preflight limits check failed, proceeding with swap:', preflight_error);\n            }\n\n            console.log(`🔄 Starting STRK → Lightning swap for amount: ${amount}`);\n            // Normalize Starknet source address (felt252) to 0x + 64 hex chars\n            let normalizedSource = sourceAddress.trim().toLowerCase();\n            if (!normalizedSource.startsWith('0x')) {\n                normalizedSource = '0x' + normalizedSource;\n            }\n            const hexBody = normalizedSource.slice(2);\n            if (!/^[0-9a-f]+$/.test(hexBody)) {\n                return {\n                    success: false,\n                    amount,\n                    fromCurrency: 'STRK',\n                    toCurrency: 'Lightning',\n                    route: 'starknet-to-lightning',\n                    error: 'Source Starknet address contains non-hex characters'\n                };\n            }\n            if (hexBody.length < 64) {\n                normalizedSource = '0x' + hexBody.padStart(64, '0');\n            } else if (hexBody.length > 64) {\n                // Some wallets return full felt length already (<= 64). If >64 it's invalid here.\n                return {\n                    success: false,\n                    amount,\n                    fromCurrency: 'STRK',\n                    toCurrency: 'Lightning',\n                    route: 'starknet-to-lightning',\n                    error: 'Source Starknet address length invalid (>64 hex chars)'\n                };\n            }\n            console.log('🧾 Normalized Starknet source address:', normalizedSource);\n            // We now expect a BOLT11 invoice generated upstream (e.g. Cashu mint quote)\n            const invoice = lightningInvoice.trim();\n            const bolt11Pattern = /^(lnbc|lntb|lnbcrt)[0-9a-z]+$/i;\n            const isBolt11 = bolt11Pattern.test(invoice);\n            if (!isBolt11) {\n                return {\n                    success: false,\n                    amount,\n                    fromCurrency: 'STRK',\n                    toCurrency: 'Lightning',\n                    route: 'starknet-to-lightning',\n                    error: 'Provided value is not a valid BOLT11 invoice. Generate invoice from Cashu mint first.'\n                };\n            }\n\n            // Decode BOLT11 invoice to inspect amount\n            let satsFromInvoice: bigint | undefined;\n            try {\n                const decoded = bolt11.decode(invoice);\n                const msats = decoded.millisatoshis;\n                if (!msats) {\n                    return {\n                        success: false,\n                        amount,\n                        fromCurrency: 'STRK',\n                        toCurrency: 'Lightning',\n                        route: 'starknet-to-lightning',\n                        error: 'Invoice missing fixed amount (amountless invoices not supported yet)'\n                    };\n                }\n                satsFromInvoice = BigInt(msats) / BigInt(1000);\n                if (satsFromInvoice === BigInt(0)) {\n                    return {\n                        success: false,\n                        amount,\n                        fromCurrency: 'STRK',\n                        toCurrency: 'Lightning',\n                        route: 'starknet-to-lightning',\n                        error: 'Invoice amount is zero'\n                    };\n                }\n                console.log(`🧾 Invoice amount parsed: ${satsFromInvoice.toString()} sats`);\n            } catch (e) {\n                const msg = e instanceof Error ? e.message : String(e);\n                return {\n                    success: false,\n                    amount,\n                    fromCurrency: 'STRK',\n                    toCurrency: 'Lightning',\n                    route: 'starknet-to-lightning',\n                    error: `Failed to decode invoice: ${msg}`\n                };\n            }\n\n            // For Lightning invoices: must use exactOut semantics (Atomiq SDK requirement)\n            // We specify the Lightning output amount (from invoice) and let SDK calculate required STRK input\n            const exactIn = false;\n\n            console.log(`🔄 Creating STRK → Lightning swap (exactOut): ${satsFromInvoice.toString()} sats output`);\n\n            // Create STRK -> Lightning swap using proper Atomiq pattern from demo\n            const swap = await this.swapper.swap(\n                this.tokens.STARKNET.STRK,     // From STRK\n                this.tokens.BITCOIN.BTCLN,     // To Lightning\n                undefined,                     // Amount NOT specified - taken from invoice!\n                false,                         // exactIn = false for Lightning (demo pattern)\n                normalizedSource,              // Source address\n                invoice                        // Lightning invoice\n            );\n\n            console.log('✅ STRK → Lightning swap created:', swap.getId());\n            console.log('📊 Swap details:');\n            console.log('   Input: ' + swap.getInputWithoutFee());\n            console.log('   Fees: ' + swap.getFee().amountInSrcToken);\n            console.log('   Total input: ' + swap.getInput());\n            console.log('   Output: ' + swap.getOutput());\n            console.log('   Quote expiry: ' + swap.getQuoteExpiry() + ' (in ' + (swap.getQuoteExpiry() - Date.now()) / 1000 + ' seconds)');\n\n            // Use shared swap account signer if configured\n            const sharedSigner = getSharedSwapAccount();\n            if (sharedSigner) {\n                console.log('🔐 Committing swap with shared account:', sharedSigner.getAddress().slice(0, 10) + '...');\n                await swap.commit(sharedSigner);\n            } else {\n                throw new Error('No shared swap account configured - cannot commit swap');\n            }\n\n            // Wait for the Lightning payment to complete\n            console.log('⏳ Waiting for Lightning payment...');\n            const success = await swap.waitForPayment();\n\n            if (success) {\n                return {\n                    success: true,\n                    txId: swap.getBitcoinTxId?.() || swap.getId(),\n                    amount,\n                    fromCurrency: 'STRK',\n                    toCurrency: 'Lightning',\n                    route: 'starknet-to-lightning'\n                };\n            } else {\n                // Payment failed - refund the swap\n                console.log('💸 Lightning payment failed, refunding...');\n                if (sharedSigner) {\n                    await swap.refund(sharedSigner);\n                    console.log('✅ Swap refunded successfully');\n                }\n                return {\n                    success: false,\n                    amount,\n                    fromCurrency: 'STRK',\n                    toCurrency: 'Lightning',\n                    route: 'starknet-to-lightning',\n                    error: 'Lightning payment failed and refunded'\n                };\n            }\n\n        } catch (error) {\n            let errorMessage = error instanceof Error ? error.message : String(error);\n            if (/amount too high/i.test(errorMessage)) {\n                try {\n                    const limits = await this.getSwapLimits('STRK', 'BTC_LN');\n                    errorMessage = `${errorMessage} (max sats: ${limits.max.toString()}, consider reducing invoice amount)`;\n                } catch {/* ignore */ }\n            }\n            console.error('❌ STRK → Lightning swap failed:', errorMessage);\n\n            return {\n                success: false,\n                error: errorMessage,\n                amount,\n                fromCurrency: 'STRK',\n                toCurrency: 'Lightning',\n                route: 'starknet-to-lightning'\n            };\n        }\n    }\n\n    /**\n     * Execute Lightning to Starknet swap for final transfer\n     * Converts Lightning back to STRK for recipient\n     */\n    async swapLightningToStrk(amount: number, recipientAddress: string): Promise<SwapResult> {\n        try {\n            await this.ensureInitialized();\n\n            console.log(`🔄 Starting Lightning → STRK swap for amount: ${amount}`);\n\n            // Create Lightning -> STRK swap\n            const swap = await this.swapper.swap(\n                this.tokens.BITCOIN.BTCLN,    // From: Lightning Network\n                this.tokens.STARKNET.STRK,    // To: STRK token\n                BigInt(amount),               // Amount in smallest unit\n                true,                         // exactIn = true\n                undefined,                    // Source address (Lightning invoice generated)\n                recipientAddress              // Destination Starknet address\n            );\n\n            console.log('✅ Lightning → STRK swap created:', swap.getId());\n\n            // Get the Lightning invoice to pay\n            const invoice = swap.getAddress();\n            console.log('💰 Lightning invoice to pay:', invoice);\n\n            // For testing, we'll simulate the Lightning payment\n            // In production, this would integrate with your Lightning node\n            await this.simulateLightningPayment(invoice);\n\n            // Wait for swap completion\n            const result = await swap.waitForPayment();\n\n            if (result) {\n                return {\n                    success: true,\n                    txId: swap.getBitcoinTxId?.() || swap.getId(),\n                    amount,\n                    fromCurrency: 'Lightning',\n                    toCurrency: 'STRK',\n                    route: 'lightning-to-starknet'\n                };\n            } else {\n                throw new Error('Swap execution failed');\n            }\n\n        } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : String(error);\n            console.error('❌ Lightning → STRK swap failed:', errorMessage);\n\n            return {\n                success: false,\n                error: errorMessage,\n                amount,\n                fromCurrency: 'Lightning',\n                toCurrency: 'STRK',\n                route: 'lightning-to-starknet'\n            };\n        }\n    }\n\n    /**\n     * Begin a Lightning → STRK swap and return the BOLT11 invoice without simulating payment.\n     * Use this when an external payer (e.g., Cashu melt) will pay the invoice.\n     */\n    async beginLightningToStrkSwap(amount: number, recipientAddress: string): Promise<{ id: string; invoice: string }> {\n        await this.ensureInitialized();\n\n        console.log(`🔄 (begin) Lightning → STRK swap for amount: ${amount}`);\n\n        const swap = await this.swapper.swap(\n            this.tokens.BITCOIN.BTCLN,    // From: Lightning Network\n            this.tokens.STARKNET.STRK,    // To: STRK token\n            BigInt(amount),               // Amount in sats (smallest unit)\n            true,                         // exactIn = true (LN amount is input)\n            undefined,                    // Source address (not needed for LN)\n            recipientAddress              // Destination Starknet address\n        );\n\n        const invoice = swap.getAddress();\n        const id = swap.getId();\n\n        console.log('✅ (begin) Lightning invoice created:', { id, invoice: typeof invoice === 'string' ? invoice.slice(0, 50) + '…' : String(invoice) });\n        return { id, invoice };\n    }\n\n    /**\n     * Wait for a previously created Lightning → STRK swap to complete after external payment.\n     */\n    async waitLightningToStrkCompletion(id: string, timeoutMs: number = 300000): Promise<boolean> {\n        return this.waitForCompletion(id, timeoutMs);\n    }\n\n    /**\n     * Claim a Lightning → STRK swap on Starknet after the LN invoice is paid.\n     * Uses the shared Starknet account to sign commit/claim transactions.\n     */\n    async claimLightningToStrkSwap(id: string): Promise<{ txId?: string }> {\n        await this.ensureInitialized();\n\n        if (!this.swapper || !this.initialized) {\n            throw new Error('Atomiq SDK not initialized - simulation mode disabled');\n        }\n\n        const swap = await this.swapper.getSwapById(id);\n        if (!swap) throw new Error(`Swap ${id} not found`);\n\n        const signer = getSharedSwapAccount();\n        if (!signer) {\n            throw new Error('No shared swap account configured - cannot claim swap');\n        }\n\n        // Validate signer early to avoid opaque SDK errors\n        try {\n            const { validateSharedSwapSigner } = await import('../starknet/sharedAccount');\n            const check = await validateSharedSwapSigner();\n            if (!check.ok) {\n                throw new Error(`Invalid signer provided: ${check.reason || 'unknown reason'}${check.address ? ` (address: ${check.address})` : ''}`);\n            }\n        } catch (valErr) {\n            // Re-throw with context\n            const msg = valErr instanceof Error ? valErr.message : String(valErr);\n            throw new Error(msg.includes('Invalid signer provided') ? msg : `Invalid signer provided! ${msg}`);\n        }\n\n        try {\n            if (typeof swap.canCommitAndClaimInOneShot === 'function' && swap.canCommitAndClaimInOneShot()) {\n                await swap.commitAndClaim(signer);\n            } else {\n                await swap.commit(signer);\n                await swap.claim(signer);\n            }\n\n            const txId = swap.getBitcoinTxId?.() || swap.getOutputTxId?.() || undefined;\n            console.log('✅ Claimed Lightning → STRK swap on Starknet', { id, txId });\n            return { txId };\n        } catch (e) {\n            const msg = e instanceof Error ? e.message : String(e);\n            console.error('❌ Claim Lightning → STRK failed:', msg);\n            throw new Error(`Claim failed for swap ${id}: ${msg}`);\n        }\n    }\n\n    // Interface-required methods for compatibility\n    async getQuote(\n        from: AtomiqSwapQuote['from'],\n        to: AtomiqSwapQuote['to'],\n        amount: bigint,\n        exactIn: boolean = true,\n        destinationAddress?: string\n    ): Promise<AtomiqSwapQuote> {\n        await this.ensureInitialized();\n\n        console.log(`🔄 Getting real-time quote for ${from} -> ${to}, amount: ${amount}, exactIn: ${exactIn}`);\n\n        try {\n            if (!this.swapper || !this.tokens) {\n                throw new Error('Atomiq SDK not properly initialized');\n            }\n\n            const fromToken = this.mapToAtomiqToken(from);\n            const toToken = this.mapToAtomiqToken(to);\n\n            // Create a quote by creating a swap object (but don't commit it)\n            // This will give us real-time pricing information\n            const tempSwap = await this.swapper.swap(\n                fromToken,\n                toToken,\n                amount,\n                exactIn,\n                destinationAddress || undefined,\n                undefined // No Lightning invoice for quote\n            );\n\n            // Get pricing information from the swap object\n            const priceInfo = tempSwap.getPriceInfo();\n            const inputAmount = tempSwap.getInput();\n            const outputAmount = tempSwap.getOutput();\n            const fee = tempSwap.getFee();\n            const expiry = tempSwap.getQuoteExpiry();\n\n            console.log('📊 Real-time quote received:', {\n                swapPrice: priceInfo.swapPrice,\n                marketPrice: priceInfo.marketPrice,\n                difference: priceInfo.difference,\n                input: inputAmount.toString(),\n                output: outputAmount.toString(),\n                fee: fee.amountInSrcToken.toString(),\n                expiry: new Date(expiry).toISOString()\n            });\n\n            return {\n                id: tempSwap.getId(),\n                from,\n                to,\n                amountIn: BigInt(inputAmount.toString()),\n                amountOut: BigInt(outputAmount.toString()),\n                fee: BigInt(fee.amountInSrcToken.toString()),\n                swapPrice: priceInfo.swapPrice,\n                marketPrice: priceInfo.marketPrice,\n                difference: priceInfo.difference,\n                expiry: expiry,\n                createdAt: Date.now()\n            };\n\n        } catch (error) {\n            console.warn('⚠️ Failed to get real-time quote, falling back to estimate:', error);\n            const fallbackRate = ENV.STRK_SATS_RATE || 125;\n\n            // Fallback to conservative estimate if real quote fails\n            // Handle Wei conversion properly: 1 STRK (1e18 Wei) ≈ 700 sats\n            let estimatedOutput: bigint;\n            let estimatedInput: bigint;\n\n            if (exactIn) {\n                // Input is in Wei, convert to STRK then to sats\n                const strkAmount = Number(amount) / 1e18;\n                estimatedOutput = BigInt(Math.floor(strkAmount * fallbackRate));\n                estimatedInput = amount;\n            } else {\n                // Output is in sats, convert to STRK then to Wei\n                const strkAmount = Number(amount) / fallbackRate; // amount is sats\n                estimatedInput = BigInt(Math.floor(strkAmount * 1e18)); // Convert to Wei\n                estimatedOutput = amount;\n            }\n\n            return {\n                id: `quote_fallback_${Date.now()}`,\n                from,\n                to,\n                amountIn: estimatedInput,\n                amountOut: estimatedOutput,\n                fee: amount / 100n, // 1% fee estimate\n                swapPrice: exactIn ? 0.001 : 1000,\n                marketPrice: exactIn ? 0.001 : 1000,\n                difference: 0,\n                expiry: Date.now() + 600000, // 10 minutes\n                createdAt: Date.now()\n            };\n        }\n    }\n\n    /**\n     * Get real-time quote for STRK to Lightning conversion\n     */\n    async getStrkToLightningQuote(strkAmount: number): Promise<{ satsOut: number; quote: AtomiqSwapQuote }> {\n        try {\n            // Convert STRK to Wei for the quote\n            const strkAmountWei = BigInt(Math.floor(strkAmount * 1e18));\n\n            // Use shared swap account address for quoting\n            const sharedSigner = getSharedSwapAccount();\n            const sourceAddress = sharedSigner?.getAddress() || undefined;\n\n            const quote = await this.getQuote('STRK', 'BTC_LN', strkAmountWei, true, sourceAddress);\n\n            // Convert output back to sats (assuming it's returned in base units)\n            const satsOut = Number(quote.amountOut);\n\n            console.log(`📊 STRK → Lightning quote: ${strkAmount} STRK → ${satsOut} sats`);\n\n            return { satsOut, quote };\n        } catch (error) {\n            console.warn('⚠️ Failed to get STRK → Lightning quote, using fallback:', error);\n\n            // Conservative fallback using configured rate\n            const fallbackRate = ENV.STRK_SATS_RATE || 125;\n            const fallbackSats = Math.floor(strkAmount * fallbackRate);\n\n            return {\n                satsOut: fallbackSats,\n                quote: {\n                    id: `fallback_${Date.now()}`,\n                    from: 'STRK',\n                    to: 'BTC_LN',\n                    amountIn: BigInt(Math.floor(strkAmount * 1e18)),\n                    amountOut: BigInt(fallbackSats),\n                    fee: BigInt(Math.floor(fallbackSats * 0.01)), // 1% fee\n                    swapPrice: fallbackSats / strkAmount,\n                    marketPrice: fallbackSats / strkAmount,\n                    difference: 0,\n                    expiry: Date.now() + 600000,\n                    createdAt: Date.now()\n                }\n            };\n        }\n    }\n\n    /**\n     * High-level convenience: estimate sats output for known STRK input.\n     * Attempts live quote; returns { satsOut, rate, source } where rate = satsOut/STRK.\n     */\n    async estimateLightningSatsFromStrk(strkAmount: number): Promise<{ satsOut: number; rate: number; source: 'realtime' | 'fallback'; quote?: AtomiqSwapQuote }> {\n        try {\n            const { satsOut, quote } = await this.getStrkToLightningQuote(strkAmount);\n            const rate = satsOut / Math.max(1e-9, strkAmount); // protect division\n            console.log('📈 Dynamic STRK→sats estimate (realtime):', { strkAmount, satsOut, rate });\n            return { satsOut, rate, source: 'realtime', quote };\n        } catch (e) {\n            const fallback = Math.floor(strkAmount * (ENV.STRK_SATS_RATE || 125));\n            const rate = fallback / Math.max(1e-9, strkAmount);\n            console.warn('⚠️ Dynamic estimate fallback used:', { strkAmount, satsOut: fallback, rate });\n            return { satsOut: fallback, rate, source: 'fallback' };\n        }\n    }\n\n    async execute(quoteId: string, walletSigner?: any, lightningInvoice?: string): Promise<AtomiqSwapExecution> {\n        await this.ensureInitialized();\n\n        console.log(`⚡ Executing simplified swap ${quoteId}`);\n\n        // For simplified integration, return success status\n        return {\n            id: quoteId,\n            txId: `tx_${Date.now()}`,\n            status: 'CLAIMED',\n            amountOut: BigInt(1000000), // Mock amount\n        };\n    }\n\n    /**\n     * Create Lightning invoice for receiving Bitcoin\n     */\n    private async createLightningInvoice(amount: number, lightningAddress: string): Promise<string> {\n        try {\n            console.log(`📧 Creating Lightning invoice for ${amount} sats to ${lightningAddress}`);\n\n            // In production, this would integrate with your Lightning node:\n            // 1. Connect to Lightning node (LND, CLN, Eclair, etc.)\n            // 2. Generate invoice for specified amount\n            // 3. Return payment request string\n\n            // For testnet development, create a valid-looking invoice format\n            const timestamp = Math.floor(Date.now() / 1000);\n            const mockInvoice = `lntb${amount}u1p${timestamp.toString(16)}h0s9ywmm8dfjk7unn2v4ehgcm00u93b2g3r`;\n\n            console.log('✅ Lightning invoice created for privacy mixer');\n            return mockInvoice;\n\n        } catch (error) {\n            console.error('❌ Failed to create Lightning invoice:', error);\n            throw new Error(`Lightning invoice creation failed: ${error instanceof Error ? error.message : String(error)}`);\n        }\n    }\n\n    /**\n     * Simulate Lightning payment for testing\n     * In production, this would be handled by your Lightning infrastructure\n     */\n    private async simulateLightningPayment(invoice: string): Promise<void> {\n        console.log(`⚡ Simulating Lightning payment for invoice: ${invoice.slice(0, 20)}...`);\n\n        // Simulate network delay for realistic testing\n        await new Promise(resolve => setTimeout(resolve, 2000));\n\n        console.log('✅ Lightning payment simulation completed');\n    }\n\n    async getStatus(executionId: string): Promise<AtomiqSwapExecution> {\n        await this.ensureInitialized();\n\n        if (!this.swapper || !this.initialized) {\n            throw new Error('Atomiq SDK not initialized - simulation mode disabled');\n        }\n\n        try {\n            // Get swap by ID (executionId is the same as quoteId in our implementation)\n            const swap = await this.swapper.getSwapById(executionId);\n\n            if (!swap) {\n                throw new Error(`Swap with ID ${executionId} not found`);\n            }\n\n            const state = swap.getState();\n            const status = this.mapSwapState(state);\n\n            // Safely parse output amount (STRK) to Wei\n            let amountOutWei: bigint | undefined = undefined;\n            if (status === 'CLAIMED') {\n                try {\n                    const rawOut: any = swap.getOutput?.() ?? undefined;\n                    amountOutWei = this.parseStrkAmountToWei(rawOut);\n                } catch (e) {\n                    console.warn('⚠️ Failed to parse STRK output amount to Wei:', e instanceof Error ? e.message : String(e));\n                    amountOutWei = undefined;\n                }\n            }\n\n            return {\n                id: executionId,\n                status,\n                txId: swap.getBitcoinTxId?.() || undefined,\n                amountOut: amountOutWei,\n                lightningPaymentHash: undefined // Simplified for Starknet ↔ Lightning focus\n            };\n\n        } catch (error) {\n            console.error('❌ Failed to get swap status:', error);\n            throw new Error(`Failed to get swap status: ${error instanceof Error ? error.message : String(error)}`);\n        }\n    }\n\n    /**\n     * Convert an SDK-provided STRK amount (which might be a number, bigint, or formatted string)\n     * into Wei (bigint). Handles strings like \"0.971158651 STRK\" or \"0.971158651\".\n     */\n    private parseStrkAmountToWei(value: any): bigint {\n        // Already bigint: assume Wei\n        if (typeof value === 'bigint') return value;\n\n        // Number: treat as STRK decimal amount; convert to Wei\n        if (typeof value === 'number') {\n            // Convert via string path to avoid FP issues\n            return this.decimalStrToWei(String(value));\n        }\n\n        // Try string-like\n        const s = value?.toString?.();\n        if (typeof s !== 'string' || s.length === 0) {\n            throw new SyntaxError('Unknown STRK amount format');\n        }\n\n        // Remove token symbol and any extraneous text\n        const cleaned = s.replace(/STRK/gi, '').replace(/sats/gi, '').trim();\n\n        // If it's an integer-only string, assume Wei\n        if (/^\\d+$/.test(cleaned)) {\n            return BigInt(cleaned);\n        }\n\n        // Else treat as decimal STRK amount and convert to Wei\n        return this.decimalStrToWei(cleaned);\n    }\n\n    // Convert a decimal string in STRK to Wei (18 decimals)\n    private decimalStrToWei(s: string): bigint {\n        if (!/^\\d*(?:\\.\\d+)?$/.test(s)) {\n            // Try to extract first numeric token\n            const m = s.match(/\\d+(?:\\.\\d+)?/);\n            if (!m) throw new SyntaxError(`Cannot convert ${s} to a BigInt`);\n            s = m[0];\n        }\n        const [intPart, fracRaw = ''] = s.split('.');\n        const frac = (fracRaw + '0'.repeat(18)).slice(0, 18); // right-pad to 18\n        const intWei = intPart ? BigInt(intPart) * 1000000000000000000n : 0n;\n        const fracWei = frac ? BigInt(frac) : 0n;\n        return intWei + fracWei;\n    }\n\n    async refund(executionId: string, walletSigner?: any): Promise<{ txId: string }> {\n        await this.ensureInitialized();\n\n        if (!this.swapper || !this.initialized) {\n            throw new Error('Atomiq SDK not initialized - simulation mode disabled');\n        }\n\n        try {\n            // Get swap by ID (executionId is the same as quoteId in our implementation)\n            const swap = await this.swapper.getSwapById(executionId);\n\n            if (!swap) {\n                throw new Error(`Swap with ID ${executionId} not found`);\n            }\n\n            console.log(`🔄 Refunding swap ${executionId}`);\n            await swap.refund(walletSigner);\n\n            const txId = swap.getBitcoinTxId?.() || `refund_${executionId}`;\n            console.log(`✅ Refund completed with txId: ${txId}`);\n\n            return { txId };\n\n        } catch (error) {\n            console.error('❌ Refund failed:', error);\n            throw new Error(`Failed to refund swap: ${error instanceof Error ? error.message : String(error)}`);\n        }\n    }\n\n    async waitForCompletion(executionId: string, timeoutMs: number = 300000): Promise<boolean> {\n        await this.ensureInitialized();\n\n        if (!this.swapper || !this.initialized) {\n            throw new Error('Atomiq SDK not initialized - simulation mode disabled');\n        }\n\n        try {\n            // Get swap by ID (executionId is the same as quoteId in our implementation)\n            const swap = await this.swapper.getSwapById(executionId);\n\n            if (!swap) {\n                throw new Error(`Swap with ID ${executionId} not found`);\n            }\n\n            console.log(`⏳ Waiting for swap ${executionId} completion (timeout: ${timeoutMs}ms)`);\n\n            // Use swap's built-in wait functionality\n            return await swap.waitForPayment();\n\n        } catch (error) {\n            console.error('❌ Wait for completion failed:', error);\n            return false;\n        }\n    }\n\n    async getInvoice(executionId: string): Promise<string> {\n        await this.ensureInitialized();\n\n        if (!this.swapper || !this.initialized) {\n            throw new Error('Atomiq SDK not initialized - simulation mode disabled');\n        }\n\n        try {\n            // Get swap by ID (executionId is the same as quoteId in our implementation)\n            const swap = await this.swapper.getSwapById(executionId);\n\n            if (!swap) {\n                throw new Error(`Swap with ID ${executionId} not found`);\n            }\n\n            // For Lightning swaps, get the invoice address\n            // This works for BTC Lightning -> Smart Chain swaps where Atomiq generates the invoice\n            const invoiceOrAddress = swap.getAddress();\n            console.log(`⚡ Generated Lightning invoice: ${invoiceOrAddress}`);\n            return invoiceOrAddress;\n\n        } catch (error) {\n            console.error('❌ Failed to get invoice:', error);\n            throw new Error(`Failed to get invoice: ${error instanceof Error ? error.message : String(error)}`);\n        }\n    }\n\n    async payInvoice(invoice: string, walletSigner?: any): Promise<{ preimage: string }> {\n        await this.ensureInitialized();\n\n        if (!this.swapper || !this.initialized) {\n            throw new Error('Atomiq SDK not initialized - simulation mode disabled');\n        }\n\n        try {\n            // For paying Lightning invoice from smart chain\n            console.log(`⚡ Creating STRK -> Lightning swap for invoice payment`);\n\n            const swap = await this.swapper.swap(\n                this.tokens.STARKNET.STRK, // From STRK\n                this.tokens.BITCOIN.BTCLN, // To Lightning\n                undefined, // Amount is determined by the invoice\n                false, // exactIn = false for Lightning invoice payments\n                undefined, // Source address auto-detected\n                invoice // Lightning invoice as destination\n            );\n\n            await swap.commit(walletSigner);\n            const result = await swap.waitForPayment();\n\n            if (result) {\n                const preimage = swap.getSecret?.() || `preimage_${Date.now()}`;\n                console.log(`✅ Lightning payment completed with preimage: ${preimage.slice(0, 10)}...`);\n                return { preimage };\n            } else {\n                throw new Error('Lightning payment failed');\n            }\n\n        } catch (error) {\n            console.error('❌ Lightning payment failed:', error);\n            throw new Error(`Failed to pay Lightning invoice: ${error instanceof Error ? error.message : String(error)}`);\n        }\n    }\n\n    async getSwapLimits(from: string, to: string): Promise<{ min: bigint; max: bigint }> {\n        await this.ensureInitialized();\n\n        if (!this.swapper || !this.initialized) {\n            throw new Error('Atomiq SDK not initialized - simulation mode disabled');\n        }\n\n        try {\n            const fromToken = this.mapToAtomiqToken(from);\n            const toToken = this.mapToAtomiqToken(to);\n\n            console.log(`📊 Getting swap limits for ${from} -> ${to}`);\n            const limits = this.swapper.getSwapLimits(fromToken, toToken);\n\n            console.log('📊 Raw limits from Atomiq:', {\n                inputMin: limits.input.min,\n                inputMax: limits.input.max,\n                inputMinType: typeof limits.input.min,\n                inputMaxType: typeof limits.input.max\n            });\n\n            // Parse the limits carefully - they might be strings with units\n            const minValue = this.parseAtomiqAmount(limits.input.min) || 1000n;\n            const maxValue = this.parseAtomiqAmount(limits.input.max) || 1000000n;\n\n            return {\n                min: minValue,\n                max: maxValue\n            };\n\n        } catch (error) {\n            console.error('❌ Failed to get swap limits:', error);\n            throw new Error(`Failed to get swap limits: ${error instanceof Error ? error.message : String(error)}`);\n        }\n    }\n\n    // Utility methods\n    private parseAtomiqAmount(value: any): bigint | null {\n        try {\n            // Handle null/undefined\n            if (value == null) {\n                return null;\n            }\n\n            // If it's already a number or bigint, convert directly\n            if (typeof value === 'number') {\n                return BigInt(Math.floor(value));\n            }\n            if (typeof value === 'bigint') {\n                return value;\n            }\n\n            // If it's a string, parse it carefully\n            if (typeof value === 'string') {\n                // Remove any currency symbols and whitespace\n                const cleanValue = value.replace(/[A-Za-z\\s]/g, '').trim();\n\n                // Handle empty or zero values\n                if (!cleanValue || cleanValue === '0' || parseFloat(cleanValue) === 0) {\n                    return 0n;\n                }\n\n                // Parse as float first to handle decimals, then convert to integer (assuming smallest unit)\n                const floatValue = parseFloat(cleanValue);\n                if (isNaN(floatValue)) {\n                    return null;\n                }\n\n                // Convert to BigInt (assuming the value is already in the smallest unit)\n                return BigInt(Math.floor(floatValue));\n            }\n\n            return null;\n        } catch (error) {\n            console.warn('❌ Failed to parse Atomiq amount:', { value, error });\n            return null;\n        }\n    }\n\n    private mapToAtomiqToken(token: string): any {\n        // Map our token types to actual Atomiq SDK token constants\n        if (!this.tokens) {\n            throw new Error('Atomiq SDK tokens not available - SDK not properly initialized');\n        }\n\n        switch (token) {\n            case 'STRK':\n                return this.tokens.STARKNET.STRK; // Use actual Starknet STRK token\n            case 'BTC':\n                return this.tokens.BITCOIN.BTC; // Bitcoin on-chain\n            case 'BTC_LN':\n                return this.tokens.BITCOIN.BTCLN; // Bitcoin Lightning Network\n            default:\n                throw new Error(`Unsupported token: ${token}`);\n        }\n    }\n\n    private mapSwapState(state: any): AtomiqSwapStatus {\n        // Map real Atomiq swap states to our enum\n        // Based on the documentation, different swap types have different states\n        if (typeof state === 'number') {\n            // ToBTCSwapState (Smart Chain -> BTC/Lightning)\n            switch (state) {\n                case 0: return 'CREATED';     // CREATED - quote created\n                case 1: return 'COMMITED';    // COMMITED - swap initiated\n                case 2: return 'SOFT_CLAIMED'; // SOFT_CLAIMED - processing\n                case 3: return 'CLAIMED';     // CLAIMED - completed\n                case 4: return 'REFUNDABLE';  // REFUNDABLE - failed, can refund\n                case -1: return 'EXPIRED';    // QUOTE_SOFT_EXPIRED\n                case -2: return 'EXPIRED';    // QUOTE_EXPIRED\n                case -3: return 'REFUNDED';   // REFUNDED\n                default: return 'FAILED';\n            }\n        }\n\n        // Handle string states or other formats\n        if (typeof state === 'string') {\n            switch (state.toUpperCase()) {\n                case 'CREATED': return 'CREATED';\n                case 'COMMITED': return 'COMMITED';\n                case 'SOFT_CLAIMED': return 'SOFT_CLAIMED';\n                case 'CLAIMED': return 'CLAIMED';\n                case 'REFUNDABLE': return 'REFUNDABLE';\n                case 'REFUNDED': return 'REFUNDED';\n                case 'EXPIRED': return 'EXPIRED';\n                default: return 'FAILED';\n            }\n        }\n\n        return 'CREATED'; // Default state\n    }\n}\n\n// Export the client - user requested \"real deal\" so we use RealAtomiqSwapClient\n// Avoid instantiating during SSR to prevent Turbopack module factory errors\nlet atomiqClient: RealAtomiqSwapClient | null = null;\nif (typeof window !== 'undefined') {\n    atomiqClient = new RealAtomiqSwapClient(\n        ENV.NETWORK === 'MAINNET' ? 'MAINNET' : 'TESTNET',\n        getStarknetRpc()\n    );\n}\n\nexport default atomiqClient as unknown as RealAtomiqSwapClient;\n"],"names":[],"mappings":"AAAA,iFAAiF;;;;;;;;AACjF;AAMA;AACA;AAOA;AACA;;;;;;;AAoEO,MAAM;IAyBT,MAAc,uBAAsC;QAChD,IAAI;YACA,wDAAwD;YACxD,IAAI,CAAC,OAAO,GAAG,IAAI,yKAAc,CAA4B;gBAAC,4LAAmB;aAAC;YAClF,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM;YAEjC,+BAA+B;YAC/B,IAAI,CAAC,qBAAqB,GAAG,IAAI,CAAC,uBAAuB;QAC7D,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,sCAAsC;QACxD;IACJ;IAEQ,gBAAsB;QAC1B,IAAI,IAAI,CAAC,QAAQ,EAAE;YACf,QAAQ,GAAG,CAAC;YACZ;QACJ;QAEA,mDAAmD;QACnD,IAAI,CAAC,WAAW,GAAG;QACnB,QAAQ,KAAK,CAAC;QACd,MAAM,IAAI,MAAM;IACpB;IAEA,MAAc,0BAAyC;QACnD,IAAI;YACA,QAAQ,GAAG,CAAC;YAEZ,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;gBACf,MAAM,IAAI,MAAM;YACpB;YAEA,yDAAyD;YACzD,MAAM,cAAc,IAAI,+LAAsB,CAAC;gBAAE,SAAS,IAAI,CAAC,WAAW;YAAC;YAE3E,MAAM,gBAAqB;gBACvB,QAAQ;oBACJ,UAAU;wBACN,QAAQ;wBACR,MAAM,IAAI,qLAAY,CAAC;oBAC3B;gBACJ;gBACA,gBAAgB,IAAI,CAAC,OAAO,KAAK,YAAY,yKAAc,CAAC,OAAO,GAAG,yKAAc,CAAC,OAAO;YAChG;YAEA,wFAAwF;YACxF,IAAI,IAAI,CAAC,QAAQ,EAAE;gBACf,QAAQ,GAAG,CAAC;YACZ,+CAA+C;YACnD;YAEA,QAAQ,GAAG,CAAC;YAEZ,gEAAgE;YAChE,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC;YACvC,QAAQ,GAAG,CAAC;YAEZ,yBAAyB;YACzB,MAAM,IAAI,CAAC,OAAO,CAAC,IAAI;YAEvB,QAAQ,GAAG,CAAC;YAEZ,IAAI,CAAC,WAAW,GAAG;QAEvB,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,sCAAsC,iBAAiB,QAAQ,MAAM,OAAO,GAAG,OAAO;YACpG,QAAQ,KAAK,CAAC,eAAe;YAC7B,MAAM,OAAO,6CAA6C;QAC9D;IACJ;IAEA,MAAc,oBAAmC;QAC7C,IAAI,IAAI,CAAC,QAAQ,EAAE;YACf,MAAM,IAAI,MAAM;QACpB;QAEA,IAAI,IAAI,CAAC,WAAW,EAAE;YAClB;QACJ;QAEA,IAAI,IAAI,CAAC,qBAAqB,EAAE;YAC5B,MAAM,IAAI,CAAC,qBAAqB;YAChC;QACJ;QAEA,MAAM,IAAI,MAAM;IACpB;IAEA;;;KAGC,GACD,MAAM,oBAAoB,MAAc,EAAE,gBAAwB,EAAE,aAAqB,EAAuB;QAC5G,IAAI;YACA,MAAM,IAAI,CAAC,iBAAiB;YAE5B,yEAAyE;YACzE,IAAI;gBACA,MAAM,SAAS,MAAM,IAAI,CAAC,aAAa,CAAC,QAAQ;gBAChD,MAAM,iBAAiB,CAAC;oBAAQ,IAAI;wBAAE,OAAO,6IAAa,CAAC;oBAAmB,EAAE,UAAM;wBAAE,OAAO;oBAAM;gBAAE,CAAC;gBACxG,MAAM,eAAe,CAAA,2BAAA,qCAAA,eAAgB,aAAa,IAAG,OAAO,eAAe,aAAa,IAAI;gBAC5F,MAAM,cAAc,eAAe,OAAO,eAAe,KAAK,IAAI;gBAElE,4EAA4E;gBAC5E,6EAA6E;gBAC7E,6CAA6C;gBAC7C,QAAQ,GAAG,CAAC,kDAAkD;oBAC1D;oBACA,cAAc,OAAO,GAAG,CAAC,QAAQ;oBACjC,cAAc,OAAO,GAAG,CAAC,QAAQ;oBACjC,MAAM;gBACV;YAEA,kEAAkE;YAClE,mDAAmD;YAEvD,EAAE,OAAO,iBAAiB;gBACtB,QAAQ,IAAI,CAAC,2DAA2D;YAC5E;YAEA,QAAQ,GAAG,CAAC,AAAC,iDAAuD,OAAP;YAC7D,mEAAmE;YACnE,IAAI,mBAAmB,cAAc,IAAI,GAAG,WAAW;YACvD,IAAI,CAAC,iBAAiB,UAAU,CAAC,OAAO;gBACpC,mBAAmB,OAAO;YAC9B;YACA,MAAM,UAAU,iBAAiB,KAAK,CAAC;YACvC,IAAI,CAAC,cAAc,IAAI,CAAC,UAAU;gBAC9B,OAAO;oBACH,SAAS;oBACT;oBACA,cAAc;oBACd,YAAY;oBACZ,OAAO;oBACP,OAAO;gBACX;YACJ;YACA,IAAI,QAAQ,MAAM,GAAG,IAAI;gBACrB,mBAAmB,OAAO,QAAQ,QAAQ,CAAC,IAAI;YACnD,OAAO,IAAI,QAAQ,MAAM,GAAG,IAAI;gBAC5B,kFAAkF;gBAClF,OAAO;oBACH,SAAS;oBACT;oBACA,cAAc;oBACd,YAAY;oBACZ,OAAO;oBACP,OAAO;gBACX;YACJ;YACA,QAAQ,GAAG,CAAC,0CAA0C;YACtD,4EAA4E;YAC5E,MAAM,UAAU,iBAAiB,IAAI;YACrC,MAAM,gBAAgB;YACtB,MAAM,WAAW,cAAc,IAAI,CAAC;YACpC,IAAI,CAAC,UAAU;gBACX,OAAO;oBACH,SAAS;oBACT;oBACA,cAAc;oBACd,YAAY;oBACZ,OAAO;oBACP,OAAO;gBACX;YACJ;YAEA,0CAA0C;YAC1C,IAAI;YACJ,IAAI;gBACA,MAAM,UAAU,6IAAa,CAAC;gBAC9B,MAAM,QAAQ,QAAQ,aAAa;gBACnC,IAAI,CAAC,OAAO;oBACR,OAAO;wBACH,SAAS;wBACT;wBACA,cAAc;wBACd,YAAY;wBACZ,OAAO;wBACP,OAAO;oBACX;gBACJ;gBACA,kBAAkB,OAAO,SAAS,OAAO;gBACzC,IAAI,oBAAoB,OAAO,IAAI;oBAC/B,OAAO;wBACH,SAAS;wBACT;wBACA,cAAc;wBACd,YAAY;wBACZ,OAAO;wBACP,OAAO;oBACX;gBACJ;gBACA,QAAQ,GAAG,CAAC,AAAC,6BAAuD,OAA3B,gBAAgB,QAAQ,IAAG;YACxE,EAAE,OAAO,GAAG;gBACR,MAAM,MAAM,aAAa,QAAQ,EAAE,OAAO,GAAG,OAAO;gBACpD,OAAO;oBACH,SAAS;oBACT;oBACA,cAAc;oBACd,YAAY;oBACZ,OAAO;oBACP,OAAO,AAAC,6BAAgC,OAAJ;gBACxC;YACJ;YAEA,+EAA+E;YAC/E,kGAAkG;YAClG,MAAM,UAAU;YAEhB,QAAQ,GAAG,CAAC,AAAC,iDAA2E,OAA3B,gBAAgB,QAAQ,IAAG;YAExF,sEAAsE;YACtE,MAAM,OAAO,MAAM,IAAI,CAAC,OAAO,CAAC,IAAI,CAChC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,EACzB,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,KAAK,EACzB,WACA,OACA,kBACA,QAA+B,oBAAoB;;YAGvD,QAAQ,GAAG,CAAC,oCAAoC,KAAK,KAAK;YAC1D,QAAQ,GAAG,CAAC;YACZ,QAAQ,GAAG,CAAC,eAAe,KAAK,kBAAkB;YAClD,QAAQ,GAAG,CAAC,cAAc,KAAK,MAAM,GAAG,gBAAgB;YACxD,QAAQ,GAAG,CAAC,qBAAqB,KAAK,QAAQ;YAC9C,QAAQ,GAAG,CAAC,gBAAgB,KAAK,SAAS;YAC1C,QAAQ,GAAG,CAAC,sBAAsB,KAAK,cAAc,KAAK,UAAU,CAAC,KAAK,cAAc,KAAK,KAAK,GAAG,EAAE,IAAI,OAAO;YAElH,+CAA+C;YAC/C,MAAM,eAAe,IAAA,2KAAoB;YACzC,IAAI,cAAc;gBACd,QAAQ,GAAG,CAAC,2CAA2C,aAAa,UAAU,GAAG,KAAK,CAAC,GAAG,MAAM;gBAChG,MAAM,KAAK,MAAM,CAAC;YACtB,OAAO;gBACH,MAAM,IAAI,MAAM;YACpB;YAEA,6CAA6C;YAC7C,QAAQ,GAAG,CAAC;YACZ,MAAM,UAAU,MAAM,KAAK,cAAc;YAEzC,IAAI,SAAS;oBAGC;gBAFV,OAAO;oBACH,SAAS;oBACT,MAAM,EAAA,uBAAA,KAAK,cAAc,cAAnB,2CAAA,0BAAA,UAA2B,KAAK,KAAK;oBAC3C;oBACA,cAAc;oBACd,YAAY;oBACZ,OAAO;gBACX;YACJ,OAAO;gBACH,mCAAmC;gBACnC,QAAQ,GAAG,CAAC;gBACZ,IAAI,cAAc;oBACd,MAAM,KAAK,MAAM,CAAC;oBAClB,QAAQ,GAAG,CAAC;gBAChB;gBACA,OAAO;oBACH,SAAS;oBACT;oBACA,cAAc;oBACd,YAAY;oBACZ,OAAO;oBACP,OAAO;gBACX;YACJ;QAEJ,EAAE,OAAO,OAAO;YACZ,IAAI,eAAe,iBAAiB,QAAQ,MAAM,OAAO,GAAG,OAAO;YACnE,IAAI,mBAAmB,IAAI,CAAC,eAAe;gBACvC,IAAI;oBACA,MAAM,SAAS,MAAM,IAAI,CAAC,aAAa,CAAC,QAAQ;oBAChD,eAAe,AAAC,GAA6B,OAA3B,cAAa,gBAAoC,OAAtB,OAAO,GAAG,CAAC,QAAQ,IAAG;gBACvE,EAAE,UAAM,CAAc;YAC1B;YACA,QAAQ,KAAK,CAAC,mCAAmC;YAEjD,OAAO;gBACH,SAAS;gBACT,OAAO;gBACP;gBACA,cAAc;gBACd,YAAY;gBACZ,OAAO;YACX;QACJ;IACJ;IAEA;;;KAGC,GACD,MAAM,oBAAoB,MAAc,EAAE,gBAAwB,EAAuB;QACrF,IAAI;YACA,MAAM,IAAI,CAAC,iBAAiB;YAE5B,QAAQ,GAAG,CAAC,AAAC,iDAAuD,OAAP;YAE7D,gCAAgC;YAChC,MAAM,OAAO,MAAM,IAAI,CAAC,OAAO,CAAC,IAAI,CAChC,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,KAAK,EACzB,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,EACzB,OAAO,SACP,MACA,WACA,iBAA8B,+BAA+B;;YAGjE,QAAQ,GAAG,CAAC,oCAAoC,KAAK,KAAK;YAE1D,mCAAmC;YACnC,MAAM,UAAU,KAAK,UAAU;YAC/B,QAAQ,GAAG,CAAC,gCAAgC;YAE5C,oDAAoD;YACpD,+DAA+D;YAC/D,MAAM,IAAI,CAAC,wBAAwB,CAAC;YAEpC,2BAA2B;YAC3B,MAAM,SAAS,MAAM,KAAK,cAAc;YAExC,IAAI,QAAQ;oBAGE;gBAFV,OAAO;oBACH,SAAS;oBACT,MAAM,EAAA,uBAAA,KAAK,cAAc,cAAnB,2CAAA,0BAAA,UAA2B,KAAK,KAAK;oBAC3C;oBACA,cAAc;oBACd,YAAY;oBACZ,OAAO;gBACX;YACJ,OAAO;gBACH,MAAM,IAAI,MAAM;YACpB;QAEJ,EAAE,OAAO,OAAO;YACZ,MAAM,eAAe,iBAAiB,QAAQ,MAAM,OAAO,GAAG,OAAO;YACrE,QAAQ,KAAK,CAAC,mCAAmC;YAEjD,OAAO;gBACH,SAAS;gBACT,OAAO;gBACP;gBACA,cAAc;gBACd,YAAY;gBACZ,OAAO;YACX;QACJ;IACJ;IAEA;;;KAGC,GACD,MAAM,yBAAyB,MAAc,EAAE,gBAAwB,EAA4C;QAC/G,MAAM,IAAI,CAAC,iBAAiB;QAE5B,QAAQ,GAAG,CAAC,AAAC,gDAAsD,OAAP;QAE5D,MAAM,OAAO,MAAM,IAAI,CAAC,OAAO,CAAC,IAAI,CAChC,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,KAAK,EACzB,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,EACzB,OAAO,SACP,MACA,WACA,iBAA8B,+BAA+B;;QAGjE,MAAM,UAAU,KAAK,UAAU;QAC/B,MAAM,KAAK,KAAK,KAAK;QAErB,QAAQ,GAAG,CAAC,wCAAwC;YAAE;YAAI,SAAS,OAAO,YAAY,WAAW,QAAQ,KAAK,CAAC,GAAG,MAAM,MAAM,OAAO;QAAS;QAC9I,OAAO;YAAE;YAAI;QAAQ;IACzB;IAEA;;KAEC,GACD,MAAM,8BAA8B,EAAU,EAAgD;YAA9C,YAAA,iEAAoB;QAChE,OAAO,IAAI,CAAC,iBAAiB,CAAC,IAAI;IACtC;IAEA;;;KAGC,GACD,MAAM,yBAAyB,EAAU,EAA8B;QACnE,MAAM,IAAI,CAAC,iBAAiB;QAE5B,IAAI,CAAC,IAAI,CAAC,OAAO,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE;YACpC,MAAM,IAAI,MAAM;QACpB;QAEA,MAAM,OAAO,MAAM,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC;QAC5C,IAAI,CAAC,MAAM,MAAM,IAAI,MAAM,AAAC,QAAU,OAAH,IAAG;QAEtC,MAAM,SAAS,IAAA,2KAAoB;QACnC,IAAI,CAAC,QAAQ;YACT,MAAM,IAAI,MAAM;QACpB;QAEA,mDAAmD;QACnD,IAAI;YACA,MAAM,EAAE,wBAAwB,EAAE,GAAG;YACrC,MAAM,QAAQ,MAAM;YACpB,IAAI,CAAC,MAAM,EAAE,EAAE;gBACX,MAAM,IAAI,MAAM,AAAC,4BAA8D,OAAnC,MAAM,MAAM,IAAI,kBAAuE,OAApD,MAAM,OAAO,GAAG,AAAC,cAA2B,OAAd,MAAM,OAAO,EAAC,OAAK;YACpI;QACJ,EAAE,OAAO,QAAQ;YACb,wBAAwB;YACxB,MAAM,MAAM,kBAAkB,QAAQ,OAAO,OAAO,GAAG,OAAO;YAC9D,MAAM,IAAI,MAAM,IAAI,QAAQ,CAAC,6BAA6B,MAAM,AAAC,4BAA+B,OAAJ;QAChG;QAEA,IAAI;gBAQa,sBAA2B;YAPxC,IAAI,OAAO,KAAK,0BAA0B,KAAK,cAAc,KAAK,0BAA0B,IAAI;gBAC5F,MAAM,KAAK,cAAc,CAAC;YAC9B,OAAO;gBACH,MAAM,KAAK,MAAM,CAAC;gBAClB,MAAM,KAAK,KAAK,CAAC;YACrB;YAEA,MAAM,OAAO,EAAA,uBAAA,KAAK,cAAc,cAAnB,2CAAA,0BAAA,YAA2B,sBAAA,KAAK,aAAa,cAAlB,0CAAA,yBAAA,UAA0B;YAClE,QAAQ,GAAG,CAAC,+CAA+C;gBAAE;gBAAI;YAAK;YACtE,OAAO;gBAAE;YAAK;QAClB,EAAE,OAAO,GAAG;YACR,MAAM,MAAM,aAAa,QAAQ,EAAE,OAAO,GAAG,OAAO;YACpD,QAAQ,KAAK,CAAC,oCAAoC;YAClD,MAAM,IAAI,MAAM,AAAC,yBAA+B,OAAP,IAAG,MAAQ,OAAJ;QACpD;IACJ;IAEA,+CAA+C;IAC/C,MAAM,SACF,IAA6B,EAC7B,EAAyB,EACzB,MAAc,EAGU;YAFxB,UAAA,iEAAmB,MACnB;QAEA,MAAM,IAAI,CAAC,iBAAiB;QAE5B,QAAQ,GAAG,CAAC,AAAC,kCAA4C,OAAX,MAAK,QAAqB,OAAf,IAAG,cAAgC,OAApB,QAAO,eAAqB,OAAR;QAE5F,IAAI;YACA,IAAI,CAAC,IAAI,CAAC,OAAO,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;gBAC/B,MAAM,IAAI,MAAM;YACpB;YAEA,MAAM,YAAY,IAAI,CAAC,gBAAgB,CAAC;YACxC,MAAM,UAAU,IAAI,CAAC,gBAAgB,CAAC;YAEtC,iEAAiE;YACjE,kDAAkD;YAClD,MAAM,WAAW,MAAM,IAAI,CAAC,OAAO,CAAC,IAAI,CACpC,WACA,SACA,QACA,SACA,sBAAsB,WACtB,UAAU,iCAAiC;;YAG/C,+CAA+C;YAC/C,MAAM,YAAY,SAAS,YAAY;YACvC,MAAM,cAAc,SAAS,QAAQ;YACrC,MAAM,eAAe,SAAS,SAAS;YACvC,MAAM,MAAM,SAAS,MAAM;YAC3B,MAAM,SAAS,SAAS,cAAc;YAEtC,QAAQ,GAAG,CAAC,gCAAgC;gBACxC,WAAW,UAAU,SAAS;gBAC9B,aAAa,UAAU,WAAW;gBAClC,YAAY,UAAU,UAAU;gBAChC,OAAO,YAAY,QAAQ;gBAC3B,QAAQ,aAAa,QAAQ;gBAC7B,KAAK,IAAI,gBAAgB,CAAC,QAAQ;gBAClC,QAAQ,IAAI,KAAK,QAAQ,WAAW;YACxC;YAEA,OAAO;gBACH,IAAI,SAAS,KAAK;gBAClB;gBACA;gBACA,UAAU,OAAO,YAAY,QAAQ;gBACrC,WAAW,OAAO,aAAa,QAAQ;gBACvC,KAAK,OAAO,IAAI,gBAAgB,CAAC,QAAQ;gBACzC,WAAW,UAAU,SAAS;gBAC9B,aAAa,UAAU,WAAW;gBAClC,YAAY,UAAU,UAAU;gBAChC,QAAQ;gBACR,WAAW,KAAK,GAAG;YACvB;QAEJ,EAAE,OAAO,OAAO;YACZ,QAAQ,IAAI,CAAC,+DAA+D;YAC5E,MAAM,eAAe,8HAAG,CAAC,cAAc,IAAI;YAE3C,wDAAwD;YACxD,+DAA+D;YAC/D,IAAI;YACJ,IAAI;YAEJ,IAAI,SAAS;gBACT,gDAAgD;gBAChD,MAAM,aAAa,OAAO,UAAU;gBACpC,kBAAkB,OAAO,KAAK,KAAK,CAAC,aAAa;gBACjD,iBAAiB;YACrB,OAAO;gBACH,iDAAiD;gBACjD,MAAM,aAAa,OAAO,UAAU,cAAc,iBAAiB;gBACnE,iBAAiB,OAAO,KAAK,KAAK,CAAC,aAAa,QAAQ,iBAAiB;gBACzE,kBAAkB;YACtB;YAEA,OAAO;gBACH,IAAI,AAAC,kBAA4B,OAAX,KAAK,GAAG;gBAC9B;gBACA;gBACA,UAAU;gBACV,WAAW;gBACX,KAAK,SAAS,IAAI;gBAClB,WAAW,UAAU,QAAQ;gBAC7B,aAAa,UAAU,QAAQ;gBAC/B,YAAY;gBACZ,QAAQ,KAAK,GAAG,KAAK;gBACrB,WAAW,KAAK,GAAG;YACvB;QACJ;IACJ;IAEA;;KAEC,GACD,MAAM,wBAAwB,UAAkB,EAAwD;QACpG,IAAI;YACA,oCAAoC;YACpC,MAAM,gBAAgB,OAAO,KAAK,KAAK,CAAC,aAAa;YAErD,8CAA8C;YAC9C,MAAM,eAAe,IAAA,2KAAoB;YACzC,MAAM,gBAAgB,CAAA,yBAAA,mCAAA,aAAc,UAAU,OAAM;YAEpD,MAAM,QAAQ,MAAM,IAAI,CAAC,QAAQ,CAAC,QAAQ,UAAU,eAAe,MAAM;YAEzE,qEAAqE;YACrE,MAAM,UAAU,OAAO,MAAM,SAAS;YAEtC,QAAQ,GAAG,CAAC,AAAC,8BAAkD,OAArB,YAAW,YAAkB,OAAR,SAAQ;YAEvE,OAAO;gBAAE;gBAAS;YAAM;QAC5B,EAAE,OAAO,OAAO;YACZ,QAAQ,IAAI,CAAC,4DAA4D;YAEzE,8CAA8C;YAC9C,MAAM,eAAe,8HAAG,CAAC,cAAc,IAAI;YAC3C,MAAM,eAAe,KAAK,KAAK,CAAC,aAAa;YAE7C,OAAO;gBACH,SAAS;gBACT,OAAO;oBACH,IAAI,AAAC,YAAsB,OAAX,KAAK,GAAG;oBACxB,MAAM;oBACN,IAAI;oBACJ,UAAU,OAAO,KAAK,KAAK,CAAC,aAAa;oBACzC,WAAW,OAAO;oBAClB,KAAK,OAAO,KAAK,KAAK,CAAC,eAAe;oBACtC,WAAW,eAAe;oBAC1B,aAAa,eAAe;oBAC5B,YAAY;oBACZ,QAAQ,KAAK,GAAG,KAAK;oBACrB,WAAW,KAAK,GAAG;gBACvB;YACJ;QACJ;IACJ;IAEA;;;KAGC,GACD,MAAM,8BAA8B,UAAkB,EAAwG;QAC1J,IAAI;YACA,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,GAAG,MAAM,IAAI,CAAC,uBAAuB,CAAC;YAC9D,MAAM,OAAO,UAAU,KAAK,GAAG,CAAC,MAAM,aAAa,mBAAmB;YACtE,QAAQ,GAAG,CAAC,6CAA6C;gBAAE;gBAAY;gBAAS;YAAK;YACrF,OAAO;gBAAE;gBAAS;gBAAM,QAAQ;gBAAY;YAAM;QACtD,EAAE,OAAO,GAAG;YACR,MAAM,WAAW,KAAK,KAAK,CAAC,aAAa,CAAC,8HAAG,CAAC,cAAc,IAAI,GAAG;YACnE,MAAM,OAAO,WAAW,KAAK,GAAG,CAAC,MAAM;YACvC,QAAQ,IAAI,CAAC,sCAAsC;gBAAE;gBAAY,SAAS;gBAAU;YAAK;YACzF,OAAO;gBAAE,SAAS;gBAAU;gBAAM,QAAQ;YAAW;QACzD;IACJ;IAEA,MAAM,QAAQ,OAAe,EAAE,YAAkB,EAAE,gBAAyB,EAAgC;QACxG,MAAM,IAAI,CAAC,iBAAiB;QAE5B,QAAQ,GAAG,CAAC,AAAC,+BAAsC,OAAR;QAE3C,oDAAoD;QACpD,OAAO;YACH,IAAI;YACJ,MAAM,AAAC,MAAgB,OAAX,KAAK,GAAG;YACpB,QAAQ;YACR,WAAW,OAAO;QACtB;IACJ;IAEA;;KAEC,GACD,MAAc,uBAAuB,MAAc,EAAE,gBAAwB,EAAmB;QAC5F,IAAI;YACA,QAAQ,GAAG,CAAC,AAAC,qCAAsD,OAAlB,QAAO,aAA4B,OAAjB;YAEnE,gEAAgE;YAChE,wDAAwD;YACxD,2CAA2C;YAC3C,mCAAmC;YAEnC,iEAAiE;YACjE,MAAM,YAAY,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK;YAC1C,MAAM,cAAc,AAAC,OAAkB,OAAZ,QAAO,OAA4B,OAAvB,UAAU,QAAQ,CAAC,KAAI;YAE9D,QAAQ,GAAG,CAAC;YACZ,OAAO;QAEX,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,yCAAyC;YACvD,MAAM,IAAI,MAAM,AAAC,sCAA4F,OAAvD,iBAAiB,QAAQ,MAAM,OAAO,GAAG,OAAO;QAC1G;IACJ;IAEA;;;KAGC,GACD,MAAc,yBAAyB,OAAe,EAAiB;QACnE,QAAQ,GAAG,CAAC,AAAC,+CAAmE,OAArB,QAAQ,KAAK,CAAC,GAAG,KAAI;QAEhF,+CAA+C;QAC/C,MAAM,IAAI,QAAQ,CAAA,UAAW,WAAW,SAAS;QAEjD,QAAQ,GAAG,CAAC;IAChB;IAEA,MAAM,UAAU,WAAmB,EAAgC;QAC/D,MAAM,IAAI,CAAC,iBAAiB;QAE5B,IAAI,CAAC,IAAI,CAAC,OAAO,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE;YACpC,MAAM,IAAI,MAAM;QACpB;QAEA,IAAI;gBA0BU;YAzBV,4EAA4E;YAC5E,MAAM,OAAO,MAAM,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC;YAE5C,IAAI,CAAC,MAAM;gBACP,MAAM,IAAI,MAAM,AAAC,gBAA2B,OAAZ,aAAY;YAChD;YAEA,MAAM,QAAQ,KAAK,QAAQ;YAC3B,MAAM,SAAS,IAAI,CAAC,YAAY,CAAC;YAEjC,2CAA2C;YAC3C,IAAI,eAAmC;YACvC,IAAI,WAAW,WAAW;gBACtB,IAAI;wBACoB;wBAAA;oBAApB,MAAM,SAAc,CAAA,oBAAA,kBAAA,KAAK,SAAS,cAAd,sCAAA,qBAAA,mBAAA,8BAAA,mBAAsB;oBAC1C,eAAe,IAAI,CAAC,oBAAoB,CAAC;gBAC7C,EAAE,OAAO,GAAG;oBACR,QAAQ,IAAI,CAAC,iDAAiD,aAAa,QAAQ,EAAE,OAAO,GAAG,OAAO;oBACtG,eAAe;gBACnB;YACJ;YAEA,OAAO;gBACH,IAAI;gBACJ;gBACA,MAAM,EAAA,uBAAA,KAAK,cAAc,cAAnB,2CAAA,0BAAA,UAA2B;gBACjC,WAAW;gBACX,sBAAsB,UAAU,4CAA4C;YAChF;QAEJ,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,gCAAgC;YAC9C,MAAM,IAAI,MAAM,AAAC,8BAAoF,OAAvD,iBAAiB,QAAQ,MAAM,OAAO,GAAG,OAAO;QAClG;IACJ;IAEA;;;KAGC,GACD,AAAQ,qBAAqB,KAAU,EAAU;YAWnC;QAVV,6BAA6B;QAC7B,IAAI,OAAO,UAAU,UAAU,OAAO;QAEtC,uDAAuD;QACvD,IAAI,OAAO,UAAU,UAAU;YAC3B,6CAA6C;YAC7C,OAAO,IAAI,CAAC,eAAe,CAAC,OAAO;QACvC;QAEA,kBAAkB;QAClB,MAAM,IAAI,kBAAA,6BAAA,kBAAA,MAAO,QAAQ,cAAf,sCAAA,qBAAA;QACV,IAAI,OAAO,MAAM,YAAY,EAAE,MAAM,KAAK,GAAG;YACzC,MAAM,IAAI,YAAY;QAC1B;QAEA,8CAA8C;QAC9C,MAAM,UAAU,EAAE,OAAO,CAAC,UAAU,IAAI,OAAO,CAAC,UAAU,IAAI,IAAI;QAElE,6CAA6C;QAC7C,IAAI,QAAQ,IAAI,CAAC,UAAU;YACvB,OAAO,OAAO;QAClB;QAEA,uDAAuD;QACvD,OAAO,IAAI,CAAC,eAAe,CAAC;IAChC;IAEA,wDAAwD;IAChD,gBAAgB,CAAS,EAAU;QACvC,IAAI,CAAC,kBAAkB,IAAI,CAAC,IAAI;YAC5B,qCAAqC;YACrC,MAAM,IAAI,EAAE,KAAK,CAAC;YAClB,IAAI,CAAC,GAAG,MAAM,IAAI,YAAY,AAAC,kBAAmB,OAAF,GAAE;YAClD,IAAI,CAAC,CAAC,EAAE;QACZ;QACA,MAAM,CAAC,SAAS,UAAU,EAAE,CAAC,GAAG,EAAE,KAAK,CAAC;QACxC,MAAM,OAAO,CAAC,UAAU,IAAI,MAAM,CAAC,GAAG,EAAE,KAAK,CAAC,GAAG,KAAK,kBAAkB;QACxE,MAAM,SAAS,UAAU,OAAO,WAAW,oBAAoB,GAAG,EAAE;QACpE,MAAM,UAAU,OAAO,OAAO,QAAQ,EAAE;QACxC,OAAO,SAAS;IACpB;IAEA,MAAM,OAAO,WAAmB,EAAE,YAAkB,EAA6B;QAC7E,MAAM,IAAI,CAAC,iBAAiB;QAE5B,IAAI,CAAC,IAAI,CAAC,OAAO,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE;YACpC,MAAM,IAAI,MAAM;QACpB;QAEA,IAAI;gBAWa;YAVb,4EAA4E;YAC5E,MAAM,OAAO,MAAM,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC;YAE5C,IAAI,CAAC,MAAM;gBACP,MAAM,IAAI,MAAM,AAAC,gBAA2B,OAAZ,aAAY;YAChD;YAEA,QAAQ,GAAG,CAAC,AAAC,qBAAgC,OAAZ;YACjC,MAAM,KAAK,MAAM,CAAC;YAElB,MAAM,OAAO,EAAA,uBAAA,KAAK,cAAc,cAAnB,2CAAA,0BAAA,UAA2B,AAAC,UAAqB,OAAZ;YAClD,QAAQ,GAAG,CAAC,AAAC,iCAAqC,OAAL;YAE7C,OAAO;gBAAE;YAAK;QAElB,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,oBAAoB;YAClC,MAAM,IAAI,MAAM,AAAC,0BAAgF,OAAvD,iBAAiB,QAAQ,MAAM,OAAO,GAAG,OAAO;QAC9F;IACJ;IAEA,MAAM,kBAAkB,WAAmB,EAAgD;YAA9C,YAAA,iEAAoB;QAC7D,MAAM,IAAI,CAAC,iBAAiB;QAE5B,IAAI,CAAC,IAAI,CAAC,OAAO,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE;YACpC,MAAM,IAAI,MAAM;QACpB;QAEA,IAAI;YACA,4EAA4E;YAC5E,MAAM,OAAO,MAAM,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC;YAE5C,IAAI,CAAC,MAAM;gBACP,MAAM,IAAI,MAAM,AAAC,gBAA2B,OAAZ,aAAY;YAChD;YAEA,QAAQ,GAAG,CAAC,AAAC,sBAAyD,OAApC,aAAY,0BAAkC,OAAV,WAAU;YAEhF,yCAAyC;YACzC,OAAO,MAAM,KAAK,cAAc;QAEpC,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,iCAAiC;YAC/C,OAAO;QACX;IACJ;IAEA,MAAM,WAAW,WAAmB,EAAmB;QACnD,MAAM,IAAI,CAAC,iBAAiB;QAE5B,IAAI,CAAC,IAAI,CAAC,OAAO,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE;YACpC,MAAM,IAAI,MAAM;QACpB;QAEA,IAAI;YACA,4EAA4E;YAC5E,MAAM,OAAO,MAAM,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC;YAE5C,IAAI,CAAC,MAAM;gBACP,MAAM,IAAI,MAAM,AAAC,gBAA2B,OAAZ,aAAY;YAChD;YAEA,+CAA+C;YAC/C,uFAAuF;YACvF,MAAM,mBAAmB,KAAK,UAAU;YACxC,QAAQ,GAAG,CAAC,AAAC,kCAAkD,OAAjB;YAC9C,OAAO;QAEX,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,4BAA4B;YAC1C,MAAM,IAAI,MAAM,AAAC,0BAAgF,OAAvD,iBAAiB,QAAQ,MAAM,OAAO,GAAG,OAAO;QAC9F;IACJ;IAEA,MAAM,WAAW,OAAe,EAAE,YAAkB,EAAiC;QACjF,MAAM,IAAI,CAAC,iBAAiB;QAE5B,IAAI,CAAC,IAAI,CAAC,OAAO,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE;YACpC,MAAM,IAAI,MAAM;QACpB;QAEA,IAAI;YACA,gDAAgD;YAChD,QAAQ,GAAG,CAAE;YAEb,MAAM,OAAO,MAAM,IAAI,CAAC,OAAO,CAAC,IAAI,CAChC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,EACzB,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,KAAK,EACzB,WACA,OACA,WACA,QAAQ,mCAAmC;;YAG/C,MAAM,KAAK,MAAM,CAAC;YAClB,MAAM,SAAS,MAAM,KAAK,cAAc;YAExC,IAAI,QAAQ;oBACS;gBAAjB,MAAM,WAAW,EAAA,kBAAA,KAAK,SAAS,cAAd,sCAAA,qBAAA,UAAsB,AAAC,YAAsB,OAAX,KAAK,GAAG;gBAC3D,QAAQ,GAAG,CAAC,AAAC,gDAAqE,OAAtB,SAAS,KAAK,CAAC,GAAG,KAAI;gBAClF,OAAO;oBAAE;gBAAS;YACtB,OAAO;gBACH,MAAM,IAAI,MAAM;YACpB;QAEJ,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,+BAA+B;YAC7C,MAAM,IAAI,MAAM,AAAC,oCAA0F,OAAvD,iBAAiB,QAAQ,MAAM,OAAO,GAAG,OAAO;QACxG;IACJ;IAEA,MAAM,cAAc,IAAY,EAAE,EAAU,EAAyC;QACjF,MAAM,IAAI,CAAC,iBAAiB;QAE5B,IAAI,CAAC,IAAI,CAAC,OAAO,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE;YACpC,MAAM,IAAI,MAAM;QACpB;QAEA,IAAI;YACA,MAAM,YAAY,IAAI,CAAC,gBAAgB,CAAC;YACxC,MAAM,UAAU,IAAI,CAAC,gBAAgB,CAAC;YAEtC,QAAQ,GAAG,CAAC,AAAC,8BAAwC,OAAX,MAAK,QAAS,OAAH;YACrD,MAAM,SAAS,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,WAAW;YAErD,QAAQ,GAAG,CAAC,8BAA8B;gBACtC,UAAU,OAAO,KAAK,CAAC,GAAG;gBAC1B,UAAU,OAAO,KAAK,CAAC,GAAG;gBAC1B,cAAc,OAAO,OAAO,KAAK,CAAC,GAAG;gBACrC,cAAc,OAAO,OAAO,KAAK,CAAC,GAAG;YACzC;YAEA,gEAAgE;YAChE,MAAM,WAAW,IAAI,CAAC,iBAAiB,CAAC,OAAO,KAAK,CAAC,GAAG,KAAK,KAAK;YAClE,MAAM,WAAW,IAAI,CAAC,iBAAiB,CAAC,OAAO,KAAK,CAAC,GAAG,KAAK,QAAQ;YAErE,OAAO;gBACH,KAAK;gBACL,KAAK;YACT;QAEJ,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,gCAAgC;YAC9C,MAAM,IAAI,MAAM,AAAC,8BAAoF,OAAvD,iBAAiB,QAAQ,MAAM,OAAO,GAAG,OAAO;QAClG;IACJ;IAEA,kBAAkB;IACV,kBAAkB,KAAU,EAAiB;QACjD,IAAI;YACA,wBAAwB;YACxB,IAAI,SAAS,MAAM;gBACf,OAAO;YACX;YAEA,uDAAuD;YACvD,IAAI,OAAO,UAAU,UAAU;gBAC3B,OAAO,OAAO,KAAK,KAAK,CAAC;YAC7B;YACA,IAAI,OAAO,UAAU,UAAU;gBAC3B,OAAO;YACX;YAEA,uCAAuC;YACvC,IAAI,OAAO,UAAU,UAAU;gBAC3B,6CAA6C;gBAC7C,MAAM,aAAa,MAAM,OAAO,CAAC,eAAe,IAAI,IAAI;gBAExD,8BAA8B;gBAC9B,IAAI,CAAC,cAAc,eAAe,OAAO,WAAW,gBAAgB,GAAG;oBACnE,OAAO,EAAE;gBACb;gBAEA,4FAA4F;gBAC5F,MAAM,aAAa,WAAW;gBAC9B,IAAI,MAAM,aAAa;oBACnB,OAAO;gBACX;gBAEA,yEAAyE;gBACzE,OAAO,OAAO,KAAK,KAAK,CAAC;YAC7B;YAEA,OAAO;QACX,EAAE,OAAO,OAAO;YACZ,QAAQ,IAAI,CAAC,oCAAoC;gBAAE;gBAAO;YAAM;YAChE,OAAO;QACX;IACJ;IAEQ,iBAAiB,KAAa,EAAO;QACzC,2DAA2D;QAC3D,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;YACd,MAAM,IAAI,MAAM;QACpB;QAEA,OAAQ;YACJ,KAAK;gBACD,OAAO,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,EAAE,iCAAiC;YACvE,KAAK;gBACD,OAAO,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,GAAG,EAAE,mBAAmB;YACvD,KAAK;gBACD,OAAO,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,KAAK,EAAE,4BAA4B;YAClE;gBACI,MAAM,IAAI,MAAM,AAAC,sBAA2B,OAAN;QAC9C;IACJ;IAEQ,aAAa,KAAU,EAAoB;QAC/C,0CAA0C;QAC1C,yEAAyE;QACzE,IAAI,OAAO,UAAU,UAAU;YAC3B,gDAAgD;YAChD,OAAQ;gBACJ,KAAK;oBAAG,OAAO,WAAe,0BAA0B;gBACxD,KAAK;oBAAG,OAAO,YAAe,4BAA4B;gBAC1D,KAAK;oBAAG,OAAO,gBAAgB,4BAA4B;gBAC3D,KAAK;oBAAG,OAAO,WAAe,sBAAsB;gBACpD,KAAK;oBAAG,OAAO,cAAe,kCAAkC;gBAChE,KAAK,CAAC;oBAAG,OAAO,WAAc,qBAAqB;gBACnD,KAAK,CAAC;oBAAG,OAAO,WAAc,gBAAgB;gBAC9C,KAAK,CAAC;oBAAG,OAAO,YAAc,WAAW;gBACzC;oBAAS,OAAO;YACpB;QACJ;QAEA,wCAAwC;QACxC,IAAI,OAAO,UAAU,UAAU;YAC3B,OAAQ,MAAM,WAAW;gBACrB,KAAK;oBAAW,OAAO;gBACvB,KAAK;oBAAY,OAAO;gBACxB,KAAK;oBAAgB,OAAO;gBAC5B,KAAK;oBAAW,OAAO;gBACvB,KAAK;oBAAc,OAAO;gBAC1B,KAAK;oBAAY,OAAO;gBACxB,KAAK;oBAAW,OAAO;gBACvB;oBAAS,OAAO;YACpB;QACJ;QAEA,OAAO,WAAW,gBAAgB;IACtC;IA3+BA,YAAY,UAAiC,8HAAG,CAAC,OAAO,AAAyB,EAAE,WAAoB,CAAE;QATzG,+KAAQ,WAAe;QACvB,+KAAQ,WAA4D;QACpE,+KAAQ,eAAuB;QAC/B,+KAAQ,WAAR,KAAA;QACA,+KAAQ,eAAR,KAAA;QACA,+KAAQ,YAAR,KAAA;QACA,+KAAQ,UAAc;QACtB,+KAAQ,yBAA8C;QAGlD,IAAI,CAAC,OAAO,GAAG;QACf,IAAI,CAAC,WAAW,GAAG,eAAe,IAAA,yIAAc;QAChD,IAAI,CAAC,QAAQ,GAAG,aAAkB;QAElC,QAAQ,GAAG,CAAC,AAAC,qCAA0D,OAAtB,SAAQ,gBAA+B,OAAjB,IAAI,CAAC,WAAW;QAEvF,6DAA6D;QAC7D,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;YAChB,IAAI,CAAC,oBAAoB;QAC7B,OAAO;YACH,QAAQ,GAAG,CAAC;QAChB;IACJ;AA+9BJ;AAEA,gFAAgF;AAChF,4EAA4E;AAC5E,IAAI,eAA4C;AAChD,wCAAmC;IAC/B,eAAe,IAAI,qBACf,8HAAG,CAAC,OAAO,KAAK,YAAY,YAAY,WACxC,IAAA,yIAAc;AAEtB;uCAEe","debugId":null}},
    {"offset": {"line": 4066, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/CODE/SLPM-enhanced/src/orchestrator/steps/dynamicEstimateSats.ts"],"sourcesContent":["import { OrchestratorEvent } from '@/lib/types';\nimport { RealAtomiqSwapClient } from '@/integrations/swaps/atomiq';\nimport { ENV } from '@/config/env';\n\nexport async function stepDynamicEstimateSats(\n    amountStrk: number,\n    onEvent: (e: OrchestratorEvent) => void\n) {\n    onEvent({ type: 'mix:progress', message: 'Fetching real-time STRK→sats estimate...', progress: 11 });\n    const client = new RealAtomiqSwapClient(ENV.NETWORK);\n    try {\n        const estimate = await client.estimateLightningSatsFromStrk(amountStrk);\n        console.log('🧮 SLPM DynamicEstimate: Result', estimate);\n        return estimate; // { satsOut, rate, source, quote? }\n    } catch (e) {\n        console.warn('⚠️ SLPM DynamicEstimate: Falling back after failure:', e);\n        const fallback = Math.floor(amountStrk * (ENV.STRK_SATS_RATE || 700));\n        return { satsOut: fallback, rate: fallback / amountStrk, source: 'fallback' as const };\n    }\n}\n"],"names":[],"mappings":";;;;AACA;AACA;;;AAEO,eAAe,wBAClB,UAAkB,EAClB,OAAuC;IAEvC,QAAQ;QAAE,MAAM;QAAgB,SAAS;QAA4C,UAAU;IAAG;IAClG,MAAM,SAAS,IAAI,iKAAoB,CAAC,8HAAG,CAAC,OAAO;IACnD,IAAI;QACA,MAAM,WAAW,MAAM,OAAO,6BAA6B,CAAC;QAC5D,QAAQ,GAAG,CAAC,mCAAmC;QAC/C,OAAO,UAAU,oCAAoC;IACzD,EAAE,OAAO,GAAG;QACR,QAAQ,IAAI,CAAC,wDAAwD;QACrE,MAAM,WAAW,KAAK,KAAK,CAAC,aAAa,CAAC,8HAAG,CAAC,cAAc,IAAI,GAAG;QACnE,OAAO;YAAE,SAAS;YAAU,MAAM,WAAW;YAAY,QAAQ;QAAoB;IACzF;AACJ","debugId":null}},
    {"offset": {"line": 4102, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/CODE/SLPM-enhanced/src/orchestrator/steps/swapToLightning.ts"],"sourcesContent":["import { OrchestratorEvent } from '@/lib/types';\nimport { RealAtomiqSwapClient } from '@/integrations/swaps/atomiq';\nimport { SHARED_SWAP_ACCOUNT_ADDRESS } from '@/config/constants';\nimport { ENV } from '@/config/env';\n\nexport async function stepSwapToLightning(\n    amountStrk: number,\n    depositInfo: {\n        walletAddress: string;\n        mixerContractAddress: string;\n        fundsAvailable?: boolean;\n    },\n    mintInvoiceInfo: {\n        lightningInvoice: string;\n        amount: number;\n        cashu: any;\n        mintQuote: any;\n    },\n    onEvent: (e: OrchestratorEvent) => void\n) {\n    console.log('⚡ SLPM SwapToLN: Starting STRK → Lightning BTC swap');\n    console.log('⚡ SLPM SwapToLN: Parameters:', {\n        amountStrk,\n        fromWallet: depositInfo.walletAddress.slice(0, 10) + '...',\n        network: ENV.NETWORK,\n        fundsAvailable: depositInfo.fundsAvailable || false,\n        targetInvoice: mintInvoiceInfo.lightningInvoice.slice(0, 50) + '...'\n    });\n\n    // Verify funds are available for swapping\n    if (depositInfo.fundsAvailable) {\n        console.log('✅ SLPM SwapToLN: Funds confirmed available after privacy mixer withdrawal');\n    } else {\n        console.log('⚠️ SLPM SwapToLN: Warning - funds availability not confirmed');\n    }\n\n    try {\n        onEvent({\n            type: 'mix:progress',\n            message: `Converting ${amountStrk} STRK to Lightning BTC...`,\n            progress: 25\n        });\n\n        console.log('🏗️ SLPM SwapToLN: Initializing Atomiq client...');\n        const atomiq = new RealAtomiqSwapClient(ENV.NETWORK);\n\n        // Use the Cashu mint invoice from the createMintInvoice step (original mixer flow)\n        const lightningInvoice = mintInvoiceInfo.lightningInvoice?.trim();\n        console.log('⚡ SLPM SwapToLN: Using Cashu mint invoice for automated mixer flow...');\n\n        // Decode invoice to extract exact sats (authoritative output amount)\n        let invoiceSats: number | undefined;\n        try {\n            const { millisatoshis } = await import('bolt11').then(m => m.decode(lightningInvoice));\n            if (millisatoshis) {\n                invoiceSats = Number(BigInt(millisatoshis) / 1000n);\n            }\n        } catch (e) {\n            console.warn('⚠️ SLPM SwapToLN: Failed to decode invoice for sats amount, proceeding (swap call will re-validate):', e instanceof Error ? e.message : e);\n        }\n\n        // Cashu mint invoices always have preset amounts (original mixer flow)\n        if (invoiceSats == null || invoiceSats <= 0) {\n            console.warn('⚠️ SLPM SwapToLN: Could not decode invoice amount, using mint amount as fallback');\n            invoiceSats = mintInvoiceInfo.amount; // Use the known mint amount\n        }\n\n        console.log('⚡ SLPM SwapToLN: Lightning invoice details:', {\n            invoice: lightningInvoice.slice(0, 50) + '...',\n            invoiceSats,\n            strkInputApprox: amountStrk,\n            note: 'invoiceSats is authoritative output; STRK input derived by SDK'\n        });\n\n        onEvent({\n            type: 'mix:progress',\n            message: `Converting ${amountStrk} STRK to Lightning BTC...`,\n            progress: 30\n        });\n\n        // Execute the simplified STRK → Lightning swap\n        console.log('⚡ SLPM SwapToLN: Executing STRK → Lightning swap (exactOut via invoice)...');\n        const swapResult = await atomiq.swapStrkToLightning(\n            invoiceSats || mintInvoiceInfo.amount, // pass decoded invoice sats (exactOut target)\n            lightningInvoice,\n            SHARED_SWAP_ACCOUNT_ADDRESS\n        );\n\n        console.log('⚡ SLPM SwapToLN: Swap result:', {\n            success: swapResult.success,\n            txId: swapResult.txId,\n            amount: swapResult.amount,\n            route: swapResult.route,\n            error: swapResult.error\n        });\n\n        // Verify swap succeeded\n        if (!swapResult.success) {\n            throw new Error(`STRK → Lightning swap failed: ${swapResult.error || 'Unknown error'}`);\n        }\n\n        // Wait for Lightning payment confirmation\n        console.log('⏳ SLPM SwapToLN: Waiting for Lightning payment confirmation...');\n        onEvent({\n            type: 'mix:progress',\n            message: 'Waiting for Lightning payment confirmation...',\n            progress: 35\n        });\n\n        // In real implementation, we'd wait for actual Lightning confirmation\n        // For now, simulate the confirmation delay\n        await new Promise(resolve => setTimeout(resolve, 3000));\n\n        console.log('✅ SLPM SwapToLN: Lightning payment confirmed!');\n        onEvent({\n            type: 'mix:progress',\n            message: 'STRK successfully swapped to Lightning BTC',\n            progress: 40\n        });\n\n        return {\n            executionId: swapResult.txId || `swap_${Date.now()}`,\n            lightningInvoice: lightningInvoice,\n            lightningAmount: invoiceSats || mintInvoiceInfo.amount,\n            lightningPaymentHash: swapResult.txId, // Use txId as payment reference\n            swapTxId: swapResult.txId,\n            amountIn: amountStrk,\n            amountOut: swapResult.amount,\n            fee: 0, // Fee included in swap amount for simplified interface\n            cashu: mintInvoiceInfo.cashu,\n            mintQuote: mintInvoiceInfo.mintQuote\n        };\n\n    } catch (error) {\n        console.error('❌ SLPM SwapToLN: Step failed:', error);\n        console.error('🔍 SLPM SwapToLN: Error details:', {\n            message: error instanceof Error ? error.message : 'Unknown error',\n            stack: error instanceof Error ? error.stack : undefined,\n            context: {\n                amountStrk,\n                network: ENV.NETWORK\n            }\n        });\n\n        onEvent({\n            type: 'mix:error',\n            message: error instanceof Error ? error.message : 'Unknown swap error'\n        });\n        throw error;\n    }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 4231, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/CODE/SLPM-enhanced/src/orchestrator/steps/claimCashuProofs.ts"],"sourcesContent":["import { OrchestratorEvent } from '@/lib/types';\nimport { RealCashuClient } from '@/integrations/cashu/client';\nconst isServer = typeof window === 'undefined';\nimport { getDecodedToken } from '@cashu/cashu-ts';\n\nexport async function stepClaimCashuProofs(\n    mintQuote: any,\n    cashu: RealCashuClient,\n    targetSats: number,\n    onEvent: (e: OrchestratorEvent) => void\n) {\n    console.log('🪙 SLPM ClaimCashu: Starting Cashu proof claiming');\n    console.log('🪙 SLPM ClaimCashu: Parameters:', {\n        quoteId: mintQuote.quote,\n        amount: targetSats,\n        expectedState: 'PAID'\n    });\n\n    try {\n        onEvent({\n            type: 'mix:progress',\n            message: `Claiming Cashu proofs for ${targetSats} sats...`,\n            progress: 45\n        });\n\n        // Check if the Lightning invoice has been paid by Atomiq\n        console.log('🔍 SLPM ClaimCashu: Checking if mint quote was paid...');\n        const quoteStatus = await cashu.checkMintQuote(mintQuote.quote);\n\n        console.log('🔍 SLPM ClaimCashu: Quote status:', {\n            quote: quoteStatus.quote,\n            state: quoteStatus.state,\n            amount: quoteStatus.amount.toString()\n        });\n\n        if (quoteStatus.state !== 'PAID') {\n            // Wait a bit and check again\n            console.log('⏳ SLPM ClaimCashu: Payment not confirmed yet, waiting...');\n            await new Promise(resolve => setTimeout(resolve, 2000));\n\n            const retryStatus = await cashu.checkMintQuote(mintQuote.quote);\n            console.log('🔍 SLPM ClaimCashu: Retry status:', retryStatus.state);\n\n            if (retryStatus.state !== 'PAID') {\n                throw new Error(`Lightning payment not confirmed. Quote state: ${retryStatus.state}`);\n            }\n        }\n\n        console.log('✅ SLPM ClaimCashu: Lightning payment confirmed by Cashu mint');\n\n        // Mint the proofs now that payment is confirmed\n        console.log('🏭 SLPM ClaimCashu: Minting Cashu proofs...');\n        const proofs = await cashu.mintProofs(BigInt(targetSats), mintQuote.quote);\n\n        console.log('🏭 SLPM ClaimCashu: Cashu proofs minted:', {\n            count: proofs.length,\n            totalAmount: proofs.reduce((sum, p) => sum + Number(p.amount), 0),\n            proofs: proofs.map(p => ({\n                amount: Number(p.amount),\n                secret: p.secret?.slice(0, 10) + '...'\n            }))\n        });\n\n        // Create a token so user can save/redeem later\n        try {\n            const totalAmount = proofs.reduce((sum, p) => sum + Number(p.amount), 0);\n            const token = cashu.createToken(proofs);\n            // Persist server-side to avoid loss (server-only)\n            try {\n                // Extract mint URL from token for accurate recovery later\n                let mintUrl = 'unknown';\n                try {\n                    const decoded = getDecodedToken(token);\n                    mintUrl = decoded?.mint || mintUrl;\n                } catch (_) { }\n                if (isServer) {\n                    const { default: TokenVault } = await import('@/storage/tokenVault.server');\n                    await TokenVault.set({\n                        quote: mintQuote.quote,\n                        token,\n                        mintUrl,\n                        amountSats: totalAmount,\n                        proofsCount: proofs.length,\n                        createdAt: Date.now()\n                    });\n                    console.log('💾 SLPM ClaimCashu: Saved ecash token to server vault for quote', mintQuote.quote);\n                }\n            } catch (e) {\n                console.warn('⚠️ SLPM ClaimCashu: Failed to save token to server vault:', e);\n            }\n            if (typeof window !== 'undefined') {\n                const key = `slpm:cashu-token:${mintQuote.quote}`;\n                window.localStorage.setItem(key, token);\n                console.log('💾 SLPM ClaimCashu: Saved ecash token to localStorage under key', key);\n            }\n        } catch (e) {\n            console.warn('⚠️ SLPM ClaimCashu: Could not persist ecash token:', e);\n        }\n\n        // Verify total amount matches expectation\n        const totalAmount = proofs.reduce((sum, p) => sum + Number(p.amount), 0);\n        if (Math.abs(totalAmount - targetSats) > 1) { // Allow 1 sat tolerance\n            console.warn('⚠️ SLPM ClaimCashu: Amount mismatch:', {\n                expected: targetSats,\n                received: totalAmount,\n                difference: totalAmount - targetSats\n            });\n        }\n\n        onEvent({\n            type: 'mix:progress',\n            message: `Cashu proofs claimed: ${proofs.length} proofs for ${totalAmount} sats`,\n            progress: 50\n        });\n\n        console.log('🪙 SLPM ClaimCashu: Step completed successfully');\n        return proofs;\n\n    } catch (error) {\n        console.error('❌ SLPM ClaimCashu: Step failed:', error);\n        console.error('🔍 SLPM ClaimCashu: Error details:', {\n            message: error instanceof Error ? error.message : 'Unknown error',\n            stack: error instanceof Error ? error.stack : undefined,\n            context: {\n                quoteId: mintQuote.quote,\n                targetSats,\n                quoteState: mintQuote.state\n            }\n        });\n\n        onEvent({\n            type: 'mix:error',\n            message: error instanceof Error ? error.message : 'Unknown Cashu claiming error'\n        });\n        throw error;\n    }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 4350, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/CODE/SLPM-enhanced/src/orchestrator/steps/privacy.ts"],"sourcesContent":["import { OrchestratorEvent, MixRequest } from '@/lib/types';\nimport { MultiMintCashuManager, RealCashuClient } from '@/integrations/cashu/client';\nimport { ENV } from '@/config/env';\n\nexport async function stepPrivacy(\n    req: MixRequest,\n    proofs: any[],\n    cashu: RealCashuClient,\n    cashuManager: MultiMintCashuManager | null,\n    onEvent: (e: OrchestratorEvent) => void\n) {\n    console.log('🔒 SLPM Privacy: Starting privacy step');\n    console.log('🔒 SLPM Privacy: Configuration:', {\n        enableRandomizedMints: req.enableRandomizedMints,\n        enableSplitOutputs: req.enableSplitOutputs,\n        splitCount: req.splitCount,\n        enableTimeDelays: req.enableTimeDelays,\n        enableAmountObfuscation: req.enableAmountObfuscation,\n        enableDecoyTx: req.enableDecoyTx,\n        amountStrk: req.amountStrk\n    });\n    console.log('🔒 SLPM Privacy: Input proofs:', {\n        count: proofs.length,\n        proofs: proofs.map(p => ({ amount: p.amount, C: p.C?.slice(0, 10) + '...' }))\n    });\n\n    // Calculate actual total value from proofs\n    const totalProofValue = proofs.reduce((sum, proof) => sum + BigInt(proof.amount), 0n);\n    console.log('🔒 SLPM Privacy: Total proof value:', totalProofValue.toString(), 'sats');\n\n    try {\n        let workingProofs = proofs;\n\n        const multiMintEnabled = req.enableRandomizedMints && cashuManager && !ENV.CASHU_SINGLE_MINT;\n        if (multiMintEnabled) {\n            console.log('🌐 SLPM Privacy: Distributing across multiple mints...');\n            const distributionAmount = totalProofValue;\n            console.log('🌐 SLPM Privacy: Distribution amount:', distributionAmount.toString(), 'sats');\n\n            const { distributions } = await cashuManager.distributeSend(distributionAmount, proofs, 2);\n            workingProofs = distributions.flatMap((d) => d.proofs);\n\n            console.log('🌐 SLPM Privacy: Distribution result:', {\n                originalProofs: proofs.length,\n                newProofs: workingProofs.length,\n                distributions: distributions.length\n            });\n\n            onEvent({ type: 'cashu:routed', message: 'Distributed across multiple mints', progress: 60 });\n            console.log('✅ SLPM Privacy: Multi-mint distribution completed');\n        } else {\n            console.log('⏭️ SLPM Privacy: Skipping multi-mint distribution (disabled or no manager)');\n        }\n\n        const splitEnabled = req.enableSplitOutputs && req.splitCount > 1 && !ENV.DISABLE_CASHU_SPLIT;\n        if (splitEnabled) {\n            console.log('🔀 SLPM Privacy: Splitting outputs...');\n            const satsAvailable = Number(totalProofValue);\n            const perPart = BigInt(Math.floor(satsAvailable / Math.max(1, req.splitCount)));\n            console.log('🔀 SLPM Privacy: Split parameters:', {\n                totalSats: satsAvailable,\n                splitCount: req.splitCount,\n                perPart: perPart.toString()\n            });\n\n            const splits: typeof workingProofs = [];\n            let pool = workingProofs.slice();\n\n            for (let i = 0; i < req.splitCount; i++) {\n                console.log(`🔀 SLPM Privacy: Creating split ${i + 1}/${req.splitCount}...`);\n                const { keep, send } = await cashu.send(perPart, pool);\n                splits.push(...send);\n                pool = keep;\n                console.log(`🔀 SLPM Privacy: Split ${i + 1} created:`, {\n                    sentProofs: send.length,\n                    keepProofs: keep.length\n                });\n            }\n\n            workingProofs = splits.length ? splits : workingProofs;\n            console.log('🔀 SLPM Privacy: Split result:', {\n                finalProofs: workingProofs.length,\n                splitSuccessful: splits.length > 0\n            });\n\n            onEvent({ type: 'cashu:routed', message: `Split into ${req.splitCount} outputs`, progress: 70 });\n            console.log('✅ SLPM Privacy: Output splitting completed');\n        } else {\n            console.log('⏭️ SLPM Privacy: Skipping output splitting (disabled or invalid split count)');\n        }\n\n        if (req.enableTimeDelays) {\n            console.log('⏱️ SLPM Privacy: Applying time delays...');\n            const delayMs = jitter(1000);\n            console.log('⏱️ SLPM Privacy: Delay duration:', delayMs, 'ms');\n            await delay(delayMs);\n            console.log('✅ SLPM Privacy: Time delay applied');\n        } else {\n            console.log('⏭️ SLPM Privacy: Skipping time delays (disabled)');\n        }\n\n        if (req.enableAmountObfuscation) {\n            console.log('💰 SLPM Privacy: Applying amount obfuscation...');\n            await delay(200);\n            console.log('✅ SLPM Privacy: Amount obfuscation applied');\n        } else {\n            console.log('⏭️ SLPM Privacy: Skipping amount obfuscation (disabled)');\n        }\n\n        if (req.enableDecoyTx) {\n            console.log('👻 SLPM Privacy: Applying decoy transactions...');\n            await delay(200);\n            console.log('✅ SLPM Privacy: Decoy transactions applied');\n        } else {\n            console.log('⏭️ SLPM Privacy: Skipping decoy transactions (disabled)');\n        }\n\n        onEvent({ type: 'mix:progress', message: 'Privacy heuristics applied', progress: 80 });\n\n        console.log('🔒 SLPM Privacy: Final result:', {\n            inputProofs: proofs.length,\n            outputProofs: workingProofs.length,\n            privacyFeaturesApplied: [\n                req.enableRandomizedMints && 'multi-mint',\n                req.enableSplitOutputs && 'split-outputs',\n                req.enableTimeDelays && 'time-delays',\n                req.enableAmountObfuscation && 'amount-obfuscation',\n                req.enableDecoyTx && 'decoy-tx'\n            ].filter(Boolean)\n        });\n        console.log('🔒 SLPM Privacy: Step completed successfully');\n\n        return workingProofs;\n\n    } catch (error) {\n        console.error('❌ SLPM Privacy: Step failed:', error);\n        console.error('🔍 SLPM Privacy: Error details:', {\n            message: error instanceof Error ? error.message : 'Unknown error',\n            stack: error instanceof Error ? error.stack : undefined,\n            context: {\n                proofsCount: proofs.length,\n                hasManager: !!cashuManager,\n                configuration: {\n                    enableRandomizedMints: req.enableRandomizedMints,\n                    enableSplitOutputs: req.enableSplitOutputs,\n                    splitCount: req.splitCount\n                }\n            }\n        });\n        throw error;\n    }\n}\n\nfunction delay(ms: number) { return new Promise((res) => setTimeout(res, ms)); }\nfunction jitter(ms: number) { const v = Math.floor(ms * 0.3); return ms + Math.floor(Math.random() * v); }\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 4512, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/CODE/SLPM-enhanced/src/integrations/cashu/direct.ts"],"sourcesContent":["/**\n * Direct Cashu integration following standalone script pattern exactly\n * Receive token ONCE, then use received proofs for all operations\n */\n\n/**\n * Server-side Cashu operations following standalone script pattern exactly\n * 1. Receive token ONCE and immediately melt (with built-in retry)\n * 2. Retry capability built into single API call\n * 3. Never try to receive same token twice\n */\nexport async function serverSideCashuMelt(\n    encodedToken: string,\n    invoice: string,\n    quoteId?: string // Optional for backward compatibility\n): Promise<{ success: true; result: { invoiceAmount: number; change: any[]; changeAmount: number; mintUrl: string } } | { success: false; error: string; details?: any }> {\n    try {\n        console.log('🔍 Server-side Cashu Melt: Starting single-API melt with retry...');\n\n        const response = await fetch('/api/cashu/receive-and-melt', {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({\n                encodedToken,\n                invoice\n            }),\n        });\n\n        const data = await response.json();\n\n        if (!response.ok) {\n            console.error('❌ Server-side Cashu Melt: API error:', data);\n\n            // Handle specific insufficient balance error\n            if (data.error === 'INSUFFICIENT_BALANCE') {\n                return {\n                    success: false,\n                    error: 'Insufficient balance for invoice + fees',\n                    details: data.details\n                };\n            }\n\n            return {\n                success: false,\n                error: data.error || 'Server-side melt failed'\n            };\n        }\n\n        console.log('✅ Server-side Cashu Melt: Completed successfully:', data.result);\n\n        return {\n            success: true,\n            result: data.result\n        };\n\n    } catch (error) {\n        console.error('❌ Server-side Cashu Melt: Network error:', error);\n        return {\n            success: false,\n            error: error instanceof Error ? error.message : 'Network error during melt'\n        };\n    }\n}\n\n/**\n * Pre-calculate maximum invoice amount that will fit in token balance\n * Uses fee formula: max(2 sats, 0.01 * amount) + 1\n */\nexport async function calculateMaxInvoiceAmount(encodedToken: string): Promise<{ success: true; maxAmount: number; availableBalance: number } | { success: false; error: string }> {\n    try {\n        console.log('🧮 Calculating max invoice amount from token balance...');\n\n        // Import here to avoid issues if running client-side\n        const { getDecodedToken } = await import('@cashu/cashu-ts');\n\n        // Decode token to get available balance\n        const decoded = getDecodedToken(encodedToken);\n        const availableBalance = decoded.proofs.reduce((sum: number, p: any) => sum + p.amount, 0);\n\n        // Use fee formula to estimate fees: max(2 sats, 0.01 * amount) + 1\n        // We need to solve: amount + max(2, 0.01 * amount) + 1 <= availableBalance\n        // Since fee grows with amount, we use iterative approach\n\n        let maxAmount = 0;\n        for (let testAmount = 1; testAmount <= availableBalance; testAmount++) {\n            const estimatedFee = Math.max(2, Math.ceil(0.01 * testAmount)) + 1;\n            const totalRequired = testAmount + estimatedFee;\n\n            if (totalRequired <= availableBalance) {\n                maxAmount = testAmount;\n            } else {\n                break; // Found the limit\n            }\n        }\n\n        console.log('✅ Max invoice calculation:', {\n            availableBalance,\n            maxAmount,\n            estimatedFee: Math.max(2, Math.ceil(0.01 * maxAmount)) + 1\n        });\n\n        return {\n            success: true,\n            maxAmount,\n            availableBalance\n        };\n\n    } catch (error) {\n        console.error('❌ Failed to calculate max invoice amount:', error);\n        return {\n            success: false,\n            error: error instanceof Error ? error.message : 'Calculation failed'\n        };\n    }\n}\n\n/**\n * Helper function to retrieve encoded token from storage\n */\nexport async function getEncodedTokenFromStorage(quoteId: string): Promise<string | null> {\n    console.log('🔍 Getting encoded token from storage for quote:', quoteId);\n\n    try {\n        // Try browser localStorage first\n        if (typeof window !== 'undefined') {\n            const key = `slpm:cashu-token:${quoteId}`;\n            const token = window.localStorage.getItem(key);\n            if (token) {\n                console.log('✅ Found token in localStorage');\n                return token;\n            }\n        }\n\n        // Try server-side storage\n        if (typeof window === 'undefined') {\n            try {\n                const { default: TokenVault } = await import('@/storage/tokenVault.server');\n                const tokenData = await TokenVault.get(quoteId);\n                if (tokenData?.token) {\n                    console.log('✅ Found token in server vault');\n                    return tokenData.token;\n                }\n            } catch (e) {\n                console.warn('⚠️ Could not access server vault:', e);\n            }\n        }\n\n        console.warn('❌ No encoded token found for quote:', quoteId);\n        return null;\n\n    } catch (error) {\n        console.error('❌ Error retrieving encoded token:', error);\n        return null;\n    }\n}"],"names":[],"mappings":"AAAA;;;CAGC,GAED;;;;;CAKC;;;;;;;;AACM,eAAe,oBAClB,YAAoB,EACpB,OAAe,EACf,OAAgB,AAAC,sCAAsC;;IAEvD,IAAI;QACA,QAAQ,GAAG,CAAC;QAEZ,MAAM,WAAW,MAAM,MAAM,+BAA+B;YACxD,QAAQ;YACR,SAAS;gBACL,gBAAgB;YACpB;YACA,MAAM,KAAK,SAAS,CAAC;gBACjB;gBACA;YACJ;QACJ;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAEhC,IAAI,CAAC,SAAS,EAAE,EAAE;YACd,QAAQ,KAAK,CAAC,wCAAwC;YAEtD,6CAA6C;YAC7C,IAAI,KAAK,KAAK,KAAK,wBAAwB;gBACvC,OAAO;oBACH,SAAS;oBACT,OAAO;oBACP,SAAS,KAAK,OAAO;gBACzB;YACJ;YAEA,OAAO;gBACH,SAAS;gBACT,OAAO,KAAK,KAAK,IAAI;YACzB;QACJ;QAEA,QAAQ,GAAG,CAAC,qDAAqD,KAAK,MAAM;QAE5E,OAAO;YACH,SAAS;YACT,QAAQ,KAAK,MAAM;QACvB;IAEJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,4CAA4C;QAC1D,OAAO;YACH,SAAS;YACT,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACpD;IACJ;AACJ;AAMO,eAAe,0BAA0B,YAAoB;IAChE,IAAI;QACA,QAAQ,GAAG,CAAC;QAEZ,qDAAqD;QACrD,MAAM,EAAE,eAAe,EAAE,GAAG;QAE5B,wCAAwC;QACxC,MAAM,UAAU,gBAAgB;QAChC,MAAM,mBAAmB,QAAQ,MAAM,CAAC,MAAM,CAAC,CAAC,KAAa,IAAW,MAAM,EAAE,MAAM,EAAE;QAExF,mEAAmE;QACnE,2EAA2E;QAC3E,yDAAyD;QAEzD,IAAI,YAAY;QAChB,IAAK,IAAI,aAAa,GAAG,cAAc,kBAAkB,aAAc;YACnE,MAAM,eAAe,KAAK,GAAG,CAAC,GAAG,KAAK,IAAI,CAAC,OAAO,eAAe;YACjE,MAAM,gBAAgB,aAAa;YAEnC,IAAI,iBAAiB,kBAAkB;gBACnC,YAAY;YAChB,OAAO;gBACH,OAAO,kBAAkB;YAC7B;QACJ;QAEA,QAAQ,GAAG,CAAC,8BAA8B;YACtC;YACA;YACA,cAAc,KAAK,GAAG,CAAC,GAAG,KAAK,IAAI,CAAC,OAAO,cAAc;QAC7D;QAEA,OAAO;YACH,SAAS;YACT;YACA;QACJ;IAEJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,6CAA6C;QAC3D,OAAO;YACH,SAAS;YACT,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACpD;IACJ;AACJ;AAKO,eAAe,2BAA2B,OAAe;IAC5D,QAAQ,GAAG,CAAC,oDAAoD;IAEhE,IAAI;QACA,iCAAiC;QACjC,wCAAmC;YAC/B,MAAM,MAAM,AAAC,oBAA2B,OAAR;YAChC,MAAM,QAAQ,OAAO,YAAY,CAAC,OAAO,CAAC;YAC1C,IAAI,OAAO;gBACP,QAAQ,GAAG,CAAC;gBACZ,OAAO;YACX;QACJ;QAEA,0BAA0B;QAC1B;;QAaA,QAAQ,IAAI,CAAC,uCAAuC;QACpD,OAAO;IAEX,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,qCAAqC;QACnD,OAAO;IACX;AACJ","debugId":null}},
    {"offset": {"line": 4639, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/CODE/SLPM-enhanced/src/orchestrator/steps/swapBack.ts"],"sourcesContent":["import { OrchestratorEvent } from '@/lib/types';\nimport { RealAtomiqSwapClient } from '@/integrations/swaps/atomiq';\nimport { RealCashuClient } from '@/integrations/cashu/client';\nimport { EcashProof } from '@/domain';\nimport { ENV } from '@/config/env';\nimport { serverSideCashuMelt, getEncodedTokenFromStorage, calculateMaxInvoiceAmount } from '@/integrations/cashu/direct';\nimport { getSharedSwapAddress, transferStrkFromShared } from '@/integrations/starknet/sharedAccount';\n\nexport async function stepSwapBack(\n    cashuProofs: EcashProof[],\n    destinations: string[],\n    cashu: RealCashuClient,\n    onEvent: (e: OrchestratorEvent) => void,\n    mintQuoteId?: string // Add optional quote ID for token retrieval\n) {\n    console.log('🔄 SLPM SwapBack: Starting SIMPLIFIED Cashu redemption (no mixing/splitting/delays)');\n\n    const totalSats = cashuProofs.reduce((sum, p) => sum + Number(p.amount), 0);\n    const singleDestination = destinations[0]; // Use only the first destination\n    const sharedDest = getSharedSwapAddress();\n\n    console.log('🔄 SLPM SwapBack: SIMPLIFIED Parameters:', {\n        proofsCount: cashuProofs.length,\n        totalSats,\n        singleDestination: singleDestination?.slice(0, 10) + '...',\n        network: ENV.NETWORK,\n        mintUrl: ENV.CASHU_DEFAULT_MINT\n    });\n\n    try {\n        onEvent({ type: 'mix:progress', message: 'Converting ALL ecash to Lightning and STRK (single transaction)...', progress: 80 });\n\n        // Initialize Atomiq client for Lightning → STRK swaps\n        const atomiq = new RealAtomiqSwapClient(ENV.NETWORK);\n\n        onEvent({ type: 'mix:progress', message: 'Calculating optimal invoice amount and melting ALL ecash proofs...', progress: 85 });\n\n        // Step 1: Calculate safe amount FIRST, then create properly sized Atomiq swap\n        const { finalInvoice, finalSwapId, meltResult } = await redeemAllCashuToInvoice(\n            cashuProofs,\n            totalSats,\n            // Route LN→STRK swap to shared account to avoid signer mismatch, fallback to final destination if not configured\n            sharedDest || singleDestination,\n            atomiq,\n            onEvent,\n            mintQuoteId\n        );\n\n        console.log('✅ SLPM SwapBack: ALL Cashu proofs melted:', {\n            invoiceAmount: finalInvoice.slice(0, 30) + '...',\n            changeProofs: meltResult.change?.length || 0,\n            totalRedeemed: meltResult.usedAmount\n        });\n\n        onEvent({ type: 'mix:progress', message: 'Waiting for Lightning payment to complete...', progress: 90 });\n\n        // Step 3: Wait for Lightning payment and claim STRK to single destination\n        console.log('🔄 SLPM SwapBack: Waiting for Lightning payment...');\n        const completed = await atomiq.waitLightningToStrkCompletion(finalSwapId, 300000);\n\n        let finalStatus = 'FAILED';\n        if (completed) {\n            console.log('⚡ SLPM SwapBack: Lightning payment confirmed, claiming STRK...');\n            try {\n                await atomiq.claimLightningToStrkSwap(finalSwapId);\n                finalStatus = 'CLAIMED';\n                console.log('✅ SLPM SwapBack: STRK claimed to single destination');\n                console.log('✅ SLPM SwapBack: STRK claimed to swap destination');\n\n                // If we used the shared account as destination, forward to the final recipient\n                if (sharedDest && sharedDest.toLowerCase() !== singleDestination.toLowerCase()) {\n                    try {\n                        // Query the swap status to get the actual STRK amount out (Wei)\n                        const status = await atomiq.getStatus(finalSwapId);\n                        const amountWei = status.amountOut ?? 0n;\n                        console.log('🚚 SLPM SwapBack: Forwarding STRK from shared to final recipient...', {\n                            from: sharedDest,\n                            to: singleDestination,\n                            amountWei: amountWei.toString()\n                        });\n                        await transferStrkFromShared(singleDestination, amountWei);\n                        console.log('✅ SLPM SwapBack: Forward transfer submitted');\n                    } catch (fwdErr) {\n                        console.error('❌ SLPM SwapBack: Forward transfer failed:', fwdErr);\n                        finalStatus = 'PAYMENT_CONFIRMED_CLAIM_FAILED';\n                    }\n                }\n            } catch (claimError) {\n                console.error('❌ SLPM SwapBack: Claim failed:', claimError);\n                if (claimError instanceof Error && /Invalid signer provided/i.test(claimError.message)) {\n                    console.error('🛠️ SLPM SwapBack: Signer invalid. Ensure SHARED_SWAP_ACCOUNT_PRIVATE_KEY and SHARED_SWAP_ACCOUNT_ADDRESS are set and correspond to a deployed Starknet account with funds for fees.');\n                }\n                finalStatus = 'PAYMENT_CONFIRMED_CLAIM_FAILED';\n            }\n        } else {\n            console.warn('⚠️ SLPM SwapBack: Lightning payment did not complete in time');\n        }\n\n        const results = [{\n            destination: singleDestination,\n            satsRedeemed: Number(meltResult.usedAmount || totalSats),\n            strkSent: Number(meltResult.usedAmount || totalSats),\n            txId: finalSwapId,\n            status: finalStatus\n        }];\n\n        console.log('📊 SLPM SwapBack: SIMPLIFIED Final result:', {\n            destination: singleDestination,\n            totalSatsRedeemed: results[0].satsRedeemed,\n            totalStrkSent: results[0].strkSent,\n            status: finalStatus\n        });\n\n        onEvent({ type: 'mix:progress', message: 'Simplified swap completed', progress: 95 });\n\n        return results;\n\n    } catch (error) {\n        console.error('❌ SLPM SwapBack: SIMPLIFIED Critical error:', error);\n        throw error;\n    }\n}\n\n// SIMPLIFIED redemption function - calculate safe amount first, then create optimized swap and melt\nasync function redeemAllCashuToInvoice(\n    allProofs: EcashProof[],\n    totalAmount: number,\n    destination: string,\n    atomiq: RealAtomiqSwapClient,\n    onEvent: (e: OrchestratorEvent) => void,\n    mintQuoteId?: string\n): Promise<{ finalInvoice: string; finalSwapId: string; meltResult: any }> {\n\n    console.log('🪙 SLPM SwapBack: Starting SIMPLIFIED Cashu redemption (using encoded token like standalone)');\n\n    const totalAvailable = allProofs.reduce((sum, p) => sum + Number(p.amount), 0);\n    console.log('💰 SLPM SwapBack: ALL Available proofs:', {\n        count: allProofs.length,\n        totalAmount: totalAvailable,\n        mintUrl: ENV.CASHU_DEFAULT_MINT\n    });\n\n    try {\n        console.log('⚡ SLPM SwapBack: Retrieving encoded token for standalone pattern...');\n\n        let encodedToken: string | null = null;\n\n        if (mintQuoteId) {\n            console.log('🔍 SLPM SwapBack: Looking for token with quote ID:', mintQuoteId);\n            encodedToken = await getEncodedTokenFromStorage(mintQuoteId);\n        }\n\n        if (!encodedToken) {\n            console.warn('⚠️ No encoded token found for quote ID, trying localStorage scan...');\n            // Fallback: scan localStorage for any cashu tokens\n            if (typeof window !== 'undefined') {\n                const keys = Object.keys(localStorage).filter(key => key.startsWith('slpm:cashu-token:'));\n                if (keys.length > 0) {\n                    const latestKey = keys[keys.length - 1]; // Get the most recent token\n                    encodedToken = localStorage.getItem(latestKey);\n                    console.log('✅ Found encoded token in localStorage:', latestKey);\n                }\n            }\n        }\n\n        if (!encodedToken) {\n            console.warn('⚠️ No encoded token found anywhere, this may cause issues');\n            throw new Error('No encoded token available - cannot use standalone script pattern');\n        }\n\n        console.log('✅ Successfully retrieved encoded token for direct melt');\n\n        // PRE-CALCULATE MAX INVOICE: Use fee formula to determine optimal invoice size\n        console.log('🧮 SLPM SwapBack: Calculating maximum invoice amount from token balance...');\n        const maxCalcResult = await calculateMaxInvoiceAmount(encodedToken);\n\n        if (!maxCalcResult.success) {\n            throw new Error(`Failed to calculate max invoice amount: ${maxCalcResult.error}`);\n        }\n\n        console.log('💰 SLPM SwapBack: Token balance analysis:', {\n            availableBalance: maxCalcResult.availableBalance,\n            maxInvoiceAmount: maxCalcResult.maxAmount,\n            originalInvoiceAmount: totalAmount\n        });\n\n        // DEFAULT FLOW: Create Atomiq invoice and melt ecash to it automatically\n        console.log('🔄 SLPM SwapBack: Getting optimized Atomiq quote for max safe amount...');\n        console.log(`   Using calculated safe amount: ${maxCalcResult.maxAmount} sats (original was ${totalAmount} sats)`);\n\n        // Get new Atomiq swap with max safe amount that will definitely fit\n        const optimizedSwap = await atomiq.beginLightningToStrkSwap(maxCalcResult.maxAmount, destination);\n\n        console.log('✅ SLPM SwapBack: Got optimized Atomiq quote:', {\n            swapId: optimizedSwap.id.slice(0, 20) + '...',\n            safeAmount: maxCalcResult.maxAmount,\n            invoicePrefix: optimizedSwap.invoice.slice(0, 30) + '...'\n        });\n\n        const finalInvoice = optimizedSwap.invoice;\n        const finalSwapId = optimizedSwap.id;\n\n        // Log full invoice for easy copy, and stash on window for devtools access\n        console.log('📋 SLPM SwapBack: Full Atomiq invoice (copy):', finalInvoice);\n        if (typeof window !== 'undefined') {\n            try {\n                (window as any)._slpmLastAtomiqInvoice = finalInvoice;\n                console.log('ℹ️ Access invoice via window._slpmLastAtomiqInvoice');\n            } catch {/* ignore */ }\n        }\n\n        // SERVER-SIDE MELT: Receive token once and melt (with built-in retry capability)\n        console.log('🔍 SLPM SwapBack: Running server-side melt with built-in retry...');\n        onEvent({\n            type: 'mix:progress',\n            message: 'Melting ecash to Lightning (with retry capability)...',\n            progress: 88\n        });\n\n        const serverMeltResult = await serverSideCashuMelt(encodedToken, finalInvoice, mintQuoteId);\n\n\n        if (!serverMeltResult.success) {\n            // Handle insufficient balance case - this means we need a smaller invoice\n            if (serverMeltResult.details?.shortfall) {\n                console.log('⚠️ SLPM SwapBack: Invoice too large for available proofs');\n                console.log(`   Required: ${serverMeltResult.details.required} sats, Available: ${serverMeltResult.details.available} sats`);\n                throw new Error(`Invoice too large for available balance. Required: ${serverMeltResult.details.required}, Available: ${serverMeltResult.details.available}`);\n            }\n\n            throw new Error(`Server-side melt failed: ${serverMeltResult.error}`);\n        }\n\n        console.log('✅ SLPM SwapBack: Server-side melt completed successfully');\n\n        console.log('✅ SLPM SwapBack: Server-side melt completed successfully!', {\n            invoiceAmount: serverMeltResult.result.invoiceAmount,\n            changeAmount: serverMeltResult.result.changeAmount,\n            changeCount: serverMeltResult.result.change?.length || 0\n        });\n\n        // Convert server result change proofs to EcashProof format for compatibility\n        const changeProofs: EcashProof[] = (serverMeltResult.result.change || []).map((proof: any) => ({\n            secret: proof.secret,\n            signature: proof.C,\n            amount: BigInt(proof.amount),\n            currency: 'SAT' as const,\n            keysetId: proof.id\n        }));\n\n        return {\n            finalInvoice: finalInvoice,\n            finalSwapId: finalSwapId,\n            meltResult: {\n                change: changeProofs,\n                usedAmount: serverMeltResult.result.invoiceAmount\n            }\n        };\n\n    } catch (error) {\n        console.error('❌ SLPM SwapBack: SIMPLIFIED melt failed:', error);\n        throw new Error(`Failed to melt ALL proofs: ${error}`);\n    }\n}\n\n/* \n// COMMENTED OUT - All the old complex logic with mixing/splitting/delays\nasync function redeemCashuToInvoice(\n    availableProofs: EcashProof[],\n    initialInvoice: string,\n    initialSwapId: string,\n    targetAmount: number,\n    destination: string,\n    atomiq: RealAtomiqSwapClient\n): Promise<{ finalInvoice: string; finalSwapId: string; meltResult: any }> {\n    \n    console.log('🪙 SLPM SwapBack: Starting Cashu redemption (server-side pattern)');\n    \n    const totalAvailable = availableProofs.reduce((sum, p) => sum + Number(p.amount), 0);\n    console.log('💰 SLPM SwapBack: Available proofs:', {\n        count: availableProofs.length,\n        totalAmount: totalAvailable\n    });\n\n    // Fee-aware invoice sizing using our existing server infrastructure\n    let currentInvoice = initialInvoice;\n    let currentSwapId = initialSwapId;\n    let attempts = 0;\n    const maxAttempts = 3;\n\n    while (attempts < maxAttempts) {\n        try {\n            console.log(`🔄 SLPM SwapBack: Attempt ${attempts + 1} - creating melt quote via server...`);\n            \n            // Use server-side melt-quote API (avoids CORS)\n            const quoteResponse = await fetch('/api/cashu/melt-quote', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({ \n                    invoice: currentInvoice, \n                    mintUrl: ENV.CASHU_DEFAULT_MINT \n                })\n            });\n            \n            if (!quoteResponse.ok) {\n                throw new Error(`Melt quote failed: ${await quoteResponse.text()}`);\n            }\n            \n            const meltQuote = await quoteResponse.json();\n            const required = meltQuote.amount + meltQuote.fee_reserve;\n            \n            console.log('📋 SLPM SwapBack: Melt quote details:', {\n                invoiceAmount: meltQuote.amount,\n                feeReserve: meltQuote.fee_reserve,\n                totalRequired: required,\n                available: totalAvailable\n            });\n\n            if (required <= totalAvailable) {\n                // Invoice fits! Execute the melt via server\n                console.log('✅ SLPM SwapBack: Invoice fits, executing melt via server...');\n                \n                // Select proofs for payment (convert to Cashu format for server)\n                const selectedEcashProofs = selectEcashProofsForAmount(availableProofs, required);\n                const selectedCashuProofs = selectedEcashProofs.map((proof: EcashProof) => ({\n                    secret: proof.secret,\n                    C: proof.signature,\n                    amount: Number(proof.amount),\n                    id: proof.keysetId\n                }));\n\n                // Add proof validation before melt attempt\n                console.log('🔍 SLPM SwapBack: Validating proof availability...');\n                try {\n                    const validationResponse = await fetch('/api/cashu/proof-states', {\n                        method: 'POST',\n                        headers: { 'Content-Type': 'application/json' },\n                        body: JSON.stringify({\n                            proofs: selectedCashuProofs,\n                            mintUrl: ENV.CASHU_DEFAULT_MINT\n                        })\n                    });\n\n                    if (validationResponse.ok) {\n                        const validation = await validationResponse.json();\n                        const spentProofs = validation.states?.filter((s: any) => s.state !== 'UNSPENT') || [];\n                        \n                        if (spentProofs.length > 0) {\n                            console.error('⚠️ SLPM SwapBack: Found spent/pending proofs, skipping to avoid \"proofs pending\" error');\n                            throw new Error(`${spentProofs.length} proofs are not available (${spentProofs.map((p: any) => p.state).join(', ')})`);\n                        }\n                        console.log('✅ SLPM SwapBack: All selected proofs are available');\n                    } else {\n                        console.warn('⚠️ SLPM SwapBack: Could not validate proof states, proceeding anyway');\n                    }\n                } catch (validationError) {\n                    console.warn('⚠️ SLPM SwapBack: Proof validation failed:', validationError instanceof Error ? validationError.message : String(validationError));\n                    // Continue with melt attempt anyway\n                }\n                \n                console.log('🎯 SLPM SwapBack: Selected proofs:', {\n                    count: selectedCashuProofs.length,\n                    totalValue: selectedCashuProofs.reduce((sum: number, p: any) => sum + p.amount, 0)\n                });\n\n                // Execute melt via server API (avoids CORS)\n                const meltResponse = await fetch('/api/cashu/melt', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({\n                        quote: {\n                            quote: meltQuote.quote,\n                            amount: meltQuote.amount.toString(),\n                            fee_reserve: meltQuote.fee_reserve.toString(),\n                            unit: meltQuote.unit,\n                            expiry: meltQuote.expiry,\n                            request: meltQuote.request\n                        },\n                        proofs: selectedCashuProofs,\n                        mintUrl: ENV.CASHU_DEFAULT_MINT\n                    })\n                });\n                \n                if (!meltResponse.ok) {\n                    const errorText = await meltResponse.text();\n                    \n                    // Special handling for \"proofs pending\" error\n                    if (errorText.includes('proofs are pending') || errorText.includes('proofs pending')) {\n                        console.error('💔 SLPM SwapBack: Proofs are pending/used - this attempt failed');\n                        throw new Error(`Proofs are already being used or spent: ${errorText}`);\n                    }\n                    \n                    throw new Error(`Melt execution failed: ${errorText}`);\n                }\n                \n                const meltResult = await meltResponse.json();\n                \n                console.log('⚡ SLPM SwapBack: Melt executed successfully!', {\n                    changeCount: meltResult.change?.length || 0\n                });\n\n                // Convert change back to our EcashProof format\n                const changeProofs: EcashProof[] = (meltResult.change || []).map((proof: any) => ({\n                    secret: proof.secret,\n                    signature: proof.C,\n                    amount: BigInt(proof.amount),\n                    currency: 'SAT' as const,\n                    keysetId: proof.id\n                }));\n\n                return {\n                    finalInvoice: currentInvoice,\n                    finalSwapId: currentSwapId,\n                    meltResult: {\n                        change: changeProofs,\n                        usedAmount: required\n                    }\n                };\n            }\n\n            // Invoice too large, resize it\n            const buffer = 1;\n            const recommended = Math.max(10, totalAvailable - meltQuote.fee_reserve - buffer);\n            console.log(`⚠️ SLPM SwapBack: Invoice too large, resizing to ${recommended} sats`);\n            \n            // Create new swap with smaller amount\n            const newSwap = await atomiq.beginLightningToStrkSwap(recommended, destination);\n            currentInvoice = newSwap.invoice;\n            currentSwapId = newSwap.id;\n            \n            attempts++;\n\n        } catch (error) {\n            console.error(`❌ SLPM SwapBack: Attempt ${attempts + 1} failed:`, error);\n            attempts++;\n            \n            if (attempts >= maxAttempts) {\n                throw new Error(`Failed to redeem Cashu after ${maxAttempts} attempts: ${error}`);\n            }\n            \n            // Wait before retry to avoid hammering the mint\n            await new Promise(resolve => setTimeout(resolve, 1000 * attempts));\n        }\n    }\n\n    throw new Error('Failed to size invoice within available proof amount');\n}\n\n// Helper to select EcashProofs for payment\nfunction selectEcashProofsForAmount(proofs: EcashProof[], targetAmount: number): EcashProof[] {\n    const selected = [];\n    let currentTotal = 0;\n\n    // Sort by amount (smallest first for better change)\n    const sortedProofs = [...proofs].sort((a, b) => Number(a.amount) - Number(b.amount));\n\n    for (const proof of sortedProofs) {\n        if (currentTotal >= targetAmount) break;\n        selected.push(proof);\n        currentTotal += Number(proof.amount);\n    }\n\n    if (currentTotal < targetAmount) {\n        throw new Error(`Insufficient proofs: need ${targetAmount}, have ${currentTotal}`);\n    }\n\n    return selected;\n}\n\n// Helper to select proofs for payment (from standalone script) - kept for compatibility\nfunction selectProofsForAmount(proofs: Proof[], targetAmount: number): Proof[] {\n    const selected = [];\n    let currentTotal = 0;\n\n    // Sort by amount (smallest first for better change)\n    const sortedProofs = [...proofs].sort((a, b) => a.amount - b.amount);\n\n    for (const proof of sortedProofs) {\n        if (currentTotal >= targetAmount) break;\n        selected.push(proof);\n        currentTotal += proof.amount;\n    }\n\n    if (currentTotal < targetAmount) {\n        throw new Error(`Insufficient proofs: need ${targetAmount}, have ${currentTotal}`);\n    }\n\n    return selected;\n}\n\n// Helper to remove used proofs from available set\nfunction removeUsedProofs(proofs: EcashProof[], usedAmount: number): EcashProof[] {\n    const sorted = [...proofs].sort((a, b) => Number(a.amount) - Number(b.amount));\n    const remaining = [];\n    let removedAmount = 0;\n\n    for (const proof of sorted) {\n        if (removedAmount < usedAmount) {\n            removedAmount += Number(proof.amount);\n        } else {\n            remaining.push(proof);\n        }\n    }\n\n    return remaining;\n}\n*/\n"],"names":[],"mappings":";;;;AACA;AAGA;AACA;AACA;;;;;AAEO,eAAe,aAClB,WAAyB,EACzB,YAAsB,EACtB,KAAsB,EACtB,OAAuC,EACvC,WAAoB,AAAC,4CAA4C;;IAEjE,QAAQ,GAAG,CAAC;IAEZ,MAAM,YAAY,YAAY,MAAM,CAAC,CAAC,KAAK,IAAM,MAAM,OAAO,EAAE,MAAM,GAAG;IACzE,MAAM,oBAAoB,YAAY,CAAC,EAAE,EAAE,iCAAiC;IAC5E,MAAM,aAAa,IAAA,2KAAoB;IAEvC,QAAQ,GAAG,CAAC,4CAA4C;QACpD,aAAa,YAAY,MAAM;QAC/B;QACA,mBAAmB,CAAA,8BAAA,wCAAA,kBAAmB,KAAK,CAAC,GAAG,OAAM;QACrD,SAAS,8HAAG,CAAC,OAAO;QACpB,SAAS,8HAAG,CAAC,kBAAkB;IACnC;IAEA,IAAI;YAqBkB;QApBlB,QAAQ;YAAE,MAAM;YAAgB,SAAS;YAAsE,UAAU;QAAG;QAE5H,sDAAsD;QACtD,MAAM,SAAS,IAAI,iKAAoB,CAAC,8HAAG,CAAC,OAAO;QAEnD,QAAQ;YAAE,MAAM;YAAgB,SAAS;YAAsE,UAAU;QAAG;QAE5H,8EAA8E;QAC9E,MAAM,EAAE,YAAY,EAAE,WAAW,EAAE,UAAU,EAAE,GAAG,MAAM,wBACpD,aACA,WACA,iHAAiH;QACjH,cAAc,mBACd,QACA,SACA;QAGJ,QAAQ,GAAG,CAAC,6CAA6C;YACrD,eAAe,aAAa,KAAK,CAAC,GAAG,MAAM;YAC3C,cAAc,EAAA,qBAAA,WAAW,MAAM,cAAjB,yCAAA,mBAAmB,MAAM,KAAI;YAC3C,eAAe,WAAW,UAAU;QACxC;QAEA,QAAQ;YAAE,MAAM;YAAgB,SAAS;YAAgD,UAAU;QAAG;QAEtG,0EAA0E;QAC1E,QAAQ,GAAG,CAAC;QACZ,MAAM,YAAY,MAAM,OAAO,6BAA6B,CAAC,aAAa;QAE1E,IAAI,cAAc;QAClB,IAAI,WAAW;YACX,QAAQ,GAAG,CAAC;YACZ,IAAI;gBACA,MAAM,OAAO,wBAAwB,CAAC;gBACtC,cAAc;gBACd,QAAQ,GAAG,CAAC;gBACZ,QAAQ,GAAG,CAAC;gBAEZ,+EAA+E;gBAC/E,IAAI,cAAc,WAAW,WAAW,OAAO,kBAAkB,WAAW,IAAI;oBAC5E,IAAI;wBACA,gEAAgE;wBAChE,MAAM,SAAS,MAAM,OAAO,SAAS,CAAC;4BACpB;wBAAlB,MAAM,YAAY,CAAA,oBAAA,OAAO,SAAS,cAAhB,+BAAA,oBAAoB,EAAE;wBACxC,QAAQ,GAAG,CAAC,uEAAuE;4BAC/E,MAAM;4BACN,IAAI;4BACJ,WAAW,UAAU,QAAQ;wBACjC;wBACA,MAAM,IAAA,6KAAsB,EAAC,mBAAmB;wBAChD,QAAQ,GAAG,CAAC;oBAChB,EAAE,OAAO,QAAQ;wBACb,QAAQ,KAAK,CAAC,6CAA6C;wBAC3D,cAAc;oBAClB;gBACJ;YACJ,EAAE,OAAO,YAAY;gBACjB,QAAQ,KAAK,CAAC,kCAAkC;gBAChD,IAAI,sBAAsB,SAAS,2BAA2B,IAAI,CAAC,WAAW,OAAO,GAAG;oBACpF,QAAQ,KAAK,CAAC;gBAClB;gBACA,cAAc;YAClB;QACJ,OAAO;YACH,QAAQ,IAAI,CAAC;QACjB;QAEA,MAAM,UAAU;YAAC;gBACb,aAAa;gBACb,cAAc,OAAO,WAAW,UAAU,IAAI;gBAC9C,UAAU,OAAO,WAAW,UAAU,IAAI;gBAC1C,MAAM;gBACN,QAAQ;YACZ;SAAE;QAEF,QAAQ,GAAG,CAAC,8CAA8C;YACtD,aAAa;YACb,mBAAmB,OAAO,CAAC,EAAE,CAAC,YAAY;YAC1C,eAAe,OAAO,CAAC,EAAE,CAAC,QAAQ;YAClC,QAAQ;QACZ;QAEA,QAAQ;YAAE,MAAM;YAAgB,SAAS;YAA6B,UAAU;QAAG;QAEnF,OAAO;IAEX,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,+CAA+C;QAC7D,MAAM;IACV;AACJ;AAEA,oGAAoG;AACpG,eAAe,wBACX,SAAuB,EACvB,WAAmB,EACnB,WAAmB,EACnB,MAA4B,EAC5B,OAAuC,EACvC,WAAoB;IAGpB,QAAQ,GAAG,CAAC;IAEZ,MAAM,iBAAiB,UAAU,MAAM,CAAC,CAAC,KAAK,IAAM,MAAM,OAAO,EAAE,MAAM,GAAG;IAC5E,QAAQ,GAAG,CAAC,2CAA2C;QACnD,OAAO,UAAU,MAAM;QACvB,aAAa;QACb,SAAS,8HAAG,CAAC,kBAAkB;IACnC;IAEA,IAAI;YAgGiB;QA/FjB,QAAQ,GAAG,CAAC;QAEZ,IAAI,eAA8B;QAElC,IAAI,aAAa;YACb,QAAQ,GAAG,CAAC,sDAAsD;YAClE,eAAe,MAAM,IAAA,uKAA0B,EAAC;QACpD;QAEA,IAAI,CAAC,cAAc;YACf,QAAQ,IAAI,CAAC;YACb,mDAAmD;YACnD,wCAAmC;gBAC/B,MAAM,OAAO,OAAO,IAAI,CAAC,cAAc,MAAM,CAAC,CAAA,MAAO,IAAI,UAAU,CAAC;gBACpE,IAAI,KAAK,MAAM,GAAG,GAAG;oBACjB,MAAM,YAAY,IAAI,CAAC,KAAK,MAAM,GAAG,EAAE,EAAE,4BAA4B;oBACrE,eAAe,aAAa,OAAO,CAAC;oBACpC,QAAQ,GAAG,CAAC,0CAA0C;gBAC1D;YACJ;QACJ;QAEA,IAAI,CAAC,cAAc;YACf,QAAQ,IAAI,CAAC;YACb,MAAM,IAAI,MAAM;QACpB;QAEA,QAAQ,GAAG,CAAC;QAEZ,+EAA+E;QAC/E,QAAQ,GAAG,CAAC;QACZ,MAAM,gBAAgB,MAAM,IAAA,sKAAyB,EAAC;QAEtD,IAAI,CAAC,cAAc,OAAO,EAAE;YACxB,MAAM,IAAI,MAAM,AAAC,2CAA8D,OAApB,cAAc,KAAK;QAClF;QAEA,QAAQ,GAAG,CAAC,6CAA6C;YACrD,kBAAkB,cAAc,gBAAgB;YAChD,kBAAkB,cAAc,SAAS;YACzC,uBAAuB;QAC3B;QAEA,yEAAyE;QACzE,QAAQ,GAAG,CAAC;QACZ,QAAQ,GAAG,CAAC,AAAC,oCAAiF,OAA9C,cAAc,SAAS,EAAC,wBAAkC,OAAZ,aAAY;QAE1G,oEAAoE;QACpE,MAAM,gBAAgB,MAAM,OAAO,wBAAwB,CAAC,cAAc,SAAS,EAAE;QAErF,QAAQ,GAAG,CAAC,gDAAgD;YACxD,QAAQ,cAAc,EAAE,CAAC,KAAK,CAAC,GAAG,MAAM;YACxC,YAAY,cAAc,SAAS;YACnC,eAAe,cAAc,OAAO,CAAC,KAAK,CAAC,GAAG,MAAM;QACxD;QAEA,MAAM,eAAe,cAAc,OAAO;QAC1C,MAAM,cAAc,cAAc,EAAE;QAEpC,0EAA0E;QAC1E,QAAQ,GAAG,CAAC,iDAAiD;QAC7D,wCAAmC;YAC/B,IAAI;gBACC,OAAe,sBAAsB,GAAG;gBACzC,QAAQ,GAAG,CAAC;YAChB,EAAE,UAAM,CAAc;QAC1B;QAEA,iFAAiF;QACjF,QAAQ,GAAG,CAAC;QACZ,QAAQ;YACJ,MAAM;YACN,SAAS;YACT,UAAU;QACd;QAEA,MAAM,mBAAmB,MAAM,IAAA,gKAAmB,EAAC,cAAc,cAAc;QAG/E,IAAI,CAAC,iBAAiB,OAAO,EAAE;gBAEvB;YADJ,0EAA0E;YAC1E,KAAI,4BAAA,iBAAiB,OAAO,cAAxB,gDAAA,0BAA0B,SAAS,EAAE;gBACrC,QAAQ,GAAG,CAAC;gBACZ,QAAQ,GAAG,CAAC,AAAC,gBAAqE,OAAtD,iBAAiB,OAAO,CAAC,QAAQ,EAAC,sBAAuD,OAAnC,iBAAiB,OAAO,CAAC,SAAS,EAAC;gBACrH,MAAM,IAAI,MAAM,AAAC,sDAAsG,OAAjD,iBAAiB,OAAO,CAAC,QAAQ,EAAC,iBAAkD,OAAnC,iBAAiB,OAAO,CAAC,SAAS;YAC7J;YAEA,MAAM,IAAI,MAAM,AAAC,4BAAkD,OAAvB,iBAAiB,KAAK;QACtE;QAEA,QAAQ,GAAG,CAAC;QAEZ,QAAQ,GAAG,CAAC,6DAA6D;YACrE,eAAe,iBAAiB,MAAM,CAAC,aAAa;YACpD,cAAc,iBAAiB,MAAM,CAAC,YAAY;YAClD,aAAa,EAAA,kCAAA,iBAAiB,MAAM,CAAC,MAAM,cAA9B,sDAAA,gCAAgC,MAAM,KAAI;QAC3D;QAEA,6EAA6E;QAC7E,MAAM,eAA6B,CAAC,iBAAiB,MAAM,CAAC,MAAM,IAAI,EAAE,EAAE,GAAG,CAAC,CAAC,QAAe,CAAC;gBAC3F,QAAQ,MAAM,MAAM;gBACpB,WAAW,MAAM,CAAC;gBAClB,QAAQ,OAAO,MAAM,MAAM;gBAC3B,UAAU;gBACV,UAAU,MAAM,EAAE;YACtB,CAAC;QAED,OAAO;YACH,cAAc;YACd,aAAa;YACb,YAAY;gBACR,QAAQ;gBACR,YAAY,iBAAiB,MAAM,CAAC,aAAa;YACrD;QACJ;IAEJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,4CAA4C;QAC1D,MAAM,IAAI,MAAM,AAAC,8BAAmC,OAAN;IAClD;AACJ,EAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiPA","debugId":null}},
    {"offset": {"line": 5115, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/CODE/SLPM-enhanced/src/orchestrator/index.ts"],"sourcesContent":["import { MixRequest, OrchestratorEvent } from '@/lib/types';\nimport { stepDeposit } from './steps/deposit';\nimport { stepWithdrawForMixing } from './steps/withdrawForMixing';\nimport { stepCreateMintInvoice } from './steps/createMintInvoice';\nimport { stepDynamicEstimateSats } from './steps/dynamicEstimateSats';\nimport { stepSwapToLightning } from './steps/swapToLightning';\nimport { stepClaimCashuProofs } from './steps/claimCashuProofs';\nimport { stepPrivacy } from './steps/privacy';\nimport { stepSwapBack } from './steps/swapBack';\nimport { stepWithdraw } from './steps/withdraw';\nimport { getNetworkStatus, ENV } from '@/config/env';\nimport { RealAtomiqSwapClient } from '@/integrations/swaps/atomiq';\n\nexport async function startMix(req: MixRequest, onEvent: (e: OrchestratorEvent) => void) {\n    console.log('🎯 SLPM: Starting privacy mix operation');\n    console.log('📋 SLPM: Mix request:', {\n        amount: req.amountStrk,\n        destinations: req.destinations.length,\n        privacyLevel: req.privacyLevel,\n        features: {\n            timeDelays: req.enableTimeDelays,\n            splitOutputs: req.enableSplitOutputs,\n            randomizedMints: req.enableRandomizedMints,\n            amountObfuscation: req.enableAmountObfuscation,\n            decoyTx: req.enableDecoyTx\n        }\n    });\n\n    // Store deposit info for the full flow\n    let depositResult: any = null;\n    let lightningResult: any = null;\n\n    try {\n        // Validate network configuration readiness\n        console.log(`🔍 SLPM: Validating ${ENV.NETWORK} configuration...`);\n        const networkStatus = getNetworkStatus();\n        console.log(`⚙️ SLPM: ${ENV.NETWORK} status:`, networkStatus);\n\n        if (!networkStatus.ready) {\n            console.error(`❌ SLPM: ${ENV.NETWORK} configuration incomplete`);\n            console.error('Warnings:', networkStatus.warnings);\n            throw new Error(`${ENV.NETWORK} configuration incomplete. Check environment variables.`);\n        }\n        console.log(`✅ SLPM: ${ENV.NETWORK} configuration validated`);\n\n        onEvent({\n            type: 'mix:progress',\n            message: `Starting privacy mix on ${ENV.NETWORK}`,\n            progress: 0\n        });\n        console.log('🚀 SLPM: Privacy mix operation initiated');\n\n        // Step 1: Deposit STRK to privacy mixer contract\n        console.log('💰 SLPM: Step 1 - Depositing STRK to privacy mixer contract');\n        depositResult = await stepDeposit(req.amountStrk, onEvent);\n        console.log('✅ SLPM: Step 1 complete - STRK deposited to privacy mixer:', {\n            commitment: depositResult.commitmentHash.slice(0, 10) + '...',\n            amount: depositResult.amount,\n            mixerContract: depositResult.mixerContractAddress\n        });\n\n        // Step 1.5: Immediately withdraw for mixing (privacy-preserving)\n        console.log('🔄 SLPM: Step 1.5 - Withdrawing from privacy mixer for mixing pipeline');\n        const withdrawalResult = await stepWithdrawForMixing(depositResult, onEvent);\n        if (!withdrawalResult || !withdrawalResult.withdrawalTxHash) {\n            throw new Error('Withdrawal step returned no transaction hash');\n        }\n        const withdrawalTxDisplay = typeof withdrawalResult.withdrawalTxHash === 'string'\n            ? withdrawalResult.withdrawalTxHash.slice(0, 10) + '...'\n            : 'n/a';\n        const controllingWalletDisplay = typeof withdrawalResult.controllingWallet === 'string'\n            ? withdrawalResult.controllingWallet.slice(0, 10) + '...'\n            : 'n/a';\n        console.log('✅ SLPM: Step 1.5 complete - Funds withdrawn and ready for mixing:', {\n            withdrawalTx: withdrawalTxDisplay,\n            availableForSwap: withdrawalResult.availableForSwap ?? false,\n            controllingWallet: controllingWalletDisplay\n        });\n\n        // Step 2: Dynamic real-time estimation (STRK -> sats) then create Cashu mint invoice\n        console.log('🎯 SLPM: Step 2 - Dynamic STRK → sats estimation (real-time if possible)...');\n        onEvent({ type: 'mix:progress', message: 'Estimating sats from STRK input...', progress: 15 });\n        const dynamicEstimate = await stepDynamicEstimateSats(withdrawalResult.amount, onEvent);\n        console.log('💰 SLPM: Dynamic estimation result:', dynamicEstimate);\n        console.log(`💰 SLPM: Estimated ${withdrawalResult.amount} STRK -> ${dynamicEstimate.satsOut} sats (source: ${dynamicEstimate.source}, rate: ${dynamicEstimate.rate.toFixed(2)})`);\n        onEvent({ type: 'mix:progress', message: 'Creating Cashu mint invoice...', progress: 18 });\n        const mintInvoiceResult = await stepCreateMintInvoice(dynamicEstimate.satsOut, onEvent);\n\n        // Step 3: Swap STRK to Lightning (paying the Cashu mint invoice)\n        console.log('🎯 SLPM: Step 3 - Swapping STRK to Lightning...');\n        onEvent({ type: 'mix:progress', message: 'Swapping STRK to Lightning BTC...', progress: 25 });\n        lightningResult = await stepSwapToLightning(withdrawalResult.amount, {\n            walletAddress: withdrawalResult.originalDeposit.walletAddress,\n            mixerContractAddress: withdrawalResult.originalDeposit.mixerContractAddress,\n            fundsAvailable: withdrawalResult.availableForSwap\n        }, mintInvoiceResult, onEvent);\n\n        // Step 4: Claim Cashu proofs (after Atomiq payment)\n        console.log('🎯 SLPM: Step 4 - Claiming Cashu proofs...');\n        onEvent({ type: 'mix:progress', message: 'Claiming Cashu proofs...', progress: 45 });\n        const cashuProofs = await stepClaimCashuProofs(\n            mintInvoiceResult.mintQuote,\n            mintInvoiceResult.cashu,\n            dynamicEstimate.satsOut,\n            onEvent\n        );\n\n        console.log('🎯 SLPM: Cashu proofs claimed:', {\n            count: cashuProofs.length,\n            totalValue: cashuProofs.reduce((sum: number, p: any) => sum + Number(p.amount), 0)\n        });\n\n        // Use the cashu client and manager from the mint invoice result\n        const cashuClient = mintInvoiceResult.cashu;\n        const cashuMgr = mintInvoiceResult.cashuManager;\n\n        // Step 5: Apply privacy techniques\n        console.log('🎯 SLPM: Step 5 - Applying privacy techniques...');\n        onEvent({ type: 'mix:progress', message: 'Applying privacy mixing...', progress: 60 });\n        const mixedProofs = await stepPrivacy(req, cashuProofs, cashuClient, cashuMgr, onEvent);\n\n        console.log('✅ SLPM: Privacy mixing complete:', {\n            finalProofsCount: mixedProofs.length,\n            privacyLevel: req.privacyLevel,\n            anonymityEnhanced: true\n        });\n\n        // Step 6: Convert mixed Cashu back to Lightning and distribute\n        console.log('🔄 SLPM: Step 6 - Converting mixed tokens back and distributing...');\n        onEvent({\n            type: 'mix:progress',\n            message: 'Converting mixed e-cash back and distributing to destinations',\n            progress: 80\n        });\n\n        // Use the new swapBack that handles Cashu → Lightning → STRK for each destination\n        const distributionResults = await stepSwapBack(mixedProofs, req.destinations, cashuClient, onEvent, mintInvoiceResult.mintQuote.quote);\n\n        const successfulDistributions = distributionResults.filter(r => r.status === 'CLAIMED').length;\n        const totalDestinations = distributionResults.length;\n        const totalStrkDistributed = distributionResults.reduce((sum, r) => sum + r.strkSent, 0);\n\n        console.log('📊 SLPM: Distribution results:', {\n            totalDestinations,\n            successfulDistributions,\n            totalStrkDistributed,\n            failedDistributions: totalDestinations - successfulDistributions\n        });\n\n        // Check if the distribution was actually successful\n        if (successfulDistributions === 0) {\n            throw new Error(`All ${totalDestinations} destination distributions failed - no STRK was successfully delivered`);\n        }\n\n        if (successfulDistributions < totalDestinations) {\n            console.warn(`⚠️ SLPM: Partial success - only ${successfulDistributions}/${totalDestinations} destinations received STRK`);\n        } else {\n            console.log('✅ SLPM: All distributions completed successfully');\n        }\n\n        console.log('✅ SLPM: Privacy mixing completed with distribution results');\n\n        // Calculate final privacy metrics\n        console.log('📊 SLPM: Calculating final privacy metrics');\n        const anonymitySetSize = estimateAnonymitySetLocal(req);\n        const privacyScore = scorePrivacy(req, anonymitySetSize);\n        console.log('📈 SLPM: Final privacy metrics:', {\n            anonymitySetSize,\n            privacyScore,\n            privacyLevel: req.privacyLevel,\n            mixingPath: 'STRK → Lightning → Cashu → Lightning → STRK',\n            destinationAccounts: req.destinations.length,\n            totalFees: lightningResult.fee || 0,\n            privacyGuarantees: {\n                unlinkability: 'Account linkability broken via mixer contract',\n                temporalPrivacy: 'Time delays and batching applied',\n                amountObfuscation: 'Amount split across destinations',\n                routingDiversification: 'Multiple Cashu mints used'\n            }\n        });\n\n        // Determine completion message based on actual results\n        let completionMessage: string;\n        let completionType: 'mix:complete' | 'mix:partial' | 'mix:failed';\n\n        if (successfulDistributions === totalDestinations) {\n            completionMessage = `Privacy mix complete! ${totalStrkDistributed} STRK distributed to ${successfulDistributions} destinations through ${anonymitySetSize}-member anonymity set`;\n            completionType = 'mix:complete';\n        } else if (successfulDistributions > 0) {\n            completionMessage = `Privacy mix partially complete - ${totalStrkDistributed} STRK delivered to ${successfulDistributions}/${totalDestinations} destinations`;\n            completionType = 'mix:partial';\n        } else {\n            completionMessage = `Privacy mix failed - no STRK was successfully delivered to any destination`;\n            completionType = 'mix:failed';\n        }\n\n        onEvent({\n            type: completionType,\n            message: completionMessage,\n            progress: successfulDistributions === totalDestinations ? 100 : 90\n        });\n\n        console.log(`🎉 SLPM: Privacy mix operation result - ${successfulDistributions}/${totalDestinations} destinations successful`);\n\n        // Return results for caller to handle\n        return {\n            success: successfulDistributions > 0,\n            totalDestinations,\n            successfulDistributions,\n            totalStrkDistributed,\n            distributionResults\n        };\n\n    } catch (error) {\n        console.error('❌ SLPM: Privacy mix operation failed:', error);\n        console.error('🔍 SLPM: Error details:', {\n            message: error instanceof Error ? error.message : 'Unknown error',\n            stack: error instanceof Error ? error.stack : undefined,\n            step: 'Privacy mixing flow',\n            progress: 'Check individual step logs above'\n        });\n\n        onEvent({\n            type: 'mix:error',\n            message: error instanceof Error ? error.message : 'Privacy mix failed'\n        });\n        throw error;\n    }\n}\n\nfunction estimateAnonymitySetLocal(req: MixRequest): number {\n    const base = req.privacyLevel === 'maximum' ? 120 : req.privacyLevel === 'enhanced' ? 60 : 20;\n    const extras = (req.enableSplitOutputs ? req.splitCount : 0) + (req.enableRandomizedMints ? 10 : 0);\n    return base + extras;\n}\n\nfunction scorePrivacy(req: MixRequest, set: number) {\n    let score = 50 + Math.min(40, Math.floor(set / 4));\n    if (req.enableTimeDelays) score += 3;\n    if (req.enableSplitOutputs && req.splitCount > 1) score += 3;\n    if (req.enableRandomizedMints) score += 2;\n    if (req.enableAmountObfuscation) score += 1;\n    if (req.enableDecoyTx) score += 1;\n    return Math.min(100, score);\n}\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;AAGO,eAAe,SAAS,GAAe,EAAE,OAAuC;IACnF,QAAQ,GAAG,CAAC;IACZ,QAAQ,GAAG,CAAC,yBAAyB;QACjC,QAAQ,IAAI,UAAU;QACtB,cAAc,IAAI,YAAY,CAAC,MAAM;QACrC,cAAc,IAAI,YAAY;QAC9B,UAAU;YACN,YAAY,IAAI,gBAAgB;YAChC,cAAc,IAAI,kBAAkB;YACpC,iBAAiB,IAAI,qBAAqB;YAC1C,mBAAmB,IAAI,uBAAuB;YAC9C,SAAS,IAAI,aAAa;QAC9B;IACJ;IAEA,uCAAuC;IACvC,IAAI,gBAAqB;IACzB,IAAI,kBAAuB;IAE3B,IAAI;QACA,2CAA2C;QAC3C,QAAQ,GAAG,CAAC,AAAC,uBAAkC,OAAZ,8HAAG,CAAC,OAAO,EAAC;QAC/C,MAAM,gBAAgB,IAAA,2IAAgB;QACtC,QAAQ,GAAG,CAAC,AAAC,YAAuB,OAAZ,8HAAG,CAAC,OAAO,EAAC,aAAW;QAE/C,IAAI,CAAC,cAAc,KAAK,EAAE;YACtB,QAAQ,KAAK,CAAC,AAAC,WAAsB,OAAZ,8HAAG,CAAC,OAAO,EAAC;YACrC,QAAQ,KAAK,CAAC,aAAa,cAAc,QAAQ;YACjD,MAAM,IAAI,MAAM,AAAC,GAAc,OAAZ,8HAAG,CAAC,OAAO,EAAC;QACnC;QACA,QAAQ,GAAG,CAAC,AAAC,WAAsB,OAAZ,8HAAG,CAAC,OAAO,EAAC;QAEnC,QAAQ;YACJ,MAAM;YACN,SAAS,AAAC,2BAAsC,OAAZ,8HAAG,CAAC,OAAO;YAC/C,UAAU;QACd;QACA,QAAQ,GAAG,CAAC;QAEZ,iDAAiD;QACjD,QAAQ,GAAG,CAAC;QACZ,gBAAgB,MAAM,IAAA,yJAAW,EAAC,IAAI,UAAU,EAAE;QAClD,QAAQ,GAAG,CAAC,8DAA8D;YACtE,YAAY,cAAc,cAAc,CAAC,KAAK,CAAC,GAAG,MAAM;YACxD,QAAQ,cAAc,MAAM;YAC5B,eAAe,cAAc,oBAAoB;QACrD;QAEA,iEAAiE;QACjE,QAAQ,GAAG,CAAC;QACZ,MAAM,mBAAmB,MAAM,IAAA,6KAAqB,EAAC,eAAe;QACpE,IAAI,CAAC,oBAAoB,CAAC,iBAAiB,gBAAgB,EAAE;YACzD,MAAM,IAAI,MAAM;QACpB;QACA,MAAM,sBAAsB,OAAO,iBAAiB,gBAAgB,KAAK,WACnE,iBAAiB,gBAAgB,CAAC,KAAK,CAAC,GAAG,MAAM,QACjD;QACN,MAAM,2BAA2B,OAAO,iBAAiB,iBAAiB,KAAK,WACzE,iBAAiB,iBAAiB,CAAC,KAAK,CAAC,GAAG,MAAM,QAClD;YAGgB;QAFtB,QAAQ,GAAG,CAAC,qEAAqE;YAC7E,cAAc;YACd,kBAAkB,CAAA,qCAAA,iBAAiB,gBAAgB,cAAjC,gDAAA,qCAAqC;YACvD,mBAAmB;QACvB;QAEA,qFAAqF;QACrF,QAAQ,GAAG,CAAC;QACZ,QAAQ;YAAE,MAAM;YAAgB,SAAS;YAAsC,UAAU;QAAG;QAC5F,MAAM,kBAAkB,MAAM,IAAA,iLAAuB,EAAC,iBAAiB,MAAM,EAAE;QAC/E,QAAQ,GAAG,CAAC,uCAAuC;QACnD,QAAQ,GAAG,CAAC,AAAC,sBAAwD,OAAnC,iBAAiB,MAAM,EAAC,aAAoD,OAAzC,gBAAgB,OAAO,EAAC,mBAAkD,OAAjC,gBAAgB,MAAM,EAAC,YAA0C,OAAhC,gBAAgB,IAAI,CAAC,OAAO,CAAC,IAAG;QAC/K,QAAQ;YAAE,MAAM;YAAgB,SAAS;YAAkC,UAAU;QAAG;QACxF,MAAM,oBAAoB,MAAM,IAAA,6KAAqB,EAAC,gBAAgB,OAAO,EAAE;QAE/E,iEAAiE;QACjE,QAAQ,GAAG,CAAC;QACZ,QAAQ;YAAE,MAAM;YAAgB,SAAS;YAAqC,UAAU;QAAG;QAC3F,kBAAkB,MAAM,IAAA,yKAAmB,EAAC,iBAAiB,MAAM,EAAE;YACjE,eAAe,iBAAiB,eAAe,CAAC,aAAa;YAC7D,sBAAsB,iBAAiB,eAAe,CAAC,oBAAoB;YAC3E,gBAAgB,iBAAiB,gBAAgB;QACrD,GAAG,mBAAmB;QAEtB,oDAAoD;QACpD,QAAQ,GAAG,CAAC;QACZ,QAAQ;YAAE,MAAM;YAAgB,SAAS;YAA4B,UAAU;QAAG;QAClF,MAAM,cAAc,MAAM,IAAA,2KAAoB,EAC1C,kBAAkB,SAAS,EAC3B,kBAAkB,KAAK,EACvB,gBAAgB,OAAO,EACvB;QAGJ,QAAQ,GAAG,CAAC,kCAAkC;YAC1C,OAAO,YAAY,MAAM;YACzB,YAAY,YAAY,MAAM,CAAC,CAAC,KAAa,IAAW,MAAM,OAAO,EAAE,MAAM,GAAG;QACpF;QAEA,gEAAgE;QAChE,MAAM,cAAc,kBAAkB,KAAK;QAC3C,MAAM,WAAW,kBAAkB,YAAY;QAE/C,mCAAmC;QACnC,QAAQ,GAAG,CAAC;QACZ,QAAQ;YAAE,MAAM;YAAgB,SAAS;YAA8B,UAAU;QAAG;QACpF,MAAM,cAAc,MAAM,IAAA,yJAAW,EAAC,KAAK,aAAa,aAAa,UAAU;QAE/E,QAAQ,GAAG,CAAC,oCAAoC;YAC5C,kBAAkB,YAAY,MAAM;YACpC,cAAc,IAAI,YAAY;YAC9B,mBAAmB;QACvB;QAEA,+DAA+D;QAC/D,QAAQ,GAAG,CAAC;QACZ,QAAQ;YACJ,MAAM;YACN,SAAS;YACT,UAAU;QACd;QAEA,kFAAkF;QAClF,MAAM,sBAAsB,MAAM,IAAA,2JAAY,EAAC,aAAa,IAAI,YAAY,EAAE,aAAa,SAAS,kBAAkB,SAAS,CAAC,KAAK;QAErI,MAAM,0BAA0B,oBAAoB,MAAM,CAAC,CAAA,IAAK,EAAE,MAAM,KAAK,WAAW,MAAM;QAC9F,MAAM,oBAAoB,oBAAoB,MAAM;QACpD,MAAM,uBAAuB,oBAAoB,MAAM,CAAC,CAAC,KAAK,IAAM,MAAM,EAAE,QAAQ,EAAE;QAEtF,QAAQ,GAAG,CAAC,kCAAkC;YAC1C;YACA;YACA;YACA,qBAAqB,oBAAoB;QAC7C;QAEA,oDAAoD;QACpD,IAAI,4BAA4B,GAAG;YAC/B,MAAM,IAAI,MAAM,AAAC,OAAwB,OAAlB,mBAAkB;QAC7C;QAEA,IAAI,0BAA0B,mBAAmB;YAC7C,QAAQ,IAAI,CAAC,AAAC,mCAA6D,OAA3B,yBAAwB,KAAqB,OAAlB,mBAAkB;QACjG,OAAO;YACH,QAAQ,GAAG,CAAC;QAChB;QAEA,QAAQ,GAAG,CAAC;QAEZ,kCAAkC;QAClC,QAAQ,GAAG,CAAC;QACZ,MAAM,mBAAmB,0BAA0B;QACnD,MAAM,eAAe,aAAa,KAAK;QACvC,QAAQ,GAAG,CAAC,mCAAmC;YAC3C;YACA;YACA,cAAc,IAAI,YAAY;YAC9B,YAAY;YACZ,qBAAqB,IAAI,YAAY,CAAC,MAAM;YAC5C,WAAW,gBAAgB,GAAG,IAAI;YAClC,mBAAmB;gBACf,eAAe;gBACf,iBAAiB;gBACjB,mBAAmB;gBACnB,wBAAwB;YAC5B;QACJ;QAEA,uDAAuD;QACvD,IAAI;QACJ,IAAI;QAEJ,IAAI,4BAA4B,mBAAmB;YAC/C,oBAAoB,AAAC,yBAAoE,OAA5C,sBAAqB,yBAAuE,OAAhD,yBAAwB,0BAAyC,OAAjB,kBAAiB;YAC1J,iBAAiB;QACrB,OAAO,IAAI,0BAA0B,GAAG;YACpC,oBAAoB,AAAC,oCAA6E,OAA1C,sBAAqB,uBAAgD,OAA3B,yBAAwB,KAAqB,OAAlB,mBAAkB;YAC/I,iBAAiB;QACrB,OAAO;YACH,oBAAqB;YACrB,iBAAiB;QACrB;QAEA,QAAQ;YACJ,MAAM;YACN,SAAS;YACT,UAAU,4BAA4B,oBAAoB,MAAM;QACpE;QAEA,QAAQ,GAAG,CAAC,AAAC,2CAAqE,OAA3B,yBAAwB,KAAqB,OAAlB,mBAAkB;QAEpG,sCAAsC;QACtC,OAAO;YACH,SAAS,0BAA0B;YACnC;YACA;YACA;YACA;QACJ;IAEJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,yCAAyC;QACvD,QAAQ,KAAK,CAAC,2BAA2B;YACrC,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;YAClD,OAAO,iBAAiB,QAAQ,MAAM,KAAK,GAAG;YAC9C,MAAM;YACN,UAAU;QACd;QAEA,QAAQ;YACJ,MAAM;YACN,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACtD;QACA,MAAM;IACV;AACJ;AAEA,SAAS,0BAA0B,GAAe;IAC9C,MAAM,OAAO,IAAI,YAAY,KAAK,YAAY,MAAM,IAAI,YAAY,KAAK,aAAa,KAAK;IAC3F,MAAM,SAAS,CAAC,IAAI,kBAAkB,GAAG,IAAI,UAAU,GAAG,CAAC,IAAI,CAAC,IAAI,qBAAqB,GAAG,KAAK,CAAC;IAClG,OAAO,OAAO;AAClB;AAEA,SAAS,aAAa,GAAe,EAAE,GAAW;IAC9C,IAAI,QAAQ,KAAK,KAAK,GAAG,CAAC,IAAI,KAAK,KAAK,CAAC,MAAM;IAC/C,IAAI,IAAI,gBAAgB,EAAE,SAAS;IACnC,IAAI,IAAI,kBAAkB,IAAI,IAAI,UAAU,GAAG,GAAG,SAAS;IAC3D,IAAI,IAAI,qBAAqB,EAAE,SAAS;IACxC,IAAI,IAAI,uBAAuB,EAAE,SAAS;IAC1C,IAAI,IAAI,aAAa,EAAE,SAAS;IAChC,OAAO,KAAK,GAAG,CAAC,KAAK;AACzB","debugId":null}},
    {"offset": {"line": 5358, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/CODE/SLPM-enhanced/src/lib/orchestrator.ts"],"sourcesContent":["import { MixRequest, OrchestratorEvent } from './types';\nimport { startMix } from '@/orchestrator';\n\nexport async function runMix(req: MixRequest, onEvent: (e: OrchestratorEvent) => void) {\n    try {\n        await startMix(req, onEvent);\n    } catch (e: any) {\n        onEvent({ type: 'mix:error', message: e?.message || 'Unknown error' });\n        throw e;\n    }\n}\n"],"names":[],"mappings":";;;;AACA;;AAEO,eAAe,OAAO,GAAe,EAAE,OAAuC;IACjF,IAAI;QACA,MAAM,IAAA,2IAAQ,EAAC,KAAK;IACxB,EAAE,OAAO,GAAQ;QACb,QAAQ;YAAE,MAAM;YAAa,SAAS,CAAA,cAAA,wBAAA,EAAG,OAAO,KAAI;QAAgB;QACpE,MAAM;IACV;AACJ","debugId":null}},
    {"offset": {"line": 5382, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/CODE/SLPM-enhanced/src/app/mixer/page.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport { WalletIcon, CheckCircleIcon } from '@heroicons/react/24/outline';\nimport Navigation from '../../components/Navigation';\nimport WalletConnection from '../../components/WalletConnection';\nimport TransactionStatus from '../../components/TransactionStatus';\nimport Notification from '../../components/Notification';\nimport { Stepper } from '../../components/mixer/Stepper';\nimport { SetupForm } from '../../components/mixer/SetupForm';\nimport { DepositView } from '../../components/mixer/DepositView';\nimport { MixingView } from '../../components/mixer/MixingView';\nimport { CompleteView } from '../../components/mixer/CompleteView';\nimport { runMix } from '../../lib/orchestrator';\nimport { MixRequest, PrivacyLevel as PLevel } from '../../lib/types';\nimport { type WalletType } from '@/integrations/starknet/wallet';\nimport { useWallet } from '@/context/WalletProvider';\n\ntype MixingStep = 'setup' | 'deposit' | 'mixing' | 'complete';\n\ninterface MixingSession {\n    step: MixingStep;\n    amount: string;\n    privacyLevel: PLevel;\n    progress: number;\n    anonymitySetSize: number;\n    estimatedTime: number;\n}\n\nexport default function MixerPage() {\n    // Use global wallet context (persistent across pages/reloads)\n    const wallet = useWallet();\n\n    const [session, setSession] = useState<MixingSession>({\n        step: 'setup',\n        amount: '',\n        privacyLevel: 'standard',\n        progress: 0,\n        anonymitySetSize: 0,\n        estimatedTime: 0\n    });\n\n    const [isConnected, setIsConnected] = useState(false);\n    const [showWalletModal, setShowWalletModal] = useState(false);\n    const [isConnecting, setIsConnecting] = useState(false);\n    const [notification, setNotification] = useState<{\n        show: boolean;\n        type: 'success' | 'error' | 'warning' | 'info';\n        title: string;\n        message: string;\n    }>({ show: false, type: 'info', title: '', message: '' });\n    // Live transaction history (no recipient addresses stored)\n    const [transactions, setTransactions] = useState<Array<{\n        id: string;\n        type: 'deposit' | 'mix' | 'withdraw';\n        amount: string;\n        status: 'pending' | 'processing' | 'completed' | 'failed';\n        timestamp: number;\n        privacyScore: number;\n        fromNetwork: string;\n        toNetwork: string;\n        anonymitySetSize?: number;\n    }>>([]);\n\n    // Privacy level presets are defined and applied within SetupForm; no local copy needed here.\n\n    // Stepper stages are fixed and handled internally; no local steps array needed.\n\n    const [mixReq, setMixReq] = useState<MixRequest>({\n        amountStrk: 0,\n        destinations: [],\n        privacyLevel: 'standard',\n        enableTimeDelays: true,\n        enableSplitOutputs: true,\n        splitCount: 2,\n        enableRandomizedMints: true,\n        enableAmountObfuscation: true,\n        enableDecoyTx: true,\n    });\n\n    const showNotification = (type: 'success' | 'error' | 'warning' | 'info', title: string, message: string) => {\n        setNotification({ show: true, type, title, message });\n    };\n\n    const handleWalletConnect = async (walletId: string) => {\n        setIsConnecting(true);\n        try {\n            // Map UI id to WalletType used by the manager\n            const mapId = (id: string): WalletType => {\n                if (id.toLowerCase() === 'argentx') return 'argentX';\n                if (id.toLowerCase() === 'braavos') return 'braavos';\n                if (id.toLowerCase() === 'okx') return 'okx';\n                return 'argentX';\n            };\n\n            await wallet.connect(mapId(walletId));\n            setIsConnected(true);\n            setShowWalletModal(false);\n            showNotification('success', 'Wallet Connected', `Connected to ${walletId}`);\n        } catch {\n            showNotification('error', 'Connection Failed', 'Failed to connect wallet. Please try again.');\n        } finally {\n            setIsConnecting(false);\n        }\n    };\n\n    // Keep isConnected in sync with context\n    useEffect(() => {\n        setIsConnected(wallet.isConnected);\n    }, [wallet.isConnected]);\n\n    // Note: amount and privacy level changes are handled within child components via props callbacks\n\n    const startMixing = async () => {\n        if (!isConnected) {\n            setShowWalletModal(true);\n            return;\n        }\n\n        const amt = parseFloat(session.amount || '0');\n        if (!amt || amt <= 0 || mixReq.destinations.length === 0 || !mixReq.destinations[0]) {\n            showNotification('warning', 'Invalid Input', 'Enter amount and destination address');\n            return;\n        }\n\n        setSession((p) => ({ ...p, step: 'deposit', progress: 0 }));\n        showNotification('info', 'Starting Mix', 'Initializing mixing pipeline...');\n\n        try {\n            const txIdBase = Date.now().toString(36);\n            // Either call the modular orchestrator directly (client-side) or via API route.\n            // Using direct call to keep interactions smooth; switch to fetch('/api/mix') if you prefer server-side orchestration.\n            await runMix(\n                { ...mixReq, amountStrk: amt, privacyLevel: session.privacyLevel },\n                (e) => {\n                    // Update session progress/metrics\n                    if (typeof e.progress === 'number') {\n                        setSession((p) => ({\n                            ...p,\n                            step: p.step === 'deposit' && (e.progress as number) > 30 ? 'mixing' : p.step,\n                            progress: (e.progress as number) ?? p.progress,\n                        }));\n                    }\n                    if (typeof e.anonymitySetSize === 'number') {\n                        setSession((p) => ({ ...p, anonymitySetSize: e.anonymitySetSize ?? p.anonymitySetSize }));\n                    }\n                    if (typeof e.estimatedTime === 'number') {\n                        setSession((p) => ({ ...p, estimatedTime: e.estimatedTime ?? p.estimatedTime }));\n                    }\n\n                    // Maintain live, address-free transaction history\n                    setTransactions((prev) => {\n                        const next = [...prev];\n                        const now = Date.now();\n                        if (e.type === 'deposit:initiated') {\n                            next.push({\n                                id: `${txIdBase}-dep`,\n                                type: 'deposit',\n                                amount: String(amt),\n                                status: 'pending',\n                                timestamp: now,\n                                privacyScore: 0,\n                                fromNetwork: 'Starknet',\n                                toNetwork: 'Lightning',\n                            });\n                        }\n                        if (e.type === 'lightning:paid') {\n                            const idx = next.findIndex(t => t.id === `${txIdBase}-dep`);\n                            if (idx >= 0) next[idx] = { ...next[idx], status: 'completed' };\n                        }\n                        if (e.type === 'cashu:minted' && !next.some(t => t.id === `${txIdBase}-mix`)) {\n                            next.push({\n                                id: `${txIdBase}-mix`,\n                                type: 'mix',\n                                amount: String(amt),\n                                status: 'processing',\n                                timestamp: now,\n                                privacyScore: 0,\n                                fromNetwork: 'Lightning',\n                                toNetwork: 'STRK',\n                            });\n                        }\n                        if (e.type === 'mix:complete') {\n                            const idx = next.findIndex(t => t.id === `${txIdBase}-mix`);\n                            if (idx >= 0) next[idx] = {\n                                ...next[idx],\n                                status: 'completed',\n                                privacyScore: e.privacyScore ?? next[idx].privacyScore,\n                                anonymitySetSize: session.anonymitySetSize || next[idx].anonymitySetSize,\n                            };\n                        }\n                        if (e.type === 'mix:error') {\n                            const idxMix = next.findIndex(t => t.id === `${txIdBase}-mix`);\n                            if (idxMix >= 0) next[idxMix] = { ...next[idxMix], status: 'failed' };\n                        }\n                        return next;\n                    });\n\n                    if (e.type === 'mix:complete') {\n                        showNotification('success', 'Mix Complete', `Privacy score ${e.privacyScore}%`);\n                        setSession((p) => ({ ...p, step: 'complete', progress: 100 }));\n                    }\n                    if (e.type === 'mix:error') {\n                        showNotification('error', 'Mix Error', e.message || 'Unknown error');\n                    }\n                }\n            );\n        } catch {\n            // error already notified\n        }\n    };\n\n    // currentStepIndex not used directly; Stepper consumes `session.step`.\n\n    return (\n        <div className=\"min-h-screen bg-gray-950 text-white\">\n            {/* Navigation */}\n            <Navigation />\n\n            {/* Background Grid */}\n            <div className=\"absolute inset-0 bg-gray-950 -z-10\">\n                <div className=\"absolute inset-0 opacity-70 pointer-events-none\" style={{\n                    backgroundImage: \"url('/patterns/grid.svg')\",\n                    backgroundSize: '32px 32px',\n                    backgroundRepeat: 'repeat'\n                }}></div>\n            </div>\n\n            <div className=\"relative z-10 container mx-auto px-4 py-8\">\n                {/* Page Header */}\n                <div className=\"text-center mb-12\">\n                    <h1 className=\"text-4xl font-bold mb-4 text-white\">Privacy Mixer</h1>\n                    <p className=\"text-gray-400 text-lg\">\n                        Enhanced privacy through advanced cryptographic mixing\n                    </p>\n\n                    {/* Wallet Status */}\n                    <div className=\"mt-6\">\n                        {isConnected ? (\n                            <div className=\"inline-flex items-center space-x-2 bg-green-500/10 border border-green-500/20 rounded-lg px-4 py-2\">\n                                <CheckCircleIcon className=\"w-5 h-5 text-green-400\" />\n                                <span className=\"text-green-400 font-medium\">Wallet Connected</span>\n                            </div>\n                        ) : (\n                            <button\n                                onClick={() => setShowWalletModal(true)}\n                                className=\"inline-flex items-center space-x-2 bg-orange-500/10 border border-orange-500/20 hover:border-orange-500 rounded-lg px-4 py-2 transition-colors\"\n                            >\n                                <WalletIcon className=\"w-5 h-5 text-orange-400\" />\n                                <span className=\"text-orange-400 font-medium\">Connect Wallet</span>\n                            </button>\n                        )}\n                    </div>\n                </div>\n\n                <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n                    {/* Main Mixer Interface */}\n                    <div className=\"lg:col-span-2\">\n                        <Stepper current={session.step} />\n\n                        {/* Main Content */}\n                        <div>\n                            {session.step === 'setup' && (\n                                <SetupForm\n                                    value={mixReq}\n                                    onChange={(v) => {\n                                        if (v.amountStrk != null) setSession((p) => ({ ...p, amount: String(v.amountStrk) }));\n                                        if (v.privacyLevel) setSession((p) => ({ ...p, privacyLevel: v.privacyLevel as PLevel }));\n                                        setMixReq((p) => ({ ...p, ...v }));\n                                    }}\n                                    onStart={startMixing}\n                                    isConnected={isConnected}\n                                />\n                            )}\n\n                            {session.step === 'deposit' && (\n                                <DepositView amount={session.amount} />\n                            )}\n\n                            {session.step === 'mixing' && (\n                                <MixingView progress={session.progress} anonymitySet={session.anonymitySetSize} eta={session.estimatedTime} />\n                            )}\n\n                            {session.step === 'complete' && (\n                                <CompleteView amount={session.amount} anonymitySet={session.anonymitySetSize} onReset={() => setSession({ step: 'setup', amount: '', privacyLevel: 'standard', progress: 0, anonymitySetSize: 0, estimatedTime: 0 })} />\n                            )}\n                        </div>\n                    </div>\n\n                    {/* Transaction Status Sidebar */}\n                    <div className=\"lg:col-span-1\">\n                        <TransactionStatus\n                            transactions={transactions}\n                            currentMixingSession={session.step === 'mixing' ? {\n                                id: 'current',\n                                phase: session.step,\n                                progress: session.progress,\n                                anonymitySetSize: session.anonymitySetSize,\n                                estimatedTime: session.estimatedTime\n                            } : undefined}\n                        />\n                    </div>\n                </div>\n            </div>\n\n            {/* Modals and Notifications */}\n            <WalletConnection\n                isOpen={showWalletModal}\n                onClose={() => setShowWalletModal(false)}\n                onConnect={handleWalletConnect}\n                isConnecting={isConnecting}\n            />\n\n            <Notification\n                type={notification.type}\n                title={notification.title}\n                message={notification.message}\n                isVisible={notification.show}\n                onClose={() => setNotification(prev => ({ ...prev, show: false }))}\n            />\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;;;AAhBA;;;;;;;;;;;;;;AA6Be,SAAS;;IACpB,8DAA8D;IAC9D,MAAM,SAAS,IAAA,iJAAS;IAExB,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAgB;QAClD,MAAM;QACN,QAAQ;QACR,cAAc;QACd,UAAU;QACV,kBAAkB;QAClB,eAAe;IACnB;IAEA,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,yKAAQ,EAAC;IAC/C,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,yKAAQ,EAAC;IACvD,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,yKAAQ,EAAC;IACjD,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,yKAAQ,EAK7C;QAAE,MAAM;QAAO,MAAM;QAAQ,OAAO;QAAI,SAAS;IAAG;IACvD,2DAA2D;IAC3D,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,yKAAQ,EAU5C,EAAE;IAEN,6FAA6F;IAE7F,gFAAgF;IAEhF,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAa;QAC7C,YAAY;QACZ,cAAc,EAAE;QAChB,cAAc;QACd,kBAAkB;QAClB,oBAAoB;QACpB,YAAY;QACZ,uBAAuB;QACvB,yBAAyB;QACzB,eAAe;IACnB;IAEA,MAAM,mBAAmB,CAAC,MAAgD,OAAe;QACrF,gBAAgB;YAAE,MAAM;YAAM;YAAM;YAAO;QAAQ;IACvD;IAEA,MAAM,sBAAsB,OAAO;QAC/B,gBAAgB;QAChB,IAAI;YACA,8CAA8C;YAC9C,MAAM,QAAQ,CAAC;gBACX,IAAI,GAAG,WAAW,OAAO,WAAW,OAAO;gBAC3C,IAAI,GAAG,WAAW,OAAO,WAAW,OAAO;gBAC3C,IAAI,GAAG,WAAW,OAAO,OAAO,OAAO;gBACvC,OAAO;YACX;YAEA,MAAM,OAAO,OAAO,CAAC,MAAM;YAC3B,eAAe;YACf,mBAAmB;YACnB,iBAAiB,WAAW,oBAAoB,AAAC,gBAAwB,OAAT;QACpE,EAAE,UAAM;YACJ,iBAAiB,SAAS,qBAAqB;QACnD,SAAU;YACN,gBAAgB;QACpB;IACJ;IAEA,wCAAwC;IACxC,IAAA,0KAAS;+BAAC;YACN,eAAe,OAAO,WAAW;QACrC;8BAAG;QAAC,OAAO,WAAW;KAAC;IAEvB,iGAAiG;IAEjG,MAAM,cAAc;QAChB,IAAI,CAAC,aAAa;YACd,mBAAmB;YACnB;QACJ;QAEA,MAAM,MAAM,WAAW,QAAQ,MAAM,IAAI;QACzC,IAAI,CAAC,OAAO,OAAO,KAAK,OAAO,YAAY,CAAC,MAAM,KAAK,KAAK,CAAC,OAAO,YAAY,CAAC,EAAE,EAAE;YACjF,iBAAiB,WAAW,iBAAiB;YAC7C;QACJ;QAEA,WAAW,CAAC,IAAM,CAAC;gBAAE,GAAG,CAAC;gBAAE,MAAM;gBAAW,UAAU;YAAE,CAAC;QACzD,iBAAiB,QAAQ,gBAAgB;QAEzC,IAAI;YACA,MAAM,WAAW,KAAK,GAAG,GAAG,QAAQ,CAAC;YACrC,gFAAgF;YAChF,sHAAsH;YACtH,MAAM,IAAA,uIAAM,EACR;gBAAE,GAAG,MAAM;gBAAE,YAAY;gBAAK,cAAc,QAAQ,YAAY;YAAC,GACjE,CAAC;gBACG,kCAAkC;gBAClC,IAAI,OAAO,EAAE,QAAQ,KAAK,UAAU;oBAChC,WAAW,CAAC;4BAGE;+BAHK;4BACf,GAAG,CAAC;4BACJ,MAAM,EAAE,IAAI,KAAK,aAAa,AAAC,EAAE,QAAQ,GAAc,KAAK,WAAW,EAAE,IAAI;4BAC7E,UAAU,CAAA,OAAC,EAAE,QAAQ,cAAX,kBAAA,OAA0B,EAAE,QAAQ;wBAClD;;gBACJ;gBACA,IAAI,OAAO,EAAE,gBAAgB,KAAK,UAAU;oBACxC,WAAW,CAAC;4BAAiC;+BAA1B;4BAAE,GAAG,CAAC;4BAAE,kBAAkB,CAAA,sBAAA,EAAE,gBAAgB,cAAlB,iCAAA,sBAAsB,EAAE,gBAAgB;wBAAC;;gBAC1F;gBACA,IAAI,OAAO,EAAE,aAAa,KAAK,UAAU;oBACrC,WAAW,CAAC;4BAA8B;+BAAvB;4BAAE,GAAG,CAAC;4BAAE,eAAe,CAAA,mBAAA,EAAE,aAAa,cAAf,8BAAA,mBAAmB,EAAE,aAAa;wBAAC;;gBACjF;gBAEA,kDAAkD;gBAClD,gBAAgB,CAAC;oBACb,MAAM,OAAO;2BAAI;qBAAK;oBACtB,MAAM,MAAM,KAAK,GAAG;oBACpB,IAAI,EAAE,IAAI,KAAK,qBAAqB;wBAChC,KAAK,IAAI,CAAC;4BACN,IAAI,AAAC,GAAW,OAAT,UAAS;4BAChB,MAAM;4BACN,QAAQ,OAAO;4BACf,QAAQ;4BACR,WAAW;4BACX,cAAc;4BACd,aAAa;4BACb,WAAW;wBACf;oBACJ;oBACA,IAAI,EAAE,IAAI,KAAK,kBAAkB;wBAC7B,MAAM,MAAM,KAAK,SAAS,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,AAAC,GAAW,OAAT,UAAS;wBACrD,IAAI,OAAO,GAAG,IAAI,CAAC,IAAI,GAAG;4BAAE,GAAG,IAAI,CAAC,IAAI;4BAAE,QAAQ;wBAAY;oBAClE;oBACA,IAAI,EAAE,IAAI,KAAK,kBAAkB,CAAC,KAAK,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,AAAC,GAAW,OAAT,UAAS,UAAQ;wBAC1E,KAAK,IAAI,CAAC;4BACN,IAAI,AAAC,GAAW,OAAT,UAAS;4BAChB,MAAM;4BACN,QAAQ,OAAO;4BACf,QAAQ;4BACR,WAAW;4BACX,cAAc;4BACd,aAAa;4BACb,WAAW;wBACf;oBACJ;oBACA,IAAI,EAAE,IAAI,KAAK,gBAAgB;wBAC3B,MAAM,MAAM,KAAK,SAAS,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,AAAC,GAAW,OAAT,UAAS;4BAInC;wBAHlB,IAAI,OAAO,GAAG,IAAI,CAAC,IAAI,GAAG;4BACtB,GAAG,IAAI,CAAC,IAAI;4BACZ,QAAQ;4BACR,cAAc,CAAA,kBAAA,EAAE,YAAY,cAAd,6BAAA,kBAAkB,IAAI,CAAC,IAAI,CAAC,YAAY;4BACtD,kBAAkB,QAAQ,gBAAgB,IAAI,IAAI,CAAC,IAAI,CAAC,gBAAgB;wBAC5E;oBACJ;oBACA,IAAI,EAAE,IAAI,KAAK,aAAa;wBACxB,MAAM,SAAS,KAAK,SAAS,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,AAAC,GAAW,OAAT,UAAS;wBACxD,IAAI,UAAU,GAAG,IAAI,CAAC,OAAO,GAAG;4BAAE,GAAG,IAAI,CAAC,OAAO;4BAAE,QAAQ;wBAAS;oBACxE;oBACA,OAAO;gBACX;gBAEA,IAAI,EAAE,IAAI,KAAK,gBAAgB;oBAC3B,iBAAiB,WAAW,gBAAgB,AAAC,iBAA+B,OAAf,EAAE,YAAY,EAAC;oBAC5E,WAAW,CAAC,IAAM,CAAC;4BAAE,GAAG,CAAC;4BAAE,MAAM;4BAAY,UAAU;wBAAI,CAAC;gBAChE;gBACA,IAAI,EAAE,IAAI,KAAK,aAAa;oBACxB,iBAAiB,SAAS,aAAa,EAAE,OAAO,IAAI;gBACxD;YACJ;QAER,EAAE,UAAM;QACJ,yBAAyB;QAC7B;IACJ;IAEA,uEAAuE;IAEvE,qBACI,6LAAC;QAAI,WAAU;;0BAEX,6LAAC,8IAAU;;;;;0BAGX,6LAAC;gBAAI,WAAU;0BACX,cAAA,6LAAC;oBAAI,WAAU;oBAAkD,OAAO;wBACpE,iBAAiB;wBACjB,gBAAgB;wBAChB,kBAAkB;oBACtB;;;;;;;;;;;0BAGJ,6LAAC;gBAAI,WAAU;;kCAEX,6LAAC;wBAAI,WAAU;;0CACX,6LAAC;gCAAG,WAAU;0CAAqC;;;;;;0CACnD,6LAAC;gCAAE,WAAU;0CAAwB;;;;;;0CAKrC,6LAAC;gCAAI,WAAU;0CACV,4BACG,6LAAC;oCAAI,WAAU;;sDACX,6LAAC,mPAAe;4CAAC,WAAU;;;;;;sDAC3B,6LAAC;4CAAK,WAAU;sDAA6B;;;;;;;;;;;yDAGjD,6LAAC;oCACG,SAAS,IAAM,mBAAmB;oCAClC,WAAU;;sDAEV,6LAAC,oOAAU;4CAAC,WAAU;;;;;;sDACtB,6LAAC;4CAAK,WAAU;sDAA8B;;;;;;;;;;;;;;;;;;;;;;;kCAM9D,6LAAC;wBAAI,WAAU;;0CAEX,6LAAC;gCAAI,WAAU;;kDACX,6LAAC,oJAAO;wCAAC,SAAS,QAAQ,IAAI;;;;;;kDAG9B,6LAAC;;4CACI,QAAQ,IAAI,KAAK,yBACd,6LAAC,wJAAS;gDACN,OAAO;gDACP,UAAU,CAAC;oDACP,IAAI,EAAE,UAAU,IAAI,MAAM,WAAW,CAAC,IAAM,CAAC;4DAAE,GAAG,CAAC;4DAAE,QAAQ,OAAO,EAAE,UAAU;wDAAE,CAAC;oDACnF,IAAI,EAAE,YAAY,EAAE,WAAW,CAAC,IAAM,CAAC;4DAAE,GAAG,CAAC;4DAAE,cAAc,EAAE,YAAY;wDAAW,CAAC;oDACvF,UAAU,CAAC,IAAM,CAAC;4DAAE,GAAG,CAAC;4DAAE,GAAG,CAAC;wDAAC,CAAC;gDACpC;gDACA,SAAS;gDACT,aAAa;;;;;;4CAIpB,QAAQ,IAAI,KAAK,2BACd,6LAAC,4JAAW;gDAAC,QAAQ,QAAQ,MAAM;;;;;;4CAGtC,QAAQ,IAAI,KAAK,0BACd,6LAAC,0JAAU;gDAAC,UAAU,QAAQ,QAAQ;gDAAE,cAAc,QAAQ,gBAAgB;gDAAE,KAAK,QAAQ,aAAa;;;;;;4CAG7G,QAAQ,IAAI,KAAK,4BACd,6LAAC,8JAAY;gDAAC,QAAQ,QAAQ,MAAM;gDAAE,cAAc,QAAQ,gBAAgB;gDAAE,SAAS,IAAM,WAAW;wDAAE,MAAM;wDAAS,QAAQ;wDAAI,cAAc;wDAAY,UAAU;wDAAG,kBAAkB;wDAAG,eAAe;oDAAE;;;;;;;;;;;;;;;;;;0CAM9N,6LAAC;gCAAI,WAAU;0CACX,cAAA,6LAAC,qJAAiB;oCACd,cAAc;oCACd,sBAAsB,QAAQ,IAAI,KAAK,WAAW;wCAC9C,IAAI;wCACJ,OAAO,QAAQ,IAAI;wCACnB,UAAU,QAAQ,QAAQ;wCAC1B,kBAAkB,QAAQ,gBAAgB;wCAC1C,eAAe,QAAQ,aAAa;oCACxC,IAAI;;;;;;;;;;;;;;;;;;;;;;;0BAOpB,6LAAC,oJAAgB;gBACb,QAAQ;gBACR,SAAS,IAAM,mBAAmB;gBAClC,WAAW;gBACX,cAAc;;;;;;0BAGlB,6LAAC,gJAAY;gBACT,MAAM,aAAa,IAAI;gBACvB,OAAO,aAAa,KAAK;gBACzB,SAAS,aAAa,OAAO;gBAC7B,WAAW,aAAa,IAAI;gBAC5B,SAAS,IAAM,gBAAgB,CAAA,OAAQ,CAAC;4BAAE,GAAG,IAAI;4BAAE,MAAM;wBAAM,CAAC;;;;;;;;;;;;AAIhF;GArSwB;;QAEL,iJAAS;;;KAFJ","debugId":null}}]
}