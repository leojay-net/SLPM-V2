module.exports=[814747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},522734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},961724,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-route-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-route-turbo.runtime.prod.js"))},918622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},120635,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},324725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},270406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},666680,(e,t,r)=>{t.exports=e.x("node:crypto",()=>require("node:crypto"))},919822,e=>{"use strict";e.s(["CONFIG_STATUS",()=>i,"ENV",()=>t,"getNetworkStatus",()=>n,"getStarknetRpc",()=>r,"getTestnetStatus",()=>a]);let t={NETWORK:"MAINNET",STARKNET_RPC:"https://starknet-mainnet.g.alchemy.com/starknet/version/rpc/v0_8/kwgGr9GGk4YyLXuGfEvpITv1jpvn3PgP",STARKNET_PRIVATE_KEY:process.env.STARKNET_PRIVATE_KEY||"",SHARED_SWAP_ACCOUNT_PRIVATE_KEY:process.env.SHARED_SWAP_ACCOUNT_PRIVATE_KEY||"0x017e929b437eb038963df230f6dcc8002d06741107abfe22972e4532ba25ccaa",SHARED_SWAP_ACCOUNT_ADDRESS:process.env.SHARED_SWAP_ACCOUNT_ADDRESS||"",MIXER_CONTRACT_ADDRESS:"0x05effdcfda86066c72c108e174c55a4f8d1249ba69f80e975d7fc814199a376b",LND_URL:"https://slpm-node.t.voltageapp.io:8080",LND_MACAROON:"0201036c6e64025e030a103294bb4616a5eb95a9a935fd5183e1111207383635383234331a160a0761646472657373120472656164120577726974651a170a08696e766f69636573120472656164120577726974651a0f0a076f6e636861696e12047265616400000620bb9f424dcd1d871d56445eb2394e9f734a461bfbd8904538bb370965efd79643",LND_TLS:"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUUyRENDQkY2Z0F3SUJBZ0lTQmRPR3lzblJnUmJaR1NON3B3ZTQ2a0NrTUFvR0NDcUdTTTQ5QkFNRE1ESXgKQ3pBSkJnTlZCQVlUQWxWVE1SWXdGQVlEVlFRS0V3MU1aWFFuY3lCRmJtTnllWEIwTVFzd0NRWURWUVFERXdKRgpPREFlRncweU5UQTVNVGt5TXpRd01EZGFGdzB5TlRFeU1UZ3lNelF3TURaYU1Cb3hHREFXQmdOVkJBTU1EeW91CmRtOXNkR0ZuWldGd2NDNXBiekJaTUJNR0J5cUdTTTQ5QWdFR0NDcUdTTTQ5QXdFSEEwSUFCQ2tTZnIyTVlzWUgKN05zYUNOVVdCY1V2NmlJMGRVUkxFL0E2UEVSRjUvZkdIU1Vneldzc0o5emdqeG1uQ29JK0tzN1llcWlvMVBHWgp0dUJoVjNJVkJNV2pnZ05xTUlJRFpqQU9CZ05WSFE4QkFmOEVCQU1DQjRBd0hRWURWUjBsQkJZd0ZBWUlLd1lCCkJRVUhBd0VHQ0NzR0FRVUZCd01DTUF3R0ExVWRFd0VCL3dRQ01BQXdIUVlEVlIwT0JCWUVGTzRVNGdScjA3djIKbUUwc1dFdmdjeFpEbk84Sk1COEdBMVVkSXdRWU1CYUFGSThORTZMMkxuN1JVR3d6R0RoZFdZNGpjcEhLTURJRwpDQ3NHQVFVRkJ3RUJCQ1l3SkRBaUJnZ3JCZ0VGQlFjd0FvWVdhSFIwY0RvdkwyVTRMbWt1YkdWdVkzSXViM0puCkx6Q0NBV1VHQTFVZEVRU0NBVnd3Z2dGWWdoRXFMbUl1ZG05c2RHRm5aV0Z3Y0M1cGI0SVJLaTVrTG5admJIUmgKWjJVdVkyeHZkV1NDRVNvdVpDNTJiMngwWVdkbFlYQndMbWx2Z2hjcUxtMHVjbVZzWVhrdWRtOXNkR0ZuWlM1agpiRzkxWklJWEtpNXRMbkpsYkdGNUxuWnZiSFJoWjJWaGNIQXVhVytDRVNvdWJTNTJiMngwWVdkbExtTnNiM1ZrCmdoRXFMbTB1ZG05c2RHRm5aV0Z3Y0M1cGI0SU9LaTV1YjNOMGNpNTJiSFF1WjJXQ0Z5b3VkQzV5Wld4aGVTNTIKYjJ4MFlXZGxMbU5zYjNWa2doY3FMblF1Y21Wc1lYa3VkbTlzZEdGblpXRndjQzVwYjRJUktpNTBMblp2YkhSaApaMlV1WTJ4dmRXU0NFU291ZEM1MmIyeDBZV2RsWVhCd0xtbHZnaEVxTG5VdWRtOXNkR0ZuWldGd2NDNXBiNElQCktpNTJiMngwWVdkbExtTnNiM1ZrZ2hBcUxuWnZiSFJoWjJWaGNHa3VZMjl0Z2c4cUxuWnZiSFJoWjJWaGNIQXUKYVcrQ0JuWnNkQzVuWllJT2RtOXNkR0ZuWldGd2FTNWpiMjB3RXdZRFZSMGdCQXd3Q2pBSUJnWm5nUXdCQWdFdwpMUVlEVlIwZkJDWXdKREFpb0NDZ0hvWWNhSFIwY0RvdkwyVTRMbU11YkdWdVkzSXViM0puTHpNM0xtTnliRENDCkFRUUdDaXNHQVFRQjFua0NCQUlFZ2ZVRWdmSUE4QUIyQU4zY3lqU1YxK0VXQmVlVk12ckhuL2c5SEZEZjJ3QTYKRkJKMkNpeXN1OGdxQUFBQm1XU1BBNVlBQUFRREFFY3dSUUlnVVV0TGtNQk9oYUtDUk1odkZpa1AwUi9DUEhLdgptZHdSNGtsMWVZT3VOSklDSVFDaS8xZmVKNVBYZmMyME9FWDBnMDVZQkxEL01Ic2xzWkZ3UXF5M3BHY3h0UUIyCkFNejdEMnFGY1FsbC9wV2JVODdwc253aTZZVmNEWmVOdHFsK1ZNRCtUQTJ3QUFBQm1XU1BBNkVBQUFRREFFY3cKUlFJaEFKM0QvTFFzR0d5cFYrT2FpSWZJekQ4bFo4bEo3TnZaT2Y3QnVveStxR00xQWlCaTFxZFVwSGdNdTgzbQo5TGxTQ2k5YVo0eFN6VW93aVp6MDBkZDhlN3g5VlRBS0JnZ3Foa2pPUFFRREF3Tm9BREJsQWpFQWpyUERRM1FuClVjYTJSRng0TkhhZ1FwdWtFcTRrV2k0VkduUHIwZFplMERWc2RBM3hnSy9QTHRpcFlDODVDeUlxQWpCNjhLT2cKQzMvb05PN1ZqcmovUjFFWVd1QjZXWDJwYlMyN25PSW10V2taMm9ldWV1dUJ6Y2QyM1pKMHp6Z01UUXM9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVWakNDQWo2Z0F3SUJBZ0lRWTVXVFk4Sk9jSUp4V1JpL3c5ZnRWakFOQmdrcWhraUc5dzBCQVFzRkFEQlAKTVFzd0NRWURWUVFHRXdKVlV6RXBNQ2NHQTFVRUNoTWdTVzUwWlhKdVpYUWdVMlZqZFhKcGRIa2dVbVZ6WldGeQpZMmdnUjNKdmRYQXhGVEFUQmdOVkJBTVRERWxUVWtjZ1VtOXZkQ0JZTVRBZUZ3MHlOREF6TVRNd01EQXdNREJhCkZ3MHlOekF6TVRJeU16VTVOVGxhTURJeEN6QUpCZ05WQkFZVEFsVlRNUll3RkFZRFZRUUtFdzFNWlhRbmN5QkYKYm1OeWVYQjBNUXN3Q1FZRFZRUURFd0pGT0RCMk1CQUdCeXFHU000OUFnRUdCU3VCQkFBaUEySUFCTkZsOGw3YwpTN1FNQXB6U3N2cnU2V3lyT3E0NG9mVFVPVEl6eFVMVXpETU1OTWNoSUpCd1hPaGlMeHh4czBMWGViNUdEY0hiClI2RVRvTWZmZ1Naak85U05IZlk5Z2pNeTl2UXI1L1dXT3JRVFp4aDdhejZOU05ucTN1MnViVDZIVEtPQitEQ0IKOVRBT0JnTlZIUThCQWY4RUJBTUNBWVl3SFFZRFZSMGxCQll3RkFZSUt3WUJCUVVIQXdJR0NDc0dBUVVGQndNQgpNQklHQTFVZEV3RUIvd1FJTUFZQkFmOENBUUF3SFFZRFZSME9CQllFRkk4TkU2TDJMbjdSVUd3ekdEaGRXWTRqCmNwSEtNQjhHQTFVZEl3UVlNQmFBRkhtMFdlWjd0dVhrQVhPQUNJaklHbGoyNlp0dU1ESUdDQ3NHQVFVRkJ3RUIKQkNZd0pEQWlCZ2dyQmdFRkJRY3dBb1lXYUhSMGNEb3ZMM2d4TG1rdWJHVnVZM0l1YjNKbkx6QVRCZ05WSFNBRQpEREFLTUFnR0JtZUJEQUVDQVRBbkJnTlZIUjhFSURBZU1CeWdHcUFZaGhab2RIUndPaTh2ZURFdVl5NXNaVzVqCmNpNXZjbWN2TUEwR0NTcUdTSWIzRFFFQkN3VUFBNElDQVFCbkUwaEdJTktzQ1lXaTBYeDF5Z3hENXFpaEVqWjAKUkkzdFRaejF3dUFUSDNad1lQSXA5N2tXRWF5YW5EMWowY0RoSVl6eTRDa0RvMmpCOEQ1dDBhNnpaV3pscjk4ZApBUUZOaDh1S0prSUhkTFNoeStuVXllWnhjNWJOZU1wMUx1MGdTekU0TWNxZm1OTXZJcGVpd1dTWU85dzgyT2I4Cm90dlhjTzJKVVlpM3N2SElXUm0zKzcwN0RVYkw1MVhNY1kyaVpkbENxNFdhOW5idWszV1RVNGdyNkxZOE16VkEKYURRRzIrNFUzZUo2cVVGMTBiQm5SMXV1VnlEWXM5Umhyd3VjUlZuZnVEajI5Q01MVHNwbE01ZjV3U1Y1aFVwbQpVd3AvdlY3TTR3NGFHdW50NzRrb1g3MW40RWRhZ0NzTC9ZazUrbUFRVTArdHVlMEpPZkFWL1I2dDFrK1hrOXMyCkhNUUZlb3hwcGZ6QVZDMDRGZEc5TStBQzJKV3htRlN0NkJDdWgzQ0VleTNmRTUyUXJqOVlNNzVydHZJanNtLzEKSGwrdS8vV3F4bnUxWlE0anBhK1ZwdVppR09sV3JxU1A5ZW9nZE9oQ0dpc255ZXdXSndSUU9xSzE2d2lHeVplUgp4cy9CZWt3NjV2d1NJYVZrQnJ1UGlUZk1PbzBaaDRnVmE4L3FKZ01iSmJ5cnd3Rzk3ei9QUmdtTEtDRGw4ejNkCnRBMFo3cXE3ZnRhMEdsMjR1eXVCMDVkcUk1SjFMdkF6S3VXZElqVDF0UDhxQ294U0UveHBpeDhoWDJkdDNoKy8KanVqVWdGUEZaMEVWWjB4U3lCTlJGM01ib0dabllYRlV4cE5qVFdQS3BhZ0RISlFtcXJBY0RtV0puTXNGWTNqUwp1MWlndjNPZWZuV2pTUT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K",CASHU_MINTS:"https://mint.coinos.io".split(",").map(e=>e.trim()).filter(Boolean),CASHU_DEFAULT_MINT:"https://mint.coinos.io",CASHU_SINGLE_MINT:!0,DISABLE_CASHU_SPLIT:!0,STRK_BTC_RATE:Number(process.env.NEXT_PUBLIC_STRK_BTC_RATE||process.env.STRK_BTC_RATE||"0"),STRK_SATS_RATE:(()=>{let e=process.env.NEXT_PUBLIC_STRK_SATS_RATE||process.env.STRK_SATS_RATE;if(e)return Number(e);let t=Number(process.env.NEXT_PUBLIC_STRK_BTC_RATE||process.env.STRK_BTC_RATE||"0");return t&&!isNaN(t)&&t>0?Math.floor(1e8*t):125})(),DISABLE_ATOMIQ_PRICE_FETCH:!1,ALLOW_SWAP_PRICE_FALLBACK:"true"===process.env.ALLOW_SWAP_PRICE_FALLBACK};function r(){if(t.STARKNET_RPC)return t.STARKNET_RPC;switch(t.NETWORK){case"MAINNET":default:return"https://starknet-mainnet.g.alchemy.com/starknet/version/rpc/v0_8/kwgGr9GGk4YyLXuGfEvpITv1jpvn3PgP";case"TESTNET":return"https://starknet-sepolia.public.blastapi.io/rpc/v0_7"}}function n(){let e=!!(t.LND_URL&&t.LND_MACAROON),r="MAINNET"===t.NETWORK?["MAINNET"===t.NETWORK&&t.STARKNET_RPC&&t.STARKNET_PRIVATE_KEY&&t.CASHU_DEFAULT_MINT&&t.LND_URL&&t.LND_MACAROON].every(Boolean):["TESTNET"===t.NETWORK&&t.STARKNET_RPC&&t.STARKNET_PRIVATE_KEY&&t.CASHU_DEFAULT_MINT].every(Boolean);return{network:t.NETWORK,starknetRpc:!!t.STARKNET_RPC,privateKey:!!t.STARKNET_PRIVATE_KEY,cashuMint:!!t.CASHU_DEFAULT_MINT,lightningNode:!!t.LND_URL,lightningConfigured:e,cashuMints:t.CASHU_MINTS.length,ready:r,warnings:(()=>{let e=[];return t.STARKNET_RPC||e.push("STARKNET_RPC not configured"),t.STARKNET_PRIVATE_KEY||e.push("STARKNET_PRIVATE_KEY not configured"),t.CASHU_DEFAULT_MINT||e.push("CASHU_DEFAULT_MINT not configured"),"MAINNET"===t.NETWORK&&(t.LND_URL||e.push("Lightning node (LND_URL) required for mainnet"),t.LND_MACAROON||e.push("Lightning authentication (LND_MACAROON) required for mainnet")),e})()}}function a(){return n()}let i=function(){let e=[],r=[];return t.NETWORK&&["MAINNET","TESTNET"].includes(t.NETWORK)||e.push("Invalid network configuration"),t.CASHU_DEFAULT_MINT||e.push("No Cashu mint configured"),t.STARKNET_RPC||r.push(`Using default ${t.NETWORK} Starknet RPC - configure STARKNET_RPC for better reliability`),t.LND_URL||r.push("Lightning node URL not configured - using fallback mode"),0===t.CASHU_MINTS.length&&r.push("No multi-mint configuration - using single mint mode"),t.STARKNET_PRIVATE_KEY||r.push("No Starknet private key configured for server-side operations"),r.forEach(e=>console.warn(e)),{valid:0===e.length,errors:e,warnings:r}}()},21564,e=>{"use strict";e.s(["MultiMintCashuManager",()=>n,"RealCashuClient",()=>r]);var t=e.i(662951);class r{mint;wallet;initialized=!1;mintUrl;constructor(e){this.mintUrl=e,this.mint=new t.CashuMint(e),this.wallet=new t.CashuWallet(this.mint),console.log(`ðŸª™ Initializing Cashu client for testnet mint: ${e}`)}async ensureInitialized(){if(!this.initialized)try{console.log(`ðŸ”— Connecting to Cashu mint: ${this.mintUrl}`),await this.wallet.loadMint(),this.initialized=!0,console.log(`âœ… Cashu mint connected successfully`)}catch(e){throw console.warn(`âš ï¸ Failed to connect to Cashu mint: ${e instanceof Error?e.message:String(e)}`),Error(`Cashu mint connection failed: ${e instanceof Error?e.message:"Unknown error"}`)}}async createMintQuote(e){await this.ensureInitialized();let r=await this.wallet.createMintQuote(Number(e));return{quote:r.quote,amount:BigInt(r.amount),state:r.state===t.MintQuoteState.PAID?"PAID":r.state===t.MintQuoteState.ISSUED?"ISSUED":"CREATED",request:r.request}}async checkMintQuote(e){await this.ensureInitialized();let r=await this.wallet.checkMintQuote(e);return{quote:r.quote,amount:BigInt(r.amount||0),state:r.state===t.MintQuoteState.PAID?"PAID":r.state===t.MintQuoteState.ISSUED?"ISSUED":"CREATED",request:r.request}}async mintProofs(e,t){return await this.ensureInitialized(),(await this.wallet.mintProofs(Number(e),t)).map(this.convertToEcashProof)}async createMeltQuote(e){await this.ensureInitialized();let t=await this.wallet.createMeltQuote(e);return{quote:t.quote,amount:BigInt(t.amount),fee_reserve:BigInt(t.fee_reserve),unit:t.unit,expiry:t.expiry,request:t.request}}async meltProofs(e,t){await this.ensureInitialized();let r=t.map(this.convertFromEcashProof),n={quote:e.quote,amount:Number(e.amount),fee_reserve:Number(e.fee_reserve),state:"UNPAID",expiry:Math.floor(Date.now()/1e3)+3600,payment_preimage:null,request:"",unit:"sat"},a=await this.wallet.meltProofs(n,r);return{change:a.change?.map(this.convertToEcashProof)||[]}}async send(e,t){await this.ensureInitialized();let r=t.map(this.convertFromEcashProof),{keep:n,send:a}=await this.wallet.send(Number(e),r);return{keep:n.map(this.convertToEcashProof),send:a.map(this.convertToEcashProof)}}createToken(e){let r=e.map(this.convertFromEcashProof);return(0,t.getEncodedTokenV4)({mint:this.mint.mintUrl,proofs:r})}async receive(e){return await this.ensureInitialized(),(await this.wallet.receive(e)).map(this.convertToEcashProof)}async getMintInfo(){await this.ensureInitialized();let e=await this.mint.getInfo();return{name:e.name,description:e.description,version:e.version}}getBalance(e){return e.reduce((e,t)=>e+t.amount,0n)}convertToEcashProof(e){return{secret:e.secret,signature:e.C,amount:BigInt(e.amount),currency:"SAT",keysetId:e.id}}convertFromEcashProof(e){return{secret:e.secret,C:e.signature,amount:Number(e.amount),id:e.keysetId}}}class n{clients=new Map;mintUrls;constructor(e){this.mintUrls=e,e.forEach(e=>{this.clients.set(e,new r(e))})}selectMint(){let e=Math.floor(Math.random()*this.mintUrls.length),t=this.mintUrls[e];return this.clients.get(t)}getAllMints(){return Array.from(this.clients.values())}async distributeSend(e,t,r=2){let n=this.mintUrls.slice(0,r),a=e/BigInt(r),i=[];for(let e of n){let r=this.clients.get(e),n=t.filter(e=>this.getBalance([e])<=a);i.push({mint:r,proofs:n})}return{distributions:i}}getBalance(e){return e.reduce((e,t)=>e+t.amount,0n)}}},949070,e=>{"use strict";e.s(["default",()=>l]);var t=e.i(522734),r=e.i(814747);let n=r.default.join(process.cwd(),".data"),a=r.default.join(n,"cashu-tokens.json");async function i(){try{await t.promises.mkdir(n,{recursive:!0})}catch(e){}}async function s(){await i();try{let e=await t.promises.readFile(a,"utf8"),r=JSON.parse(e);if(r&&"object"==typeof r&&r.records)return{version:r.version||1,records:r.records}}catch(e){}return{version:1,records:{}}}async function o(e){let r=JSON.stringify(e,null,2);await t.promises.writeFile(a,r,"utf8")}let l={get:async e=>(await s()).records[e]||null,async set(e){let t=await s();t.records[e.quote]=e,await o(t)},async has(e){return!!await this.get(e)},async list(e=100){let t=Object.values((await s()).records);return t.sort((e,t)=>t.createdAt-e.createdAt),t.slice(0,e)}}},889011,(e,t,r)=>{},566307,e=>{"use strict";e.s(["handler",()=>Z,"patchFetch",()=>W,"routeModule",()=>k,"serverHooks",()=>M,"workAsyncStorage",()=>C,"workUnitAsyncStorage",()=>A],566307);var t=e.i(747909),r=e.i(174017),n=e.i(996250),a=e.i(759756),i=e.i(561916),s=e.i(869741),o=e.i(316795),l=e.i(487718),d=e.i(995169),u=e.i(47587),c=e.i(666012),R=e.i(570101),p=e.i(626937),T=e.i(10372),N=e.i(193695);e.i(52474);var U=e.i(600220);e.s(["GET",()=>m],191789);var E=e.i(89171),V=e.i(949070),h=e.i(21564),S=e.i(919822);async function m(e){try{let{searchParams:t}=new URL(e.url),r=t.get("quote"),n=t.get("mint")||void 0;if(!r)return E.NextResponse.json({error:"Missing quote parameter"},{status:400});let a=await V.default.get(r);if(a)return E.NextResponse.json({ok:!0,source:"vault",quote:a.quote,token:a.token,amountSats:a.amountSats,mint:a.mintUrl,createdAt:a.createdAt});let i=n||S.ENV.CASHU_DEFAULT_MINT,s=new h.RealCashuClient(i),o=await s.checkMintQuote(r);if("PAID"!==o.state)return E.NextResponse.json({ok:!1,error:`Quote not in PAID state (state=${o.state}). If you already paid, retry shortly.`},{status:409});let l=Number(o.amount||0n),d=await s.mintProofs(BigInt(l),r),u=s.createToken(d);return await V.default.set({quote:r,token:u,mintUrl:i,amountSats:d.reduce((e,t)=>e+Number(t.amount),0),proofsCount:d.length,createdAt:Date.now()}),E.NextResponse.json({ok:!0,source:"mint",quote:r,token:u,amountSats:l,mint:i})}catch(t){let e=t?.message||"Unknown error";return E.NextResponse.json({ok:!1,error:e},{status:500})}}var F=e.i(191789);let k=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/cashu/recover/route",pathname:"/api/cashu/recover",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/cashu/recover/route.ts",nextConfigOutput:"",userland:F}),{workAsyncStorage:C,workUnitAsyncStorage:A,serverHooks:M}=k;function W(){return(0,n.patchFetch)({workAsyncStorage:C,workUnitAsyncStorage:A})}async function Z(e,t,n){var E;let V="/api/cashu/recover/route";V=V.replace(/\/index$/,"")||"/";let h=await k.prepare(e,t,{srcPage:V,multiZoneDraftMode:!1});if(!h)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:S,params:m,nextConfig:F,isDraftMode:C,prerenderManifest:A,routerServerContext:M,isOnDemandRevalidate:W,revalidateOnlyGenerated:Z,resolvedPathname:Q}=h,f=(0,s.normalizeAppPath)(V),w=!!(A.dynamicRoutes[f]||A.routes[Q]);if(w&&!C){let e=!!A.routes[Q],t=A.dynamicRoutes[f];if(t&&!1===t.fallback&&!e)throw new N.NoFallbackError}let _=null;!w||k.isDev||C||(_="/index"===(_=Q)?"/":_);let g=!0===k.isDev||!w,v=w&&!g,x=e.method||"GET",I=(0,i.getTracer)(),D=I.getActiveScopeSpan(),y={params:m,prerenderManifest:A,renderOpts:{experimental:{cacheComponents:!!F.experimental.cacheComponents,authInterrupts:!!F.experimental.authInterrupts},supportsDynamicResponse:g,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:null==(E=F.experimental)?void 0:E.cacheLife,isRevalidate:v,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,n)=>k.onRequestError(e,t,n,M)},sharedContext:{buildId:S}},b=new o.NodeNextRequest(e),J=new o.NodeNextResponse(t),B=l.NextRequestAdapter.fromNodeNextRequest(b,(0,l.signalFromNodeResponse)(t));try{let s=async r=>k.handle(B,y).finally(()=>{if(!r)return;r.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let n=I.getRootSpanAttributes();if(!n)return;if(n.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${n.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=n.get("next.route");if(a){let e=`${x} ${a}`;r.setAttributes({"next.route":a,"http.route":a,"next.span_name":e}),r.updateName(e)}else r.updateName(`${x} ${e.url}`)}),o=async i=>{var o,l;let d=async({previousCacheEntry:r})=>{try{if(!(0,a.getRequestMeta)(e,"minimalMode")&&W&&Z&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await s(i);e.fetchMetrics=y.renderOpts.fetchMetrics;let l=y.renderOpts.pendingWaitUntil;l&&n.waitUntil&&(n.waitUntil(l),l=void 0);let d=y.renderOpts.collectedTags;if(!w)return await (0,c.sendResponse)(b,J,o,y.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,R.toNodeOutgoingHttpHeaders)(o.headers);d&&(t[T.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==y.renderOpts.collectedRevalidate&&!(y.renderOpts.collectedRevalidate>=T.INFINITE_CACHE)&&y.renderOpts.collectedRevalidate,n=void 0===y.renderOpts.collectedExpire||y.renderOpts.collectedExpire>=T.INFINITE_CACHE?void 0:y.renderOpts.collectedExpire;return{value:{kind:U.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==r?void 0:r.isStale)&&await k.onRequestError(e,t,{routerKind:"App Router",routePath:V,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isRevalidate:v,isOnDemandRevalidate:W})},M),t}},N=await k.handleResponse({req:e,nextConfig:F,cacheKey:_,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:A,isRoutePPREnabled:!1,isOnDemandRevalidate:W,revalidateOnlyGenerated:Z,responseGenerator:d,waitUntil:n.waitUntil});if(!w)return null;if((null==N||null==(o=N.value)?void 0:o.kind)!==U.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==N||null==(l=N.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,a.getRequestMeta)(e,"minimalMode")||t.setHeader("x-nextjs-cache",W?"REVALIDATED":N.isMiss?"MISS":N.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let E=(0,R.fromNodeOutgoingHttpHeaders)(N.value.headers);return(0,a.getRequestMeta)(e,"minimalMode")&&w||E.delete(T.NEXT_CACHE_TAGS_HEADER),!N.cacheControl||t.getHeader("Cache-Control")||E.get("Cache-Control")||E.set("Cache-Control",(0,p.getCacheControlHeader)(N.cacheControl)),await (0,c.sendResponse)(b,J,new Response(N.value.body,{headers:E,status:N.value.status||200})),null};D?await o(D):await I.withPropagatedContext(e.headers,()=>I.trace(d.BaseServerSpan.handleRequest,{spanName:`${x} ${e.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":x,"http.target":e.url}},o))}catch(t){if(D||t instanceof N.NoFallbackError||await k.onRequestError(e,t,{routerKind:"App Router",routePath:f,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isRevalidate:v,isOnDemandRevalidate:W})}),w)throw t;return await (0,c.sendResponse)(b,J,new Response(null,{status:500})),null}}}];

//# sourceMappingURL=%5Broot-of-the-server%5D__c155178a._.js.map