module.exports=[685358,a=>{"use strict";a.s(["default",()=>M],685358);var b=a.i(187924),c=a.i(572131),d=a.i(564379),e=a.i(329514),f=a.i(758212),g=a.i(142266),h=a.i(940772),i=a.i(366497),j=a.i(859508),k=a.i(828391),l=a.i(157726);function m({transactions:a,currentMixingSession:c}){return(0,b.jsxs)("div",{className:"bg-gray-900 border border-gray-700 rounded-xl p-6",children:[(0,b.jsxs)("h2",{className:"text-xl font-bold text-white mb-6 flex items-center space-x-3",children:[(0,b.jsx)(j.EyeSlashIcon,{className:"w-6 h-6 text-blue-400"}),(0,b.jsx)("span",{children:"Privacy Operations"})]}),c&&(0,b.jsxs)("div",{className:"mb-8 p-6 bg-gray-900/60 border border-gray-700 rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsxs)("h3",{className:"font-semibold text-white flex items-center space-x-2",children:[(0,b.jsx)(l.ArrowPathIcon,{className:"w-5 h-5 text-orange-400 animate-spin"}),(0,b.jsx)("span",{children:"Active Mixing Session"})]}),(0,b.jsxs)("div",{className:"text-sm text-gray-400",children:["Phase: ",(0,b.jsx)("span",{className:"text-orange-400 capitalize",children:c.phase})]})]}),(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsxs)("div",{className:"flex justify-between text-sm text-gray-400 mb-2",children:[(0,b.jsx)("span",{children:"Progress"}),(0,b.jsxs)("span",{children:[c.progress,"%"]})]}),(0,b.jsx)("div",{className:"w-full bg-gray-700 rounded-full h-2",children:(0,b.jsx)("div",{className:"bg-orange-500 h-2 rounded-full transition-all duration-1000",style:{width:`${c.progress}%`}})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-gray-400",children:"Anonymity Set:"}),(0,b.jsx)("span",{className:"text-white ml-2 font-medium",children:c.anonymitySetSize})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-gray-400",children:"Est. Time:"}),(0,b.jsxs)("span",{className:"text-white ml-2 font-medium",children:[c.estimatedTime,"min"]})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold text-white mb-4",children:"Recent Transactions"}),0===a.length?(0,b.jsxs)("div",{className:"text-center py-8 text-gray-400",children:[(0,b.jsx)(k.BanknotesIcon,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),(0,b.jsx)("p",{children:"No transactions yet"}),(0,b.jsx)("p",{className:"text-sm mt-1",children:"Start your first privacy mix to see transactions here"})]}):(0,b.jsx)("div",{className:"space-y-3",children:a.map(a=>{var c;return(0,b.jsx)("div",{className:"p-4 bg-gray-800 border border-gray-700 rounded-lg hover:border-gray-600 transition-colors",children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex items-start space-x-3",children:[(a=>{switch(a){case"completed":return(0,b.jsx)(e.CheckCircleIcon,{className:"w-5 h-5 text-green-400"});case"failed":return(0,b.jsx)(i.ExclamationTriangleIcon,{className:"w-5 h-5 text-red-400"});case"processing":return(0,b.jsx)(l.ArrowPathIcon,{className:"w-5 h-5 text-orange-400 animate-spin"});default:return(0,b.jsx)(h.ClockIcon,{className:"w-5 h-5 text-gray-400"})}})(a.status),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)("span",{className:"font-medium text-white capitalize",children:a.type}),(0,b.jsx)("span",{className:"text-sm text-gray-400",children:"â€¢"}),(0,b.jsxs)("span",{className:"text-sm text-white font-mono",children:[a.amount," STRK"]})]}),(0,b.jsxs)("div",{className:"text-sm text-gray-400 mt-1",children:[a.fromNetwork," â†’ ",a.toNetwork]}),(0,b.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:new Date(a.timestamp).toLocaleString()})]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("div",{className:`text-sm font-medium ${(a=>{switch(a){case"completed":return"text-green-400";case"failed":return"text-red-400";case"processing":return"text-orange-400";default:return"text-gray-400"}})(a.status)} capitalize`,children:a.status}),(0,b.jsxs)("div",{className:"text-xs text-gray-400 mt-1",children:["Privacy Score: ",(0,b.jsxs)("span",{className:(c=a.privacyScore)>=80?"text-green-400":c>=60?"text-yellow-400":"text-red-400",children:[a.privacyScore,"%"]})]}),a.anonymitySetSize&&(0,b.jsxs)("div",{className:"text-xs text-gray-400 mt-1",children:["Anonymity Set: ",a.anonymitySetSize]})]})]})},a.id)})})]}),a.length>0&&(0,b.jsxs)("div",{className:"mt-6 p-4 bg-gray-800/50 border border-gray-700 rounded-lg",children:[(0,b.jsx)("h4",{className:"font-medium text-white mb-3",children:"Privacy Metrics"}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-green-400",children:a.filter(a=>"completed"===a.status).length}),(0,b.jsx)("div",{className:"text-gray-400",children:"Completed"})]}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsxs)("div",{className:"text-2xl font-bold text-blue-400",children:[Math.round(a.reduce((a,b)=>a+b.privacyScore,0)/a.length),"%"]}),(0,b.jsx)("div",{className:"text-gray-400",children:"Avg Privacy"})]}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-orange-400",children:a.reduce((a,b)=>a+parseFloat(b.amount),0).toFixed(2)}),(0,b.jsx)("div",{className:"text-gray-400",children:"Total STRK"})]})]})]})]})}var n=a.i(304547);let o={setup:d.WalletIcon,deposit:k.BanknotesIcon,mixing:l.ArrowPathIcon,complete:e.CheckCircleIcon};function p({current:a}){let c=[{id:"setup",name:"Setup"},{id:"deposit",name:"Deposit"},{id:"mixing",name:"Mixing"},{id:"complete",name:"Complete"}],d=c.findIndex(b=>b.id===a);return(0,b.jsx)("div",{className:"mb-8",children:(0,b.jsx)("div",{className:"flex items-center justify-between",children:c.map((a,e)=>{let f=o[a.id],g=e<=d;return(0,b.jsxs)("div",{className:"flex flex-col items-center relative",children:[(0,b.jsx)("div",{className:`w-11 h-11 rounded-full border-2 flex items-center justify-center mb-2 ${g?"border-orange-500 bg-orange-500/10":"border-gray-600 bg-gray-800"}`,children:(0,b.jsx)(f,{className:`w-6 h-6 ${g?"text-orange-400":"text-gray-400"}`})}),(0,b.jsx)("span",{className:`text-sm ${e===d?"text-orange-400":g?"text-white":"text-gray-400"}`,children:a.name}),e<c.length-1&&(0,b.jsx)("div",{className:`absolute w-full h-0.5 top-6 left-11 ${e<d?"bg-orange-500":"bg-gray-600"}`,style:{width:"calc(100% + 44px)"}})]},a.id)})})})}let q={standard:{name:"Standard",description:"10+ participants",minParticipants:10,estimatedTime:5,feeBps:10},enhanced:{name:"Enhanced",description:"50+ participants",minParticipants:50,estimatedTime:15,feeBps:20},maximum:{name:"Maximum",description:"100+ participants",minParticipants:100,estimatedTime:30,feeBps:30}};function r({value:a,onChange:d,onStart:e,isConnected:f}){let g=(0,c.useMemo)(()=>q[a.privacyLevel].feeBps/100,[a.privacyLevel]),h=a.amountStrk>0&&a.destinations.length>0&&a.destinations[0]?.length>0;return(0,b.jsxs)("div",{className:"bg-gray-900 border border-gray-700 rounded-xl p-6",children:[(0,b.jsxs)("h2",{className:"text-xl font-bold mb-6 flex items-center space-x-3",children:[(0,b.jsx)(j.EyeSlashIcon,{className:"w-6 h-6 text-blue-400"}),(0,b.jsx)("span",{children:"Configure Privacy Mix"})]}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("label",{className:"block text-sm text-gray-300 mb-2",children:"Amount (STRK)"}),(0,b.jsx)("input",{inputMode:"decimal",value:a.amountStrk||"",onChange:a=>d({amountStrk:Number(a.target.value||0)}),placeholder:"0.00",className:"w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-400 focus:border-orange-500 focus:outline-none"}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Min: 1 STRK â€¢ Max: 10,000 STRK"})]}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("label",{className:"block text-sm text-gray-300 mb-2",children:"Destination Address"}),(0,b.jsx)("input",{value:a.destinations[0]||"",onChange:a=>d({destinations:a.target.value.trim()?[a.target.value.trim()]:[]}),placeholder:"0x1234567890abcdef...",className:"w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-400 focus:border-orange-500 focus:outline-none"}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"The STRK address where mixed funds will be sent."})]}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("label",{className:"block text-sm text-gray-300 mb-3",children:"Privacy Level"}),(0,b.jsx)("div",{className:"grid sm:grid-cols-3 gap-3",children:Object.keys(q).map(c=>{let e=q[c],f=a.privacyLevel===c;return(0,b.jsxs)("button",{type:"button",onClick:()=>d({privacyLevel:c}),className:`p-4 border rounded-lg text-left ${f?"border-orange-500 bg-orange-500/10":"border-gray-600 hover:border-gray-500"}`,children:[(0,b.jsx)("div",{className:"font-semibold",children:e.name}),(0,b.jsx)("div",{className:"text-sm text-gray-400",children:e.description}),(0,b.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:["Fee: ",(e.feeBps/100).toFixed(2),"% â€¢ Est: ",e.estimatedTime,"m"]})]},c)})})]}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("label",{className:"block text-sm text-gray-300 mb-3",children:"Advanced Privacy Options"}),(0,b.jsxs)("div",{className:"grid sm:grid-cols-2 gap-4",children:[(0,b.jsxs)("label",{className:"flex items-center gap-3 text-gray-300",children:[(0,b.jsx)("input",{type:"checkbox",checked:a.enableTimeDelays,onChange:a=>d({enableTimeDelays:a.target.checked})}),"Time delays & randomization"]}),(0,b.jsxs)("label",{className:"flex items-center gap-3 text-gray-300",children:[(0,b.jsx)("input",{type:"checkbox",checked:a.enableRandomizedMints,onChange:a=>d({enableRandomizedMints:a.target.checked})}),"Randomized Cashu mint hops"]}),(0,b.jsxs)("label",{className:"flex items-center gap-3 text-gray-300",children:[(0,b.jsx)("input",{type:"checkbox",checked:a.enableAmountObfuscation,onChange:a=>d({enableAmountObfuscation:a.target.checked})}),"Amount obfuscation"]}),(0,b.jsxs)("label",{className:"flex items-center gap-3 text-gray-300",children:[(0,b.jsx)("input",{type:"checkbox",checked:a.enableDecoyTx,onChange:a=>d({enableDecoyTx:a.target.checked})}),"Decoy transactions"]})]}),(0,b.jsxs)("div",{className:"mt-4 grid sm:grid-cols-2 gap-4",children:[(0,b.jsxs)("label",{className:"block text-sm text-gray-300",children:["Split outputs",(0,b.jsx)("input",{type:"number",min:1,max:10,value:a.splitCount,onChange:a=>d({splitCount:Number(a.target.value)}),className:"mt-1 w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-orange-500 focus:outline-none"})]}),(0,b.jsxs)("div",{className:"text-sm text-gray-400 self-end",children:["Fee estimate: ",g.toFixed(2),"%"]})]})]}),(0,b.jsx)("button",{onClick:e,disabled:!h,className:"w-full bg-orange-600 hover:bg-orange-700 disabled:bg-gray-700 disabled:cursor-not-allowed text-white font-semibold py-3 rounded-lg",children:f?"Start Privacy Mix":"Connect Wallet to Continue"})]})}function s({amount:a}){return(0,b.jsxs)("div",{className:"bg-gray-900 border border-gray-700 rounded-xl p-8 text-center",children:[(0,b.jsx)(k.BanknotesIcon,{className:"w-14 h-14 text-orange-400 mx-auto mb-4"}),(0,b.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"Processing Deposit"}),(0,b.jsxs)("p",{className:"text-gray-400 mb-6",children:["Preparing your ",a," STRK for mixing..."]}),(0,b.jsx)("div",{className:"animate-spin w-8 h-8 border-2 border-orange-500 border-t-transparent rounded-full mx-auto"})]})}function t({progress:a,anonymitySet:c,eta:d}){return(0,b.jsxs)("div",{className:"bg-gray-900 border border-gray-700 rounded-xl p-8",children:[(0,b.jsxs)("div",{className:"text-center mb-8",children:[(0,b.jsx)(l.ArrowPathIcon,{className:"w-14 h-14 text-orange-400 mx-auto mb-4 animate-spin"}),(0,b.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"Mixing in Progress"}),(0,b.jsxs)("p",{className:"text-gray-400",children:["Your transaction is being mixed with ",c," participants"]})]}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsxs)("div",{className:"flex justify-between text-sm text-gray-400 mb-2",children:[(0,b.jsx)("span",{children:"Progress"}),(0,b.jsxs)("span",{children:[Math.round(a),"%"]})]}),(0,b.jsx)("div",{className:"w-full bg-gray-700 rounded-full h-3",children:(0,b.jsx)("div",{className:"bg-orange-500 h-3 rounded-full transition-all duration-700",style:{width:`${a}%`}})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-center",children:[(0,b.jsxs)("div",{className:"p-4 bg-gray-800 rounded-lg",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-blue-400",children:c}),(0,b.jsx)("div",{className:"text-sm text-gray-400",children:"Anonymity Set"})]}),(0,b.jsxs)("div",{className:"p-4 bg-gray-800 rounded-lg",children:[(0,b.jsxs)("div",{className:"text-2xl font-bold text-orange-400",children:[d,"m"]}),(0,b.jsx)("div",{className:"text-sm text-gray-400",children:"Est. Time"})]})]})]})}function u({amount:a,anonymitySet:c,onReset:d}){return(0,b.jsxs)("div",{className:"bg-gray-900 border border-gray-700 rounded-xl p-8 text-center",children:[(0,b.jsx)(e.CheckCircleIcon,{className:"w-14 h-14 text-green-400 mx-auto mb-4"}),(0,b.jsx)("h2",{className:"text-2xl font-bold mb-2 text-green-400",children:"Mix Complete"}),(0,b.jsxs)("p",{className:"text-gray-400 mb-6",children:["Your ",a," STRK has been mixed with ",c," participants"]}),(0,b.jsx)("button",{onClick:d,className:"bg-orange-600 hover:bg-orange-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors",children:"Start New Mix"})]})}var v=a.i(867102),w=a.i(657262),x=a.i(515096),y=a.i(918373),z=a.i(14382),A=a.i(680665),B=a.i(140678);async function C(a,b,c,d,e){console.log("ðŸ”’ SLPM Privacy: Starting privacy step"),console.log("ðŸ”’ SLPM Privacy: Configuration:",{enableRandomizedMints:a.enableRandomizedMints,enableSplitOutputs:a.enableSplitOutputs,splitCount:a.splitCount,enableTimeDelays:a.enableTimeDelays,enableAmountObfuscation:a.enableAmountObfuscation,enableDecoyTx:a.enableDecoyTx,amountStrk:a.amountStrk}),console.log("ðŸ”’ SLPM Privacy: Input proofs:",{count:b.length,proofs:b.map(a=>({amount:a.amount,C:a.C?.slice(0,10)+"..."}))});let f=b.reduce((a,b)=>a+BigInt(b.amount),0n);console.log("ðŸ”’ SLPM Privacy: Total proof value:",f.toString(),"sats");try{let g=b;if(a.enableRandomizedMints&&d&&!B.ENV.CASHU_SINGLE_MINT){console.log("ðŸŒ SLPM Privacy: Distributing across multiple mints..."),console.log("ðŸŒ SLPM Privacy: Distribution amount:",f.toString(),"sats");let{distributions:a}=await d.distributeSend(f,b,2);g=a.flatMap(a=>a.proofs),console.log("ðŸŒ SLPM Privacy: Distribution result:",{originalProofs:b.length,newProofs:g.length,distributions:a.length}),e({type:"cashu:routed",message:"Distributed across multiple mints",progress:60}),console.log("âœ… SLPM Privacy: Multi-mint distribution completed")}else console.log("â­ï¸ SLPM Privacy: Skipping multi-mint distribution (disabled or no manager)");if(a.enableSplitOutputs&&a.splitCount>1&&!B.ENV.DISABLE_CASHU_SPLIT){console.log("ðŸ”€ SLPM Privacy: Splitting outputs...");let b=Number(f),d=BigInt(Math.floor(b/Math.max(1,a.splitCount)));console.log("ðŸ”€ SLPM Privacy: Split parameters:",{totalSats:b,splitCount:a.splitCount,perPart:d.toString()});let h=[],i=g.slice();for(let b=0;b<a.splitCount;b++){console.log(`ðŸ”€ SLPM Privacy: Creating split ${b+1}/${a.splitCount}...`);let{keep:e,send:f}=await c.send(d,i);h.push(...f),i=e,console.log(`ðŸ”€ SLPM Privacy: Split ${b+1} created:`,{sentProofs:f.length,keepProofs:e.length})}g=h.length?h:g,console.log("ðŸ”€ SLPM Privacy: Split result:",{finalProofs:g.length,splitSuccessful:h.length>0}),e({type:"cashu:routed",message:`Split into ${a.splitCount} outputs`,progress:70}),console.log("âœ… SLPM Privacy: Output splitting completed")}else console.log("â­ï¸ SLPM Privacy: Skipping output splitting (disabled or invalid split count)");if(a.enableTimeDelays){console.log("â±ï¸ SLPM Privacy: Applying time delays...");let a=function(a){let b=Math.floor(300);return a+Math.floor(Math.random()*b)}(1e3);console.log("â±ï¸ SLPM Privacy: Delay duration:",a,"ms"),await D(a),console.log("âœ… SLPM Privacy: Time delay applied")}else console.log("â­ï¸ SLPM Privacy: Skipping time delays (disabled)");return a.enableAmountObfuscation?(console.log("ðŸ’° SLPM Privacy: Applying amount obfuscation..."),await D(200),console.log("âœ… SLPM Privacy: Amount obfuscation applied")):console.log("â­ï¸ SLPM Privacy: Skipping amount obfuscation (disabled)"),a.enableDecoyTx?(console.log("ðŸ‘» SLPM Privacy: Applying decoy transactions..."),await D(200),console.log("âœ… SLPM Privacy: Decoy transactions applied")):console.log("â­ï¸ SLPM Privacy: Skipping decoy transactions (disabled)"),e({type:"mix:progress",message:"Privacy heuristics applied",progress:80}),console.log("ðŸ”’ SLPM Privacy: Final result:",{inputProofs:b.length,outputProofs:g.length,privacyFeaturesApplied:[a.enableRandomizedMints&&"multi-mint",a.enableSplitOutputs&&"split-outputs",a.enableTimeDelays&&"time-delays",a.enableAmountObfuscation&&"amount-obfuscation",a.enableDecoyTx&&"decoy-tx"].filter(Boolean)}),console.log("ðŸ”’ SLPM Privacy: Step completed successfully"),g}catch(c){throw console.error("âŒ SLPM Privacy: Step failed:",c),console.error("ðŸ” SLPM Privacy: Error details:",{message:c instanceof Error?c.message:"Unknown error",stack:c instanceof Error?c.stack:void 0,context:{proofsCount:b.length,hasManager:!!d,configuration:{enableRandomizedMints:a.enableRandomizedMints,enableSplitOutputs:a.enableSplitOutputs,splitCount:a.splitCount}}}),c}}function D(a){return new Promise(b=>setTimeout(b,a))}var E=a.i(729521),F=a.i(545750),G=a.i(140707);async function H(a,b,c,d,e){console.log("ðŸ”„ SLPM SwapBack: Starting SIMPLIFIED Cashu redemption (no mixing/splitting/delays)");let f=a.reduce((a,b)=>a+Number(b.amount),0),g=b[0],h=(0,G.getSharedSwapAddress)();console.log("ðŸ”„ SLPM SwapBack: SIMPLIFIED Parameters:",{proofsCount:a.length,totalSats:f,singleDestination:g?.slice(0,10)+"...",network:B.ENV.NETWORK,mintUrl:B.ENV.CASHU_DEFAULT_MINT});try{d({type:"mix:progress",message:"Converting ALL ecash to Lightning and STRK (single transaction)...",progress:80});let b=new E.RealAtomiqSwapClient(B.ENV.NETWORK);d({type:"mix:progress",message:"Calculating optimal invoice amount and melting ALL ecash proofs...",progress:85});let{finalInvoice:c,finalSwapId:i,meltResult:j}=await I(a,f,h||g,b,d,e);console.log("âœ… SLPM SwapBack: ALL Cashu proofs melted:",{invoiceAmount:c.slice(0,30)+"...",changeProofs:j.change?.length||0,totalRedeemed:j.usedAmount}),d({type:"mix:progress",message:"Waiting for Lightning payment to complete...",progress:90}),console.log("ðŸ”„ SLPM SwapBack: Waiting for Lightning payment...");let k=await b.waitLightningToStrkCompletion(i,3e5),l="FAILED";if(k){console.log("âš¡ SLPM SwapBack: Lightning payment confirmed, claiming STRK...");try{if(await b.claimLightningToStrkSwap(i),l="CLAIMED",console.log("âœ… SLPM SwapBack: STRK claimed to single destination"),console.log("âœ… SLPM SwapBack: STRK claimed to swap destination"),h&&h.toLowerCase()!==g.toLowerCase())try{let a=(await b.getStatus(i)).amountOut??0n;console.log("ðŸšš SLPM SwapBack: Forwarding STRK from shared to final recipient...",{from:h,to:g,amountWei:a.toString()}),await (0,G.transferStrkFromShared)(g,a),console.log("âœ… SLPM SwapBack: Forward transfer submitted")}catch(a){console.error("âŒ SLPM SwapBack: Forward transfer failed:",a),l="PAYMENT_CONFIRMED_CLAIM_FAILED"}}catch(a){console.error("âŒ SLPM SwapBack: Claim failed:",a),a instanceof Error&&/Invalid signer provided/i.test(a.message)&&console.error("ðŸ› ï¸ SLPM SwapBack: Signer invalid. Ensure SHARED_SWAP_ACCOUNT_PRIVATE_KEY and SHARED_SWAP_ACCOUNT_ADDRESS are set and correspond to a deployed Starknet account with funds for fees."),l="PAYMENT_CONFIRMED_CLAIM_FAILED"}}else console.warn("âš ï¸ SLPM SwapBack: Lightning payment did not complete in time");let m=[{destination:g,satsRedeemed:Number(j.usedAmount||f),strkSent:Number(j.usedAmount||f),txId:i,status:l}];return console.log("ðŸ“Š SLPM SwapBack: SIMPLIFIED Final result:",{destination:g,totalSatsRedeemed:m[0].satsRedeemed,totalStrkSent:m[0].strkSent,status:l}),d({type:"mix:progress",message:"Simplified swap completed",progress:95}),m}catch(a){throw console.error("âŒ SLPM SwapBack: SIMPLIFIED Critical error:",a),a}}async function I(a,b,c,d,e,f){console.log("ðŸª™ SLPM SwapBack: Starting SIMPLIFIED Cashu redemption (using encoded token like standalone)");let g=a.reduce((a,b)=>a+Number(b.amount),0);console.log("ðŸ’° SLPM SwapBack: ALL Available proofs:",{count:a.length,totalAmount:g,mintUrl:B.ENV.CASHU_DEFAULT_MINT});try{console.log("âš¡ SLPM SwapBack: Retrieving encoded token for standalone pattern...");let a=null;if(f&&(console.log("ðŸ” SLPM SwapBack: Looking for token with quote ID:",f),a=await (0,F.getEncodedTokenFromStorage)(f)),a||console.warn("âš ï¸ No encoded token found for quote ID, trying localStorage scan..."),!a)throw console.warn("âš ï¸ No encoded token found anywhere, this may cause issues"),Error("No encoded token available - cannot use standalone script pattern");console.log("âœ… Successfully retrieved encoded token for direct melt"),console.log("ðŸ§® SLPM SwapBack: Calculating maximum invoice amount from token balance...");let g=await (0,F.calculateMaxInvoiceAmount)(a);if(!g.success)throw Error(`Failed to calculate max invoice amount: ${g.error}`);console.log("ðŸ’° SLPM SwapBack: Token balance analysis:",{availableBalance:g.availableBalance,maxInvoiceAmount:g.maxAmount,originalInvoiceAmount:b}),console.log("ðŸ”„ SLPM SwapBack: Getting optimized Atomiq quote for max safe amount..."),console.log(`   Using calculated safe amount: ${g.maxAmount} sats (original was ${b} sats)`);let h=await d.beginLightningToStrkSwap(g.maxAmount,c);console.log("âœ… SLPM SwapBack: Got optimized Atomiq quote:",{swapId:h.id.slice(0,20)+"...",safeAmount:g.maxAmount,invoicePrefix:h.invoice.slice(0,30)+"..."});let i=h.invoice,j=h.id;console.log("ðŸ“‹ SLPM SwapBack: Full Atomiq invoice (copy):",i),console.log("ðŸ” SLPM SwapBack: Running server-side melt with built-in retry..."),e({type:"mix:progress",message:"Melting ecash to Lightning (with retry capability)...",progress:88});let k=await (0,F.serverSideCashuMelt)(a,i,f);if(!k.success){if(k.details?.shortfall)throw console.log("âš ï¸ SLPM SwapBack: Invoice too large for available proofs"),console.log(`   Required: ${k.details.required} sats, Available: ${k.details.available} sats`),Error(`Invoice too large for available balance. Required: ${k.details.required}, Available: ${k.details.available}`);throw Error(`Server-side melt failed: ${k.error}`)}console.log("âœ… SLPM SwapBack: Server-side melt completed successfully"),console.log("âœ… SLPM SwapBack: Server-side melt completed successfully!",{invoiceAmount:k.result.invoiceAmount,changeAmount:k.result.changeAmount,changeCount:k.result.change?.length||0});let l=(k.result.change||[]).map(a=>({secret:a.secret,signature:a.C,amount:BigInt(a.amount),currency:"SAT",keysetId:a.id}));return{finalInvoice:i,finalSwapId:j,meltResult:{change:l,usedAmount:k.result.invoiceAmount}}}catch(a){throw console.error("âŒ SLPM SwapBack: SIMPLIFIED melt failed:",a),Error(`Failed to melt ALL proofs: ${a}`)}}async function J(a,b){console.log("ðŸŽ¯ SLPM: Starting privacy mix operation"),console.log("ðŸ“‹ SLPM: Mix request:",{amount:a.amountStrk,destinations:a.destinations.length,privacyLevel:a.privacyLevel,features:{timeDelays:a.enableTimeDelays,splitOutputs:a.enableSplitOutputs,randomizedMints:a.enableRandomizedMints,amountObfuscation:a.enableAmountObfuscation,decoyTx:a.enableDecoyTx}});let c=null,d=null;try{var e,f,g;let h,i,j;console.log(`ðŸ” SLPM: Validating ${B.ENV.NETWORK} configuration...`);let k=(0,B.getNetworkStatus)();if(console.log(`âš™ï¸ SLPM: ${B.ENV.NETWORK} status:`,k),!k.ready)throw console.error(`âŒ SLPM: ${B.ENV.NETWORK} configuration incomplete`),console.error("Warnings:",k.warnings),Error(`${B.ENV.NETWORK} configuration incomplete. Check environment variables.`);console.log(`âœ… SLPM: ${B.ENV.NETWORK} configuration validated`),b({type:"mix:progress",message:`Starting privacy mix on ${B.ENV.NETWORK}`,progress:0}),console.log("ðŸš€ SLPM: Privacy mix operation initiated"),console.log("ðŸ’° SLPM: Step 1 - Depositing STRK to privacy mixer contract"),c=await (0,v.stepDeposit)(a.amountStrk,b),console.log("âœ… SLPM: Step 1 complete - STRK deposited to privacy mixer:",{commitment:c.commitmentHash.slice(0,10)+"...",amount:c.amount,mixerContract:c.mixerContractAddress}),console.log("ðŸ”„ SLPM: Step 1.5 - Withdrawing from privacy mixer for mixing pipeline");let l=await (0,w.stepWithdrawForMixing)(c,b);if(!l||!l.withdrawalTxHash)throw Error("Withdrawal step returned no transaction hash");let m="string"==typeof l.withdrawalTxHash?l.withdrawalTxHash.slice(0,10)+"...":"n/a",n="string"==typeof l.controllingWallet?l.controllingWallet.slice(0,10)+"...":"n/a";console.log("âœ… SLPM: Step 1.5 complete - Funds withdrawn and ready for mixing:",{withdrawalTx:m,availableForSwap:l.availableForSwap??!1,controllingWallet:n}),console.log("ðŸŽ¯ SLPM: Step 2 - Dynamic STRK â†’ sats estimation (real-time if possible)..."),b({type:"mix:progress",message:"Estimating sats from STRK input...",progress:15});let o=await (0,y.stepDynamicEstimateSats)(l.amount,b);console.log("ðŸ’° SLPM: Dynamic estimation result:",o),console.log(`ðŸ’° SLPM: Estimated ${l.amount} STRK -> ${o.satsOut} sats (source: ${o.source}, rate: ${o.rate.toFixed(2)})`),b({type:"mix:progress",message:"Creating Cashu mint invoice...",progress:18});let p=await (0,x.stepCreateMintInvoice)(o.satsOut,b);console.log("ðŸŽ¯ SLPM: Step 3 - Swapping STRK to Lightning..."),b({type:"mix:progress",message:"Swapping STRK to Lightning BTC...",progress:25}),d=await (0,z.stepSwapToLightning)(l.amount,{walletAddress:l.originalDeposit.walletAddress,mixerContractAddress:l.originalDeposit.mixerContractAddress,fundsAvailable:l.availableForSwap},p,b),console.log("ðŸŽ¯ SLPM: Step 4 - Claiming Cashu proofs..."),b({type:"mix:progress",message:"Claiming Cashu proofs...",progress:45});let q=await (0,A.stepClaimCashuProofs)(p.mintQuote,p.cashu,o.satsOut,b);console.log("ðŸŽ¯ SLPM: Cashu proofs claimed:",{count:q.length,totalValue:q.reduce((a,b)=>a+Number(b.amount),0)});let r=p.cashu,s=p.cashuManager;console.log("ðŸŽ¯ SLPM: Step 5 - Applying privacy techniques..."),b({type:"mix:progress",message:"Applying privacy mixing...",progress:60});let t=await C(a,q,r,s,b);console.log("âœ… SLPM: Privacy mixing complete:",{finalProofsCount:t.length,privacyLevel:a.privacyLevel,anonymityEnhanced:!0}),console.log("ðŸ”„ SLPM: Step 6 - Converting mixed tokens back and distributing..."),b({type:"mix:progress",message:"Converting mixed e-cash back and distributing to destinations",progress:80});let u=await H(t,a.destinations,r,b,p.mintQuote.quote),D=u.filter(a=>"CLAIMED"===a.status).length,E=u.length,F=u.reduce((a,b)=>a+b.strkSent,0);if(console.log("ðŸ“Š SLPM: Distribution results:",{totalDestinations:E,successfulDistributions:D,totalStrkDistributed:F,failedDistributions:E-D}),0===D)throw Error(`All ${E} destination distributions failed - no STRK was successfully delivered`);D<E?console.warn(`âš ï¸ SLPM: Partial success - only ${D}/${E} destinations received STRK`):console.log("âœ… SLPM: All distributions completed successfully"),console.log("âœ… SLPM: Privacy mixing completed with distribution results"),console.log("ðŸ“Š SLPM: Calculating final privacy metrics");let G=(e=a,("maximum"===e.privacyLevel?120:"enhanced"===e.privacyLevel?60:20)+((e.enableSplitOutputs?e.splitCount:0)+10*!!e.enableRandomizedMints)),I=(f=a,g=G,j=50+Math.min(40,Math.floor(g/4)),f.enableTimeDelays&&(j+=3),f.enableSplitOutputs&&f.splitCount>1&&(j+=3),f.enableRandomizedMints&&(j+=2),f.enableAmountObfuscation&&(j+=1),f.enableDecoyTx&&(j+=1),Math.min(100,j));return console.log("ðŸ“ˆ SLPM: Final privacy metrics:",{anonymitySetSize:G,privacyScore:I,privacyLevel:a.privacyLevel,mixingPath:"STRK â†’ Lightning â†’ Cashu â†’ Lightning â†’ STRK",destinationAccounts:a.destinations.length,totalFees:d.fee||0,privacyGuarantees:{unlinkability:"Account linkability broken via mixer contract",temporalPrivacy:"Time delays and batching applied",amountObfuscation:"Amount split across destinations",routingDiversification:"Multiple Cashu mints used"}}),D===E?(h=`Privacy mix complete! ${F} STRK distributed to ${D} destinations through ${G}-member anonymity set`,i="mix:complete"):D>0?(h=`Privacy mix partially complete - ${F} STRK delivered to ${D}/${E} destinations`,i="mix:partial"):(h="Privacy mix failed - no STRK was successfully delivered to any destination",i="mix:failed"),b({type:i,message:h,progress:D===E?100:90}),console.log(`ðŸŽ‰ SLPM: Privacy mix operation result - ${D}/${E} destinations successful`),{success:D>0,totalDestinations:E,successfulDistributions:D,totalStrkDistributed:F,distributionResults:u}}catch(a){throw console.error("âŒ SLPM: Privacy mix operation failed:",a),console.error("ðŸ” SLPM: Error details:",{message:a instanceof Error?a.message:"Unknown error",stack:a instanceof Error?a.stack:void 0,step:"Privacy mixing flow",progress:"Check individual step logs above"}),b({type:"mix:error",message:a instanceof Error?a.message:"Privacy mix failed"}),a}}async function K(a,b){try{await J(a,b)}catch(a){throw b({type:"mix:error",message:a?.message||"Unknown error"}),a}}var L=a.i(726956);function M(){let a=(0,L.useWallet)(),[h,i]=(0,c.useState)({step:"setup",amount:"",privacyLevel:"standard",progress:0,anonymitySetSize:0,estimatedTime:0}),[j,k]=(0,c.useState)(!1),[l,o]=(0,c.useState)(!1),[q,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)({show:!1,type:"info",title:"",message:""}),[y,z]=(0,c.useState)([]),[A,B]=(0,c.useState)({amountStrk:0,destinations:[],privacyLevel:"standard",enableTimeDelays:!0,enableSplitOutputs:!0,splitCount:2,enableRandomizedMints:!0,enableAmountObfuscation:!0,enableDecoyTx:!0}),C=(a,b,c)=>{x({show:!0,type:a,title:b,message:c})},D=async b=>{v(!0);try{await a.connect("argentx"===b.toLowerCase()?"argentX":"braavos"===b.toLowerCase()?"braavos":"okx"===b.toLowerCase()?"okx":"argentX"),k(!0),o(!1),C("success","Wallet Connected",`Connected to ${b}`)}catch{C("error","Connection Failed","Failed to connect wallet. Please try again.")}finally{v(!1)}};(0,c.useEffect)(()=>{k(a.isConnected)},[a.isConnected]);let E=async()=>{if(!j)return void o(!0);let a=parseFloat(h.amount||"0");if(!a||a<=0||0===A.destinations.length||!A.destinations[0])return void C("warning","Invalid Input","Enter amount and destination address");i(a=>({...a,step:"deposit",progress:0})),C("info","Starting Mix","Initializing mixing pipeline...");try{let b=Date.now().toString(36);await K({...A,amountStrk:a,privacyLevel:h.privacyLevel},c=>{"number"==typeof c.progress&&i(a=>({...a,step:"deposit"===a.step&&c.progress>30?"mixing":a.step,progress:c.progress??a.progress})),"number"==typeof c.anonymitySetSize&&i(a=>({...a,anonymitySetSize:c.anonymitySetSize??a.anonymitySetSize})),"number"==typeof c.estimatedTime&&i(a=>({...a,estimatedTime:c.estimatedTime??a.estimatedTime})),z(d=>{let e=[...d],f=Date.now();if("deposit:initiated"===c.type&&e.push({id:`${b}-dep`,type:"deposit",amount:String(a),status:"pending",timestamp:f,privacyScore:0,fromNetwork:"Starknet",toNetwork:"Lightning"}),"lightning:paid"===c.type){let a=e.findIndex(a=>a.id===`${b}-dep`);a>=0&&(e[a]={...e[a],status:"completed"})}if("cashu:minted"!==c.type||e.some(a=>a.id===`${b}-mix`)||e.push({id:`${b}-mix`,type:"mix",amount:String(a),status:"processing",timestamp:f,privacyScore:0,fromNetwork:"Lightning",toNetwork:"STRK"}),"mix:complete"===c.type){let a=e.findIndex(a=>a.id===`${b}-mix`);a>=0&&(e[a]={...e[a],status:"completed",privacyScore:c.privacyScore??e[a].privacyScore,anonymitySetSize:h.anonymitySetSize||e[a].anonymitySetSize})}if("mix:error"===c.type){let a=e.findIndex(a=>a.id===`${b}-mix`);a>=0&&(e[a]={...e[a],status:"failed"})}return e}),"mix:complete"===c.type&&(C("success","Mix Complete",`Privacy score ${c.privacyScore}%`),i(a=>({...a,step:"complete",progress:100}))),"mix:error"===c.type&&C("error","Mix Error",c.message||"Unknown error")})}catch{}};return(0,b.jsxs)("div",{className:"min-h-screen bg-gray-950 text-white",children:[(0,b.jsx)(f.default,{}),(0,b.jsx)("div",{className:"absolute inset-0 bg-gray-950 -z-10",children:(0,b.jsx)("div",{className:"absolute inset-0 opacity-70 pointer-events-none",style:{backgroundImage:"url('/patterns/grid.svg')",backgroundSize:"32px 32px",backgroundRepeat:"repeat"}})}),(0,b.jsxs)("div",{className:"relative z-10 container mx-auto px-4 py-8",children:[(0,b.jsxs)("div",{className:"text-center mb-12",children:[(0,b.jsx)("h1",{className:"text-4xl font-bold mb-4 text-white",children:"Privacy Mixer"}),(0,b.jsx)("p",{className:"text-gray-400 text-lg",children:"Enhanced privacy through advanced cryptographic mixing"}),(0,b.jsx)("div",{className:"mt-6",children:j?(0,b.jsxs)("div",{className:"inline-flex items-center space-x-2 bg-green-500/10 border border-green-500/20 rounded-lg px-4 py-2",children:[(0,b.jsx)(e.CheckCircleIcon,{className:"w-5 h-5 text-green-400"}),(0,b.jsx)("span",{className:"text-green-400 font-medium",children:"Wallet Connected"})]}):(0,b.jsxs)("button",{onClick:()=>o(!0),className:"inline-flex items-center space-x-2 bg-orange-500/10 border border-orange-500/20 hover:border-orange-500 rounded-lg px-4 py-2 transition-colors",children:[(0,b.jsx)(d.WalletIcon,{className:"w-5 h-5 text-orange-400"}),(0,b.jsx)("span",{className:"text-orange-400 font-medium",children:"Connect Wallet"})]})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,b.jsxs)("div",{className:"lg:col-span-2",children:[(0,b.jsx)(p,{current:h.step}),(0,b.jsxs)("div",{children:["setup"===h.step&&(0,b.jsx)(r,{value:A,onChange:a=>{null!=a.amountStrk&&i(b=>({...b,amount:String(a.amountStrk)})),a.privacyLevel&&i(b=>({...b,privacyLevel:a.privacyLevel})),B(b=>({...b,...a}))},onStart:E,isConnected:j}),"deposit"===h.step&&(0,b.jsx)(s,{amount:h.amount}),"mixing"===h.step&&(0,b.jsx)(t,{progress:h.progress,anonymitySet:h.anonymitySetSize,eta:h.estimatedTime}),"complete"===h.step&&(0,b.jsx)(u,{amount:h.amount,anonymitySet:h.anonymitySetSize,onReset:()=>i({step:"setup",amount:"",privacyLevel:"standard",progress:0,anonymitySetSize:0,estimatedTime:0})})]})]}),(0,b.jsx)("div",{className:"lg:col-span-1",children:(0,b.jsx)(m,{transactions:y,currentMixingSession:"mixing"===h.step?{id:"current",phase:h.step,progress:h.progress,anonymitySetSize:h.anonymitySetSize,estimatedTime:h.estimatedTime}:void 0})})]})]}),(0,b.jsx)(g.default,{isOpen:l,onClose:()=>o(!1),onConnect:D,isConnecting:q}),(0,b.jsx)(n.default,{type:w.type,title:w.title,message:w.message,isVisible:w.show,onClose:()=>x(a=>({...a,show:!1}))})]})}}];

//# sourceMappingURL=src_app_mixer_page_tsx_6d859a59._.js.map