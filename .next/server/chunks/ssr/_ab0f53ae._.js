module.exports=[545750,a=>{"use strict";async function b(a,b,c){try{console.log("ðŸ” Server-side Cashu Melt: Starting single-API melt with retry...");let c=await fetch("/api/cashu/receive-and-melt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({encodedToken:a,invoice:b})}),d=await c.json();if(!c.ok){if(console.error("âŒ Server-side Cashu Melt: API error:",d),"INSUFFICIENT_BALANCE"===d.error)return{success:!1,error:"Insufficient balance for invoice + fees",details:d.details};return{success:!1,error:d.error||"Server-side melt failed"}}return console.log("âœ… Server-side Cashu Melt: Completed successfully:",d.result),{success:!0,result:d.result}}catch(a){return console.error("âŒ Server-side Cashu Melt: Network error:",a),{success:!1,error:a instanceof Error?a.message:"Network error during melt"}}}async function c(b){try{console.log("ðŸ§® Calculating max invoice amount from token balance...");let{getDecodedToken:c}=await a.A(12246),d=c(b).proofs.reduce((a,b)=>a+b.amount,0),e=0;for(let a=1;a<=d;a++){let b=Math.max(2,Math.ceil(.01*a))+1;if(a+b<=d)e=a;else break}return console.log("âœ… Max invoice calculation:",{availableBalance:d,maxAmount:e,estimatedFee:Math.max(2,Math.ceil(.01*e))+1}),{success:!0,maxAmount:e,availableBalance:d}}catch(a){return console.error("âŒ Failed to calculate max invoice amount:",a),{success:!1,error:a instanceof Error?a.message:"Calculation failed"}}}async function d(b){console.log("ðŸ” Getting encoded token from storage for quote:",b);try{try{let{default:c}=await a.A(361010),d=await c.get(b);if(d?.token)return console.log("âœ… Found token in server vault"),d.token}catch(a){console.warn("âš ï¸ Could not access server vault:",a)}return console.warn("âŒ No encoded token found for quote:",b),null}catch(a){return console.error("âŒ Error retrieving encoded token:",a),null}}a.s(["calculateMaxInvoiceAmount",()=>c,"getEncodedTokenFromStorage",()=>d,"serverSideCashuMelt",()=>b])},12246,a=>{a.v(a=>Promise.resolve().then(()=>a(43445)))},361010,a=>{a.v(b=>Promise.all(["server/chunks/ssr/src_storage_tokenVault_server_ts_563da3b1._.js"].map(b=>a.l(b))).then(()=>b(662124)))}];

//# sourceMappingURL=_ab0f53ae._.js.map