module.exports=[142266,304547,867102,657262,a=>{"use strict";a.s(["default",()=>j],142266);var b=a.i(187924),c=a.i(572131),d=a.i(564379);let e=c.forwardRef(function({title:a,titleId:b,...d},e){return c.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:e,"aria-labelledby":b},d),a?c.createElement("title",{id:b},a):null,c.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5Z"}))}),f=c.forwardRef(function({title:a,titleId:b,...d},e){return c.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:e,"aria-labelledby":b},d),a?c.createElement("title",{id:b},a):null,c.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 5.25a3 3 0 0 1 3 3m3 0a6 6 0 0 1-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1 1 21.75 8.25Z"}))});var g=a.i(734498);let h=c.forwardRef(function({title:a,titleId:b,...d},e){return c.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:e,"aria-labelledby":b},d),a?c.createElement("title",{id:b},a):null,c.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m0-10.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.75c0 5.592 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.57-.598-3.75h-.152c-3.196 0-6.1-1.25-8.25-3.286Zm0 13.036h.008v.008H12v-.008Z"}))}),i=c.forwardRef(function({title:a,titleId:b,...d},e){return c.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:e,"aria-labelledby":b},d),a?c.createElement("title",{id:b},a):null,c.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125"}))});function j({isOpen:a,onClose:j,onConnect:k,isConnecting:l}){let[m,n]=(0,c.useState)("");return a?(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:(0,b.jsxs)("div",{className:"bg-gray-900 border border-gray-700 rounded-xl max-w-md w-full p-6 shadow-2xl",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)(d.WalletIcon,{className:"w-6 h-6 text-blue-400"}),(0,b.jsx)("h2",{className:"text-xl font-bold text-white",children:"Connect Wallet"})]}),(0,b.jsx)("button",{onClick:j,className:"text-gray-400 hover:text-white transition-colors",children:(0,b.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,b.jsx)("div",{className:"space-y-3",children:[{id:"argentx",name:"ArgentX",icon:"argentx",description:"Most popular Starknet wallet with advanced features",isInstalled:!1,isPopular:!0},{id:"braavos",name:"Braavos",icon:"braavos",description:"Security-focused wallet with hardware support",isInstalled:!1},{id:"okx",name:"OKX Wallet",icon:"okx",description:"Multi-chain wallet with DeFi integration",isInstalled:!1}].map(a=>(0,b.jsx)("div",{className:"relative",children:(0,b.jsx)("button",{onClick:()=>{var b;n(b=a.id),k(b)},disabled:l||!a.isInstalled,className:`w-full p-4 rounded-lg border transition-all duration-200 ${a.isInstalled?"border-gray-600 hover:border-orange-500 hover:bg-gray-800 focus:border-orange-500 focus:ring-2 focus:ring-orange-500/20":"border-gray-700 bg-gray-800/50 cursor-not-allowed opacity-50"} ${m===a.id&&l?"border-orange-500 bg-orange-500/10":""}`,children:(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsxs)("div",{className:"w-12 h-12 bg-gray-800 rounded-lg flex items-center justify-center",children:["argentx"===a.id&&(0,b.jsx)(g.ShieldCheckIcon,{className:"w-6 h-6 text-blue-400"}),"braavos"===a.id&&(0,b.jsx)(h,{className:"w-6 h-6 text-orange-400"}),"okx"===a.id&&(0,b.jsx)(i,{className:"w-6 h-6 text-gray-300"})]}),(0,b.jsxs)("div",{className:"flex-1 text-left",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)("h3",{className:"font-semibold text-white",children:a.name}),a.isPopular&&(0,b.jsx)("span",{className:"px-2 py-1 bg-orange-500/20 text-orange-400 text-xs rounded font-medium",children:"Popular"})]}),(0,b.jsx)("p",{className:"text-sm text-gray-400 mt-1",children:a.description}),!a.isInstalled&&(0,b.jsx)("p",{className:"text-xs text-red-400 mt-1",children:"Not installed"})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[a.isInstalled?(0,b.jsx)(g.ShieldCheckIcon,{className:"w-5 h-5 text-green-400"}):(0,b.jsx)(f,{className:"w-5 h-5 text-gray-600"}),m===a.id&&l&&(0,b.jsx)("div",{className:"w-4 h-4 border-2 border-orange-500 border-t-transparent rounded-full animate-spin"})]})]})})},a.id))}),(0,b.jsx)("div",{className:"mt-6 p-4 bg-gray-800/50 rounded-lg border border-gray-700",children:(0,b.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,b.jsx)(e,{className:"w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-medium text-white",children:"Wallet Security"}),(0,b.jsx)("p",{className:"text-sm text-gray-400 mt-1",children:"Only connect wallets you trust. The mixer requires transaction signing for privacy operations."})]})]})}),(0,b.jsx)("div",{className:"mt-4 text-center",children:(0,b.jsxs)("p",{className:"text-xs text-gray-500",children:["Don't have a wallet?"," ",(0,b.jsx)("a",{href:"https://www.argent.xyz/starknet/",target:"_blank",rel:"noopener noreferrer",className:"text-orange-400 hover:text-orange-300 transition-colors",children:"Install ArgentX"})]})})]})}):null}a.s(["default",()=>o],304547);var k=a.i(329514),l=a.i(366497),m=a.i(658669);let n=c.forwardRef(function({title:a,titleId:b,...d},e){return c.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:e,"aria-labelledby":b},d),a?c.createElement("title",{id:b},a):null,c.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))});function o({type:a,title:d,message:e,isVisible:f,onClose:g,autoClose:h=!0,duration:i=5e3}){if(c.default.useEffect(()=>{if(f&&h){let a=setTimeout(g,i);return()=>clearTimeout(a)}},[f,h,i,g]),!f)return null;let j={success:{icon:k.CheckCircleIcon,bgColor:"bg-green-500/10",borderColor:"border-green-500/20",iconColor:"text-green-400",titleColor:"text-green-300"},error:{icon:n,bgColor:"bg-red-500/10",borderColor:"border-red-500/20",iconColor:"text-red-400",titleColor:"text-red-300"},warning:{icon:l.ExclamationTriangleIcon,bgColor:"bg-yellow-500/10",borderColor:"border-yellow-500/20",iconColor:"text-yellow-400",titleColor:"text-yellow-300"},info:{icon:m.InformationCircleIcon,bgColor:"bg-blue-500/10",borderColor:"border-blue-500/20",iconColor:"text-blue-400",titleColor:"text-blue-300"}}[a],o=j.icon;return(0,b.jsx)("div",{className:"fixed top-4 right-4 z-50 max-w-sm w-full",children:(0,b.jsx)("div",{className:`${j.bgColor} ${j.borderColor} border rounded-lg p-4 shadow-lg transition-all duration-300 transform ${f?"translate-x-0 opacity-100":"translate-x-full opacity-0"}`,children:(0,b.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,b.jsx)(o,{className:`w-6 h-6 ${j.iconColor} flex-shrink-0`}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("h4",{className:`font-semibold ${j.titleColor}`,children:d}),(0,b.jsx)("p",{className:"text-sm text-gray-300 mt-1",children:e})]}),(0,b.jsx)("button",{onClick:g,className:"text-gray-400 hover:text-white transition-colors",children:(0,b.jsx)(n,{className:"w-5 h-5"})})]})})})}a.s(["stepDeposit",()=>v],867102);var p=a.i(449260),q=a.i(140678),r=a.i(805428),s=a.i(313535);let t="0x04718f5a0fc34cc1af16a1cdee98ffb20c31f5cd61d6ab07201858f4287c938d",u=q.ENV.MIXER_CONTRACT_ADDRESS||r.PRIVACY_MIXER.CONTRACT_ADDRESS;async function v(a,b){console.log("üí∞ SLPM Deposit: Starting deposit step"),console.log("üí∞ SLPM Deposit: Amount requested:",a,"STRK");try{let c=r.PRIVACY_MIXER.DEPLOYMENT_PARAMS.MIN_DEPOSIT,d=Number(c)/1e18;if(a<d){let c=`Requested amount ${a} STRK is below current minimum deposit (${d} STRK). Increase amount or redeploy with lower MIN_DEPOSIT.`;throw console.warn("‚ö†Ô∏è SLPM Deposit: Early rejection -",c),b({type:"deposit:error",message:c}),Error(c)}b({type:"deposit:initiated",message:"Connecting to Starknet wallet..."}),console.log("üí∞ SLPM Deposit: Initializing wallet client...");let e=new p.RealStarknetWalletClient(q.ENV.STARKNET_RPC);console.log("üí∞ SLPM Deposit: Connecting wallet...");let f=await e.connect();console.log("üí∞ SLPM Deposit: Wallet connected:",{address:f.account.address,walletType:f.walletType}),b({type:"deposit:wallet_connected",message:"Wallet connected successfully"}),console.log("üí∞ SLPM Deposit: Initializing privacy mixer contract..."),await e.initMixerContract(u),console.log("üí∞ SLPM Deposit: Mixer contract initialized"),console.log("üí∞ SLPM Deposit: Checking STRK balance...");let g=await e.getBalance(t),h=BigInt(Math.round(Number(a)*10**g.decimals)),i=BigInt("0x800000000000011000000000000000000000000000000000000000000000000")-BigInt(1);if(h>i)throw Error(`Amount too large for Starknet felt: ${h.toString()}`);if(console.log("üí∞ SLPM Deposit: Balance check:",{tokenAddress:t,symbol:g.symbol,onChainBalanceWei:g.balance.toString(),onChainBalanceSTRK:Number(g.balance)/Math.pow(10,g.decimals),decimals:g.decimals,requestedAmountWei:h.toString(),requestedAmountSTRK:a,requestedAmountHex:"0x"+h.toString(16),minDepositWei:c.toString(),minDepositSTRK:d}),g.balance<h)throw Error(`Insufficient STRK balance. Required: ${a} STRK, Available: ${Number(g.balance)/Math.pow(10,g.decimals)} STRK`);b({type:"deposit:balance_checked",message:`Balance confirmed: ${Number(g.balance)/Math.pow(10,g.decimals)} STRK available`}),console.log("üí∞ SLPM Deposit: Generating commitment & nullifier (contract spec)...");let j="0x"+Array.from(crypto.getRandomValues(new Uint8Array(31))).map(a=>a.toString(16).padStart(2,"0")).join(""),k=BigInt(h.toString()),l=function(a,b){if(!a.startsWith("0x"))throw Error("secret must be 0x-prefixed");let c=BigInt(a),{low:d,high:e}=s.uint256.bnToUint256(b),f=s.hash.computePoseidonHashOnElements([c,BigInt(d),BigInt(e)]),g=s.hash.computePoseidonHashOnElements([c,BigInt(f)]);return{commitment:s.num.toHex(f),nullifier:s.num.toHex(g),secret:a,amountLow:BigInt(d),amountHigh:BigInt(e)}}(j,k);console.log("üí∞ SLPM Deposit: Generated artifacts:",{secret:l.secret.slice(0,10)+"...",commitment:l.commitment,nullifier:l.nullifier.slice(0,10)+"..."}),b({type:"deposit:balance_checked",message:"Privacy commitment generated"}),console.log("üí∞ SLPM Deposit: Approving STRK spending by mixer contract...");let m=await e.approve(t,u,h);console.log("üí∞ SLPM Deposit: Approval transaction submitted:",m),b({type:"deposit:transfer_submitted",message:`Approval submitted: ${m.transactionHash}`}),console.log("üí∞ SLPM Deposit: Waiting for approval confirmation...");let n=await e.waitForTransaction(m.transactionHash);if(console.log("üí∞ SLPM Deposit: Approval confirmed:",n),"REJECTED"===n.status)throw Error("Approval transaction was rejected by the network");b({type:"deposit:balance_checked",message:"STRK spending approval confirmed"}),console.log("üí∞ SLPM Deposit: Verifying allowance was set correctly...");try{let c=await e.callContract(t,"allowance",[f.account.address,u]),d=BigInt(c[0]||0);if(console.log("üí∞ SLPM Deposit: Current allowance:",{allowanceWei:d.toString(),allowanceSTRK:Number(d)/Math.pow(10,g.decimals),requiredWei:h.toString(),requiredSTRK:a,sufficient:d>=h}),d<h)throw Error(`Insufficient allowance: ${Number(d)/Math.pow(10,g.decimals)} STRK allowed, ${a} STRK required`);b({type:"deposit:balance_checked",message:`Allowance verified: ${Number(d)/Math.pow(10,g.decimals)} STRK`})}catch(a){console.error("üí∞ SLPM Deposit: Allowance check failed:",a),b({type:"deposit:balance_checked",message:"Allowance check failed, proceeding with deposit..."})}console.log("üí∞ SLPM Deposit: Depositing to privacy mixer contract...");let o=await e.depositToMixer(l.commitment,h);console.log("üí∞ SLPM Deposit: Deposit transaction submitted:",o),b({type:"deposit:transfer_submitted",message:`Deposit to mixer submitted: ${o}`}),console.log("üí∞ SLPM Deposit: Waiting for deposit confirmation...");let v=await e.waitForTransaction(o);if(console.log("üí∞ SLPM Deposit: Deposit confirmed:",v),"REJECTED"===v.status)throw Error("Deposit transaction was rejected by the network");b({type:"deposit:confirmed",message:"STRK deposit confirmed in privacy mixer",progress:20}),console.log("üí∞ SLPM Deposit: Step completed successfully"),console.log("üîÑ SLPM Deposit: Now preparing for immediate withdrawal to enable swapping..."),b({type:"deposit:preparing_withdrawal",message:"Preparing privacy withdrawal for mixing...",progress:22});let w=l.commitment;return{transactionHash:v.transactionHash,amount:a,amountWei:h.toString(),walletAddress:f.account.address,commitmentHash:w,secret:l.secret,nullifier:l.nullifier,mixerContractAddress:u,withdrawalReady:!0}}catch(c){let a=c instanceof Error?c.message:"Unknown deposit error";throw/Execute failed/i.test(a)&&(a+=" (Possible causes: amount below MIN_DEPOSIT, insufficient allowance, or token transfer_from failure)"),console.error("‚ùå SLPM Deposit: Step failed:",c),b({type:"deposit:error",message:a}),Error(a)}}a.s(["stepWithdrawForMixing",()=>y],657262);var w=a.i(140707),x=a.i(747340);async function y(a,b){console.log("üîÑ SLPM Withdraw: Starting immediate withdrawal for mixing pipeline"),console.log("üîÑ SLPM Withdraw: Parameters:",{commitment:a.commitmentHash.slice(0,10)+"...",amount:a.amount,nullifier:a.nullifier.slice(0,10)+"..."});try{let c,d;b({type:"deposit:preparing_withdrawal",message:"Preparing withdrawal for privacy mixing...",progress:25});let e=(0,w.getSharedSwapAccount)(),f=(0,w.getSharedSwapAccountRaw)(),g=null,h=null;if(e&&f){console.log("üîÑ SLPM Withdraw: Using shared swap account for headless withdrawal");let b=(0,w.getSharedSwapProvider)();if(!b)throw Error("Shared swap provider not initialized");h=new x.PrivacyMixerContract(a.mixerContractAddress,f,b)}else console.log("üîÑ SLPM Withdraw: Shared account not configured, falling back to interactive wallet connection"),g=new p.RealStarknetWalletClient(q.ENV.STARKNET_RPC),await g.connect(),await g.initMixerContract(a.mixerContractAddress);let i=r.SHARED_SWAP_ACCOUNT_ADDRESS;console.log("üîÑ SLPM Withdraw: Preparing withdrawal transaction..."),console.log("üîÑ SLPM Withdraw: Withdrawal details (shared swap account):",{nullifier:a.nullifier.slice(0,10)+"...",commitment:a.commitmentHash.slice(0,10)+"...",recipient:i.slice(0,10)+"...",amount:a.amountWei}),console.log("üîÑ SLPM Withdraw: Generating withdrawal proof (3-element format)...");let j=BigInt(a.amountWei),k=BigInt(i),l=s.uint256.bnToUint256(j),m=BigInt(l.low),n=BigInt(l.high),o=s.hash.computePoseidonHashOnElements([k]),t=s.hash.computePoseidonHashOnElements([m,n]),u=[a.secret,s.num.toHex(o),s.num.toHex(t)];if(3!==u.length)throw Error(`Generated proof length mismatch: expected 3, got ${u.length}`);if(console.log("üîÑ SLPM Withdraw: Proof generated:",{proofLength:u.length,elements:u.map(a=>a.slice(0,10)+"...")}),b({type:"deposit:preparing_withdrawal",message:"Checking minimum mixing delay...",progress:25}),console.log("üïê SLPM Withdraw: Checking timing requirements..."),console.log("üïê SLPM Withdraw: Contract requires 4 second delay between deposit and withdrawal"),console.log("‚è≥ SLPM Withdraw: Waiting 4 seconds for mixing delay..."),await new Promise(a=>setTimeout(a,4e3)),console.log("‚úÖ SLPM Withdraw: Minimum delay satisfied, proceeding with withdrawal"),b({type:"deposit:preparing_withdrawal",message:"Submitting withdrawal transaction...",progress:30}),console.log("üîÑ SLPM Withdraw: Executing withdrawal from privacy mixer..."),h)c=(await h.withdraw(a.nullifier,a.commitmentHash,i,j,u)).transaction_hash;else if(g)c=await g.withdrawFromMixer(a.nullifier,a.commitmentHash,i,j,u);else throw Error("No withdrawal pathway available");if(console.log("üîÑ SLPM Withdraw: Withdrawal transaction submitted:",c),b({type:"deposit:withdrawn_for_mixing",message:`Withdrawal submitted: ${c}`,progress:35}),console.log("üîÑ SLPM Withdraw: Waiting for withdrawal confirmation..."),g)d=await g.waitForTransaction(c);else{let a=(0,w.getSharedSwapProvider)();if(!a)throw Error("Shared swap provider not available for confirmation");d=await a.waitForTransaction(c)}if(console.log("üîÑ SLPM Withdraw: Withdrawal confirmed:",d),"REJECTED"===d.status)throw Error("Withdrawal transaction was rejected by the network");b({type:"deposit:withdrawn_for_mixing",message:"STRK successfully withdrawn from privacy mixer for mixing pipeline",progress:40}),console.log("üîÑ SLPM Withdraw: Step completed successfully"),console.log("üîÑ SLPM Withdraw: Funds are now available for Lightning/Cashu mixing");let v=d.transactionHash||d.transaction_hash||c;return console.log("üîÑ SLPM Withdraw: Determined withdrawal tx hash:",v),{withdrawalTxHash:v,availableForSwap:!0,controllingWallet:i,amount:a.amount,amountWei:a.amountWei,originalDeposit:a}}catch(a){throw console.error("‚ùå SLPM Withdraw: Step failed:",a),b({type:"deposit:error",message:a instanceof Error?a.message:"Unknown withdrawal error"}),a}}},515096,a=>{"use strict";a.s(["stepCreateMintInvoice",()=>f],515096);var b=a.i(43445);class c{mint;wallet;initialized=!1;mintUrl;constructor(a){this.mintUrl=a,this.mint=new b.CashuMint(a),this.wallet=new b.CashuWallet(this.mint),console.log(`ü™ô Initializing Cashu client for testnet mint: ${a}`)}async ensureInitialized(){if(!this.initialized)try{console.log(`üîó Connecting to Cashu mint: ${this.mintUrl}`),await this.wallet.loadMint(),this.initialized=!0,console.log(`‚úÖ Cashu mint connected successfully`)}catch(a){throw console.warn(`‚ö†Ô∏è Failed to connect to Cashu mint: ${a instanceof Error?a.message:String(a)}`),Error(`Cashu mint connection failed: ${a instanceof Error?a.message:"Unknown error"}`)}}async createMintQuote(a){await this.ensureInitialized();let c=await this.wallet.createMintQuote(Number(a));return{quote:c.quote,amount:BigInt(c.amount),state:c.state===b.MintQuoteState.PAID?"PAID":c.state===b.MintQuoteState.ISSUED?"ISSUED":"CREATED",request:c.request}}async checkMintQuote(a){await this.ensureInitialized();let c=await this.wallet.checkMintQuote(a);return{quote:c.quote,amount:BigInt(c.amount||0),state:c.state===b.MintQuoteState.PAID?"PAID":c.state===b.MintQuoteState.ISSUED?"ISSUED":"CREATED",request:c.request}}async mintProofs(a,b){return await this.ensureInitialized(),(await this.wallet.mintProofs(Number(a),b)).map(this.convertToEcashProof)}async createMeltQuote(a){await this.ensureInitialized();let b=await this.wallet.createMeltQuote(a);return{quote:b.quote,amount:BigInt(b.amount),fee_reserve:BigInt(b.fee_reserve),unit:b.unit,expiry:b.expiry,request:b.request}}async meltProofs(a,b){await this.ensureInitialized();let c=b.map(this.convertFromEcashProof),d={quote:a.quote,amount:Number(a.amount),fee_reserve:Number(a.fee_reserve),state:"UNPAID",expiry:Math.floor(Date.now()/1e3)+3600,payment_preimage:null,request:"",unit:"sat"},e=await this.wallet.meltProofs(d,c);return{change:e.change?.map(this.convertToEcashProof)||[]}}async send(a,b){await this.ensureInitialized();let c=b.map(this.convertFromEcashProof),{keep:d,send:e}=await this.wallet.send(Number(a),c);return{keep:d.map(this.convertToEcashProof),send:e.map(this.convertToEcashProof)}}createToken(a){let c=a.map(this.convertFromEcashProof);return(0,b.getEncodedTokenV4)({mint:this.mint.mintUrl,proofs:c})}async receive(a){return await this.ensureInitialized(),(await this.wallet.receive(a)).map(this.convertToEcashProof)}async getMintInfo(){await this.ensureInitialized();let a=await this.mint.getInfo();return{name:a.name,description:a.description,version:a.version}}getBalance(a){return a.reduce((a,b)=>a+b.amount,0n)}convertToEcashProof(a){return{secret:a.secret,signature:a.C,amount:BigInt(a.amount),currency:"SAT",keysetId:a.id}}convertFromEcashProof(a){return{secret:a.secret,C:a.signature,amount:Number(a.amount),id:a.keysetId}}}class d{clients=new Map;mintUrls;constructor(a){this.mintUrls=a,a.forEach(a=>{this.clients.set(a,new c(a))})}selectMint(){let a=Math.floor(Math.random()*this.mintUrls.length),b=this.mintUrls[a];return this.clients.get(b)}getAllMints(){return Array.from(this.clients.values())}async distributeSend(a,b,c=2){let d=this.mintUrls.slice(0,c),e=a/BigInt(c),f=[];for(let a of d){let c=this.clients.get(a),d=b.filter(a=>this.getBalance([a])<=e);f.push({mint:c,proofs:d})}return{distributions:f}}getBalance(a){return a.reduce((a,b)=>a+b.amount,0n)}}var e=a.i(140678);async function f(a,b){console.log("üè¶ SLPM MintInvoice: Starting mint invoice creation"),console.log("üè¶ SLPM MintInvoice: Amount:",a,"sats");try{b({type:"mix:progress",message:`Creating Cashu mint invoice for ${a} sats...`,progress:15}),console.log("üè¶ SLPM MintInvoice: Initializing Cashu services..."),console.log("üè¶ SLPM MintInvoice: Available mints:",e.ENV.CASHU_MINTS.length),console.log("üè¶ SLPM MintInvoice: Default mint:",e.ENV.CASHU_DEFAULT_MINT);let f=e.ENV.CASHU_MINTS.length?new d(e.ENV.CASHU_MINTS):null,g=f?f.selectMint():new c(e.ENV.CASHU_DEFAULT_MINT);console.log("üè¶ SLPM MintInvoice: Cashu client type:",f?"Multi-mint manager":"Single mint"),console.log("üè¶ SLPM MintInvoice: Creating mint quote...");let h=await g.createMintQuote(BigInt(a));if(console.log("üè¶ SLPM MintInvoice: Mint quote created:",{quote:h.quote,amount:h.amount.toString(),state:h.state,invoice:h.request?.slice(0,50)+"..."}),!h.request)throw Error("Cashu mint did not provide Lightning invoice");return b({type:"mix:progress",message:"Cashu mint invoice created successfully",progress:20}),console.log("üè¶ SLPM MintInvoice: Invoice ready for Atomiq payment"),console.log("üè¶ SLPM MintInvoice: Step completed successfully"),{cashu:g,cashuManager:f,mintQuote:h,lightningInvoice:h.request,amount:a}}catch(c){throw console.error("‚ùå SLPM MintInvoice: Step failed:",c),console.error("üîç SLPM MintInvoice: Error details:",{message:c instanceof Error?c.message:"Unknown error",stack:c instanceof Error?c.stack:void 0,context:{sats:a,mintUrl:e.ENV.CASHU_DEFAULT_MINT,mintsAvailable:e.ENV.CASHU_MINTS.length}}),b({type:"mix:error",message:c instanceof Error?c.message:"Unknown mint invoice error"}),c}}},918373,a=>{"use strict";a.s(["stepDynamicEstimateSats",()=>d]);var b=a.i(729521),c=a.i(140678);async function d(a,d){d({type:"mix:progress",message:"Fetching real-time STRK‚Üísats estimate...",progress:11});let e=new b.RealAtomiqSwapClient(c.ENV.NETWORK);try{let b=await e.estimateLightningSatsFromStrk(a);return console.log("üßÆ SLPM DynamicEstimate: Result",b),b}catch(d){console.warn("‚ö†Ô∏è SLPM DynamicEstimate: Falling back after failure:",d);let b=Math.floor(a*(c.ENV.STRK_SATS_RATE||700));return{satsOut:b,rate:b/a,source:"fallback"}}}},14382,680665,a=>{"use strict";a.s(["stepSwapToLightning",()=>e],14382);var b=a.i(729521),c=a.i(805428),d=a.i(140678);async function e(e,f,g,h){console.log("‚ö° SLPM SwapToLN: Starting STRK ‚Üí Lightning BTC swap"),console.log("‚ö° SLPM SwapToLN: Parameters:",{amountStrk:e,fromWallet:f.walletAddress.slice(0,10)+"...",network:d.ENV.NETWORK,fundsAvailable:f.fundsAvailable||!1,targetInvoice:g.lightningInvoice.slice(0,50)+"..."}),f.fundsAvailable?console.log("‚úÖ SLPM SwapToLN: Funds confirmed available after privacy mixer withdrawal"):console.log("‚ö†Ô∏è SLPM SwapToLN: Warning - funds availability not confirmed");try{let f;h({type:"mix:progress",message:`Converting ${e} STRK to Lightning BTC...`,progress:25}),console.log("üèóÔ∏è SLPM SwapToLN: Initializing Atomiq client...");let i=new b.RealAtomiqSwapClient(d.ENV.NETWORK),j=g.lightningInvoice?.trim();console.log("‚ö° SLPM SwapToLN: Using Cashu mint invoice for automated mixer flow...");try{let{millisatoshis:b}=await a.A(223224).then(a=>a.decode(j));b&&(f=Number(BigInt(b)/1000n))}catch(a){console.warn("‚ö†Ô∏è SLPM SwapToLN: Failed to decode invoice for sats amount, proceeding (swap call will re-validate):",a instanceof Error?a.message:a)}(null==f||f<=0)&&(console.warn("‚ö†Ô∏è SLPM SwapToLN: Could not decode invoice amount, using mint amount as fallback"),f=g.amount),console.log("‚ö° SLPM SwapToLN: Lightning invoice details:",{invoice:j.slice(0,50)+"...",invoiceSats:f,strkInputApprox:e,note:"invoiceSats is authoritative output; STRK input derived by SDK"}),h({type:"mix:progress",message:`Converting ${e} STRK to Lightning BTC...`,progress:30}),console.log("‚ö° SLPM SwapToLN: Executing STRK ‚Üí Lightning swap (exactOut via invoice)...");let k=await i.swapStrkToLightning(f||g.amount,j,c.SHARED_SWAP_ACCOUNT_ADDRESS);if(console.log("‚ö° SLPM SwapToLN: Swap result:",{success:k.success,txId:k.txId,amount:k.amount,route:k.route,error:k.error}),!k.success)throw Error(`STRK ‚Üí Lightning swap failed: ${k.error||"Unknown error"}`);return console.log("‚è≥ SLPM SwapToLN: Waiting for Lightning payment confirmation..."),h({type:"mix:progress",message:"Waiting for Lightning payment confirmation...",progress:35}),await new Promise(a=>setTimeout(a,3e3)),console.log("‚úÖ SLPM SwapToLN: Lightning payment confirmed!"),h({type:"mix:progress",message:"STRK successfully swapped to Lightning BTC",progress:40}),{executionId:k.txId||`swap_${Date.now()}`,lightningInvoice:j,lightningAmount:f||g.amount,lightningPaymentHash:k.txId,swapTxId:k.txId,amountIn:e,amountOut:k.amount,fee:0,cashu:g.cashu,mintQuote:g.mintQuote}}catch(a){throw console.error("‚ùå SLPM SwapToLN: Step failed:",a),console.error("üîç SLPM SwapToLN: Error details:",{message:a instanceof Error?a.message:"Unknown error",stack:a instanceof Error?a.stack:void 0,context:{amountStrk:e,network:d.ENV.NETWORK}}),h({type:"mix:error",message:a instanceof Error?a.message:"Unknown swap error"}),a}}a.s(["stepClaimCashuProofs",()=>g],680665);var f=a.i(43445);async function g(b,c,d,e){console.log("ü™ô SLPM ClaimCashu: Starting Cashu proof claiming"),console.log("ü™ô SLPM ClaimCashu: Parameters:",{quoteId:b.quote,amount:d,expectedState:"PAID"});try{e({type:"mix:progress",message:`Claiming Cashu proofs for ${d} sats...`,progress:45}),console.log("üîç SLPM ClaimCashu: Checking if mint quote was paid...");let g=await c.checkMintQuote(b.quote);if(console.log("üîç SLPM ClaimCashu: Quote status:",{quote:g.quote,state:g.state,amount:g.amount.toString()}),"PAID"!==g.state){console.log("‚è≥ SLPM ClaimCashu: Payment not confirmed yet, waiting..."),await new Promise(a=>setTimeout(a,2e3));let a=await c.checkMintQuote(b.quote);if(console.log("üîç SLPM ClaimCashu: Retry status:",a.state),"PAID"!==a.state)throw Error(`Lightning payment not confirmed. Quote state: ${a.state}`)}console.log("‚úÖ SLPM ClaimCashu: Lightning payment confirmed by Cashu mint"),console.log("üè≠ SLPM ClaimCashu: Minting Cashu proofs...");let h=await c.mintProofs(BigInt(d),b.quote);console.log("üè≠ SLPM ClaimCashu: Cashu proofs minted:",{count:h.length,totalAmount:h.reduce((a,b)=>a+Number(b.amount),0),proofs:h.map(a=>({amount:Number(a.amount),secret:a.secret?.slice(0,10)+"..."}))});try{let d=h.reduce((a,b)=>a+Number(b.amount),0),e=c.createToken(h);try{let c="unknown";try{let a=(0,f.getDecodedToken)(e);c=a?.mint||c}catch(a){}{let{default:f}=await a.A(361010);await f.set({quote:b.quote,token:e,mintUrl:c,amountSats:d,proofsCount:h.length,createdAt:Date.now()}),console.log("üíæ SLPM ClaimCashu: Saved ecash token to server vault for quote",b.quote)}}catch(a){console.warn("‚ö†Ô∏è SLPM ClaimCashu: Failed to save token to server vault:",a)}}catch(a){console.warn("‚ö†Ô∏è SLPM ClaimCashu: Could not persist ecash token:",a)}let i=h.reduce((a,b)=>a+Number(b.amount),0);return Math.abs(i-d)>1&&console.warn("‚ö†Ô∏è SLPM ClaimCashu: Amount mismatch:",{expected:d,received:i,difference:i-d}),e({type:"mix:progress",message:`Cashu proofs claimed: ${h.length} proofs for ${i} sats`,progress:50}),console.log("ü™ô SLPM ClaimCashu: Step completed successfully"),h}catch(a){throw console.error("‚ùå SLPM ClaimCashu: Step failed:",a),console.error("üîç SLPM ClaimCashu: Error details:",{message:a instanceof Error?a.message:"Unknown error",stack:a instanceof Error?a.stack:void 0,context:{quoteId:b.quote,targetSats:d,quoteState:b.state}}),e({type:"mix:error",message:a instanceof Error?a.message:"Unknown Cashu claiming error"}),a}}}];

//# sourceMappingURL=src_62647504._.js.map