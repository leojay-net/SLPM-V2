module.exports=[67711,e=>{"use strict";e.s(["handler",()=>z,"patchFetch",()=>D,"routeModule",()=>q,"serverHooks",()=>b,"workAsyncStorage",()=>O,"workUnitAsyncStorage",()=>$],67711);var t=e.i(747909),r=e.i(174017),s=e.i(996250),o=e.i(759756),i=e.i(561916),a=e.i(869741),n=e.i(316795),c=e.i(487718),d=e.i(995169),u=e.i(47587),l=e.i(666012),p=e.i(570101),g=e.i(626937),h=e.i(10372),m=e.i(193695);e.i(52474);var f=e.i(600220);e.s(["GET",()=>L,"POST",()=>I],360762);var w=e.i(89171),S=e.i(254799);let T={randomUUID:S.randomUUID},y=new Uint8Array(256),E=y.length,C=[];for(let e=0;e<256;++e)C.push((e+256).toString(16).slice(1));let v=function(e,t,r){if(T.randomUUID&&!t&&!e)return T.randomUUID();let s=(e=e||{}).random??e.rng?.()??(E>y.length-16&&((0,S.randomFillSync)(y),E=0),y.slice(E,E+=16));if(s.length<16)throw Error("Random bytes length must be >= 16");if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){if((r=r||0)<0||r+16>t.length)throw RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[r+e]=s[e];return t}return function(e,t=0){return(C[e[t+0]]+C[e[t+1]]+C[e[t+2]]+C[e[t+3]]+"-"+C[e[t+4]]+C[e[t+5]]+"-"+C[e[t+6]]+C[e[t+7]]+"-"+C[e[t+8]]+C[e[t+9]]+"-"+C[e[t+10]]+C[e[t+11]]+C[e[t+12]]+C[e[t+13]]+C[e[t+14]]+C[e[t+15]]).toLowerCase()}(s)};class R{apiKey;apiSecret;baseUrl;constructor(e){this.apiKey=e.apiKey,this.apiSecret=e.apiSecret,this.baseUrl=e.baseUrl||"https://ff.io/api/v2"}generateSignature(e){return S.default.createHmac("sha256",this.apiSecret).update(e).digest("hex")}async request(e,t){let r=JSON.stringify(t),s=this.generateSignature(r),o=await fetch(`${this.baseUrl}${e}`,{method:"POST",headers:{"Content-Type":"application/json","X-API-KEY":this.apiKey,"X-API-SIGN":s},body:r});if(!o.ok)throw Error(`FixedFloat API error: ${o.status} ${o.statusText}`);let i=await o.json();if(0!==i.code)throw Error(`FixedFloat error: ${i.msg} (code: ${i.code})`);return i}async getZecToLightningQuote(e){let t=await this.request("/price",{fromCcy:"ZEC",toCcy:"BTCLN",amount:e.toString(),direction:"from",type:"float"});if(t.data.errors&&t.data.errors.length>0)throw Error(`Quote error: ${t.data.errors.join(", ")}`);return{id:S.default.randomUUID(),from:{currency:"ZEC",amount:t.data.from.amount,rate:t.data.from.rate},to:{currency:"BTCLN",amount:t.data.to.amount,rate:t.data.to.rate},minerFee:"0",serviceFee:"0",expiresAt:Date.now()+18e5}}async getLightningToZecQuote(e){let t=await this.request("/price",{fromCcy:"BTCLN",toCcy:"ZEC",amount:(e/1e8).toString(),direction:"from",type:"float"});if(t.data.errors&&t.data.errors.length>0)throw Error(`Quote error: ${t.data.errors.join(", ")}`);return{id:S.default.randomUUID(),from:{currency:"BTCLN",amount:t.data.from.amount,rate:t.data.from.rate},to:{currency:"ZEC",amount:t.data.to.amount,rate:t.data.to.rate},minerFee:"0",serviceFee:"0",expiresAt:Date.now()+18e5}}async createZecToLightningOrder(e,t,r){let s=await this.request("/order",{fromCcy:"ZEC",toCcy:"BTCLN",amount:e.toString(),direction:"from",type:"float",toAddress:t,refundAddress:r});return this.mapOrderResponse(s)}async createLightningToZecOrder(e,t){let r=await this.request("/order",{fromCcy:"BTCLN",toCcy:"ZEC",amount:(e/1e8).toString(),direction:"from",type:"float",toAddress:t});return this.mapOrderResponse(r)}async getOrderStatus(e,t){let r=await this.request("/status",{id:e,token:t});return this.mapOrderResponse(r)}async waitForOrderComplete(e,t,r=36e5,s=15e3,o){let i=Date.now(),a=null;for(;Date.now()-i<r;){let r=await this.getOrderStatus(e,t);if(a!==r.status&&(a=r.status,o?.(r)),"done"===r.status)return r;if("expired"===r.status||"emergency"===r.status)throw Error(`Order ${e} failed with status: ${r.status}`);await this.sleep(s)}throw Error(`Order ${e} timed out after ${r}ms`)}mapOrderResponse(e){let t=e.data;return{id:t.id,status:t.status,from:{currency:t.from.currency,amount:t.from.amount,address:t.from.address,txId:t.from.tx.id||void 0,confirmations:t.from.tx.confirmations||void 0},to:{currency:t.to.currency,amount:t.to.amount,address:t.to.address,txId:t.to.tx.id||void 0},createdAt:1e3*t.time.reg,expiresAt:1e3*t.time.expiration,emergency:t.back.address?{address:t.back.address}:void 0}}static toSimpleStatus(e){return({new:"waiting",pending:"confirming",exchange:"exchanging",withdraw:"sending",done:"complete",expired:"failed",emergency:"failed"})[e]||"waiting"}sleep(e){return new Promise(t=>setTimeout(t,e))}static isValidZecAddress(e){return e.startsWith("t1")||e.startsWith("t3")?35===e.length:e.startsWith("zs")?78===e.length:!!(e.startsWith("tm")||e.startsWith("ztestsapling"))}static isShieldedAddress(e){return e.startsWith("zs")||e.startsWith("ztestsapling")}static isValidLightningInvoice(e){let t=e.toLowerCase();return t.startsWith("lnbc")||t.startsWith("lntb")||t.startsWith("lnbcrt")}}class x{fixedFloat;constructor(e){this.fixedFloat=new R(e.fixedFloat)}async getZecToLightningQuote(e){try{return await this.fixedFloat.getZecToLightningQuote(e)}catch(e){throw console.error("Failed to get ZECâ†’LN quote:",e),Error(`Failed to get quote: ${e.message}`)}}async getLightningToZecQuote(e){try{return await this.fixedFloat.getLightningToZecQuote(e)}catch(e){throw console.error("Failed to get LNâ†’ZEC quote:",e),Error(`Failed to get quote: ${e.message}`)}}async swapZecToLightning(e,t,r){if(!R.isValidLightningInvoice(t))throw Error("Invalid Lightning invoice format");try{let s=await this.fixedFloat.createZecToLightningOrder(e,t,r);return console.log(`Created ZECâ†’LN swap order: ${s.id}`),console.log(`Deposit ${e} ZEC to: ${s.from.address}`),console.log("You will receive Lightning payment to your invoice"),s}catch(e){throw console.error("Failed to create ZECâ†’LN swap:",e),e}}async swapLightningToZec(e,t){if(!R.isValidZecAddress(t))throw Error("Invalid ZEC address format");R.isShieldedAddress(t)||console.warn("âš ï¸  Using transparent t-address. Consider using a shielded z-address for privacy!");try{let r=await this.fixedFloat.createLightningToZecOrder(e,t);return console.log(`Created LNâ†’ZEC swap order: ${r.id}`),console.log(`Pay this Lightning invoice: ${r.from.address}`),console.log(`You will receive ZEC at: ${t}`),r}catch(e){throw console.error("Failed to create LNâ†’ZEC swap:",e),e}}async getSwapStatus(e,t){return this.fixedFloat.getOrderStatus(e,t)}async waitForSwapComplete(e,t,r){return this.fixedFloat.waitForOrderComplete(e,t,36e5,15e3,e=>{let t=R.toSimpleStatus(e.status);r?.(e,t)})}static satsToBtc(e){return(e/1e8).toFixed(8)}static btcToSats(e){return Math.floor(1e8*Number(e))}static zecToZatoshis(e){return Math.floor(1e8*Number(e))}static zatoshisToZec(e){return(e/1e8).toFixed(8)}}var A=e.i(53438);class Z{zecService;atomiqClient;config;activeTransfers=new Map;constructor(e){this.config=e;let t={fixedFloat:{apiKey:e.fixedFloat.apiKey,apiSecret:e.fixedFloat.apiSecret}};this.zecService=new x(t);let r="mainnet"===e.atomiq.environment?"MAINNET":"TESTNET";this.atomiqClient=new A.RealAtomiqSwapClient(r,e.starknet.rpcUrl)}async getZecToStrkQuote(e){let t=await this.zecService.getZecToLightningQuote(e),r=parseFloat(t.to.amount),s=Math.floor(1e8*r),o=await this.atomiqClient.getQuote("BTC_LN","STRK",BigInt(s),!0),i=Number(o.amountOut)/1e18,a=parseFloat(t.from.amount),n=(a-r)/a*100,c=Number(o.fee)/s*100;return{zecAmount:e,lightningAmount:s,strkAmount:i,totalFeePercent:n+c,legs:{zecToLightning:{rate:parseFloat(t.from.rate),fee:n,quote:t},lightningToStrk:{rate:Number(o.amountOut)/s,fee:c}}}}async getStrkToZecQuote(e){let t=BigInt(Math.floor(1e18*e)),r=await this.atomiqClient.getQuote("STRK","BTC_LN",t,!0),s=Number(r.amountOut),o=await this.zecService.getLightningToZecQuote(s),i=parseFloat(o.to.amount),a=Number(r.fee)/Number(t)*100,n=parseFloat(o.from.amount),c=(n-i)/n*100;return{strkAmount:e,lightningAmount:s,zecAmount:i,totalFeePercent:a+c,legs:{strkToLightning:{rate:s/e,fee:a},lightningToZec:{rate:parseFloat(o.from.rate),fee:c,quote:o}}}}async initiateZecToStrk(e){let{zecAmount:t,recipientAddress:r,useCashuFlow:s=!1,usePrivacyMixer:o=!1,onProgress:i}=e,a={id:v(),direction:"zec-to-strk",from:{currency:"ZEC",amount:t.toString()},to:{currency:"STRK",amount:"0",address:r},steps:this.createZecToStrkSteps(o,s),currentStepIndex:0,status:"pending",options:{useCashuFlow:s,usePrivacyMixer:o},createdAt:Date.now()};this.activeTransfers.set(a.id,a),this.notifyProgress(a,i);try{return await this.executeZecToStrkFlow(a,i),a}catch(e){throw a.status="failed",a.error=e instanceof Error?e.message:String(e),this.notifyProgress(a,i),e}}async executeZecToStrkFlow(e,t){let r=parseFloat(e.from.amount);this.updateStep(e,0,"in-progress","Creating Atomiq Lightning swap..."),this.notifyProgress(e,t);let s=Math.floor(1e8*parseFloat((await this.zecService.getZecToLightningQuote(r)).to.amount)),o=await this.atomiqClient.beginLightningToStrkSwap(s,e.to.address);e.atomiqSwapId=o.id,this.updateStep(e,0,"complete","Atomiq swap created",{swapId:o.id}),this.notifyProgress(e,t),this.updateStep(e,1,"in-progress","Creating ZEC â†’ Lightning order..."),this.notifyProgress(e,t);let i=await this.zecService.swapZecToLightning(r,o.invoice);e.zecSwapOrderId=i.id,this.updateStep(e,1,"complete","FixedFloat order created",{orderId:i.id,depositAddress:i.from.address}),this.notifyProgress(e,t),this.updateStep(e,2,"in-progress","Waiting for ZEC deposit...",{depositAddress:i.from.address,expectedAmount:i.from.amount}),this.notifyProgress(e,t),console.log(`
ðŸ”” ACTION REQUIRED: Send ${r} ZEC to ${i.from.address}`),console.log(`Transfer ID: ${e.id}`),console.log(`Use checkTransferStatus('${e.id}') to continue after deposit
`)}async continueZecToStrkTransfer(e,t){let r=this.activeTransfers.get(e);if(!r)throw Error(`Transfer ${e} not found`);if("zec-to-strk"!==r.direction)throw Error("This method is only for ZEC â†’ STRK transfers");try{let e=await this.zecService.getSwapStatus(r.zecSwapOrderId,r.zecSwapToken||"");if(console.log(`ðŸ“Š FixedFloat order status: ${e.status}`),"new"===e.status||"pending"===e.status)return this.updateStep(r,2,"in-progress",`Waiting for ZEC deposit (status: ${e.status})`),this.notifyProgress(r,t),r;if("expired"===e.status||"emergency"===e.status)throw Error(`FixedFloat order ${e.status}`);this.updateStep(r,2,"complete","ZEC deposit confirmed"),this.notifyProgress(r,t),this.updateStep(r,3,"in-progress","Waiting for Lightning payment to Atomiq..."),this.notifyProgress(r,t);let s=await this.atomiqClient.getStatus(r.atomiqSwapId);if(console.log(`ðŸ“Š Atomiq swap status: ${s.status}`),"CREATED"===s.status||"QUOTED"===s.status)return this.updateStep(r,3,"in-progress","Waiting for FixedFloat to pay Lightning invoice..."),this.notifyProgress(r,t),r;if("EXPIRED"===s.status||"FAILED"===s.status||"REFUNDED"===s.status)throw Error(`Atomiq swap ${s.status}`);this.updateStep(r,3,"complete","Lightning payment received by Atomiq"),this.notifyProgress(r,t),this.updateStep(r,4,"in-progress","Claiming STRK on Starknet..."),this.notifyProgress(r,t);let o=await this.atomiqClient.claimLightningToStrkSwap(r.atomiqSwapId);this.updateStep(r,4,"complete","STRK claimed successfully",{txId:o.txId}),this.notifyProgress(r,t);let i=await this.atomiqClient.getStatus(r.atomiqSwapId);return i.amountOut&&(r.to.amount=(Number(i.amountOut)/1e18).toString()),r.status="complete",r.completedAt=Date.now(),this.notifyProgress(r,t),r}catch(e){throw r.status="failed",r.error=e instanceof Error?e.message:String(e),this.notifyProgress(r,t),e}}async initiateStrkToZec(e){let{strkAmount:t,zecAddress:r,useCashuFlow:s=!1,usePrivacyMixer:o=!1,onProgress:i}=e,a={id:v(),direction:"strk-to-zec",from:{currency:"STRK",amount:t.toString()},to:{currency:"ZEC",amount:"0",address:r},steps:this.createStrkToZecSteps(o,s),currentStepIndex:0,status:"pending",options:{useCashuFlow:s,usePrivacyMixer:o},createdAt:Date.now()};this.activeTransfers.set(a.id,a),this.notifyProgress(a,i);try{return await this.executeStrkToZecFlow(a,i),a}catch(e){throw a.status="failed",a.error=e instanceof Error?e.message:String(e),this.notifyProgress(a,i),e}}async executeStrkToZecFlow(t,r){let s=Number(BigInt(t.from.amount))/1e18;this.updateStep(t,0,"in-progress","Creating Lightning â†’ ZEC order..."),this.notifyProgress(t,r);let o=(await this.atomiqClient.estimateLightningSatsFromStrk(s)).satsOut,i=await this.zecService.swapLightningToZec(o,t.to.address);t.zecSwapOrderId=i.id;let a=i.from.address;this.updateStep(t,0,"complete","FixedFloat order created",{orderId:i.id,invoice:a}),this.notifyProgress(t,r),this.updateStep(t,1,"in-progress","Executing STRK â†’ Lightning swap..."),this.notifyProgress(t,r);let{getSharedSwapAccount:n}=await e.A(395555),c=n(),d=c?.getAddress()||"";if(!d)throw Error("No shared swap account configured - cannot execute STRK â†’ Lightning swap");let u=await this.atomiqClient.swapStrkToLightning(s,a,d);if(!u.success)throw Error(`Atomiq swap failed: ${u.error}`);this.updateStep(t,1,"complete","STRK â†’ Lightning swap complete",{txId:u.txId}),this.notifyProgress(t,r),this.updateStep(t,2,"in-progress","Waiting for ZEC delivery..."),this.notifyProgress(t,r),console.log(`
ðŸ”” Waiting for FixedFloat to deliver ZEC to ${t.to.address}`),console.log(`Transfer ID: ${t.id}`),console.log(`Use checkTransferStatus('${t.id}') to check delivery status
`)}async continueStrkToZecTransfer(e,t){let r=this.activeTransfers.get(e);if(!r)throw Error(`Transfer ${e} not found`);if("strk-to-zec"!==r.direction)throw Error("This method is only for STRK â†’ ZEC transfers");try{let e=await this.zecService.getSwapStatus(r.zecSwapOrderId,r.zecSwapToken||"");if(console.log(`ðŸ“Š FixedFloat ZEC delivery status: ${e.status}`),"done"===e.status)return r.to.amount=e.to.amount,this.updateStep(r,2,"complete","ZEC delivered",{amount:e.to.amount,txId:e.to.txId}),this.notifyProgress(r,t),r.status="complete",r.completedAt=Date.now(),this.notifyProgress(r,t),r;if("expired"===e.status||"emergency"===e.status)throw Error(`FixedFloat order ${e.status}`);return this.updateStep(r,2,"in-progress",`Waiting for ZEC delivery (status: ${e.status})`),this.notifyProgress(r,t),r}catch(e){throw r.status="failed",r.error=e instanceof Error?e.message:String(e),this.notifyProgress(r,t),e}}getTransfer(e){return this.activeTransfers.get(e)}listTransfers(){return Array.from(this.activeTransfers.values())}createZecToStrkSteps(e,t){let r=[{id:1,name:"atomiq-swap-create",description:"Create Atomiq Lightning swap",status:"pending"},{id:2,name:"fixedfloat-order",description:"Create ZEC â†’ Lightning order",status:"pending"},{id:3,name:"zec-deposit",description:"Waiting for ZEC deposit",status:"pending"},{id:4,name:"lightning-payment",description:"Lightning payment to Atomiq",status:"pending"},{id:5,name:"strk-claim",description:"Claim STRK on Starknet",status:"pending"}];return e&&r.push({id:r.length+1,name:"privacy-mixer",description:"Process through privacy mixer",status:"pending"}),t&&r.push({id:r.length+1,name:"cashu-flow",description:"Process through Cashu ecash",status:"pending"}),r}createStrkToZecSteps(e,t){let r=[{id:1,name:"fixedfloat-order",description:"Create Lightning â†’ ZEC order",status:"pending"},{id:2,name:"strk-to-lightning",description:"STRK â†’ Lightning swap via Atomiq",status:"pending"},{id:3,name:"zec-delivery",description:"Wait for ZEC delivery",status:"pending"}];return e&&r.unshift({id:0,name:"privacy-mixer",description:"Process through privacy mixer",status:"pending"}),r}updateStep(e,t,r,s,o){let i=e.steps[t];i&&(i.status=r,s&&(i.description=s),o&&(i.data=o),"in-progress"===r&&(i.startedAt=Date.now()),("complete"===r||"failed"===r)&&(i.completedAt=Date.now()),"in-progress"===r&&(e.currentStepIndex=t,e.status="in-progress"))}notifyProgress(e,t){t&&t({...e,steps:[...e.steps]})}}var F=e.i(919822);let N=null;function k(){return N||(N=new Z({fixedFloat:{apiKey:process.env.FIXEDFLOAT_API_KEY||"",apiSecret:process.env.FIXEDFLOAT_API_SECRET||""},atomiq:{environment:"MAINNET"===F.ENV.NETWORK?"mainnet":"testnet"},starknet:{rpcUrl:process.env.STARKNET_RPC||"https://starknet-mainnet.g.alchemy.com/starknet/version/rpc/v0_8/kwgGr9GGk4YyLXuGfEvpITv1jpvn3PgP",mixerAddress:process.env.MIXER_CONTRACT_ADDRESS||"0x05effdcfda86066c72c108e174c55a4f8d1249ba69f80e975d7fc814199a376b",verifierAddress:process.env.VERIFIER_CONTRACT_ADDRESS||""}})),N}async function I(e){try{let{action:t,...r}=await e.json();switch(t){case"quote-zec-to-strk":{let{zecAmount:e}=r;if(!e||e<=0)return w.NextResponse.json({success:!1,error:"Invalid ZEC amount"},{status:400});let t=k(),s=await t.getZecToStrkQuote(e);return w.NextResponse.json({success:!0,quote:{zecAmount:s.zecAmount,lightningAmount:s.lightningAmount,strkAmount:s.strkAmount,totalFeePercent:s.totalFeePercent,legs:{first:{from:"ZEC",to:"Lightning",rate:s.legs.zecToLightning.rate,fee:s.legs.zecToLightning.fee},second:{from:"Lightning",to:"STRK",rate:s.legs.lightningToStrk.rate,fee:s.legs.lightningToStrk.fee}}}})}case"quote-strk-to-zec":{let{strkAmount:e}=r;if(!e||e<=0)return w.NextResponse.json({success:!1,error:"Invalid STRK amount"},{status:400});let t=k(),s=await t.getStrkToZecQuote(e);return w.NextResponse.json({success:!0,quote:{strkAmount:s.strkAmount,lightningAmount:s.lightningAmount,zecAmount:s.zecAmount,totalFeePercent:s.totalFeePercent,legs:{first:{from:"STRK",to:"Lightning",rate:s.legs.strkToLightning.rate,fee:s.legs.strkToLightning.fee},second:{from:"Lightning",to:"ZEC",rate:s.legs.lightningToZec.rate,fee:s.legs.lightningToZec.fee}}}})}case"initiate-zec-to-strk":{let{zecAmount:e,recipientAddress:t,usePrivacyMixer:s,useCashuFlow:o}=r;if(!e||e<=0)return w.NextResponse.json({success:!1,error:"Invalid ZEC amount"},{status:400});if(!t)return w.NextResponse.json({success:!1,error:"Recipient address required"},{status:400});let i=k(),a=await i.initiateZecToStrk({zecAmount:e,recipientAddress:t,usePrivacyMixer:s||!1,useCashuFlow:o||!1}),n=a.steps.find(e=>"fixedfloat-order"===e.name),c=n?.data?.depositAddress,d=n?.data?.expectedAmount;return w.NextResponse.json({success:!0,transfer:{id:a.id,status:a.status,direction:a.direction,depositAddress:c,expectedAmount:d||e,steps:a.steps.map(e=>({name:e.name,description:e.description,status:e.status}))}})}case"initiate-strk-to-zec":{let{strkAmount:e,zecAddress:t,usePrivacyMixer:s}=r;if(!e||e<=0)return w.NextResponse.json({success:!1,error:"Invalid STRK amount"},{status:400});if(!t)return w.NextResponse.json({success:!1,error:"ZEC address required"},{status:400});let o=k(),i=await o.initiateStrkToZec({strkAmount:e,zecAddress:t,usePrivacyMixer:s||!1});return w.NextResponse.json({success:!0,transfer:{id:i.id,status:i.status,direction:i.direction,steps:i.steps.map(e=>({name:e.name,description:e.description,status:e.status}))}})}case"status":{let{transferId:e}=r;if(!e)return w.NextResponse.json({success:!1,error:"Transfer ID required"},{status:400});let t=k().getTransfer(e);if(!t)return w.NextResponse.json({success:!1,error:"Transfer not found"},{status:404});return w.NextResponse.json({success:!0,transfer:{id:t.id,status:t.status,direction:t.direction,steps:t.steps.map(e=>({name:e.name,description:e.description,status:e.status,data:e.data})),error:t.error}})}default:return w.NextResponse.json({success:!1,error:`Unknown action: ${t}`},{status:400})}}catch(e){return console.error("Cross-chain API error:",e),w.NextResponse.json({success:!1,error:e instanceof Error?e.message:"Internal server error"},{status:500})}}async function L(){return w.NextResponse.json({service:"Cross-Chain Swap API",description:"ZEC â†” STRK atomic swaps via Lightning",actions:{"quote-zec-to-strk":"Get quote for ZEC â†’ STRK swap","quote-strk-to-zec":"Get quote for STRK â†’ ZEC swap","initiate-zec-to-strk":"Start ZEC â†’ STRK swap (returns deposit address)","initiate-strk-to-zec":"Start STRK â†’ ZEC swap",status:"Check transfer status"},network:F.ENV.NETWORK})}var P=e.i(360762);let q=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/cross-chain/route",pathname:"/api/cross-chain",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/cross-chain/route.ts",nextConfigOutput:"",userland:P}),{workAsyncStorage:O,workUnitAsyncStorage:$,serverHooks:b}=q;function D(){return(0,s.patchFetch)({workAsyncStorage:O,workUnitAsyncStorage:$})}async function z(e,t,s){var w;let S="/api/cross-chain/route";S=S.replace(/\/index$/,"")||"/";let T=await q.prepare(e,t,{srcPage:S,multiZoneDraftMode:!1});if(!T)return t.statusCode=400,t.end("Bad Request"),null==s.waitUntil||s.waitUntil.call(s,Promise.resolve()),null;let{buildId:y,params:E,nextConfig:C,isDraftMode:v,prerenderManifest:R,routerServerContext:x,isOnDemandRevalidate:A,revalidateOnlyGenerated:Z,resolvedPathname:F}=T,N=(0,a.normalizeAppPath)(S),k=!!(R.dynamicRoutes[N]||R.routes[F]);if(k&&!v){let e=!!R.routes[F],t=R.dynamicRoutes[N];if(t&&!1===t.fallback&&!e)throw new m.NoFallbackError}let I=null;!k||q.isDev||v||(I="/index"===(I=F)?"/":I);let L=!0===q.isDev||!k,P=k&&!L,O=e.method||"GET",$=(0,i.getTracer)(),b=$.getActiveScopeSpan(),D={params:E,prerenderManifest:R,renderOpts:{experimental:{cacheComponents:!!C.experimental.cacheComponents,authInterrupts:!!C.experimental.authInterrupts},supportsDynamicResponse:L,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:null==(w=C.experimental)?void 0:w.cacheLife,isRevalidate:P,waitUntil:s.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,s)=>q.onRequestError(e,t,s,x)},sharedContext:{buildId:y}},z=new n.NodeNextRequest(e),U=new n.NodeNextResponse(t),K=c.NextRequestAdapter.fromNodeNextRequest(z,(0,c.signalFromNodeResponse)(t));try{let a=async r=>q.handle(K,D).finally(()=>{if(!r)return;r.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let s=$.getRootSpanAttributes();if(!s)return;if(s.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${s.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let o=s.get("next.route");if(o){let e=`${O} ${o}`;r.setAttributes({"next.route":o,"http.route":o,"next.span_name":e}),r.updateName(e)}else r.updateName(`${O} ${e.url}`)}),n=async i=>{var n,c;let d=async({previousCacheEntry:r})=>{try{if(!(0,o.getRequestMeta)(e,"minimalMode")&&A&&Z&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await a(i);e.fetchMetrics=D.renderOpts.fetchMetrics;let c=D.renderOpts.pendingWaitUntil;c&&s.waitUntil&&(s.waitUntil(c),c=void 0);let d=D.renderOpts.collectedTags;if(!k)return await (0,l.sendResponse)(z,U,n,D.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,p.toNodeOutgoingHttpHeaders)(n.headers);d&&(t[h.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==D.renderOpts.collectedRevalidate&&!(D.renderOpts.collectedRevalidate>=h.INFINITE_CACHE)&&D.renderOpts.collectedRevalidate,s=void 0===D.renderOpts.collectedExpire||D.renderOpts.collectedExpire>=h.INFINITE_CACHE?void 0:D.renderOpts.collectedExpire;return{value:{kind:f.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:s}}}}catch(t){throw(null==r?void 0:r.isStale)&&await q.onRequestError(e,t,{routerKind:"App Router",routePath:S,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isRevalidate:P,isOnDemandRevalidate:A})},x),t}},m=await q.handleResponse({req:e,nextConfig:C,cacheKey:I,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:R,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:Z,responseGenerator:d,waitUntil:s.waitUntil});if(!k)return null;if((null==m||null==(n=m.value)?void 0:n.kind)!==f.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==m||null==(c=m.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,o.getRequestMeta)(e,"minimalMode")||t.setHeader("x-nextjs-cache",A?"REVALIDATED":m.isMiss?"MISS":m.isStale?"STALE":"HIT"),v&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let w=(0,p.fromNodeOutgoingHttpHeaders)(m.value.headers);return(0,o.getRequestMeta)(e,"minimalMode")&&k||w.delete(h.NEXT_CACHE_TAGS_HEADER),!m.cacheControl||t.getHeader("Cache-Control")||w.get("Cache-Control")||w.set("Cache-Control",(0,g.getCacheControlHeader)(m.cacheControl)),await (0,l.sendResponse)(z,U,new Response(m.value.body,{headers:w,status:m.value.status||200})),null};b?await n(b):await $.withPropagatedContext(e.headers,()=>$.trace(d.BaseServerSpan.handleRequest,{spanName:`${O} ${e.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":O,"http.target":e.url}},n))}catch(t){if(b||t instanceof m.NoFallbackError||await q.onRequestError(e,t,{routerKind:"App Router",routePath:N,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isRevalidate:P,isOnDemandRevalidate:A})}),k)throw t;return await (0,l.sendResponse)(z,U,new Response(null,{status:500})),null}}}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_1396000b.js.map