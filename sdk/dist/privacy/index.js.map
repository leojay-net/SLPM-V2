{"version":3,"sources":["../../src/types.ts","../../src/crypto.ts","../../src/constants.ts","../../src/privacy/mixer.ts"],"names":["bytesToHex","randomBytes","hexToBytes","sha256","Contract","cairo"],"mappings":"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","file":"index.js","sourcesContent":["/**\n * SLPM SDK Type Definitions\n * \n * Core types for the Starknet Lightning Privacy Mixer SDK\n */\n\nimport type { Account, Provider, RpcProvider } from 'starknet';\n\n// ============================================================================\n// Configuration Types\n// ============================================================================\n\nexport interface SLPMConfig {\n  /** Starknet RPC URL */\n  rpcUrl: string;\n  /** Network: mainnet or sepolia testnet */\n  network: 'mainnet' | 'sepolia';\n  /** Privacy mixer contract address (optional, uses default) */\n  mixerContractAddress?: string;\n  /** Verifier contract address (optional, uses default) */\n  verifierContractAddress?: string;\n  /** Cashu mint URL (optional, uses default) */\n  cashuMintUrl?: string;\n  /** FixedFloat API credentials (required for cross-chain swaps) */\n  fixedFloat?: {\n    apiKey: string;\n    apiSecret: string;\n  };\n  /** Enable debug logging */\n  debug?: boolean;\n}\n\nexport interface WalletConnection {\n  /** Connected Starknet account */\n  account: Account;\n  /** RPC provider */\n  provider: RpcProvider;\n  /** Wallet address */\n  address: string;\n}\n\n// ============================================================================\n// Privacy Mixer Types\n// ============================================================================\n\n/**\n * Commitment data - MUST be stored securely by the user\n * This is required to withdraw funds from the mixer\n */\nexport interface Commitment {\n  /** The commitment hash (stored on-chain) */\n  commitment: string;\n  /** Secret value - KEEP PRIVATE */\n  secret: string;\n  /** Nullifier - derived from secret */\n  nullifier: string;\n  /** Hash of nullifier (used to prevent double-spend) */\n  nullifierHash: string;\n  /** Amount deposited (in wei) */\n  amount: bigint;\n  /** Leaf index in Merkle tree (set after deposit) */\n  leafIndex?: number;\n  /** Deposit transaction hash */\n  depositTxHash?: string;\n  /** Timestamp of creation */\n  createdAt: number;\n}\n\nexport interface MerkleProof {\n  /** Path elements (sibling hashes) */\n  pathElements: string[];\n  /** Path indices (0=left, 1=right) */\n  pathIndices: number[];\n  /** Merkle root */\n  root: string;\n}\n\nexport interface DepositParams {\n  /** Amount to deposit in wei (e.g., 1e18 for 1 STRK) */\n  amount: bigint;\n  /** Token address (default: STRK) */\n  tokenAddress?: string;\n}\n\nexport interface DepositResult {\n  /** Transaction hash */\n  txHash: string;\n  /** Commitment data - SAVE THIS */\n  commitment: Commitment;\n  /** Leaf index in Merkle tree */\n  leafIndex: number;\n  /** Block number */\n  blockNumber: number;\n}\n\nexport interface WithdrawParams {\n  /** Commitment from deposit */\n  commitment: Commitment;\n  /** Recipient address */\n  recipient: string;\n  /** Amount to withdraw */\n  amount: bigint;\n  /** Optional relayer for enhanced privacy */\n  relayer?: string;\n  /** Relayer fee */\n  relayerFee?: bigint;\n}\n\nexport interface WithdrawResult {\n  /** Transaction hash */\n  txHash: string;\n  /** Amount withdrawn */\n  amount: bigint;\n  /** Recipient address */\n  recipient: string;\n  /** Nullifier hash (now spent) */\n  nullifierHash: string;\n}\n\nexport interface ZKProof {\n  /** Proof data */\n  proof: string[];\n  /** Public inputs */\n  publicInputs: string[];\n}\n\nexport interface MixerStats {\n  /** Total deposited amount */\n  totalDeposits: bigint;\n  /** Total withdrawn amount */\n  totalWithdrawals: bigint;\n  /** Current anonymity set size */\n  anonymitySetSize: number;\n  /** Number of active commitments */\n  activeCommitments: number;\n}\n\n// ============================================================================\n// Cross-Chain Swap Types\n// ============================================================================\n\nexport type SwapDirection = \n  | 'strk-to-zec' \n  | 'zec-to-strk' \n  | 'strk-to-btc' \n  | 'btc-to-strk';\n\nexport interface SwapQuote {\n  /** Unique quote ID */\n  id: string;\n  /** Input amount */\n  inputAmount: string;\n  /** Input currency */\n  inputCurrency: string;\n  /** Expected output amount */\n  outputAmount: string;\n  /** Output currency */\n  outputCurrency: string;\n  /** Exchange rate */\n  rate: number;\n  /** Fee percentage */\n  feePercent: number;\n  /** Quote expiry timestamp */\n  expiresAt: number;\n  /** Minimum acceptable output */\n  minOutput: string;\n}\n\nexport interface SwapParams {\n  /** Swap direction */\n  direction: SwapDirection;\n  /** Amount to swap */\n  amount: string;\n  /** Destination address (ZEC or STRK address) */\n  destinationAddress: string;\n  /** Enable privacy mixer pre/post processing */\n  usePrivacyMixer?: boolean;\n  /** Enable Cashu ecash layer */\n  useCashuFlow?: boolean;\n  /** Slippage tolerance (0-100) */\n  slippageTolerance?: number;\n}\n\nexport interface SwapResult {\n  /** Unique swap ID */\n  id: string;\n  /** Swap direction */\n  direction: SwapDirection;\n  /** Input amount */\n  inputAmount: string;\n  /** Output amount */\n  outputAmount: string;\n  /** Current status */\n  status: SwapStatus;\n  /** Steps completed */\n  steps: SwapStep[];\n  /** Current step index */\n  currentStepIndex: number;\n  /** Timestamps */\n  timestamps: {\n    created: number;\n    updated: number;\n    completed?: number;\n  };\n  /** Transaction hashes */\n  txHashes: {\n    deposit?: string;\n    mixerDeposit?: string;\n    mixerWithdraw?: string;\n    swap?: string;\n  };\n  /** Error message if failed */\n  error?: string;\n}\n\nexport type SwapStatus = \n  | 'pending'\n  | 'awaiting-deposit'\n  | 'depositing'\n  | 'mixing'\n  | 'swapping'\n  | 'delivering'\n  | 'completed'\n  | 'failed'\n  | 'expired';\n\nexport interface SwapStep {\n  /** Step ID */\n  id: number;\n  /** Step name */\n  name: string;\n  /** Description */\n  description: string;\n  /** Status */\n  status: 'pending' | 'in-progress' | 'completed' | 'failed';\n  /** Extra data */\n  data?: Record<string, unknown>;\n}\n\n// ============================================================================\n// Cashu Ecash Types\n// ============================================================================\n\nexport interface CashuToken {\n  /** Encoded token string */\n  token: string;\n  /** Amount in sats */\n  amount: number;\n  /** Mint URL */\n  mint: string;\n}\n\nexport interface CashuProof {\n  /** Keyset ID */\n  id: string;\n  /** Amount */\n  amount: number;\n  /** Secret */\n  secret: string;\n  /** Signature (C) */\n  C: string;\n}\n\nexport interface MintQuoteResult {\n  /** Quote ID */\n  quoteId: string;\n  /** Lightning invoice to pay */\n  invoice: string;\n  /** Amount in sats */\n  amount: number;\n  /** Expiry timestamp */\n  expiresAt: number;\n}\n\nexport interface MeltQuoteResult {\n  /** Quote ID */\n  quoteId: string;\n  /** Amount to melt */\n  amount: number;\n  /** Fee reserve */\n  feeReserve: number;\n  /** Expiry timestamp */\n  expiresAt: number;\n}\n\n// ============================================================================\n// Event Types\n// ============================================================================\n\nexport type SLPMEventType =\n  | 'initialized'\n  | 'connected'\n  | 'disconnected'\n  | 'deposit:started'\n  | 'deposit:confirmed'\n  | 'deposit:failed'\n  | 'withdraw:started'\n  | 'withdraw:proof-generating'\n  | 'withdraw:proof-generated'\n  | 'withdraw:completed'\n  | 'withdraw:failed'\n  | 'swap:initiated'\n  | 'swap:step-changed'\n  | 'swap:completed'\n  | 'swap:failed'\n  | 'cashu:minting'\n  | 'cashu:minted'\n  | 'cashu:melting'\n  | 'cashu:melted'\n  | 'error';\n\nexport interface SLPMEvent<T = unknown> {\n  /** Event type */\n  type: SLPMEventType;\n  /** Timestamp */\n  timestamp: number;\n  /** Event data */\n  data: T;\n}\n\nexport type SLPMEventCallback<T = unknown> = (event: SLPMEvent<T>) => void;\n\n// ============================================================================\n// Error Types\n// ============================================================================\n\nexport class SLPMError extends Error {\n  public readonly code: string;\n  public readonly details?: Record<string, unknown>;\n\n  constructor(message: string, code: string, details?: Record<string, unknown>) {\n    super(message);\n    this.name = 'SLPMError';\n    this.code = code;\n    this.details = details;\n  }\n}\n\nexport class ConfigError extends SLPMError {\n  constructor(message: string, details?: Record<string, unknown>) {\n    super(message, 'CONFIG_ERROR', details);\n    this.name = 'ConfigError';\n  }\n}\n\nexport class ConnectionError extends SLPMError {\n  constructor(message: string, details?: Record<string, unknown>) {\n    super(message, 'CONNECTION_ERROR', details);\n    this.name = 'ConnectionError';\n  }\n}\n\nexport class PrivacyError extends SLPMError {\n  constructor(message: string, details?: Record<string, unknown>) {\n    super(message, 'PRIVACY_ERROR', details);\n    this.name = 'PrivacyError';\n  }\n}\n\nexport class SwapError extends SLPMError {\n  constructor(message: string, details?: Record<string, unknown>) {\n    super(message, 'SWAP_ERROR', details);\n    this.name = 'SwapError';\n  }\n}\n\nexport class ProofError extends SLPMError {\n  constructor(message: string, details?: Record<string, unknown>) {\n    super(message, 'PROOF_ERROR', details);\n    this.name = 'ProofError';\n  }\n}\n\nexport class CashuError extends SLPMError {\n  constructor(message: string, details?: Record<string, unknown>) {\n    super(message, 'CASHU_ERROR', details);\n    this.name = 'CashuError';\n  }\n}\n","/**\n * SLPM SDK Cryptographic Utilities\n */\n\nimport { sha256 } from '@noble/hashes/sha256';\nimport { bytesToHex, hexToBytes, randomBytes } from '@noble/hashes/utils';\n\n/**\n * Generate random hex string\n */\nexport function randomHex(bytes: number = 32): string {\n  return bytesToHex(randomBytes(bytes));\n}\n\n/**\n * Hash data using SHA256\n */\nexport function hash(data: string | Uint8Array): string {\n  const input = typeof data === 'string' ? hexToBytes(data.replace('0x', '')) : data;\n  return '0x' + bytesToHex(sha256(input));\n}\n\n/**\n * Pedersen hash (simplified - in production use actual Pedersen)\n * For compatibility with Starknet/Cairo\n */\nexport function pedersenHash(a: string, b: string): string {\n  const combined = a.replace('0x', '') + b.replace('0x', '');\n  return hash(combined);\n}\n\n/**\n * Poseidon hash (simplified - in production use actual Poseidon)\n * For compatibility with Noir circuits\n */\nexport function poseidonHash(inputs: string[]): string {\n  const combined = inputs.map(x => x.replace('0x', '')).join('');\n  return hash(combined);\n}\n\n/**\n * Generate a commitment for the privacy mixer\n */\nexport function generateCommitment(amount: bigint): {\n  commitment: string;\n  secret: string;\n  nullifier: string;\n  nullifierHash: string;\n} {\n  // Generate random secret and nullifier\n  const secret = '0x' + randomHex(32);\n  const nullifier = '0x' + randomHex(32);\n  \n  // Compute nullifier hash\n  const nullifierHash = poseidonHash([nullifier]);\n  \n  // Compute commitment = hash(secret, nullifier, amount)\n  const amountHex = '0x' + amount.toString(16).padStart(64, '0');\n  const commitment = poseidonHash([secret, nullifier, amountHex]);\n  \n  return {\n    commitment,\n    secret,\n    nullifier,\n    nullifierHash,\n  };\n}\n\n/**\n * Verify a commitment\n */\nexport function verifyCommitment(\n  secret: string,\n  nullifier: string,\n  amount: bigint,\n  expectedCommitment: string\n): boolean {\n  const amountHex = '0x' + amount.toString(16).padStart(64, '0');\n  const computed = poseidonHash([secret, nullifier, amountHex]);\n  return computed.toLowerCase() === expectedCommitment.toLowerCase();\n}\n\n/**\n * Compute Merkle root from leaves\n */\nexport function computeMerkleRoot(leaves: string[]): string {\n  if (leaves.length === 0) return '0x' + '0'.repeat(64);\n  if (leaves.length === 1) return leaves[0];\n  \n  const nextLevel: string[] = [];\n  for (let i = 0; i < leaves.length; i += 2) {\n    const left = leaves[i];\n    const right = leaves[i + 1] || left; // Duplicate if odd\n    nextLevel.push(pedersenHash(left, right));\n  }\n  \n  return computeMerkleRoot(nextLevel);\n}\n\n/**\n * Generate Merkle proof for a leaf\n */\nexport function generateMerkleProof(\n  leaves: string[],\n  leafIndex: number\n): {\n  pathElements: string[];\n  pathIndices: number[];\n  root: string;\n} {\n  const pathElements: string[] = [];\n  const pathIndices: number[] = [];\n  \n  let currentLevel = [...leaves];\n  let currentIndex = leafIndex;\n  \n  while (currentLevel.length > 1) {\n    const siblingIndex = currentIndex % 2 === 0 ? currentIndex + 1 : currentIndex - 1;\n    const sibling = currentLevel[siblingIndex] || currentLevel[currentIndex];\n    \n    pathElements.push(sibling);\n    pathIndices.push(currentIndex % 2);\n    \n    // Move to next level\n    const nextLevel: string[] = [];\n    for (let i = 0; i < currentLevel.length; i += 2) {\n      const left = currentLevel[i];\n      const right = currentLevel[i + 1] || left;\n      nextLevel.push(pedersenHash(left, right));\n    }\n    \n    currentLevel = nextLevel;\n    currentIndex = Math.floor(currentIndex / 2);\n  }\n  \n  return {\n    pathElements,\n    pathIndices,\n    root: currentLevel[0],\n  };\n}\n\n/**\n * Verify a Merkle proof\n */\nexport function verifyMerkleProof(\n  leaf: string,\n  pathElements: string[],\n  pathIndices: number[],\n  root: string\n): boolean {\n  let current = leaf;\n  \n  for (let i = 0; i < pathElements.length; i++) {\n    const sibling = pathElements[i];\n    const isLeft = pathIndices[i] === 0;\n    \n    current = isLeft\n      ? pedersenHash(current, sibling)\n      : pedersenHash(sibling, current);\n  }\n  \n  return current.toLowerCase() === root.toLowerCase();\n}\n\n/**\n * Format amount for display\n */\nexport function formatAmount(amount: bigint, decimals: number = 18): string {\n  const str = amount.toString().padStart(decimals + 1, '0');\n  const intPart = str.slice(0, -decimals) || '0';\n  const decPart = str.slice(-decimals).replace(/0+$/, '');\n  return decPart ? `${intPart}.${decPart}` : intPart;\n}\n\n/**\n * Parse amount from string\n */\nexport function parseAmount(amount: string, decimals: number = 18): bigint {\n  const [intPart, decPart = ''] = amount.split('.');\n  const paddedDec = decPart.padEnd(decimals, '0').slice(0, decimals);\n  return BigInt(intPart + paddedDec);\n}\n","/**\n * SLPM SDK Constants\n */\n\n// Default contract addresses (mainnet)\nexport const MAINNET_CONTRACTS = {\n  MIXER: '0x05effdcfda86066c72c108e174c55a4f8d1249ba69f80e975d7fc814199a376b',\n  VERIFIER: '', // Set after deployment\n  STRK_TOKEN: '0x04718f5a0fc34cc1af16a1cdee98ffb20c31f5cd61d6ab07201858f4287c938d',\n} as const;\n\n// Testnet (Sepolia) contract addresses\nexport const SEPOLIA_CONTRACTS = {\n  MIXER: '0x05effdcfda86066c72c108e174c55a4f8d1249ba69f80e975d7fc814199a376b',\n  VERIFIER: '',\n  STRK_TOKEN: '0x04718f5a0fc34cc1af16a1cdee98ffb20c31f5cd61d6ab07201858f4287c938d',\n} as const;\n\n// RPC endpoints\nexport const RPC_URLS = {\n  mainnet: 'https://starknet-mainnet.public.blastapi.io',\n  sepolia: 'https://starknet-sepolia.public.blastapi.io',\n} as const;\n\n// Default Cashu mints\nexport const CASHU_MINTS = {\n  mainnet: 'https://mint.minibits.cash/Bitcoin',\n  testnet: 'https://testnut.cashu.space',\n} as const;\n\n// Mixer configuration\nexport const MIXER_CONFIG = {\n  MIN_DEPOSIT: BigInt('1000000000000000000'), // 1 STRK\n  MAX_DEPOSIT: BigInt('1000000000000000000000'), // 1000 STRK\n  FEE_RATE: 10n, // 0.1% (10/10000)\n  MERKLE_TREE_HEIGHT: 20,\n} as const;\n\n// Swap configuration\nexport const SWAP_CONFIG = {\n  MIN_AMOUNT_ZEC: 0.001,\n  MAX_AMOUNT_ZEC: 10,\n  MIN_AMOUNT_STRK: 1,\n  MAX_AMOUNT_STRK: 10000,\n  DEFAULT_SLIPPAGE: 1, // 1%\n  QUOTE_EXPIRY_MS: 60000, // 1 minute\n  POLL_INTERVAL_MS: 10000, // 10 seconds\n  MAX_POLL_ATTEMPTS: 60, // 10 minutes\n} as const;\n\n// Supported currencies\nexport const CURRENCIES = {\n  STRK: {\n    symbol: 'STRK',\n    name: 'Starknet Token',\n    decimals: 18,\n    chain: 'starknet',\n  },\n  ZEC: {\n    symbol: 'ZEC',\n    name: 'Zcash',\n    decimals: 8,\n    chain: 'zcash',\n  },\n  BTC: {\n    symbol: 'BTC',\n    name: 'Bitcoin',\n    decimals: 8,\n    chain: 'bitcoin',\n  },\n  BTCLN: {\n    symbol: 'BTCLN',\n    name: 'Bitcoin Lightning',\n    decimals: 8,\n    chain: 'lightning',\n  },\n} as const;\n","/**\n * SLPM SDK - Privacy Mixer Module\n * \n * Provides ZK-based private deposits and withdrawals on Starknet\n */\n\nimport { Account, Contract, RpcProvider, CallData, cairo } from 'starknet';\nimport { v4 as uuidv4 } from 'uuid';\nimport {\n  SLPMConfig,\n  WalletConnection,\n  Commitment,\n  DepositParams,\n  DepositResult,\n  WithdrawParams,\n  WithdrawResult,\n  MerkleProof,\n  ZKProof,\n  MixerStats,\n  SLPMEvent,\n  SLPMEventCallback,\n  PrivacyError,\n  ProofError,\n} from '../types';\nimport {\n  generateCommitment,\n  generateMerkleProof,\n  verifyMerkleProof,\n  formatAmount,\n} from '../crypto';\nimport {\n  MAINNET_CONTRACTS,\n  SEPOLIA_CONTRACTS,\n  MIXER_CONFIG,\n} from '../constants';\n\n// Mixer ABI (simplified - use actual ABI in production)\nconst MIXER_ABI = [\n  {\n    name: 'deposit',\n    type: 'function',\n    inputs: [\n      { name: 'commitment', type: 'felt252' },\n      { name: 'amount', type: 'u256' },\n    ],\n    outputs: [],\n  },\n  {\n    name: 'withdraw',\n    type: 'function',\n    inputs: [\n      { name: 'nullifier_hash', type: 'felt252' },\n      { name: 'recipient', type: 'ContractAddress' },\n      { name: 'amount', type: 'u256' },\n      { name: 'proof', type: 'Array<felt252>' },\n    ],\n    outputs: [],\n  },\n  {\n    name: 'get_merkle_root',\n    type: 'function',\n    inputs: [],\n    outputs: [{ type: 'felt252' }],\n    state_mutability: 'view',\n  },\n  {\n    name: 'get_anonymity_set_size',\n    type: 'function',\n    inputs: [],\n    outputs: [{ type: 'u64' }],\n    state_mutability: 'view',\n  },\n  {\n    name: 'is_nullifier_used',\n    type: 'function',\n    inputs: [{ name: 'nullifier_hash', type: 'felt252' }],\n    outputs: [{ type: 'bool' }],\n    state_mutability: 'view',\n  },\n  {\n    name: 'get_commitment_at_index',\n    type: 'function',\n    inputs: [{ name: 'index', type: 'u64' }],\n    outputs: [{ type: 'felt252' }],\n    state_mutability: 'view',\n  },\n];\n\n/**\n * Privacy Mixer - ZK-based private deposits and withdrawals\n * \n * @example\n * ```typescript\n * const mixer = new PrivacyMixer(config, wallet);\n * \n * // Deposit\n * const deposit = await mixer.deposit({ amount: parseAmount('10') });\n * console.log('Save this commitment:', deposit.commitment);\n * \n * // Later, withdraw to a different address\n * const withdraw = await mixer.withdraw({\n *   commitment: deposit.commitment,\n *   recipient: '0x...',\n *   amount: parseAmount('10'),\n * });\n * ```\n */\nexport class PrivacyMixer {\n  private config: SLPMConfig;\n  private wallet: WalletConnection;\n  private contract: Contract;\n  private eventCallback?: SLPMEventCallback;\n  private commitments: Map<string, Commitment> = new Map();\n  \n  constructor(\n    config: SLPMConfig,\n    wallet: WalletConnection,\n    eventCallback?: SLPMEventCallback\n  ) {\n    this.config = config;\n    this.wallet = wallet;\n    this.eventCallback = eventCallback;\n    \n    // Get contract address\n    const contracts = config.network === 'mainnet' ? MAINNET_CONTRACTS : SEPOLIA_CONTRACTS;\n    const contractAddress = config.mixerContractAddress || contracts.MIXER;\n    \n    // Initialize contract\n    this.contract = new Contract(MIXER_ABI, contractAddress, wallet.provider);\n    this.contract.connect(wallet.account);\n  }\n\n  // ============================================================================\n  // Core Operations\n  // ============================================================================\n\n  /**\n   * Deposit funds into the privacy mixer\n   * \n   * @param params - Deposit parameters\n   * @returns Deposit result including commitment (SAVE THIS!)\n   */\n  async deposit(params: DepositParams): Promise<DepositResult> {\n    const { amount, tokenAddress } = params;\n    \n    // Validate amount\n    if (amount < MIXER_CONFIG.MIN_DEPOSIT) {\n      throw new PrivacyError(\n        `Minimum deposit is ${formatAmount(MIXER_CONFIG.MIN_DEPOSIT)} STRK`,\n        { minDeposit: MIXER_CONFIG.MIN_DEPOSIT.toString() }\n      );\n    }\n    \n    if (amount > MIXER_CONFIG.MAX_DEPOSIT) {\n      throw new PrivacyError(\n        `Maximum deposit is ${formatAmount(MIXER_CONFIG.MAX_DEPOSIT)} STRK`,\n        { maxDeposit: MIXER_CONFIG.MAX_DEPOSIT.toString() }\n      );\n    }\n\n    this.emit('deposit:started', { amount: amount.toString() });\n\n    try {\n      // Generate commitment\n      const commitmentData = generateCommitment(amount);\n      \n      // Create commitment object\n      const commitment: Commitment = {\n        ...commitmentData,\n        amount,\n        createdAt: Date.now(),\n      };\n\n      // Execute deposit transaction\n      const tx = await this.contract.deposit(\n        commitmentData.commitment,\n        cairo.uint256(amount)\n      );\n\n      // Wait for confirmation\n      const receipt = await this.wallet.provider.waitForTransaction(tx.transaction_hash);\n      \n      // Get leaf index from events\n      const leafIndex = this.extractLeafIndex(receipt);\n      commitment.leafIndex = leafIndex;\n      commitment.depositTxHash = tx.transaction_hash;\n\n      // Store commitment locally\n      this.commitments.set(commitmentData.commitment, commitment);\n\n      const result: DepositResult = {\n        txHash: tx.transaction_hash,\n        commitment,\n        leafIndex,\n        blockNumber: (receipt as { block_number?: number }).block_number || 0,\n      };\n\n      this.emit('deposit:confirmed', { txHash: result.txHash, leafIndex });\n      \n      return result;\n    } catch (error) {\n      this.emit('deposit:failed', { error: String(error) });\n      throw new PrivacyError(`Deposit failed: ${error}`, { error: String(error) });\n    }\n  }\n\n  /**\n   * Withdraw funds from the privacy mixer\n   * \n   * @param params - Withdrawal parameters including the original commitment\n   * @returns Withdrawal result\n   */\n  async withdraw(params: WithdrawParams): Promise<WithdrawResult> {\n    const { commitment, recipient, amount, relayer, relayerFee } = params;\n\n    this.emit('withdraw:started', { recipient, amount: amount.toString() });\n\n    try {\n      // Check if nullifier already used\n      const isUsed = await this.isNullifierUsed(commitment.nullifierHash);\n      if (isUsed) {\n        throw new PrivacyError('This commitment has already been withdrawn');\n      }\n\n      // Generate Merkle proof\n      this.emit('withdraw:proof-generating', {});\n      const merkleProof = await this.getMerkleProof(commitment);\n      \n      // Generate ZK proof\n      const zkProof = await this.generateWithdrawProof({\n        commitment,\n        merkleProof,\n        recipient,\n      });\n      \n      this.emit('withdraw:proof-generated', {});\n\n      // Execute withdrawal\n      const tx = await this.contract.withdraw(\n        commitment.nullifierHash,\n        recipient,\n        cairo.uint256(amount),\n        zkProof.proof\n      );\n\n      // Wait for confirmation\n      await this.wallet.provider.waitForTransaction(tx.transaction_hash);\n\n      const result: WithdrawResult = {\n        txHash: tx.transaction_hash,\n        amount,\n        recipient,\n        nullifierHash: commitment.nullifierHash,\n      };\n\n      this.emit('withdraw:completed', { txHash: result.txHash, recipient });\n      \n      return result;\n    } catch (error) {\n      this.emit('withdraw:failed', { error: String(error) });\n      throw new PrivacyError(`Withdrawal failed: ${error}`, { error: String(error) });\n    }\n  }\n\n  // ============================================================================\n  // Proof Generation\n  // ============================================================================\n\n  /**\n   * Generate ZK proof for withdrawal\n   */\n  async generateWithdrawProof(params: {\n    commitment: Commitment;\n    merkleProof: MerkleProof;\n    recipient: string;\n  }): Promise<ZKProof> {\n    const { commitment, merkleProof, recipient } = params;\n\n    try {\n      // In production, this would call the Noir prover\n      // For now, return a mock proof structure\n      const proof: ZKProof = {\n        proof: [\n          commitment.nullifierHash,\n          merkleProof.root,\n          recipient,\n          // Additional proof elements would be here\n        ],\n        publicInputs: [\n          commitment.nullifierHash,\n          merkleProof.root,\n          recipient,\n          commitment.amount.toString(),\n        ],\n      };\n\n      return proof;\n    } catch (error) {\n      throw new ProofError(`Failed to generate proof: ${error}`);\n    }\n  }\n\n  /**\n   * Get Merkle proof for a commitment\n   */\n  async getMerkleProof(commitment: Commitment): Promise<MerkleProof> {\n    if (commitment.leafIndex === undefined) {\n      throw new PrivacyError('Commitment has no leaf index');\n    }\n\n    // Fetch all commitments from contract\n    const allCommitments = await this.getAllCommitments();\n    \n    // Generate proof\n    const proof = generateMerkleProof(allCommitments, commitment.leafIndex);\n    \n    return proof;\n  }\n\n  // ============================================================================\n  // View Functions\n  // ============================================================================\n\n  /**\n   * Get current Merkle root\n   */\n  async getMerkleRoot(): Promise<string> {\n    const result = await this.contract.get_merkle_root();\n    return result.toString();\n  }\n\n  /**\n   * Get anonymity set size\n   */\n  async getAnonymitySetSize(): Promise<number> {\n    const result = await this.contract.get_anonymity_set_size();\n    return Number(result);\n  }\n\n  /**\n   * Check if a nullifier has been used\n   */\n  async isNullifierUsed(nullifierHash: string): Promise<boolean> {\n    const result = await this.contract.is_nullifier_used(nullifierHash);\n    return Boolean(result);\n  }\n\n  /**\n   * Get all commitments from the contract\n   */\n  async getAllCommitments(): Promise<string[]> {\n    const size = await this.getAnonymitySetSize();\n    const commitments: string[] = [];\n    \n    for (let i = 0; i < size; i++) {\n      const commitment = await this.contract.get_commitment_at_index(i);\n      commitments.push(commitment.toString());\n    }\n    \n    return commitments;\n  }\n\n  /**\n   * Get mixer statistics\n   */\n  async getStats(): Promise<MixerStats> {\n    const anonymitySetSize = await this.getAnonymitySetSize();\n    \n    return {\n      totalDeposits: 0n, // Would need to query from events\n      totalWithdrawals: 0n,\n      anonymitySetSize,\n      activeCommitments: anonymitySetSize,\n    };\n  }\n\n  // ============================================================================\n  // Commitment Management\n  // ============================================================================\n\n  /**\n   * Store a commitment locally\n   */\n  storeCommitment(commitment: Commitment): void {\n    this.commitments.set(commitment.commitment, commitment);\n  }\n\n  /**\n   * Get stored commitment\n   */\n  getCommitment(commitmentHash: string): Commitment | undefined {\n    return this.commitments.get(commitmentHash);\n  }\n\n  /**\n   * List all stored commitments\n   */\n  listCommitments(): Commitment[] {\n    return Array.from(this.commitments.values());\n  }\n\n  /**\n   * Export commitments for backup\n   */\n  exportCommitments(): string {\n    const data = Array.from(this.commitments.values());\n    return JSON.stringify(data, (_, v) => typeof v === 'bigint' ? v.toString() : v);\n  }\n\n  /**\n   * Import commitments from backup\n   */\n  importCommitments(json: string): void {\n    const data = JSON.parse(json);\n    for (const c of data) {\n      const commitment: Commitment = {\n        ...c,\n        amount: BigInt(c.amount),\n      };\n      this.commitments.set(commitment.commitment, commitment);\n    }\n  }\n\n  // ============================================================================\n  // Private Methods\n  // ============================================================================\n\n  private extractLeafIndex(receipt: any): number {\n    // Extract leaf index from deposit event\n    const events = receipt.events || [];\n    for (const event of events) {\n      if (event.keys?.[0]?.includes('Deposit')) {\n        return Number(event.data?.[1] || 0);\n      }\n    }\n    return this.commitments.size;\n  }\n\n  private emit(type: string, data: Record<string, unknown>): void {\n    if (this.eventCallback) {\n      this.eventCallback({\n        type: type as any,\n        timestamp: Date.now(),\n        data,\n      });\n    }\n  }\n}\n\n// Export for direct import\nexport default PrivacyMixer;\n"]}